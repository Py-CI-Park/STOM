# 조건식 (Condition) - 시간대별 특화 조건식

- STOM 주식 자동거래에 사용하기 위한 분봉 기반 조건식 문서
- Back_Testing_Guideline_Min.md의 조건식을 사용하여 만든 조건식
- 아이디어.md의 "시간대별 특화 조건식"을 분봉 변수로 구현

## 소개

이 문서는 분봉 데이터를 활용한 시간대별 특화 매매 전략을 구현합니다. 
장 초반, 장 중, 장 마감 시간대별로 다른 전략을 적용합니다.

## 매수 조건식

```python
# 시간대 구분
장초반 = (시분 >= 900 and 시분 <= 1030)  # 장 시작 ~ 10:30
장중 = (시분 >= 1030 and 시분 <= 1430)   # 10:30 ~ 14:30
장마감 = (시분 >= 1430 and 시분 <= 1530) # 14:30 ~ 장 마감

# 기본 조건
if not (1000 < 현재가 <= 50000):
    매수 = False
elif not (0.5 < 등락율 <= 29.0):
    매수 = False
elif not (시가총액 >= 300):
    매수 = False

# 장초반 전략 (모멘텀 추종)
elif 장초반:
    # 개장 후 급등주 포착
    if not (등락율 >= 2.0):  # 2% 이상 상승
        매수 = False
    elif not (분당거래대금 >= 분당거래대금평균(5) * 2.0):  # 거래량 급증
        매수 = False
    elif not (현재가 > 시가 * 1.02):  # 시가 대비 2% 이상 상승
        매수 = False
    elif not (체결강도 >= 120):  # 강한 매수 우세
        매수 = False
    elif not (RSI(14) >= 60 and RSI(14) <= 80):  # RSI 강세
        매수 = False

# 장중 전략 (기술적 분석)
elif 장중:
    # 안정적인 기술적 매수 신호
    if not (현재가 > 이동평균(20)):  # 20분봉 이평선 위
        매수 = False
    elif not (RSI(14) >= 40 and RSI(14) <= 65):  # RSI 적정 구간
        매수 = False
    elif not (MACD(12, 26, 9) > MACD신호(12, 26, 9)):  # MACD 골든크로스
        매수 = False
    elif not (분당거래대금 >= 분당거래대금평균(20) * 1.3):
        매수 = False

# 장마감 전략 (단기 스캘핑)
elif 장마감:
    # 단기 반등 포착
    if not (현재가 > 현재가_N(1)):  # 직전 봉 대비 상승
        매수 = False
    elif not (분당매수량 > 분당매도량 * 1.2):  # 매수량 우세
        매수 = False
    elif not (체결강도 >= 110):
        매수 = False
    elif not (현재가 < 당일최고가 * 0.95):  # 고점 대비 5% 이하 하락
        매수 = False

else:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

## 매도 조건식

```python
# 시간대별 매도 전략
장초반 = (시분 >= 900 and 시분 <= 1030)
장중 = (시분 >= 1030 and 시분 <= 1430)
장마감 = (시분 >= 1430 and 시분 <= 1530)

# 장초반 매도 (빠른 수익 실현)
if 장초반:
    if 수익률 >= 3.0:  # 3% 빠른 수익 실현
        매도 = True
    elif 수익률 <= -1.5:  # 1.5% 빠른 손절
        매도 = True
    elif 보유시간 >= 30:  # 30분 빠른 매도
        매도 = True

# 장중 매도 (안정적 관리)
elif 장중:
    if 수익률 >= 5.0:  # 5% 수익 실현
        매도 = True
    elif 수익률 <= -2.5:  # 2.5% 손절
        매도 = True
    elif RSI(14) >= 75:  # RSI 과매수
        매도 = True
    elif 보유시간 >= 120:  # 2시간
        매도 = True

# 장마감 매도 (무조건 정리)
elif 장마감:
    if 수익률 >= 1.5:  # 1.5% 수익 실현
        매도 = True
    elif 수익률 <= -1.0:  # 1% 손절
        매도 = True
    elif 시분 >= 1520:  # 장 마감 10분 전 강제 매도
        매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

## 최적화 범위

```python
# 장초반 최적화
self.vars[0] = [[1.5, 3.0, 0.5], 2.0]    # 장초반_등락율기준
self.vars[1] = [[1.8, 2.5, 0.2], 2.0]    # 장초반_거래대금배수
self.vars[2] = [[2.0, 4.0, 0.5], 3.0]    # 장초반_수익실현기준

# 장중 최적화
self.vars[3] = [[35, 50, 5], 40]          # 장중_RSI하한
self.vars[4] = [[60, 75, 5], 65]          # 장중_RSI상한
self.vars[5] = [[4.0, 6.0, 0.5], 5.0]    # 장중_수익실현기준

# 장마감 최적화
self.vars[6] = [[1.1, 1.3, 0.1], 1.2]    # 장마감_매수량비율
self.vars[7] = [[1.0, 2.0, 0.5], 1.5]    # 장마감_수익실현기준
``` 