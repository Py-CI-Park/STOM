# 조건식 (Condition) - 변곡점 포착 조건식

- STOM 주식 자동거래에 사용하기 위한 분봉 기반 조건식 문서
- Back_Testing_Guideline_Min.md의 조건식을 사용하여 만든 조건식
- 아이디어.md의 "변곡점 포착 조건식"을 분봉 변수로 구현

## 소개

이 문서는 분봉 데이터를 활용한 변곡점 포착 전략을 구현합니다. 하락에서 상승으로 전환되는 변곡점을 감지하여 매수 타이밍을 찾습니다.

## 매수 조건식

```python
# 변곡점 감지를 위한 가격 분석
현재가격 = 현재가
이전가격1 = 현재가N(1)  # 1분 전
이전가격2 = 현재가N(2)  # 2분 전
이전가격3 = 현재가N(3)  # 3분 전
이전가격5 = 현재가N(5)  # 5분 전

# 이동평균선 계산
이동평균5 = 이동평균(5)
이동평균20 = 이동평균(20)
이동평균5_이전 = 이동평균(5, 1)
이동평균20_이전 = 이동평균(20, 1)

# RSI 계산
RSI_값 = RSI
RSI_이전 = RSI_N(1)

# 볼린저밴드 계산
BB_하단 = BBL
BB_중심 = BBM

# 변곡점 조건 1: 하락 후 반등 패턴
하락후반등 = False
if 현재가격 > 이전가격1 and 이전가격1 <= 이전가격2:  # 최근 반등
    if 현재가격 < 이전가격5 * 0.97:  # 5분 전 대비 하락 상태
        하락후반등 = True

# 변곡점 조건 2: RSI 과매도 반등
RSI_과매도반등 = False
if RSI_값 >= 25 and RSI_값 <= 45:  # 과매도 구간
    if RSI_값 > RSI_이전:  # RSI 상승 중
        RSI_과매도반등 = True

# 변곡점 조건 3: 볼린저밴드 하단 반등
BB_하단반등 = False
if 현재가격 <= BB_하단 * 1.02:  # 볼린저밴드 하단 근처
    if 현재가격 > 이전가격1:  # 반등 중
        BB_하단반등 = True

# 변곡점 조건 4: 이동평균선 지지
이동평균지지 = False
if 현재가격 >= 이동평균20 * 0.98:  # 20일선 근처 지지
    if 이동평균5 > 이동평균5_이전:  # 5일선 상승 중
        이동평균지지 = True

# 기본 조건 검증
if not (시분 >= 93000 and 시분 <= 150000):
    매수 = False
elif not (1000 < 현재가 <= 50000):
    매수 = False
elif not (0.5 < 등락율 <= 29.0):
    매수 = False
elif not (시가총액 >= 300):
    매수 = False

# 변곡점 조건 종합 (2개 이상 만족)
변곡점신호 = 0
if 하락후반등:
    변곡점신호 += 1
if RSI_과매도반등:
    변곡점신호 += 1
if BB_하단반등:
    변곡점신호 += 1
if 이동평균지지:
    변곡점신호 += 1

elif not (변곡점신호 >= 2):  # 2개 이상 신호 필요
    매수 = False

# 추가 필터링 조건
elif not (분당거래대금 >= 분당거래대금평균(20) * 1.2):
    매수 = False
elif not (체결강도 >= 100):
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

## 매도 조건식

```python
# 수익률 기반 매도
if 수익률 >= 5.0:  # 5% 수익 실현
    매도 = True
elif 수익률 <= -2.5:  # 2.5% 손절
    매도 = True

# 추적 손절
elif 최고수익률 >= 2.0 and (최고수익률 - 수익률) >= 1.5:
    매도 = True

# RSI 과매수 매도
elif RSI >= 75:
    매도 = True

# 시간 매도
elif 보유시간 >= 180:  # 3시간
    매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

## 최적화 범위

```python
# 매수 최적화
self.vars[0] = [[20, 35, 5], 25]         # RSI_하한
self.vars[1] = [[40, 55, 5], 45]         # RSI_상한
self.vars[2] = [[1.15, 1.3, 0.05], 1.2]  # 거래대금배수
self.vars[3] = [[1, 3, 1], 2]            # 변곡점신호최소개수

# 매도 최적화
self.vars[4] = [[3.0, 7.0, 1.0], 5.0]   # 수익실현기준
self.vars[5] = [[2.0, 3.5, 0.5], 2.5]   # 손절기준
self.vars[6] = [[120, 240, 30], 180]     # 보유시간기준
``` 