# 조건식 (Condition) - 종합 트레이딩 전략 20250101

- STOM 주식 자동거래에 사용하기 위한 분봉 기반 조건식 문서
- Back_Testing_Guideline_Min.md에 완전히 준수하여 만든 조건식
- 다양한 기술적 지표와 시장 조건을 종합한 안정적인 트레이딩 전략

## 목차
- [조건식 (Condition) - 종합 트레이딩 전략 20250101](#조건식-condition---종합-트레이딩-전략-20250101)
  - [목차](#목차)
  - [소개](#소개)
  - [가이드라인](#가이드라인)
    - [저장 이름 규칙](#저장-이름-규칙)
- [Condition - 종합 트레이딩 전략](#condition---종합-트레이딩-전략)
  - [조건식](#조건식)
    - [매수 조건식](#매수-조건식)
    - [매도 조건식](#매도-조건식)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식](#매수-최적화-조건식)
    - [매수 최적화 범위](#매수-최적화-범위)
    - [매도 최적화 조건식](#매도-최적화-조건식)
    - [매도 최적화 범위](#매도-최적화-범위)

## 소개

이 문서는 분봉 데이터를 활용한 종합적인 트레이딩 전략을 구현합니다. MACD, RSI, 볼린저밴드 등 다양한 기술적 지표와 거래량, 체결강도 등의 시장 데이터를 종합하여 안정적이고 수익성 높은 매매 신호를 생성합니다.

## 가이드라인

- 모든 조건식은 Python으로 작성되어 있으며, 분봉 데이터 기반 주식 거래의 자동화를 목표로 합니다.
- Back_Testing_Guideline_Min.md의 변수 사용법을 정확히 준수합니다.
- 다중 신호 확인을 통해 거짓 신호를 최소화하고 안정성을 극대화합니다.

### 저장 이름 규칙

- `C_MIN_COMP_2025_B`: 종합 전략 매수 조건식
- `C_MIN_COMP_2025_S`: 종합 전략 매도 조건식
- `C_MIN_COMP_2025_BO`: 종합 전략 매수 최적화 조건식
- `C_MIN_COMP_2025_SO`: 종합 전략 매도 최적화 조건식

---

# Condition - 종합 트레이딩 전략

## 조건식

### 매수 조건식

```python
# =============================================================================
# 종합 트레이딩 전략 매수 조건식
# 작성일: 2025-01-01
# 기반: Back_Testing_Guideline_Min.md 변수 사용법 준수
# =============================================================================

# 기본 변수 정의
현재가격 = 현재가
이전가격1 = 현재가N(1)
이전가격2 = 현재가N(2)
이전가격3 = 현재가N(3)

# 기술적 지표 변수
MACD_현재 = MACD
MACD_신호_현재 = MACDS
MACD_히스토그램_현재 = MACDH
MACD_이전 = MACD_N(1)
MACD_신호_이전 = MACDS_N(1)
MACD_히스토그램_이전 = MACDH_N(1)

RSI_현재 = RSI
RSI_이전1 = RSI_N(1)
RSI_이전2 = RSI_N(2)

볼린저_상단 = BBU
볼린저_중심 = BBM
볼린저_하단 = BBL
볼린저_상단_이전 = BBU_N(1)
볼린저_중심_이전 = BBM_N(1)
볼린저_하단_이전 = BBL_N(1)

# 이동평균선
이평5 = 이동평균(5)
이평20 = 이동평균(20)
이평60 = 이동평균(60)
이평5_이전 = 이동평균(5, 1)
이평20_이전 = 이동평균(20, 1)

# 거래량 및 체결강도 분석
분당거래대금_현재 = 분당거래대금
분당거래대금_평균20 = 분당거래대금평균(20)
분당거래대금_평균60 = 분당거래대금평균(60)
체결강도_현재 = 체결강도
체결강도_이전 = 체결강도N(1)

# =============================================================================
# 시장 상황 및 기본 조건 검증
# =============================================================================

# 시간 조건 (09:30:00 ~ 15:00:00)
if not (시분 >= 93000 and 시분 <= 150000):
    매수 = False

# 가격 범위 조건
elif not (1000 <= 현재가격 <= 100000):  # 1,000원 ~ 100,000원
    매수 = False

# 등락율 조건 (0.5% ~ 29.0%)
elif not (0.5 <= 등락율 <= 29.0):
    매수 = False

# 시가총액 조건 (500억원 이상)
elif not (시가총액 >= 500):
    매수 = False

# 유동성 조건 (당일거래대금 최소 100억원)
elif not (당일거래대금 >= 1000):
    매수 = False

# =============================================================================
# 기술적 분석 신호 생성
# =============================================================================

# 신호 점수 시스템 (최대 100점)
신호점수 = 0

# 1. MACD 신호 분석 (최대 25점)
MACD_신호점수 = 0
if MACD_현재 > MACD_신호_현재:  # MACD 라인이 시그널 라인 위
    MACD_신호점수 += 8
if MACD_히스토그램_현재 > 0:  # 히스토그램 양수
    MACD_신호점수 += 5
if MACD_히스토그램_현재 > MACD_히스토그램_이전:  # 히스토그램 증가
    MACD_신호점수 += 7
if MACD_현재 > MACD_이전:  # MACD 라인 상승
    MACD_신호점수 += 5

신호점수 += MACD_신호점수

# 2. RSI 신호 분석 (최대 20점)
RSI_신호점수 = 0
if 30 <= RSI_현재 <= 70:  # RSI 적정 범위
    RSI_신호점수 += 8
if RSI_현재 > RSI_이전1:  # RSI 상승
    RSI_신호점수 += 6
if RSI_이전1 < 50 and RSI_현재 >= 50:  # RSI 50선 돌파
    RSI_신호점수 += 6

신호점수 += RSI_신호점수

# 3. 볼린저밴드 신호 분석 (최대 20점)
볼린저_신호점수 = 0
볼린저_위치 = (현재가격 - 볼린저_하단) / (볼린저_상단 - 볼린저_하단)

if 0.2 <= 볼린저_위치 <= 0.8:  # 볼린저밴드 내 적정 위치
    볼린저_신호점수 += 8
if 현재가격 > 볼린저_중심:  # 중심선 위
    볼린저_신호점수 += 6
if 현재가격 > 볼린저_중심 and 이전가격1 <= 볼린저_중심_이전:  # 중심선 돌파
    볼린저_신호점수 += 6

신호점수 += 볼린저_신호점수

# 4. 이동평균선 신호 분석 (최대 20점)
이평_신호점수 = 0
if 이평5 > 이평20 > 이평60:  # 정배열
    이평_신호점수 += 10
if 현재가격 > 이평5:  # 5분봉 이평 위
    이평_신호점수 += 5
if 이평5 > 이평5_이전:  # 5분봉 이평 상승
    이평_신호점수 += 5

신호점수 += 이평_신호점수

# 5. 거래량 및 체결강도 신호 분석 (최대 15점)
거래량_신호점수 = 0
if 분당거래대금_현재 >= 분당거래대금_평균20 * 1.5:  # 거래량 증가
    거래량_신호점수 += 8
if 체결강도_현재 >= 120:  # 매수우세
    거래량_신호점수 += 7

신호점수 += 거래량_신호점수

# =============================================================================
# 추가 필터링 조건
# =============================================================================

# 기본 신호 점수 조건 (70점 이상)
elif not (신호점수 >= 70):
    매수 = False

# 분당매수/매도 수량 조건
elif not (분당매수수량 > 분당매도수량):
    매수 = False

# 회전율 조건 (유동성 확인)
elif not (회전율 >= 0.5):
    매수 = False

# 전일동시간비 조건 (관심도 확인)
elif not (전일동시간비 >= 120):
    매수 = False

# 가격 모멘텀 조건
elif not (현재가격 >= 최고분봉고가(10) * 1.005):  # 10분봉 고가 근처 돌파
    매수 = False

# 라운드피겨 회피
elif 라운드피겨위5호가이내:
    매수 = False

# =============================================================================
# 최종 매수 실행
# =============================================================================

# 최종 매수 조건 만족 시 실행
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식

```python
# =============================================================================
# 종합 트레이딩 전략 매도 조건식
# 작성일: 2025-01-01
# 기반: Back_Testing_Guideline_Min.md 변수 사용법 준수
# =============================================================================

# 현재 수익률 및 보유 정보
현재수익률 = 수익률
최고수익률_달성 = 최고수익률
최저수익률_기록 = 최저수익률
보유시간_분 = 보유시간
보유수량_현재 = 보유수량

# 기술적 지표 (매도 시점 분석)
RSI_현재 = RSI
RSI_이전 = RSI_N(1)
MACD_현재 = MACD
MACD_신호_현재 = MACDS
MACD_이전 = MACD_N(1)
MACD_신호_이전 = MACDS_N(1)
볼린저_상단 = BBU
볼린저_중심 = BBM

# 현재가격 및 이동평균
현재가격 = 현재가
이평20 = 이동평균(20)
이평20_이전 = 이동평균(20, 1)

# =============================================================================
# 수익실현 및 손절매 조건
# =============================================================================

# 상한가 근접 매도 (28% 이상)
if 등락율 >= 28.0:
    매도 = True

# 목표 수익률 달성 (7% 이상)
elif 현재수익률 >= 7.0:
    매도 = True

# 손절매 (-3% 이하)
elif 현재수익률 <= -3.0:
    매도 = True

# 추적 손절매 (최고 수익률 대비 하락)
elif 최고수익률_달성 >= 5.0 and (최고수익률_달성 - 현재수익률) >= 3.0:
    매도 = True

# =============================================================================
# 시간 기반 매도 조건
# =============================================================================

# 장시간 보유 매도 (6시간 = 360분)
elif 보유시간_분 >= 360:
    매도 = True

# 장마감 30분 전 강제 매도 (14:30:00)
elif 시분 >= 143000:
    매도 = True

# =============================================================================
# 기술적 지표 기반 매도 신호
# =============================================================================

# RSI 과매수 신호
elif RSI_현재 >= 75:
    매도 = True

# MACD 데드크로스 (하락 신호)
elif MACD_현재 < MACD_신호_현재 and MACD_이전 >= MACD_신호_이전:
    매도 = True

# 볼린저밴드 상단 이탈 후 하락
elif 현재가격 < 볼린저_상단 and 현재가N(1) >= BBU_N(1):
    매도 = True

# 이동평균선 하향 이탈
elif 현재가격 < 이평20 and 이평20 < 이평20_이전:
    매도 = True

# =============================================================================
# 거래량 및 시장 상황 기반 매도
# =============================================================================

# 거래량 급감 신호
elif 분당거래대금 < 분당거래대금평균(10) * 0.4:
    매도 = True

# 체결강도 급격 약화 (매도 우세)
elif 체결강도 < 70 and 분당매도수량 > 분당매수수량 * 2.0:
    매도 = True

# =============================================================================
# 수익 보호 및 안전 매도
# =============================================================================

# 소폭 수익 + 보유시간 조건 (2% 수익 + 2시간 보유)
elif 현재수익률 >= 2.0 and 보유시간_분 >= 120:
    매도 = True

# 등락율 급락 신호 (당일 등락율이 음수로 전환)
elif 등락율 < 0 and 현재수익률 >= 1.0:  # 1% 이상 수익 시 안전 매도
    매도 = True

# =============================================================================
# 최종 매도 실행
# =============================================================================

# 최종 매도 조건 만족 시 실행
if 매도:
    self.Sell(종목코드, 종목명, 보유수량_현재, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

## 최적화 조건식

### 매수 최적화 조건식

```python
# =============================================================================
# 종합 트레이딩 전략 매수 최적화 조건식
# 작성일: 2025-01-01
# =============================================================================

# 최적화 변수 정의
신호점수_임계값 = self.vars[0]  # 매수 신호 점수 임계값
거래대금_배수 = self.vars[1]    # 분당거래대금 배수
체결강도_임계값 = self.vars[2]  # 체결강도 임계값
RSI_하한 = self.vars[3]         # RSI 하한값
RSI_상한 = self.vars[4]         # RSI 상한값
이평기간_단기 = self.vars[5]     # 단기 이동평균 기간
이평기간_장기 = self.vars[6]     # 장기 이동평균 기간
볼린저_위치_하한 = self.vars[7]  # 볼린저밴드 위치 하한
볼린저_위치_상한 = self.vars[8]  # 볼린저밴드 위치 상한

# 기본 변수 정의 (동일)
현재가격 = 현재가
MACD_현재 = MACD
MACD_신호_현재 = MACDS
MACD_히스토그램_현재 = MACDH
RSI_현재 = RSI
볼린저_상단 = BBU
볼린저_중심 = BBM
볼린저_하단 = BBL

# 최적화된 이동평균
이평_단기 = 이동평균(이평기간_단기)
이평_장기 = 이동평균(이평기간_장기)

# 기본 조건 (동일)
if not (시분 >= 93000 and 시분 <= 150000):
    매수 = False
elif not (1000 <= 현재가격 <= 100000):
    매수 = False
elif not (0.5 <= 등락율 <= 29.0):
    매수 = False
elif not (시가총액 >= 500):
    매수 = False

# 최적화된 신호 분석
신호점수 = 0

# MACD 신호 (가중치 적용)
if MACD_현재 > MACD_신호_현재:
    신호점수 += 25
if MACD_히스토그램_현재 > 0:
    신호점수 += 15

# RSI 신호 (최적화된 범위)
if RSI_하한 <= RSI_현재 <= RSI_상한:
    신호점수 += 20

# 볼린저밴드 신호 (최적화된 위치)
볼린저_위치 = (현재가격 - 볼린저_하단) / (볼린저_상단 - 볼린저_하단)
if 볼린저_위치_하한 <= 볼린저_위치 <= 볼린저_위치_상한:
    신호점수 += 20

# 이동평균 신호 (최적화된 기간)
if 이평_단기 > 이평_장기 and 현재가격 > 이평_단기:
    신호점수 += 20

# 최적화된 조건 적용
elif not (신호점수 >= 신호점수_임계값):
    매수 = False
elif not (분당거래대금 >= 분당거래대금평균(20) * 거래대금_배수):
    매수 = False
elif not (체결강도 >= 체결강도_임계값):
    매수 = False
elif not (분당매수수량 > 분당매도수량):
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위

```
self.vars[0] = [50, 60, 70, 80, 90]     # 신호점수_임계값
self.vars[1] = [1.2, 1.5, 2.0, 2.5, 3.0] # 거래대금_배수
self.vars[2] = [100, 110, 120, 130, 140] # 체결강도_임계값
self.vars[3] = [20, 25, 30, 35, 40]     # RSI_하한
self.vars[4] = [60, 65, 70, 75, 80]     # RSI_상한
self.vars[5] = [3, 5, 7, 10, 15]        # 이평기간_단기
self.vars[6] = [15, 20, 30, 40, 60]     # 이평기간_장기
self.vars[7] = [0.1, 0.2, 0.3, 0.4]    # 볼린저_위치_하한
self.vars[8] = [0.6, 0.7, 0.8, 0.9]    # 볼린저_위치_상한
```

### 매도 최적화 조건식

```python
# =============================================================================
# 종합 트레이딩 전략 매도 최적화 조건식
# 작성일: 2025-01-01
# =============================================================================

# 최적화 변수 정의
목표수익률 = self.vars[0]      # 목표 수익률
손절매_수익률 = self.vars[1]   # 손절매 수익률
추적손절_기준 = self.vars[2]   # 추적손절 기준 수익률
추적손절_폭 = self.vars[3]     # 추적손절 하락폭
최대보유시간 = self.vars[4]    # 최대 보유시간
RSI_과매수_기준 = self.vars[5] # RSI 과매수 기준

# 기본 변수
현재수익률 = 수익률
최고수익률_달성 = 최고수익률
보유시간_분 = 보유시간
RSI_현재 = RSI

# 기본 매도 조건
if 등락율 >= 28.0:  # 상한가 근접
    매도 = True
elif 현재수익률 >= 목표수익률:  # 최적화된 목표 수익률
    매도 = True
elif 현재수익률 <= 손절매_수익률:  # 최적화된 손절매
    매도 = True
elif 최고수익률_달성 >= 추적손절_기준 and (최고수익률_달성 - 현재수익률) >= 추적손절_폭:
    매도 = True
elif 보유시간_분 >= 최대보유시간:  # 최적화된 보유시간
    매도 = True
elif RSI_현재 >= RSI_과매수_기준:  # 최적화된 RSI 과매수
    매도 = True
elif 시분 >= 143000:  # 장마감 30분전
    매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 최적화 범위

```
self.vars[0] = [3.0, 5.0, 7.0, 10.0, 15.0]  # 목표수익률
self.vars[1] = [-2.0, -3.0, -4.0, -5.0]     # 손절매_수익률
self.vars[2] = [3.0, 5.0, 7.0, 10.0]        # 추적손절_기준
self.vars[3] = [1.5, 2.0, 3.0, 4.0]         # 추적손절_폭
self.vars[4] = [120, 180, 240, 300, 360]    # 최대보유시간(분)
self.vars[5] = [70, 75, 80, 85]             # RSI_과매수_기준
```

---

**작성일: 2025-01-01**  
**문서버전: 1.0**  
**준수기준: Back_Testing_Guideline_Min.md** 