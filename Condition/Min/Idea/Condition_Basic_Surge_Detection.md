# 조건식 (Condition) - 기본 급등 포착 전략

- STOM 주식 자동거래에 사용하기 위한 분봉 기반 조건식 문서
- Back_Testing_Guideline_Min.md 에 있는 조건식을 사용하여 만든 조건식
- 아이디어.md의 "기본 급등 포착 조건식"을 분봉 변수로 구현

## 목차
- [조건식 (Condition) - 기본 급등 포착 전략](#조건식-condition---기본-급등-포착-전략)
  - [목차](#목차)
  - [소개](#소개)
  - [가이드라인](#가이드라인)
    - [저장 이름 규칙](#저장-이름-규칙)
- [Condition - 기본 급등 포착](#condition---기본-급등-포착)
  - [조건식](#조건식)
    - [매수 조건식](#매수-조건식)
    - [매도 조건식](#매도-조건식)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식](#매수-최적화-조건식)
    - [매수 최적화 범위](#매수-최적화-범위)
    - [매도 최적화 조건식](#매도-최적화-조건식)
    - [매도 최적화 범위](#매도-최적화-범위)
    - [매수 매도 최적화 범위](#매수-매도-최적화-범위)
    - [GA 최적화 범위](#ga-최적화-범위)

## 소개

이 문서는 분봉 데이터를 활용한 기본 급등 포착 전략을 구현합니다. 거래대금 증가와 기술적 지표 확인을 통해 안정적인 급등 종목을 포착하는 것을 목표로 합니다.

## 가이드라인

- 모든 조건식은 Python으로 작성되어 있으며, 분봉 데이터 기반 주식 거래의 자동화를 목표로 합니다.
- 분봉 변수와 TA-Lib 지표를 활용하여 급등 신호를 포착합니다.
- 최적화 조건식은 변수의 범위를 설정하여 최적의 매수/매도 시점을 찾습니다.

### 저장 이름 규칙

- `C_MIN_SURGE_B`: 기본 급등 포착 매수 조건식
- `C_MIN_SURGE_S`: 기본 급등 포착 매도 조건식
- `C_MIN_SURGE_BO`: 기본 급등 포착 매수 최적화 조건식
- `C_MIN_SURGE_SO`: 기본 급등 포착 매도 최적화 조건식

---

# Condition - 기본 급등 포착

## 조건식

### 매수 조건식

```python
# 기본 계산 변수들
전일종가 = 현재가 / (1 + (등락율 / 100))
시가대비등락율 = ((현재가 - 시가) / 시가) * 100

# 공통 선결 조건
if not (시분 >= 93000 and 시분 <= 150000):
    매수 = False
elif not (1000 < 현재가 <= 50000):
    매수 = False
elif not (0.5 < 등락율 <= 29.0):
    매수 = False
elif not (시가총액 >= 500):  # 500억원 이상
    매수 = False

# 거래대금 기반 급등 포착 조건
elif not (분당거래대금 >= 분당거래대금평균(20) * 2.0):
    매수 = False
elif not (당일거래대금 >= 1000):  # 1000백만원 (100억) 이상
    매수 = False
elif not (전일동시간비 >= 150):  # 전일 동시간대 대비 150% 이상
    매수 = False

# 가격 조건
elif not (현재가 >= 최고분봉고가(5) * 1.015):  # 5분봉 최고가 대비 1.5% 이상 상승
    매수 = False
elif not (현재가 >= 시가 * 1.03):  # 시가 대비 3% 이상 상승
    매수 = False

# 기술적 지표 조건
elif not (현재가 > 이동평균(5)):  # 5분봉 이동평균선 위
    매수 = False
elif not (50 <= RSI <= 70):  # RSI 과매수 구간 제외
    매수 = False
elif not (MACDH > 0):  # MACD 히스토그램 양수
    매수 = False

# 체결강도 및 거래량 조건
elif not (체결강도 >= 120):
    매수 = False
elif not (분당매수수량 > 분당매도수량):  # 매수우세
    매수 = False
elif not (회전율 > 0.5):  # 적절한 유동성
    매수 = False

# 추가 안전장치
elif 라운드피겨위5호가이내:  # 라운드피겨 근처 제외
    매수 = False

# 최종 매수 실행
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식

```python
# 상한가 근접 매도
if 등락율 > 28.0:
    매도 = True

# 수익 실현
elif 수익률 >= 5.0:
    매도 = True

# 손절매
elif 수익률 <= -3.0:
    매도 = True

# 추적 손절 (최고 수익률 대비 하락)
elif 최고수익률 >= 3.0 and (최고수익률 - 수익률) >= 2.0:
    매도 = True

# 시간 매도 (4시간 이상 보유)
elif 보유시간 >= 240:
    매도 = True

# 기술적 지표 매도 신호
elif RSI > 80:  # 과매수
    매도 = True
elif MACD < MACDS and MACD_N(1) >= MACDS_N(1):  # MACD 데드크로스
    매도 = True
elif 현재가 < 이동평균(20) and 이동평균(20) < 이동평균(20, 1):  # 이평선 하향 돌파
    매도 = True

# 거래량 감소 신호
elif 분당거래대금 < 분당거래대금평균(10) * 0.5:  # 거래량 급감
    매도 = True

# 체결강도 약화
elif 체결강도 < 80 and 분당매도수량 > 분당매수수량 * 1.5:
    매도 = True

# 최종 매도 실행
if 매도:
    self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

## 최적화 조건식

### 매수 최적화 조건식

```python
# 최적화 변수들
거래대금배수 = self.vars[0]  # 분당거래대금 배수
전일동시간배수 = self.vars[1]  # 전일동시간비 배수
가격돌파배수 = self.vars[2]  # 가격 돌파 배수
시가상승배수 = self.vars[3]  # 시가 대비 상승 배수
RSI하한 = self.vars[4]  # RSI 하한값
RSI상한 = self.vars[5]  # RSI 상한값
체결강도기준 = self.vars[6]  # 체결강도 기준값
이동평균기간 = self.vars[7]  # 이동평균 기간

# 계산 변수들
전일종가 = 현재가 / (1 + (등락율 / 100))
시가대비등락율 = ((현재가 - 시가) / 시가) * 100

# 공통 선결 조건
if not (시분 >= 93000 and 시분 <= 150000):
    매수 = False
elif not (1000 < 현재가 <= 50000):
    매수 = False
elif not (0.5 < 등락율 <= 29.0):
    매수 = False
elif not (시가총액 >= 500):
    매수 = False

# 최적화된 거래대금 조건
elif not (분당거래대금 >= 분당거래대금평균(20) * 거래대금배수):
    매수 = False
elif not (당일거래대금 >= 1000):
    매수 = False
elif not (전일동시간비 >= 전일동시간배수):
    매수 = False

# 최적화된 가격 조건
elif not (현재가 >= 최고분봉고가(5) * 가격돌파배수):
    매수 = False
elif not (현재가 >= 시가 * 시가상승배수):
    매수 = False

# 최적화된 기술적 지표 조건
elif not (현재가 > 이동평균(이동평균기간)):
    매수 = False
elif not (RSI하한 <= RSI <= RSI상한):
    매수 = False
elif not (MACDH > 0):
    매수 = False

# 최적화된 체결강도 조건
elif not (체결강도 >= 체결강도기준):
    매수 = False
elif not (분당매수수량 > 분당매도수량):
    매수 = False
elif not (회전율 > 0.5):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위

```python
self.vars[0] = [[1.5, 3.0, 0.1], 2.0]      # 거래대금배수
self.vars[1] = [[120, 200, 10], 150]       # 전일동시간배수
self.vars[2] = [[1.01, 1.03, 0.005], 1.015] # 가격돌파배수
self.vars[3] = [[1.02, 1.05, 0.005], 1.03]  # 시가상승배수
self.vars[4] = [[40, 60, 5], 50]            # RSI하한
self.vars[5] = [[65, 80, 5], 70]            # RSI상한
self.vars[6] = [[100, 150, 10], 120]        # 체결강도기준
self.vars[7] = [[3, 10, 1], 5]              # 이동평균기간
```

### 매도 최적화 조건식

```python
# 최적화 변수들
수익실현배수 = self.vars[0]  # 수익 실현 기준
손절배수 = self.vars[1]      # 손절 기준
추적손절배수 = self.vars[2]  # 추적 손절 기준
보유시간기준 = self.vars[3]  # 최대 보유시간
RSI과매수기준 = self.vars[4] # RSI 과매수 기준

# 상한가 근접 매도
if 등락율 > 28.0:
    매도 = True

# 최적화된 수익 실현
elif 수익률 >= 수익실현배수:
    매도 = True

# 최적화된 손절매
elif 수익률 <= -손절배수:
    매도 = True

# 최적화된 추적 손절
elif 최고수익률 >= 3.0 and (최고수익률 - 수익률) >= 추적손절배수:
    매도 = True

# 최적화된 시간 매도
elif 보유시간 >= 보유시간기준:
    매도 = True

# 최적화된 기술적 지표 매도
elif RSI > RSI과매수기준:
    매도 = True
elif MACD < MACDS and MACD_N(1) >= MACDS_N(1):
    매도 = True
elif 현재가 < 이동평균(20) and 이동평균(20) < 이동평균(20, 1):
    매도 = True
elif 분당거래대금 < 분당거래대금평균(10) * 0.5:
    매도 = True
elif 체결강도 < 80 and 분당매도수량 > 분당매수수량 * 1.5:
    매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 최적화 범위

```python
self.vars[0] = [[3.0, 8.0, 0.5], 5.0]      # 수익실현배수
self.vars[1] = [[2.0, 5.0, 0.5], 3.0]      # 손절배수
self.vars[2] = [[1.5, 3.0, 0.5], 2.0]      # 추적손절배수
self.vars[3] = [[180, 360, 30], 240]       # 보유시간기준
self.vars[4] = [[75, 85, 2], 80]           # RSI과매수기준
```

### 매수 매도 최적화 범위

```python
# 매수 최적화 범위
self.vars[0] = [[1.5, 3.0, 0.1], 2.0]      # 거래대금배수
self.vars[1] = [[120, 200, 10], 150]       # 전일동시간배수
self.vars[2] = [[1.01, 1.03, 0.005], 1.015] # 가격돌파배수
self.vars[3] = [[1.02, 1.05, 0.005], 1.03]  # 시가상승배수
self.vars[4] = [[40, 60, 5], 50]            # RSI하한
self.vars[5] = [[65, 80, 5], 70]            # RSI상한
self.vars[6] = [[100, 150, 10], 120]        # 체결강도기준
self.vars[7] = [[3, 10, 1], 5]              # 이동평균기간

# 매도 최적화 범위
self.vars[8] = [[3.0, 8.0, 0.5], 5.0]      # 수익실현배수
self.vars[9] = [[2.0, 5.0, 0.5], 3.0]      # 손절배수
self.vars[10] = [[1.5, 3.0, 0.5], 2.0]     # 추적손절배수
self.vars[11] = [[180, 360, 30], 240]      # 보유시간기준
self.vars[12] = [[75, 85, 2], 80]          # RSI과매수기준
```

### GA 최적화 범위

```python
# 매수 GA 최적화 범위
self.vars[0] = [[1.5, 1.7, 1.9, 2.1, 2.3, 2.5, 2.7, 2.9], 2.0]  # 거래대금배수
self.vars[1] = [[120, 130, 140, 150, 160, 170, 180, 190], 150]    # 전일동시간배수
self.vars[2] = [[1.01, 1.015, 1.02, 1.025, 1.03], 1.015]         # 가격돌파배수
self.vars[3] = [[1.02, 1.025, 1.03, 1.035, 1.04, 1.045, 1.05], 1.03] # 시가상승배수
self.vars[4] = [[40, 45, 50, 55, 60], 50]                        # RSI하한
self.vars[5] = [[65, 67, 70, 72, 75, 77, 80], 70]               # RSI상한
self.vars[6] = [[100, 110, 120, 130, 140, 150], 120]            # 체결강도기준
self.vars[7] = [[3, 5, 7, 10], 5]                               # 이동평균기간

# 매도 GA 최적화 범위
self.vars[8] = [[3.0, 4.0, 5.0, 6.0, 7.0, 8.0], 5.0]           # 수익실현배수
self.vars[9] = [[2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0], 3.0]      # 손절배수
self.vars[10] = [[1.5, 2.0, 2.5, 3.0], 2.0]                    # 추적손절배수
self.vars[11] = [[180, 210, 240, 270, 300, 330, 360], 240]      # 보유시간기준
self.vars[12] = [[75, 77, 80, 82, 85], 80]                      # RSI과매수기준
``` 