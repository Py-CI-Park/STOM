# 조건식 (Condition) - 고급 알고리즘 전략

- STOM 주식 자동거래에 사용하기 위한 분봉 기반 조건식 문서
- Back_Testing_Guideline_Min.md의 조건식을 사용하여 만든 조건식
- 아이디어.md의 "고급 알고리즘 전략"을 분봉 변수로 구현

## 소개

이 문서는 분봉 데이터를 활용한 고급 알고리즘 매매 전략을 구현합니다.
평균 회귀, 모멘텀, 쌍거래 등 다양한 전략을 통합한 복합 알고리즘입니다.

## 매수 조건식

```python
# 고급 알고리즘 전략
매수 = False

# 기본 필터
if not (1000 < 현재가 <= 50000):
    매수 = False
elif not (0.5 < 등락율 <= 29.0):
    매수 = False
elif not (시가총액 >= 300):
    매수 = False

# 전략 1: 평균 회귀 전략 (Mean Reversion)
elif RSI(14) <= 30 and 현재가 < 이동평균(20) * 0.97:
    # 과매도 + 이평선 하단 이탈
    if 분당매수량 > 분당매도량:  # 매수 반전 신호
        평균회귀점수 = 1
    else:
        평균회귀점수 = 0
else:
    평균회귀점수 = 0

# 전략 2: 모멘텀 전략
if 등락율 >= 3.0 and 체결강도 >= 130:
    # 급등 + 매수 강세
    if 분당거래대금 >= 분당거래대금평균(10) * 2.0:
        모멘텀점수 = 1
    else:
        모멘텀점수 = 0
else:
    모멘텀점수 = 0

# 전략 3: 기술적 분석 전략
if MACD(12, 26, 9) > MACD신호(12, 26, 9):  # MACD 골든크로스
    if RSI(14) >= 50 and RSI(14) <= 70:  # RSI 적정 구간
        if 현재가 > 이동평균(5):  # 단기 이평선 위
            기술적점수 = 1
        else:
            기술적점수 = 0
    else:
        기술적점수 = 0
else:
    기술적점수 = 0

# 전략 4: 볼린저밴드 전략
볼린저상단 = 이동평균(20) + (표준편차(20) * 2)
볼린저하단 = 이동평균(20) - (표준편차(20) * 2)
볼린저중간 = 이동평균(20)

if 현재가 <= 볼린저하단 * 1.02:  # 하단 근접
    if 현재가 > 현재가_N(1):  # 반등 시작
        볼린저점수 = 1
    else:
        볼린저점수 = 0
else:
    볼린저점수 = 0

# 전략 5: 거래량 분석 전략
if 분당거래대금 >= 분당거래대금평균(5) * 1.5:  # 거래량 증가
    if 분당매수량 / (분당매수량 + 분당매도량) >= 0.6:  # 매수 비중 60% 이상
        거래량점수 = 1
    else:
        거래량점수 = 0
else:
    거래량점수 = 0

# 최종 매수 결정 (가중 평균 점수 시스템)
총점수 = (평균회귀점수 * 1.5) + (모멘텀점수 * 2.0) + (기술적점수 * 1.8) + (볼린저점수 * 1.2) + (거래량점수 * 1.0)

# 시간대별 가중치 적용
if 시분 >= 900 and 시분 <= 1000:  # 장 초반
    시간가중치 = 1.2
elif 시분 >= 1000 and 시분 <= 1500:  # 장 중
    시간가중치 = 1.0
elif 시분 >= 1500 and 시분 <= 1530:  # 장 마감
    시간가중치 = 0.8
else:
    시간가중치 = 0.5

최종점수 = 총점수 * 시간가중치

# 매수 조건
if 최종점수 >= 3.0:  # 임계값 이상
    매수 = True

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

## 매도 조건식

```python
# 고급 알고리즘 매도 전략
매도 = False

# 수익률 기반 매도
if 수익률 >= 5.0:  # 5% 이상 수익
    매도 = True
    매도사유 = "목표수익달성"

# 손실률 기반 매도
elif 수익률 <= -3.0:  # -3% 이하 손실
    매도 = True
    매도사유 = "손절"

# 기술적 매도 신호
elif RSI(14) >= 75:  # 과매수
    if 수익률 >= 2.0:  # 2% 이상 수익 시
        매도 = True
        매도사유 = "RSI과매수"

# MACD 매도 신호
elif MACD(12, 26, 9) < MACD신호(12, 26, 9):  # 데드크로스
    if 수익률 >= 1.0:  # 1% 이상 수익 시
        매도 = True
        매도사유 = "MACD데드크로스"

# 볼린저밴드 매도 신호
elif 현재가 >= 볼린저상단 * 0.98:  # 상단 근접
    if 수익률 >= 2.0:
        매도 = True
        매도사유 = "볼린저상단"

# 거래량 기반 매도
elif 분당매도량 > 분당매수량 * 2.0:  # 매도량 급증
    if 수익률 >= 1.5:
        매도 = True
        매도사유 = "매도량급증"

# 시간 기반 매도
elif 보유시간 >= 120:  # 2시간 보유
    if 수익률 >= 1.0:  # 1% 이상 수익 시
        매도 = True
        매도사유 = "시간매도"

# 체결강도 약화
elif 체결강도 <= 80:  # 매수 세력 약화
    if 수익률 >= 2.0:
        매도 = True
        매도사유 = "체결강도약화"

if 매도:
    self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

## 최적화 범위

```python
# 점수 가중치 최적화
self.vars[0] = [[1.0, 2.0, 0.2], 1.5]      # 평균회귀_가중치
self.vars[1] = [[1.5, 2.5, 0.2], 2.0]      # 모멘텀_가중치
self.vars[2] = [[1.5, 2.2, 0.2], 1.8]      # 기술적_가중치
self.vars[3] = [[1.0, 1.5, 0.1], 1.2]      # 볼린저_가중치
self.vars[4] = [[0.8, 1.2, 0.1], 1.0]      # 거래량_가중치

# 매수 임계값 최적화
self.vars[5] = [[2.5, 4.0, 0.5], 3.0]      # 매수_임계점수

# 매도 조건 최적화
self.vars[6] = [[4.0, 6.0, 0.5], 5.0]      # 목표수익률
self.vars[7] = [[-4.0, -2.0, 0.5], -3.0]   # 손절률
self.vars[8] = [[70, 80, 2], 75]            # RSI_과매수기준

# 시간 가중치 최적화
self.vars[9] = [[1.0, 1.5, 0.1], 1.2]      # 장초반_시간가중치
self.vars[10] = [[0.6, 1.0, 0.1], 0.8]     # 장마감_시간가중치
``` 