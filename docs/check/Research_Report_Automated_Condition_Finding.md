# AI/ML 기반 자동 조건식 발굴 및 최적화 연구 보고서

## 1. 개요
본 문서는 STOM 주식 자동거래 시스템의 조건식 발굴 및 최적화 과정을 자동화하기 위한 연구 보고서이다. 기존의 수동 조건식 작성 및 제한적인 최적화 방식에서 벗어나, AI, Machine Learning, Deep Learning, Reinforcement Learning 기술을 도입하여 시장의 패턴을 자동으로 학습하고 수익성 높은 조건식을 발굴하는 것을 목표로 한다.

## 2. 현황 및 문제점 분석
### 2.1. 현재 방식 (AS-IS)
- **수동 조건 작성**: 사용자가 경험과 직관에 의존하여 `Condition_Find_X.md`와 같은 조건식 문서를 작성.
- **제한적 최적화**: 작성된 조건식의 구조 내에서 변수(Threshold) 값만을 Genetic Algorithm(GA)으로 최적화.
- **한계점**:
  - **탐색 공간의 한계**: 사람이 생각하지 못한 변수 조합이나 복잡한 비선형 관계를 놓칠 수 있음.
  - **시간 소모**: 유효한 조건식을 찾기 위해 수많은 시행착오가 필요함.
  - **과적합(Overfitting)**: 특정 기간에만 맞는 파라미터를 찾을 위험이 높음.

## 3. 기술적 접근 방법 (Methodology)

### 3.1. 변수 선정 및 특징 추출 (Feature Engineering)
어떤 변수(Factor)가 수익률에 결정적인 영향을 미치는지 자동으로 분석한다.
- **Feature Importance Analysis**:
  - **XGBoost / LightGBM / CatBoost**: 트리 기반 모델을 사용하여 각 변수(체결강도, 거래대금, 호가 잔량 등)의 중요도를 산출.
  - **SHAP (SHapley Additive exPlanations)**: 모델의 예측 결과에 각 변수가 기여한 정도를 해석하여, "왜" 이 조건이 좋은지 설명 가능하게 함.
- **Autoencoder (Deep Learning)**:
  - 고차원의 틱/분 데이터를 저차원으로 압축하여 노이즈를 제거하고, 시장의 숨겨진 특징(Latent Features)을 추출.

### 3.2. 조건식 구조 자동 생성 (Condition Generation)
사람이 코드를 짜는 것이 아니라, AI가 조건식 로직(`if ... else ...`) 자체를 생성한다.
- **Genetic Programming (GP)**:
  - **개념**: 진화 연산의 일종으로, 프로그램 코드(수식 트리) 자체를 유전자처럼 교배(Crossover)하고 변이(Mutation)시켜 더 나은 로직으로 진화시킴.
  - **적용**: `DEAP` 라이브러리 등을 활용하여 `AND`, `OR`, `NOT`, `>`, `<` 등의 연산자와 기술적 지표를 조합해 최적의 진입 조건을 탐색.
- **LLM (Large Language Models)**:
  - **개념**: GPT-4, Claude 3.5 Sonnet 등 고성능 LLM 활용.
  - **적용**: 기존의 우수한 조건식 패턴을 Few-shot으로 학습시키고, 현재 시장 트렌드에 맞는 새로운 Python 조건식 코드를 생성하도록 프롬프팅. 백테스팅 결과(에러, 수익률)를 피드백으로 주어 코드를 수정(Refinement)하게 함.

### 3.3. 파라미터 최적화 고도화 (Optimization)
- **Bayesian Optimization (베이지안 최적화)**:
  - **도구**: `Optuna`, `Hyperopt`.
  - **장점**: 기존 Grid Search나 Random Search보다 효율적으로 전역 최적해(Global Optimum)를 탐색. 이전 시도의 결과를 바탕으로 다음 탐색 지점을 결정하므로 수렴 속도가 빠름.
- **Reinforcement Learning (강화학습)**:
  - **개념**: 에이전트(Agent)가 환경(시장)과 상호작용하며 보상(수익)을 최대화하는 행동(매수/매도/관망)을 학습.
  - **도구**: `Stable Baselines3`, `Gymnasium`, `FinRL`.
  - **적용**: 정적인 조건식(Rule-based)을 넘어, 시장 상황(State)에 따라 동적으로 대응하는 정책(Policy)을 학습.

## 4. 자동화 시스템 아키텍처 (CLI 기반)

CLI(Command Line Interface)를 통해 전체 파이프라인을 제어하고 자동화한다.

### 4.1. Workflow
1.  **Data Ingestion**: DB에서 학습 데이터 로드 (Tick/Min).
2.  **Feature Selection**: XGBoost 등으로 유효 변수 필터링.
3.  **Strategy Generation**:
    *   **Mode A (GP)**: 유전 프로그래밍으로 수식 트리 진화.
    *   **Mode B (LLM)**: LLM API를 통해 Python 조건식 코드 생성.
4.  **Backtesting & Evaluation**: 생성된 전략을 백테스팅 엔진(`backtester/`)에서 검증.
5.  **Optimization**: 선정된 전략의 파라미터를 Optuna로 정밀 튜닝.
6.  **Reporting**: 결과 리포트(MD 파일) 자동 생성 및 `docs/Condition/AutoGenerated` 저장.

### 4.2. 디렉토리 구조 제안
```
STOM_V1/
├── ai_research/              # 신규 AI 연구 모듈
│   ├── feature_engineering/  # 변수 중요도 분석
│   ├── generation/           # GP, LLM 조건 생성기
│   ├── optimization/         # Optuna, RL 학습기
│   └── cli.py                # 통합 제어 CLI
└── docs/
    └── Condition/
        └── AutoGenerated/    # AI가 생성한 조건식 저장소
```

## 5. 단계별 개발 계획 (Roadmap)

### Phase 1: 데이터 분석 및 변수 발굴 (1개월)
- **목표**: 어떤 변수가 중요한지 파악하고, 데이터 전처리 파이프라인 구축.
- **액션**:
  - `backtester`의 데이터를 Pandas DataFrame으로 변환하여 ML 모델 학습용 데이터셋 구축.
  - XGBoost를 활용한 Feature Importance 리포트 생성 기능 개발.

### Phase 2: 조건식 자동 생성 프로토타입 (2개월)
- **목표**: 사람이 개입하지 않고 조건식 코드를 생성.
- **액션**:
  - Genetic Programming(DEAP)을 이용한 간단한 수식 생성기 구현.
  - 생성된 수식을 기존 `backtester`와 연동하여 수익률 검증.

### Phase 3: 최적화 고도화 및 LLM 연동 (3개월)
- **목표**: 최적화 효율 증대 및 복잡한 로직 생성.
- **액션**:
  - `Optuna`를 도입하여 기존 GA 대체 또는 보완.
  - LLM API를 연동하여 "최근 3일간 하락세인 종목 중 거래량 급증 종목"과 같은 자연어 쿼리로 조건식 생성 기능 구현.

### Phase 4: 강화학습 및 완전 자동화 (6개월~)
- **목표**: 동적 시장 대응 및 시스템 완전 자동화.
- **액션**:
  - 강화학습 환경(Environment) 구축.
  - 매일 장 마감 후 자동으로 새로운 전략을 발굴하고 검증하는 Cron Job 스케줄링.

## 6. 결론
본 연구를 통해 STOM 시스템은 단순한 룰 기반 시스템에서 데이터 기반의 지능형 트레이딩 시스템으로 진화할 수 있다. 초기에는 Feature Importance 분석과 베이지안 최적화를 통해 기존 시스템의 효율을 높이고, 점진적으로 유전 프로그래밍과 LLM을 도입하여 전략 생성 자체를 자동화하는 방향으로 나아가야 한다.
