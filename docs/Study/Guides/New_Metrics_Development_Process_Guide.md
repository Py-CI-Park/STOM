# ì‹ ê·œ ì§€í‘œ ê°œë°œ ë° í†µí•© í”„ë¡œì„¸ìŠ¤ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-12-28
**ì‘ì„±ì**: Claude Code (AI Assistant)
**ë²„ì „**: 1.0
**ëª©ì **: ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œì— ìƒˆë¡œìš´ íŒŒìƒ ì§€í‘œë¥¼ ì¶”ê°€í•˜ê³  ì „ì²´ ì‹œìŠ¤í…œì— í†µí•©í•˜ëŠ” ì²´ê³„ì ì¸ í”„ë¡œì„¸ìŠ¤ ì œê³µ

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [ì‚¬ì „ ì¤€ë¹„](#2-ì‚¬ì „-ì¤€ë¹„)
3. [Step 1: ì§€í‘œ ì„¤ê³„ ë° ê²€ì¦](#3-step-1-ì§€í‘œ-ì„¤ê³„-ë°-ê²€ì¦)
4. [Step 2: ì§€í‘œ êµ¬í˜„](#4-step-2-ì§€í‘œ-êµ¬í˜„)
5. [Step 3: ë¬¸ì„œí™” ì¶”ê°€](#5-step-3-ë¬¸ì„œí™”-ì¶”ê°€)
6. [Step 4: í•„í„° ì‹œìŠ¤í…œ í†µí•©](#6-step-4-í•„í„°-ì‹œìŠ¤í…œ-í†µí•©)
7. [Step 5: ML ì‹œìŠ¤í…œ í†µí•©](#7-step-5-ml-ì‹œìŠ¤í…œ-í†µí•©)
8. [Step 6: ê²€ì¦ ë° í…ŒìŠ¤íŠ¸](#8-step-6-ê²€ì¦-ë°-í…ŒìŠ¤íŠ¸)
9. [Step 7: í†µí•© ê²€ì¦ ë³´ê³ ì„œ ì‘ì„±](#9-step-7-í†µí•©-ê²€ì¦-ë³´ê³ ì„œ-ì‘ì„±)
10. [Step 8: ì»¤ë°‹ ë° ë°°í¬](#10-step-8-ì»¤ë°‹-ë°-ë°°í¬)
11. [ì²´í¬ë¦¬ìŠ¤íŠ¸](#11-ì²´í¬ë¦¬ìŠ¤íŠ¸)
12. [ì°¸ê³  ì‚¬ë¡€](#12-ì°¸ê³ -ì‚¬ë¡€)

---

## 1. ê°œìš”

### 1.1 í”„ë¡œì„¸ìŠ¤ ëª©ì 

ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œì— ìƒˆë¡œìš´ íŒŒìƒ ì§€í‘œë¥¼ ì¶”ê°€í•  ë•Œ ë‹¤ìŒì„ ë³´ì¥í•©ë‹ˆë‹¤:

- âœ… ì§€í‘œê°€ ëª¨ë“  ë¶„ì„ ì ˆì°¨ì— ìë™ìœ¼ë¡œ í†µí•©ë¨
- âœ… LOOKAHEAD-FREE ì›ì¹™ ì¤€ìˆ˜ë¡œ ì‹¤ì „ íŠ¸ë ˆì´ë”© ì•ˆì „ì„± í™•ë³´
- âœ… ìë™ ë¬¸ì„œí™”ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
- âœ… í•„í„°/ì„¸ê·¸ë¨¼íŠ¸/ML ë¶„ì„ì—ì„œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥

### 1.2 í†µí•© ëŒ€ìƒ ì‹œìŠ¤í…œ

ì‹ ê·œ ì§€í‘œëŠ” ë‹¤ìŒ 6ê°œ ì‹œìŠ¤í…œì— í†µí•©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:

1. **ì§€í‘œ ê³„ì‚° ì—”ì§„** (`metrics_enhanced.py`)
2. **detail.csv ì €ì¥** (`runner.py`)
3. **report.txt ë¬¸ì„œí™”** (`back_static.py`)
4. **í•„í„° ë¶„ì„** (`filter_evaluator.py`)
5. **ì„¸ê·¸ë¨¼íŠ¸ ë¶„ì„** (`phase2_runner.py`)
6. **ML Feature ì¶”ì¶œ** (`ml.py`)

### 1.3 ì†Œìš” ì‹œê°„

- **ë‹¨ìˆœ ì§€í‘œ** (1-2ê°œ, ë‹¨ì¼ ì»¬ëŸ¼ ê³„ì‚°): ~2ì‹œê°„
- **ë³µì¡ ì§€í‘œ** (3ê°œ ì´ìƒ, ì‹œê³„ì—´ ë¶„ì„): ~4ì‹œê°„
- **ê³ ê¸‰ ì§€í‘œ** (ML ê¸°ë°˜, ë‹¤ì¤‘ ì‹œê³„ì—´): ~8ì‹œê°„

---

## 2. ì‚¬ì „ ì¤€ë¹„

### 2.1 í•„ìš” ì§€ì‹

- Python (NumPy, Pandas í•„ìˆ˜)
- ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì´í•´
- LOOKAHEAD-FREE ê°œë…
- Git ê¸°ë³¸ ì‚¬ìš©ë²•

### 2.2 í•„ìš” ë¬¸ì„œ

| ë¬¸ì„œ | ê²½ë¡œ | ìš©ë„ |
|------|------|------|
| Back Testing Guideline (Tick) | `docs/Guideline/Back_Testing_Guideline_Tick.md` | 826ê°œ ë³€ìˆ˜ ì°¸ì¡° |
| Back Testing Guideline (Min) | `docs/Guideline/Back_Testing_Guideline_Min.md` | 752ê°œ ë³€ìˆ˜ ì°¸ì¡° |
| Backtesting Output System Analysis | `docs/Study/SystemAnalysis/2025-12-28_Backtesting_Output_System_Analysis.md` | 93ê°œ ê¸°ì¡´ ì§€í‘œ ë¶„ì„ |

### 2.3 ì‘ì—… í™˜ê²½ í™•ì¸

```bash
# Python í™˜ê²½ í™•ì¸
python --version  # 3.8 ì´ìƒ

# í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
pip list | grep -E "numpy|pandas|scipy|sklearn"

# Git ìƒíƒœ í™•ì¸
cd C:\System_Trading\STOM\STOM_V1
git status
git branch  # feat/add-new-metrics ë“± ì‘ì—… ë¸Œëœì¹˜ ìƒì„± ê¶Œì¥
```

---

## 3. Step 1: ì§€í‘œ ì„¤ê³„ ë° ê²€ì¦

### 3.1 ì§€í‘œ ì•„ì´ë””ì–´ ìˆ˜ë¦½

**ì§ˆë¬¸ ì²´í¬ë¦¬ìŠ¤íŠ¸**:

1. âœ… **ëª©ì **: ì´ ì§€í‘œë¡œ ë¬´ì—‡ì„ ì¸¡ì •/ì˜ˆì¸¡í•˜ëŠ”ê°€?
2. âœ… **ì°¨ë³„ì„±**: ê¸°ì¡´ 93ê°œ ì§€í‘œì™€ ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€?
3. âœ… **ì‹¤ìš©ì„±**: íŠ¸ë ˆì´ë”© ì¡°ê±´ í•„í„°ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ê°€?
4. âœ… **ê³„ì‚° ê°€ëŠ¥ì„±**: ë§¤ìˆ˜ ì‹œì  ë°ì´í„°ë§Œìœ¼ë¡œ ê³„ì‚° ê°€ëŠ¥í•œê°€? (LOOKAHEAD-FREE)

**ì˜ˆì‹œ**:
```
ëª©ì : ì‹œì¥ ìœ ë™ì„±ì˜ ê¸‰ê²©í•œ ë³€í™”ë¥¼ ê°ì§€
ì°¨ë³„ì„±: ê¸°ì¡´ì—ëŠ” ì ˆëŒ€ê°’ë§Œ ìˆê³  ì‹œê³„ì—´ ë³€í™”ìœ¨ì´ ì—†ìŒ
ì‹¤ìš©ì„±: ê±°ë˜ëŒ€ê¸ˆ 20% ì´ìƒ ì¦ê°€ ì‹œ ë§¤ìˆ˜ ì¡°ê±´ìœ¼ë¡œ í™œìš©
ê³„ì‚° ê°€ëŠ¥ì„±: ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆì€ ë§¤ìˆ˜ ì‹œì ì— í™•ì •ëœ ê°’ì´ë¯€ë¡œ OK
```

### 3.2 LOOKAHEAD-FREE ê²€ì¦

**í•µì‹¬ ì›ì¹™**: ì§€í‘œ ê³„ì‚° ì‹œ "ë¯¸ë˜ ì •ë³´"ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.

| ì‚¬ìš© ê°€ëŠ¥ ë°ì´í„° | ì‚¬ìš© ë¶ˆê°€ ë°ì´í„° |
|-----------------|-----------------|
| âœ… ë§¤ìˆ˜* ì»¬ëŸ¼ (ë§¤ìˆ˜ì‹œê°„, ë§¤ìˆ˜ê°€, ë§¤ìˆ˜ë“±ë½ìœ¨ ë“±) | âŒ ë§¤ë„* ì»¬ëŸ¼ (ë§¤ë„ì‹œê°„, ë§¤ë„ê°€, ë§¤ë„ë“±ë½ìœ¨ ë“±) |
| âœ… ì‹œê°€ì´ì•¡ (ê³ ì •ê°’) | âŒ ìˆ˜ìµê¸ˆ, ìˆ˜ìµë¥  (ì‚¬í›„ ê³„ì‚°) |
| âœ… shift(1) ì´ìƒ (ê³¼ê±° ë°ì´í„°) | âŒ shift(-1) (ë¯¸ë˜ ë°ì´í„°) |
| âœ… rolling(window).mean() (ê³¼ê±° í‰ê· ) | âŒ ë³€í™”, ì¶”ì„¸ (ë§¤ë„ ì‹œì  ê³„ì‚°) |

**ì˜ˆì™¸ ì¼€ì´ìŠ¤**:
- `ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ë§¤ìˆ˜ë§¤ë„_ë¹„ìœ¨`: ë§¤ë„ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ì‚¬ìš©í•˜ì§€ë§Œ **í•„í„°ìš©ì´ ì•„ë‹Œ ì‚¬í›„ ë¶„ì„ìš©**ì´ë¯€ë¡œ í—ˆìš©
- ì´ëŸ° ê²½ìš° report.txtì— "LOOKAHEAD í¬í•¨, í•„í„° ì‚¬ìš© ë¶ˆê°€" ëª…ì‹œ í•„ìš”

### 3.3 ìˆ˜ì‹ ì •ì˜

**ê³µì‹ ì‘ì„± ê°€ì´ë“œ**:

```python
# ë‚˜ìœ ì˜ˆ: ì• ë§¤í•œ í‘œí˜„
ratio = current / previous

# ì¢‹ì€ ì˜ˆ: ëª…í™•í•œ ìˆ˜ì‹
ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ì „í‹±ë¶„ë´‰_ë¹„ìœ¨ = (
    í˜„ì¬_ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ / ì§ì „ê±°ë˜_ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ
    if ì§ì „ê±°ë˜_ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ > 0
    else 1.0
)
```

**ê³µì‹ ë¬¸ì„œí™” í…œí”Œë¦¿**:

```markdown
## ì§€í‘œëª…: ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ì „í‹±ë¶„ë´‰_ë¹„ìœ¨

### ì„¤ëª…
ì§ì „ ê±°ë˜ ëŒ€ë¹„ ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ë³€í™”ìœ¨

### ë‹¨ìœ„
ë°°ìœ¨ (1.0 = ë³€í™” ì—†ìŒ)

### ê³µì‹
```
í˜„ì¬_ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ / ì§ì „ê±°ë˜_ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ if >0 else 1.0
```

### í™œìš© ì‹œë‚˜ë¦¬ì˜¤
- ê±°ë˜ëŒ€ê¸ˆ 20% ì´ìƒ ì¦ê°€ â†’ ì‹œì¥ ê´€ì‹¬ ì¦ê°€ ì‹ í˜¸
- ëŒíŒŒ ë§¤ë§¤ ì „ëµì— ìœ ìš©

### LOOKAHEAD-FREE ì—¬ë¶€
âœ… ì˜ˆ (ë§¤ìˆ˜ ì‹œì  ë°ì´í„°ë§Œ ì‚¬ìš©)
```

---

## 4. Step 2: ì§€í‘œ êµ¬í˜„

### 4.1 íŒŒì¼ ìœ„ì¹˜

**êµ¬í˜„ íŒŒì¼**: `backtester/analysis_enhanced/metrics_enhanced.py`

### 4.2 ì½”ë“œ ì‘ì„± íŒ¨í„´

#### 4.2.1 ê¸°ë³¸ í…œí”Œë¦¿

```python
def CalculateEnhancedDerivedMetrics(df):
    """
    ê°•í™”ëœ íŒŒìƒ ì§€í‘œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
    """
    # ... ê¸°ì¡´ ì½”ë“œ ...

    # ================================================================
    # Section N: [ì§€í‘œ ì¹´í…Œê³ ë¦¬ëª…] (NEW YYYY-MM-DD)
    # ================================================================

    # N.1 [ì§€í‘œëª…1]
    if '[í•„ìˆ˜_ì»¬ëŸ¼1]' in df.columns:
        # ê³„ì‚° ë¡œì§
        df['[ì§€í‘œëª…1]'] = np.where(
            [ì¡°ê±´],
            [ì°¸ì¼_ë•Œ_ê°’],
            [ê±°ì§“ì¼_ë•Œ_ê°’]
        )

    # N.2 [ì§€í‘œëª…2]
    if '[í•„ìˆ˜_ì»¬ëŸ¼1]' in df.columns and '[í•„ìˆ˜_ì»¬ëŸ¼2]' in df.columns:
        df['[ì§€í‘œëª…2]'] = np.where(
            df['[í•„ìˆ˜_ì»¬ëŸ¼1]'] > 0,
            df['[í•„ìˆ˜_ì»¬ëŸ¼2]'] / df['[í•„ìˆ˜_ì»¬ëŸ¼1]'],
            1.0  # ê¸°ë³¸ê°’ (ì˜ë¯¸ ìˆëŠ” ê°’ ì„ íƒ)
        )

    return df
```

#### 4.2.2 ì‹¤ì œ ì‚¬ë¡€ (ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ë¹„ìœ¨ ì§€í‘œ)

```python
# ================================================================
# Section 15: ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ì‹œê³„ì—´ ë¹„ìœ¨ (NEW 2025-12-28)
# ================================================================

# 15.1 ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ì „í‹±ë¶„ë´‰_ë¹„ìœ¨
if 'ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ' in df.columns:
    prev_trade_money = df['ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ'].shift(1)
    df['ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ì „í‹±ë¶„ë´‰_ë¹„ìœ¨'] = np.where(
        prev_trade_money > 0,
        df['ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ'] / prev_trade_money,
        1.0  # ì²« ê±°ë˜ëŠ” ë³€í™” ì—†ìŒìœ¼ë¡œ ì²˜ë¦¬
    )

# 15.2 ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ë§¤ìˆ˜ë§¤ë„_ë¹„ìœ¨ (LOOKAHEAD í¬í•¨ - ì‚¬í›„ ë¶„ì„ìš©)
if 'ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ' in df.columns and 'ë§¤ë„ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ' in df.columns:
    df['ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ë§¤ìˆ˜ë§¤ë„_ë¹„ìœ¨'] = np.where(
        df['ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ'] > 0,
        df['ë§¤ë„ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ'] / df['ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ'],
        1.0
    )

# 15.3 ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_5í‹±ë¶„ë´‰í‰ê· _ë¹„ìœ¨
if 'ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ' in df.columns:
    rolling_avg = df['ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ'].rolling(window=5, min_periods=1).mean()
    df['ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_5í‹±ë¶„ë´‰í‰ê· _ë¹„ìœ¨'] = np.where(
        rolling_avg > 0,
        df['ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ'] / rolling_avg,
        1.0
    )
```

### 4.3 ì½”ë”© ê°€ì´ë“œë¼ì¸

#### 4.3.1 í•„ìˆ˜ ì²´í¬ì‚¬í•­

- âœ… **ì»¬ëŸ¼ ì¡´ì¬ í™•ì¸**: `if 'ì»¬ëŸ¼ëª…' in df.columns:`
- âœ… **Zero Division ë°©ì§€**: `np.where(ë¶„ëª¨ > 0, ê³„ì‚°, ê¸°ë³¸ê°’)`
- âœ… **NaN ì²˜ë¦¬**: `fillna()`, `dropna()`, ë˜ëŠ” `np.where(notna(), ...)`
- âœ… **ë°ì´í„° íƒ€ì…**: `pd.to_numeric(..., errors='coerce')`
- âœ… **ëª…í™•í•œ ì£¼ì„**: ê° ì§€í‘œì˜ ì˜ë¯¸ ì„¤ëª…

#### 4.3.2 ì„±ëŠ¥ ìµœì í™”

```python
# ë‚˜ìœ ì˜ˆ: ë°˜ë³µë¬¸
for i in range(len(df)):
    df.loc[i, 'ì§€í‘œ'] = df.loc[i, 'A'] / df.loc[i, 'B']

# ì¢‹ì€ ì˜ˆ: ë²¡í„°í™”
df['ì§€í‘œ'] = df['A'] / df['B']

# ë” ì¢‹ì€ ì˜ˆ: ë²¡í„°í™” + ì•ˆì „ì„±
df['ì§€í‘œ'] = np.where(df['B'] > 0, df['A'] / df['B'], ê¸°ë³¸ê°’)
```

#### 4.3.3 ì‹œê³„ì—´ í•¨ìˆ˜ í™œìš©

```python
# shift: ê³¼ê±° ê°’ ì°¸ì¡°
df['prev_value'] = df['current_value'].shift(1)  # 1í–‰ ì´ì „
df['prev_2_value'] = df['current_value'].shift(2)  # 2í–‰ ì´ì „

# rolling: ì´ë™ í‰ê· /í•©ê³„
df['ma_5'] = df['value'].rolling(window=5, min_periods=1).mean()
df['sum_10'] = df['value'].rolling(window=10, min_periods=1).sum()

# diff: ì°¨ë¶„
df['change'] = df['value'].diff()  # í˜„ì¬ - ì´ì „

# pct_change: ë³€í™”ìœ¨
df['change_pct'] = df['value'].pct_change()  # (í˜„ì¬ - ì´ì „) / ì´ì „
```

---

## 5. Step 3: ë¬¸ì„œí™” ì¶”ê°€

### 5.1 íŒŒì¼ ìœ„ì¹˜

**ë¬¸ì„œí™” íŒŒì¼**: `backtester/back_static.py`

### 5.2 derived_docs ë”•ì…”ë„ˆë¦¬ ì—…ë°ì´íŠ¸

#### 5.2.1 ìœ„ì¹˜ ì°¾ê¸°

```python
# backtester/back_static.py Line 285-539
def _build_detail_csv_docs(all_cols):
    # ...
    derived_docs = {
        # ê¸°ì¡´ ì§€í‘œë“¤...
        'ì´ˆë‹¹ê±°ë˜ëŒ€ê¸ˆë³€í™”ìœ¨': {...},

        # ì—¬ê¸°ì— ì‹ ê·œ ì§€í‘œ ì¶”ê°€ (Line 539 ë¶€ê·¼)
    }
```

#### 5.2.2 ì¶”ê°€ í…œí”Œë¦¿

```python
# [NEW YYYY-MM-DD] [ì§€í‘œ ì¹´í…Œê³ ë¦¬ëª…]
'[ì§€í‘œëª…]': {
    'desc': '[í•œê¸€ ì„¤ëª… (1ì¤„, ëª…í™•í•˜ê²Œ)]',
    'unit': '[ë‹¨ìœ„ (ë°°ìœ¨, %, ì›, ìˆ˜ëŸ‰ ë“±)]',
    'formula': ["[ìˆ˜ì‹ (ì˜ì‚¬ì½”ë“œ í˜•íƒœë¡œ ëª…í™•í•˜ê²Œ)]"],
    'note': '[íŠ¹ì´ì‚¬í•­ ë˜ëŠ” í™œìš© íŒ (ì„ íƒì‚¬í•­)]'
},
```

#### 5.2.3 ì‹¤ì œ ì‚¬ë¡€

```python
# [NEW 2025-12-28] ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ì‹œê³„ì—´ ë¹„ìœ¨ ì§€í‘œ
'ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ì „í‹±ë¶„ë´‰_ë¹„ìœ¨': {
    'desc': 'ì§ì „ ê±°ë˜ ëŒ€ë¹„ ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ë³€í™”ìœ¨',
    'unit': 'ë°°ìœ¨',
    'formula': ["í˜„ì¬_ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ / ì§ì „ê±°ë˜_ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ if >0 else 1.0"],
    'note': 'ì²« ê±°ë˜ëŠ” 1.0, ê±°ë˜ëŒ€ê¸ˆ ì¦ê° íŠ¸ë Œë“œ íŒŒì•…ìš©'
},
'ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ë§¤ìˆ˜ë§¤ë„_ë¹„ìœ¨': {
    'desc': 'ë§¤ìˆ˜â†’ë§¤ë„ ê°„ ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ë³€í™”ìœ¨',
    'unit': 'ë°°ìœ¨',
    'formula': ["ë§¤ë„ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ / ë§¤ìˆ˜ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ if >0 else 1.0"],
    'note': 'ë³´ìœ  ê¸°ê°„ ë™ì•ˆ ì‹œì¥ ìœ ë™ì„± ë³€í™”, LOOKAHEAD í¬í•¨'
},
'ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_5í‹±ë¶„ë´‰í‰ê· _ë¹„ìœ¨': {
    'desc': 'ìµœê·¼ 5í‹±/ë¶„ë´‰ í‰ê·  ëŒ€ë¹„ ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ë¹„ìœ¨',
    'unit': 'ë°°ìœ¨',
    'formula': ["í˜„ì¬_ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ / rolling_mean(5) if >0 else 1.0"],
    'note': 'ë‹¨ê¸° í‰ê·  ëŒ€ë¹„ ìœ ë™ì„± ìˆ˜ì¤€, ë…¸ì´ì¦ˆ ê°ì†Œìš©'
},
```

### 5.3 ë¬¸ì„œí™” í’ˆì§ˆ ì²´í¬

- âœ… **desc**: 1ì¤„ë¡œ ëª…í™•í•˜ê²Œ ì„¤ëª…
- âœ… **unit**: ë‹¨ìœ„ ëª…ì‹œ (ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)
- âœ… **formula**: ì˜ì‚¬ì½”ë“œë¡œ ê³„ì‚°ì‹ í‘œí˜„ (ë¦¬ìŠ¤íŠ¸ í˜•íƒœ)
- âœ… **note**: LOOKAHEAD í¬í•¨ ì—¬ë¶€, í™œìš© íŒ ë“±

---

## 6. Step 4: í•„í„° ì‹œìŠ¤í…œ í†µí•©

### 6.1 íŒŒì¼ ìœ„ì¹˜

**í•„í„° ì„¤ì • íŒŒì¼**: `backtester/segment_analysis/filter_evaluator.py`

### 6.2 explicit_buy_columns ì—…ë°ì´íŠ¸

#### 6.2.1 ìœ„ì¹˜ ì°¾ê¸°

```python
# backtester/segment_analysis/filter_evaluator.py Line 44-59
@dataclass
class FilterEvaluatorConfig:
    # ...
    explicit_buy_columns: Tuple[str, ...] = (
        'ë§¤ìˆ˜ë“±ë½ìœ¨', 'ë§¤ìˆ˜ì‹œê°€ë“±ë½ìœ¨', ...
        'ì´ˆë‹¹ìˆœë§¤ìˆ˜ìˆ˜ëŸ‰', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ê¸ˆì•¡', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ë¹„ìœ¨',

        # ì—¬ê¸°ì— ì‹ ê·œ ì§€í‘œ ì¶”ê°€ (Line 57 ë¶€ê·¼)
    )
```

#### 6.2.2 ì¶”ê°€ ë°©ë²•

```python
    explicit_buy_columns: Tuple[str, ...] = (
        # ... ê¸°ì¡´ ì»¬ëŸ¼ë“¤ ...
        'ì´ˆë‹¹ìˆœë§¤ìˆ˜ìˆ˜ëŸ‰', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ê¸ˆì•¡', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ë¹„ìœ¨',
        # [NEW YYYY-MM-DD] [ì§€í‘œ ì¹´í…Œê³ ë¦¬ëª…] (LOOKAHEAD-FREEë§Œ ì¶”ê°€)
        '[ì§€í‘œëª…1]', '[ì§€í‘œëª…2]', '[ì§€í‘œëª…3]',
    )
```

#### 6.2.3 ì‹¤ì œ ì‚¬ë¡€

```python
    explicit_buy_columns: Tuple[str, ...] = (
        # ... ê¸°ì¡´ ì»¬ëŸ¼ë“¤ ...
        'ì´ˆë‹¹ìˆœë§¤ìˆ˜ìˆ˜ëŸ‰', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ê¸ˆì•¡', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ë¹„ìœ¨',
        # [NEW 2025-12-28] ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ì‹œê³„ì—´ ë¹„ìœ¨ ì§€í‘œ (LOOKAHEAD-FREE)
        'ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ì „í‹±ë¶„ë´‰_ë¹„ìœ¨', 'ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_5í‹±ë¶„ë´‰í‰ê· _ë¹„ìœ¨',
        # ì£¼ì˜: 'ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ë§¤ìˆ˜ë§¤ë„_ë¹„ìœ¨'ì€ LOOKAHEAD í¬í•¨ìœ¼ë¡œ ì œì™¸
    )
```

### 6.3 ì£¼ì˜ì‚¬í•­

- âš ï¸ **LOOKAHEAD ì§€í‘œëŠ” ì¶”ê°€í•˜ì§€ ì•ŠìŒ**: í•„í„° ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ ê³¼ì í•© ë°œìƒ
- âœ… **ë§¤ìˆ˜ ì‹œì  ë°ì´í„°ë§Œ ì‚¬ìš©í•œ ì§€í‘œë§Œ ì¶”ê°€**
- âœ… **ì£¼ì„ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬ êµ¬ë¶„** (ê°€ë…ì„± í–¥ìƒ)

---

## 7. Step 5: ML ì‹œìŠ¤í…œ í†µí•©

### 7.1 íŒŒì¼ ìœ„ì¹˜

**ML Feature ì„¤ì • íŒŒì¼**: `backtester/analysis_enhanced/ml.py`

### 7.2 explicit_buy_columns ì—…ë°ì´íŠ¸

#### 7.2.1 ìœ„ì¹˜ ì°¾ê¸°

```python
# backtester/analysis_enhanced/ml.py Line 394-409
def AnalyzeFeatureImportance(df_tsg):
    # ...
    explicit_buy_columns = [
        'ë§¤ìˆ˜ë“±ë½ìœ¨', 'ë§¤ìˆ˜ì‹œê°€ë“±ë½ìœ¨', ...
        'ì´ˆë‹¹ìˆœë§¤ìˆ˜ìˆ˜ëŸ‰', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ê¸ˆì•¡', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ë¹„ìœ¨',

        # ì—¬ê¸°ì— ì‹ ê·œ ì§€í‘œ ì¶”ê°€ (Line 407 ë¶€ê·¼)
    ]
```

#### 7.2.2 ì¶”ê°€ ë°©ë²•

```python
    explicit_buy_columns = [
        # ... ê¸°ì¡´ ì»¬ëŸ¼ë“¤ ...
        'ì´ˆë‹¹ìˆœë§¤ìˆ˜ìˆ˜ëŸ‰', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ê¸ˆì•¡', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ë¹„ìœ¨',
        # [NEW YYYY-MM-DD] [ì§€í‘œ ì¹´í…Œê³ ë¦¬ëª…] (LOOKAHEAD-FREEë§Œ ì¶”ê°€)
        '[ì§€í‘œëª…1]', '[ì§€í‘œëª…2]', '[ì§€í‘œëª…3]',
    ]
```

#### 7.2.3 ì‹¤ì œ ì‚¬ë¡€

```python
    explicit_buy_columns = [
        # ... ê¸°ì¡´ ì»¬ëŸ¼ë“¤ ...
        'ì´ˆë‹¹ìˆœë§¤ìˆ˜ìˆ˜ëŸ‰', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ê¸ˆì•¡', 'ì´ˆë‹¹ìˆœë§¤ìˆ˜ë¹„ìœ¨',
        # [NEW 2025-12-28] ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ì‹œê³„ì—´ ë¹„ìœ¨ ì§€í‘œ (LOOKAHEAD-FREE)
        'ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ì „í‹±ë¶„ë´‰_ë¹„ìœ¨', 'ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_5í‹±ë¶„ë´‰í‰ê· _ë¹„ìœ¨',
    ]
```

### 7.3 ML Feature ì„ íƒ ê¸°ì¤€

- âœ… **LOOKAHEAD-FREE ì§€í‘œë§Œ ì¶”ê°€**
- âœ… **ìˆ˜ì¹˜í˜• ë°ì´í„°** (ë¬¸ìì—´, ë‚ ì§œ ì œì™¸)
- âœ… **ì˜ˆì¸¡ ê°€ëŠ¥ì„±**: ì´ìµ/ì†ì‹¤ ì˜ˆì¸¡ì— ë„ì›€ì´ ë˜ëŠ” ì§€í‘œ
- âŒ **ê²°ê³¼ ë³€ìˆ˜**: ìˆ˜ìµê¸ˆ, ìˆ˜ìµë¥  ë“±ì€ ì œì™¸ (íƒ€ê²Ÿ ë³€ìˆ˜)

---

## 8. Step 6: ê²€ì¦ ë° í…ŒìŠ¤íŠ¸

### 8.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

#### 8.1.1 íŒŒì¼ ìƒì„±

**íŒŒì¼ëª…**: `backtester/_test_[ì§€í‘œëª…]_update.py`

#### 8.1.2 í…ŒìŠ¤íŠ¸ í…œí”Œë¦¿

```python
# -*- coding: utf-8 -*-
"""
[YYYY-MM-DD] [ì§€í‘œëª…] ì¶”ê°€ êµ¬í˜„ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸

ëª©ì :
- ìƒˆë¡œ ì¶”ê°€í•œ [ì§€í‘œëª…] Nì¢…ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ëŠ”ì§€ ê²€ì¦
- ê°’ì˜ ë²”ìœ„ì™€ ì˜ë¯¸ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

ê²€ì¦ í•­ëª©:
1. [ì§€í‘œ1]
2. [ì§€í‘œ2]
3. [ì§€í‘œN]
"""

import numpy as np
import pandas as pd
from analysis_enhanced.metrics_enhanced import CalculateEnhancedDerivedMetrics

def test_new_metrics():
    print("=" * 80)
    print("[ì§€í‘œëª…] ì¶”ê°€ êµ¬í˜„ ê²€ì¦")
    print("=" * 80)

    # 1. í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
    print("\n[1] í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì¤‘...")

    test_data = {
        'ì¢…ëª©ëª…': ['ì¢…ëª©A'] * 10,
        'ë§¤ìˆ˜ì‹œê°„': pd.date_range('2025-01-01 09:00:00', periods=10, freq='1min'),
        'ë§¤ë„ì‹œê°„': pd.date_range('2025-01-01 09:05:00', periods=10, freq='1min'),
        # ... ê¸°íƒ€ í•„ìˆ˜ ì»¬ëŸ¼ ...

        # í•µì‹¬ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ (ì˜ˆìƒ íŒ¨í„´ìœ¼ë¡œ ìƒì„±)
        '[ì›ë³¸_ì»¬ëŸ¼]': [ê°’1, ê°’2, ...],
    }

    df = pd.DataFrame(test_data)
    print(f"[OK] í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ ({len(df)}ê°œ ê±°ë˜)")

    # 2. íŒŒìƒ ì§€í‘œ ê³„ì‚°
    print("\n[2] íŒŒìƒ ì§€í‘œ ê³„ì‚° ì¤‘...")
    df_enhanced = CalculateEnhancedDerivedMetrics(df)
    print(f"[OK] íŒŒìƒ ì§€í‘œ ê³„ì‚° ì™„ë£Œ (ì´ ì»¬ëŸ¼ ìˆ˜: {len(df_enhanced.columns)}ê°œ)")

    # 3. ì‹ ê·œ ì§€í‘œ ì¡´ì¬ í™•ì¸
    print("\n[3] ì‹ ê·œ ì§€í‘œ ê²€ì¦")
    print("-" * 80)

    new_metrics = ['ì§€í‘œ1', 'ì§€í‘œ2', 'ì§€í‘œN']
    all_exist = True
    for metric in new_metrics:
        if metric in df_enhanced.columns:
            print(f"[OK] {metric}: ìƒì„±ë¨")
        else:
            print(f"[FAIL] {metric}: ë¯¸ìƒì„±")
            all_exist = False

    if not all_exist:
        return False

    # 4. ì§€í‘œ ê°’ ê²€ì¦
    print("\n[4] ì§€í‘œ ê°’ ê²€ì¦")
    print("-" * 80)

    # ê° ì§€í‘œë³„ ê²€ì¦ ë¡œì§
    # ...

    # 5. ìš”ì•½
    print("\n" + "=" * 80)
    print("ê²€ì¦ ìš”ì•½")
    print("=" * 80)
    print(f"[OK] ì‹ ê·œ ì§€í‘œ ê°œìˆ˜: {len(new_metrics)}ê°œ")
    print(f"[OK] ëª¨ë“  ì§€í‘œ ìƒì„±: {'ì˜ˆ' if all_exist else 'ì•„ë‹ˆì˜¤'}")

    return True

if __name__ == '__main__':
    try:
        success = test_new_metrics()
        if success:
            print("\n[SUCCESS] ëª¨ë“  ê²€ì¦ í†µê³¼!")
        else:
            print("\n[FAIL] ê²€ì¦ ì‹¤íŒ¨!")
    except Exception as e:
        print(f"\n[ERROR] ì˜¤ë¥˜ ë°œìƒ: {e}")
        import traceback
        traceback.print_exc()
```

#### 8.1.3 í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
cd C:\System_Trading\STOM\STOM_V1\backtester
python _test_[ì§€í‘œëª…]_update.py
```

**ê¸°ëŒ€ ì¶œë ¥**:
```
================================================================================
[ì§€í‘œëª…] ì¶”ê°€ êµ¬í˜„ ê²€ì¦
================================================================================

[1] í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì¤‘...
[OK] í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ (10ê°œ ê±°ë˜)

[2] íŒŒìƒ ì§€í‘œ ê³„ì‚° ì¤‘...
[OK] íŒŒìƒ ì§€í‘œ ê³„ì‚° ì™„ë£Œ (ì´ ì»¬ëŸ¼ ìˆ˜: 96ê°œ)

[3] ì‹ ê·œ ì§€í‘œ ê²€ì¦
--------------------------------------------------------------------------------
[OK] ì§€í‘œ1: ìƒì„±ë¨
[OK] ì§€í‘œ2: ìƒì„±ë¨
[OK] ì§€í‘œN: ìƒì„±ë¨

[4] ì§€í‘œ ê°’ ê²€ì¦
--------------------------------------------------------------------------------
[OK] ì§€í‘œ1 ê°’ ì •ìƒ: ...
[OK] ì§€í‘œ2 ê°’ ì •ìƒ: ...

================================================================================
ê²€ì¦ ìš”ì•½
================================================================================
[OK] ì‹ ê·œ ì§€í‘œ ê°œìˆ˜: Nê°œ
[OK] ëª¨ë“  ì§€í‘œ ìƒì„±: ì˜ˆ

[SUCCESS] ëª¨ë“  ê²€ì¦ í†µê³¼!
```

### 8.2 í†µí•© í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ë°±í…ŒìŠ¤íŒ…)

#### 8.2.1 ê°„ë‹¨í•œ ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰

```bash
# ì‘ì€ ë°ì´í„°ì…‹ìœ¼ë¡œ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸
python backtester/backtest.py --days 5
```

#### 8.2.2 í™•ì¸ í•­ëª©

**ìƒì„±ëœ íŒŒì¼**:
- `backtesting_output/[ì‹¤í–‰ëª…]/[ì‹¤í–‰ëª…]_detail.csv`
- `backtesting_output/[ì‹¤í–‰ëª…]/[ì‹¤í–‰ëª…]_report.txt`
- `backtesting_output/[ì‹¤í–‰ëª…]/[ì‹¤í–‰ëª…]_filter.csv`

**detail.csv í™•ì¸**:
```python
import pandas as pd

df = pd.read_csv('backtesting_output/.../detail.csv', encoding='utf-8-sig')
print(df.columns.tolist())  # ì‹ ê·œ ì§€í‘œ ì»¬ëŸ¼ ìˆëŠ”ì§€ í™•ì¸
print(df[['ì§€í‘œ1', 'ì§€í‘œ2']].describe())  # í†µê³„ í™•ì¸
```

**report.txt í™•ì¸**:
```bash
# report.txtì—ì„œ ì‹ ê·œ ì§€í‘œ ë¬¸ì„œ í™•ì¸
grep "ì§€í‘œ1" backtesting_output/.../report.txt
grep "ì§€í‘œ2" backtesting_output/.../report.txt
```

**filter.csv í™•ì¸**:
```python
df_filter = pd.read_csv('backtesting_output/.../filter.csv', encoding='utf-8-sig')
print(df_filter[df_filter['column'].str.contains('ì§€í‘œ')]['column'].unique())
```

---

## 9. Step 7: í†µí•© ê²€ì¦ ë³´ê³ ì„œ ì‘ì„±

### 9.1 ë³´ê³ ì„œ íŒŒì¼ ìƒì„±

**íŒŒì¼ ìœ„ì¹˜**: `docs/Study/SystemAnalysis/YYYY-MM-DD_[ì§€í‘œëª…]_Integration_Verification_Report.md`

### 9.2 ë³´ê³ ì„œ í…œí”Œë¦¿

```markdown
# [ì§€í‘œëª…] í†µí•© ê²€ì¦ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: YYYY-MM-DD
**ì‘ì„±ì**: [ì´ë¦„]
**ë¬¸ì„œ ë²„ì „**: 1.0
**ê´€ë ¨ ì´ìŠˆ**: [ì´ìŠˆ ì„¤ëª…]

---

## 1. ê°œìš”

### 1.1 ëª©ì 
[ì§€í‘œë¥¼ ì¶”ê°€í•œ ëª©ì ]

### 1.2 ìš”êµ¬ì‚¬í•­
[ì‚¬ìš©ì ìš”ì²­ì‚¬í•­]

### 1.3 ê²€ì¦ ê²°ê³¼ ìš”ì•½

| ê²€ì¦ í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|----------|------|------|
| ì§€í‘œ ê³„ì‚° ë¡œì§ êµ¬í˜„ | âœ… ì™„ë£Œ | `metrics_enhanced.py` [ë¼ì¸] |
| detail.csv ì €ì¥ | âœ… ìë™ | `runner.py` [ë¼ì¸] |
| report.txt ë¬¸ì„œí™” | âœ… ì™„ë£Œ | `back_static.py` [ë¼ì¸] |
| í•„í„° ë¶„ì„ í˜¸í™˜ì„± | âœ… ì™„ë£Œ | `filter_evaluator.py` [ë¼ì¸] |
| ì„¸ê·¸ë¨¼íŠ¸ ë¶„ì„ í˜¸í™˜ì„± | âœ… ìë™ | `phase2_runner.py` [ë¼ì¸] |
| ML feature ì¶”ì¶œ | âœ… ì™„ë£Œ | `ml.py` [ë¼ì¸] |

---

## 2. ì‹ ê·œ ì§€í‘œ êµ¬í˜„ ë‚´ì—­

### 2.1 ì§€í‘œ ëª©ë¡

| ì§€í‘œëª… | ì„¤ëª… | ë‹¨ìœ„ | ê³µì‹ |
|--------|------|------|------|
| [ì§€í‘œ1] | [ì„¤ëª…] | [ë‹¨ìœ„] | [ê³µì‹] |
| [ì§€í‘œ2] | [ì„¤ëª…] | [ë‹¨ìœ„] | [ê³µì‹] |

### 2.2 êµ¬í˜„ ìœ„ì¹˜
[ì½”ë“œ ìŠ¤ë‹ˆí«]

### 2.3 íŠ¹ì§•
- LOOKAHEAD-FREE ì—¬ë¶€
- í™œìš© ì‹œë‚˜ë¦¬ì˜¤

---

## 3. ì‹œìŠ¤í…œ í†µí•© ê²€ì¦
[6ê°œ ì‹œìŠ¤í…œë³„ í†µí•© ê³¼ì • ìƒì„¸]

---

## 4. ìˆ˜ì • íŒŒì¼ ëª©ë¡
[ìˆ˜ì •ëœ íŒŒì¼ í…Œì´ë¸”]

---

## 5. ê²€ì¦ í…ŒìŠ¤íŠ¸ ê²°ê³¼
[ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ê²°ê³¼]

---

## 6. ì‚¬ìš© ê°€ì´ë“œ
[í•„í„° ì¡°ê±´ ì˜ˆì‹œ ë° ë¶„ì„ ë°©ë²•]

---

## 7. ì°¸ê³  ë¬¸ì„œ
[ê´€ë ¨ ë¬¸ì„œ ë§í¬]
```

### 9.3 docs/Study/README.md ì—…ë°ì´íŠ¸

```markdown
# ì¢…í•© í…Œì´ë¸”ì— ì¶”ê°€
| N | **[ì§€í‘œëª…] Integration Report** | ì‹œìŠ¤í…œ ë¶„ì„ | YYYY-MM-DD | [í¬ê¸°] | [ì„¤ëª…] | â€¢ [ì£¼ìš” ì„±ê³¼1]<br>â€¢ [ì£¼ìš” ì„±ê³¼2] | [ê¸°ìˆ ] | âœ… |

# í´ë” êµ¬ì¡° ì—…ë°ì´íŠ¸
â”œâ”€â”€ SystemAnalysis/           # ì‹œìŠ¤í…œ ë¶„ì„ ë° ê°œì„ ì‚¬í•­ ([ê¸°ì¡´+1]ê°œ)
â”‚   â””â”€â”€ YYYY-MM-DD_[ì§€í‘œëª…]_Integration_Verification_Report.md

# ì´ ë¬¸ì„œ ìˆ˜ ì—…ë°ì´íŠ¸
**ì´ ë¬¸ì„œ ìˆ˜**: [ê¸°ì¡´+1]ê°œ | **ì´ ìš©ëŸ‰**: ~[í¬ê¸°]KB
```

---

## 10. Step 8: ì»¤ë°‹ ë° ë°°í¬

### 10.1 Git ì‘ì—…

#### 10.1.1 ë³€ê²½ íŒŒì¼ í™•ì¸

```bash
cd C:\System_Trading\STOM\STOM_V1
git status
```

**ì˜ˆìƒ ì¶œë ¥**:
```
M backtester/analysis_enhanced/metrics_enhanced.py
M backtester/back_static.py
M backtester/segment_analysis/filter_evaluator.py
M backtester/analysis_enhanced/ml.py
M docs/Study/README.md
?? backtester/_test_[ì§€í‘œëª…]_update.py
?? docs/Study/SystemAnalysis/YYYY-MM-DD_[ì§€í‘œëª…]_Integration_Verification_Report.md
?? docs/Study/Guides/New_Metrics_Development_Process_Guide.md
```

#### 10.1.2 íŒŒì¼ ìŠ¤í…Œì´ì§•

```bash
# ì‹ ê·œ ì§€í‘œ êµ¬í˜„
git add backtester/analysis_enhanced/metrics_enhanced.py

# ë¬¸ì„œí™” ë° í†µí•©
git add backtester/back_static.py
git add backtester/segment_analysis/filter_evaluator.py
git add backtester/analysis_enhanced/ml.py

# í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
git add backtester/_test_[ì§€í‘œëª…]_update.py

# ë¬¸ì„œ
git add docs/Study/README.md
git add docs/Study/SystemAnalysis/YYYY-MM-DD_[ì§€í‘œëª…]_Integration_Verification_Report.md
git add docs/Study/Guides/New_Metrics_Development_Process_Guide.md
```

#### 10.1.3 ì»¤ë°‹ ë©”ì‹œì§€ ì‘ì„±

**í…œí”Œë¦¿**:
```
feat: [ì§€í‘œëª…] Nì¢… ì¶”ê°€ ë° ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œ ì™„ì „ í†µí•©

[ìƒì„¸ ì„¤ëª…]
- ì‹ ê·œ ì§€í‘œ [N]ì¢… êµ¬í˜„: [ì§€í‘œ1], [ì§€í‘œ2], [ì§€í‘œN]
- ëª©ì : [êµ¬í˜„ ëª©ì ]
- LOOKAHEAD-FREE ê²€ì¦ ì™„ë£Œ

[í†µí•© ì‘ì—…]
1. metrics_enhanced.py: Section [N] ì¶”ê°€ (Line [XXX-YYY])
2. back_static.py: derived_docs ë¬¸ì„œí™” ([N]ê°œ ì§€í‘œ)
3. filter_evaluator.py: explicit_buy_columns ì—…ë°ì´íŠ¸
4. ml.py: ML feature ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸

[ê²€ì¦]
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: _test_[ì§€í‘œëª…]_update.py (ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼)
- í†µí•© í…ŒìŠ¤íŠ¸: ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰ ì •ìƒ í™•ì¸
- ë¬¸ì„œí™”: í†µí•© ê²€ì¦ ë³´ê³ ì„œ ì‘ì„± ([í¬ê¸°]KB)

[íŒŒì¼ ë³€ê²½]
- ìˆ˜ì •: 4ê°œ (metrics_enhanced.py, back_static.py, filter_evaluator.py, ml.py)
- ì‹ ê·œ: 3ê°œ (ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸, í†µí•© ë³´ê³ ì„œ, í”„ë¡œì„¸ìŠ¤ ê°€ì´ë“œ)

[ì˜í–¥ ë²”ìœ„]
- detail.csv: [N]ê°œ ì»¬ëŸ¼ ì¶”ê°€
- report.txt: ìë™ ë¬¸ì„œí™” í¬í•¨
- í•„í„° ë¶„ì„: [N]ê°œ í•„í„° í›„ë³´ ì¶”ê°€
- ML ëª¨ë¸: [N]ê°œ feature ì¶”ê°€

ğŸ¤– Generated with Claude Code
Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**ì‹¤ì œ ì‚¬ë¡€ (ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ë¹„ìœ¨ ì§€í‘œ)**:
```
feat: ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ë¹„ìœ¨ ì§€í‘œ 3ì¢… ì¶”ê°€ ë° ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œ ì™„ì „ í†µí•©

ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆì˜ ì‹œê³„ì—´ ë³€í™” íŒ¨í„´ì„ ë¶„ì„í•˜ê¸° ìœ„í•œ ë¹„ìœ¨ ì§€í‘œ 3ì¢…ì„ ì¶”ê°€í•˜ê³ ,
ë°±í…ŒìŠ¤íŒ… ì‹œìŠ¤í…œì˜ ëª¨ë“  ë¶„ì„ ì ˆì°¨(í•„í„°/ì„¸ê·¸ë¨¼íŠ¸/ML)ì— ì™„ì „ í†µí•©í–ˆìŠµë‹ˆë‹¤.

ì‹ ê·œ ì§€í‘œ 3ì¢…:
1. ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ì „í‹±ë¶„ë´‰_ë¹„ìœ¨: ì§ì „ ê±°ë˜ ëŒ€ë¹„ ë³€í™”ìœ¨ (íŠ¸ë Œë“œ)
2. ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_ë§¤ìˆ˜ë§¤ë„_ë¹„ìœ¨: ë³´ìœ  ê¸°ê°„ ìœ ë™ì„± ë³€í™” (ì‚¬í›„ ë¶„ì„)
3. ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ_5í‹±ë¶„ë´‰í‰ê· _ë¹„ìœ¨: ë‹¨ê¸° í‰ê·  ëŒ€ë¹„ ë¹„ìœ¨ (ë…¸ì´ì¦ˆ ê°ì†Œ)

í†µí•© ì‘ì—…:
1. metrics_enhanced.py: Section 15 ì¶”ê°€ (Line 383-428)
2. back_static.py: derived_docs ë¬¸ì„œí™” (3ê°œ ì§€í‘œ, Line 539-557)
3. filter_evaluator.py: explicit_buy_columns ì—…ë°ì´íŠ¸ (Line 57-58)
4. ml.py: ML feature ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (Line 407-408)

ê²€ì¦:
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: _test_metrics_update.py (ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼)
- í†µí•© í…ŒìŠ¤íŠ¸: ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰ìœ¼ë¡œ 6ê°œ ì‹œìŠ¤í…œ í†µí•© í™•ì¸
- ë¬¸ì„œí™”: í†µí•© ê²€ì¦ ë³´ê³ ì„œ ì‘ì„± (48KB)

íŒŒì¼ ë³€ê²½:
- ìˆ˜ì •: 4ê°œ (metrics_enhanced.py, back_static.py, filter_evaluator.py, ml.py)
- ì‹ ê·œ: 3ê°œ (ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸, í†µí•© ë³´ê³ ì„œ, í”„ë¡œì„¸ìŠ¤ ê°€ì´ë“œ)

ì˜í–¥ ë²”ìœ„:
- detail.csv: 3ê°œ ì»¬ëŸ¼ ì¶”ê°€ (ì´ 96ê°œ)
- report.txt: ìë™ ë¬¸ì„œí™” í¬í•¨
- í•„í„° ë¶„ì„: 2ê°œ í•„í„° í›„ë³´ ì¶”ê°€ (LOOKAHEAD-FREEë§Œ)
- ML ëª¨ë¸: 2ê°œ feature ì¶”ê°€

ğŸ¤– Generated with Claude Code
Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

#### 10.1.4 ì»¤ë°‹ ì‹¤í–‰

```bash
git commit -m "$(cat <<'EOF'
[ìƒì„¸ ì»¤ë°‹ ë©”ì‹œì§€]
EOF
)"
```

### 10.2 ê²€ì¦ í›„ ë°°í¬

```bash
# ì»¤ë°‹ í™•ì¸
git log -1 --stat

# ë¸Œëœì¹˜ í™•ì¸
git branch

# ë©”ì¸ ë¸Œëœì¹˜ì— ë¨¸ì§€ (ë¦¬ë·° í›„)
git checkout main
git merge feat/add-[ì§€í‘œëª…]
```

---

## 11. ì²´í¬ë¦¬ìŠ¤íŠ¸

### 11.1 êµ¬í˜„ ë‹¨ê³„

- [ ] **ì§€í‘œ ì„¤ê³„**
  - [ ] ëª©ì  ë° í™œìš© ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
  - [ ] LOOKAHEAD-FREE ê²€ì¦
  - [ ] ê³µì‹ ë° ë‹¨ìœ„ ì •ì˜

- [ ] **ì½”ë“œ ì‘ì„±**
  - [ ] metrics_enhanced.pyì— ì§€í‘œ êµ¬í˜„
  - [ ] Zero Division ì²˜ë¦¬
  - [ ] NaN ì²˜ë¦¬
  - [ ] ì£¼ì„ ì‘ì„±

### 11.2 ë¬¸ì„œí™” ë‹¨ê³„

- [ ] **ìë™ ë¬¸ì„œí™”**
  - [ ] back_static.py derived_docs ì¶”ê°€
  - [ ] desc, unit, formula, note ì‘ì„±

- [ ] **í†µí•© ë³´ê³ ì„œ**
  - [ ] SystemAnalysis í´ë”ì— ë³´ê³ ì„œ ì‘ì„±
  - [ ] docs/Study/README.md ì—…ë°ì´íŠ¸

### 11.3 ì‹œìŠ¤í…œ í†µí•© ë‹¨ê³„

- [ ] **í•„í„° ì‹œìŠ¤í…œ**
  - [ ] filter_evaluator.py explicit_buy_columns ì—…ë°ì´íŠ¸
  - [ ] LOOKAHEAD ì§€í‘œ ì œì™¸ í™•ì¸

- [ ] **ML ì‹œìŠ¤í…œ**
  - [ ] ml.py explicit_buy_columns ì—…ë°ì´íŠ¸
  - [ ] LOOKAHEAD ì§€í‘œ ì œì™¸ í™•ì¸

### 11.4 ê²€ì¦ ë‹¨ê³„

- [ ] **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**
  - [ ] í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
  - [ ] ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

- [ ] **í†µí•© í…ŒìŠ¤íŠ¸**
  - [ ] ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰
  - [ ] detail.csvì— ì‹ ê·œ ì»¬ëŸ¼ í™•ì¸
  - [ ] report.txtì— ë¬¸ì„œ í™•ì¸
  - [ ] filter.csvì— í•„í„° í›„ë³´ í™•ì¸

### 11.5 ë°°í¬ ë‹¨ê³„

- [ ] **Git ì‘ì—…**
  - [ ] ë³€ê²½ íŒŒì¼ ìŠ¤í…Œì´ì§•
  - [ ] ìƒì„¸í•œ í•œê¸€ ì»¤ë°‹ ë©”ì‹œì§€ ì‘ì„±
  - [ ] ì»¤ë°‹ ì‹¤í–‰
  - [ ] ë¨¸ì§€ (ë¦¬ë·° í›„)

---

## 12. ì°¸ê³  ì‚¬ë¡€

### 12.1 ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆ ë¹„ìœ¨ ì§€í‘œ (2025-12-28)

**ë°°ê²½**:
- ê¸°ì¡´ 93ê°œ ì§€í‘œ ì¤‘ ë‹¹ì¼ê±°ë˜ëŒ€ê¸ˆì˜ ì ˆëŒ€ê°’ë§Œ ìˆê³  ì‹œê³„ì—´ ë³€í™”ìœ¨ ì—†ìŒ
- ìœ ë™ì„± ê¸‰ì¦/ê¸‰ë½ ê°ì§€ë¥¼ ìœ„í•œ ë¹„ìœ¨ ì§€í‘œ í•„ìš”

**êµ¬í˜„**:
- 3ê°œ ì§€í‘œ ì¶”ê°€ (ì „í‹±ë¶„ë´‰ ë¹„ìœ¨, ë§¤ìˆ˜ë§¤ë„ ë¹„ìœ¨, 5í‹±ë¶„ë´‰í‰ê·  ë¹„ìœ¨)
- 4ê°œ íŒŒì¼ ìˆ˜ì • (metrics_enhanced.py, back_static.py, filter_evaluator.py, ml.py)
- 3ê°œ íŒŒì¼ ì‹ ê·œ (í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸, í†µí•© ë³´ê³ ì„œ, í”„ë¡œì„¸ìŠ¤ ê°€ì´ë“œ)

**ê²°ê³¼**:
- detail.csv: 93ê°œ â†’ 96ê°œ ì»¬ëŸ¼
- í•„í„° í›„ë³´: 2ê°œ ì¶”ê°€ (LOOKAHEAD-FREEë§Œ)
- ML feature: 2ê°œ ì¶”ê°€
- ë¬¸ì„œí™”: 48KB í†µí•© ë³´ê³ ì„œ

**ì†Œìš” ì‹œê°„**: ~4ì‹œê°„

**ì°¸ê³  ë¬¸ì„œ**:
- `docs/Study/SystemAnalysis/2025-12-28_New_Metrics_Integration_Verification_Report.md`
- `docs/Study/SystemAnalysis/2025-12-28_Backtesting_Output_System_Analysis.md`

---

## ğŸ“Œ ìµœì¢… ìš”ì•½

### í”„ë¡œì„¸ìŠ¤ íë¦„ë„

```
1. ì§€í‘œ ì„¤ê³„ ë° ê²€ì¦
   â†“
2. metrics_enhanced.py êµ¬í˜„
   â†“
3. back_static.py ë¬¸ì„œí™”
   â†“
4. filter_evaluator.py í†µí•© (LOOKAHEAD-FREEë§Œ)
   â†“
5. ml.py í†µí•© (LOOKAHEAD-FREEë§Œ)
   â†“
6. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ì‹¤í–‰
   â†“
7. í†µí•© í…ŒìŠ¤íŠ¸ (ë°±í…ŒìŠ¤íŒ…)
   â†“
8. í†µí•© ê²€ì¦ ë³´ê³ ì„œ ì‘ì„±
   â†“
9. Git ì»¤ë°‹ (ìƒì„¸í•œ í•œê¸€ ë©”ì‹œì§€)
   â†“
10. ë°°í¬ ë° ìš´ì˜
```

### í•µì‹¬ ì›ì¹™

1. **LOOKAHEAD-FREE**: ë§¤ìˆ˜ ì‹œì  ë°ì´í„°ë§Œ ì‚¬ìš©
2. **Zero Division Safe**: ë¶„ëª¨ 0 ì²˜ë¦¬ í•„ìˆ˜
3. **ìë™ ë¬¸ì„œí™”**: report.txtì— ê³µì‹ í¬í•¨
4. **ì™„ì „ í†µí•©**: 6ê°œ ì‹œìŠ¤í…œ ëª¨ë‘ í†µí•©
5. **ì² ì €í•œ ê²€ì¦**: ë‹¨ìœ„ + í†µí•© í…ŒìŠ¤íŠ¸

---

**ë¬¸ì„œ ì‘ì„± ì™„ë£Œ - ì‹ ê·œ ì§€í‘œ ê°œë°œ ì‹œ ì´ ê°€ì´ë“œë¥¼ ë”°ë¼ ì§„í–‰í•˜ì„¸ìš”!**
