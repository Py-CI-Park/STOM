# 조건식 (Condition) - Tick 기반 모멘텀 전략

- STOM 주식 자동거래에 사용하기 위한 조건식 문서
- [Back_Testing_Guideline_Tick](../../Guideline/Back_Testing_Guideline_Tick.md) 을(를) 기반으로 작성한 Tick 조건식
- [Condition_Document_Template_Guideline](../../Guideline/Condition_Document_Template_Guideline.md) 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 목차
- [조건식 (Condition) - Tick 기반 모멘텀 전략](#조건식-condition---tick-기반-모멘텀-전략)
  - [목차](#목차)
  - [개요](#개요)
  - [가이드라인](#가이드라인)
    - [변수·이름 규칙](#변수이름-규칙)
- [Condition - Tick 935\_945 Momentum](#condition---tick-935_945-momentum)
  - [조건식](#조건식)
    - [매수 조건식 - C\_T\_935\_945\_M\_B](#매수-조건식---c_t_935_945_m_b)
    - [매도 조건식 - C\_T\_935\_945\_M\_S](#매도-조건식---c_t_935_945_m_s)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식 - C\_T\_935\_945\_M\_BO](#매수-최적화-조건식---c_t_935_945_m_bo)
    - [매수 최적화 범위 - C\_T\_935\_945\_M\_BOR](#매수-최적화-범위---c_t_935_945_m_bor)
    - [매도 최적화 조건식 - C\_T\_935\_945\_M\_SO](#매도-최적화-조건식---c_t_935_945_m_so)
    - [매도 최적화 범위 - C\_T\_935\_945\_M\_SOR](#매도-최적화-범위---c_t_935_945_m_sor)
    - [매수·매도 통합 최적화 범위 - C\_T\_935\_945\_M\_OR](#매수매도-통합-최적화-범위---c_t_935_945_m_or)
    - [예상 시간 계산](#예상-시간-계산)
    - [GA 최적화 범위 - C\_T\_935\_945\_M\_GAR](#ga-최적화-범위---c_t_935_945_m_gar)
  - [조건식 개선 방향 연구](#조건식-개선-방향-연구)
  - [태그](#태그)

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **장 초반 09:35:00 ~ 09:45:00 (Tick 데이터)** 구간에 사용하는 **체결강도 + 거래대금 모멘텀 복합 전략** 조건식을 정의합니다.

- **대상 시간 구간**: 09:35:00 ~ 09:45:00 (장초 후반부 10분)
- **대상 종목**: 관심종목, 시가총액 차등 기준 (2,000억 / 5,000억 / 그 이상)
- **전략 타입**: 체결강도 모멘텀 + 거래대금 가속 + 등락율각도 복합 전략
- **핵심 변수**: 체결강도, 초당거래대금, 등락율각도, 당일거래대금각도, 누적초당매수/매도수량

**전략의 핵심 아이디어**:
1. **체결강도 모멘텀 분석**: 체결강도 평균 대비 현재 체결강도 비율로 매수세 강도 측정
2. **거래대금 가속도 검증**: 초당거래대금과 평균의 비율로 거래 가속 확인
3. **등락율각도 복합 활용**: 등락율각도 + 당일거래대금각도로 추세 강도 이중 검증
4. **누적지표 매매압력 분석**: 30틱 누적 매수/매도수량으로 지속적 매수세 확인
5. **시가총액 차등 전략**: 중소형주/중형주/대형주별 맞춤 조건 적용

**기존 전략 대비 차별점**:
- **925_935 각도 전략**: 각도 지표 3종(등락율, 전일비, 당일거래대금) 중심 → **본 전략**: 체결강도 + 거래대금 모멘텀 중심
- **900_920 Enhanced**: 시간대 4구간 세분화 → **본 전략**: 단일 시간대(09:35~09:45) 집중, 모멘텀 지속성 검증 강화
- 장초 급등 이후 **추세 지속 종목 포착**에 최적화

## 가이드라인

- 모든 조건식은 Python으로 작성되어 있으며, 주식 거래의 자동화를 목표로 합니다.
- 각 조건식은 특정 조건을 만족할 때 매수 또는 매도를 실행합니다.
- 최적화 조건식은 변수의 범위를 설정하여 최적의 매수/매도 시점을 찾습니다.
- 최적화 범위는 `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]` 형식으로 설정합니다.
- `self.vars[0]`은 고정값으로 설정되며, 조건식 변수는 `self.vars[1]`부터 공백 없이 사용됩니다.

### 변수·이름 규칙

1. **기본 규칙**:
   - `C`: Condition을 의미
   - `T`: Tick을 의미
   - `935_945`: 09:35:00 ~ 09:45:00 시간대
   - `M`: Momentum (모멘텀 전략)
   - `B`: 매수 조건식
   - `S`: 매도 조건식
   - `BO`: 매수 최적화 조건식
   - `SO`: 매도 최적화 조건식
   - `BOR`: 매수 최적화 범위
   - `SOR`: 매도 최적화 범위
   - `OR`: 매수·매도 통합 최적화 범위
   - `GAR`: GA 최적화 범위

2. **예시**:
   - `C_T_935_945_M_B`: 935_945 모멘텀 전략 매수 조건식
   - `C_T_935_945_M_S`: 935_945 모멘텀 전략 매도 조건식
   - `C_T_935_945_M_BO`: 935_945 모멘텀 전략 매수 최적화 조건식
   - `C_T_935_945_M_SO`: 935_945 모멘텀 전략 매도 최적화 조건식

---

# Condition - Tick 935_945 Momentum

## 조건식

### 매수 조건식 - C_T_935_945_M_B

```python
# ================================
#  공통 계산 지표
# ================================
전일종가              = 현재가 / (1 + (등락율 / 100))                      # 단위: 원
시가등락율            = ((시가 - 전일종가) / 전일종가) * 100                # 단위: 퍼센트
시가대비등락율        = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트
초당순매수금액        = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000   # 단위: 백만원
체결강도모멘텀        = 체결강도 / 체결강도평균(30) if 체결강도평균(30) > 0 else 0  # 체결강도 모멘텀 비율
거래대금가속도        = 초당거래대금 / 초당거래대금평균(30) if 초당거래대금평균(30) > 0 else 0  # 거래대금 가속 비율


# ================================
#  매수 조건
# ================================
매수 = True

# 1. 공통 필터
if not (관심종목 == 1):
    매수 = False
elif not (93500 <= 시분초 < 94500):                # 09:35:00 ~ 09:45:00
    매수 = False
elif not (1000 <= 현재가 <= 50000):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (초당거래대금 > 초당거래대금N(1)):          # 거래대금 증가 확인
    매수 = False


# 2. 시가총액별 차등 조건
elif 시가총액 < 2000:                               # 중소형주 (< 2,000억)
    # 2-1. 체결강도 모멘텀 검증
    if not (1.2 < 체결강도모멘텀 < 3.0):              # 평균 대비 1.2~3배
        매수 = False
    elif not (70 <= 체결강도 <= 300):
        매수 = False
    elif not (최고체결강도(30) > 최저체결강도(30) * 1.5):  # 변동성 적정 범위
        매수 = False

    # 2-2. 거래대금 가속도 검증
    elif not (2.0 < 거래대금가속도 < 8.0):            # 평균 대비 2~8배
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) > 50_000_000):  # 최소 가속 금액
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < 1000_000_000):  # 과도한 급등 제외
        매수 = False

    # 2-3. 등락율각도 복합 검증
    elif not (5 < 등락율각도(30) < 60):
        매수 = False
    elif not (당일거래대금각도(30) > 5):
        매수 = False
    elif not (등락율각도(30) > 당일거래대금각도(30) * 0.5):  # 등락율각도가 거래대금각도의 50% 이상
        매수 = False

    # 2-4. 가격 위치 및 등락율 검증
    elif not (0 <= 시가등락율 < 8.0):
        매수 = False
    elif not (2.0 <= 시가대비등락율 < 12.0):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 0.25):  # 고가 대비 75% 이상
        매수 = False
    elif not (등락율 >= 2.0):
        매수 = False

    # 2-5. 호가잔량 밸런스 분석
    elif not (매도총잔량 * 현재가 / 100_000_000 > 1):  # 최소 매도잔량 1억원
        매수 = False
    elif not (매도총잔량 * 현재가 / 100_000_000 < 15):  # 최대 매도잔량 15억원
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * 0.5):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 2.5):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * 0.30):
        매수 = False
    elif not (초당매도수량 < 매수총잔량 * 0.25):
        매수 = False

    # 2-6. 거래대금 및 비율 검증
    elif not (당일거래대금 > 30 * 100):                # 30억 이상
        매수 = False
    elif not (전일비 > 100):
        매수 = False
    elif not (전일동시간비 > 120):
        매수 = False
    elif not (회전율 > 2.0):
        매수 = False

    # 2-7. 누적지표 검증 (지속성)
    elif not (누적초당매수수량(30) > 누적초당매도수량(30) * 1.1):  # 누적 매수 > 매도 * 1.1
        매수 = False
    elif not (최고초당매수수량(30) > 최고초당매도수량(30) * 1.5):
        매수 = False

    # 2-8. 순매수금액 검증
    elif not (40 < 초당순매수금액 < 800):              # 40백만원 ~ 800백만원
        매수 = False


elif 시가총액 < 5000:                               # 중형주 (2,000억 ~ 5,000억)
    # 2-1. 체결강도 모멘텀 검증 (보수적)
    if not (1.3 < 체결강도모멘텀 < 2.5):
        매수 = False
    elif not (80 <= 체결강도 <= 280):
        매수 = False
    elif not (최고체결강도(30) > 최저체결강도(30) * 1.3):
        매수 = False

    # 2-2. 거래대금 가속도 검증
    elif not (1.8 < 거래대금가속도 < 6.0):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) > 80_000_000):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < 800_000_000):
        매수 = False

    # 2-3. 등락율각도 복합 검증
    elif not (6 < 등락율각도(30) < 50):
        매수 = False
    elif not (당일거래대금각도(30) > 7):
        매수 = False
    elif not (등락율각도(30) > 당일거래대금각도(30) * 0.6):
        매수 = False

    # 2-4. 가격 위치 및 등락율 검증
    elif not (0.5 <= 시가등락율 < 6.0):
        매수 = False
    elif not (2.5 <= 시가대비등락율 < 10.0):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 0.30):  # 고가 대비 70% 이상
        매수 = False
    elif not (등락율 >= 2.5):
        매수 = False

    # 2-5. 호가잔량 밸런스 분석
    elif not (매도총잔량 * 현재가 / 100_000_000 > 2):
        매수 = False
    elif not (매도총잔량 * 현재가 / 100_000_000 < 25):
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * 0.6):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 3.0):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * 0.25):
        매수 = False
    elif not (초당매도수량 < 매수총잔량 * 0.20):
        매수 = False

    # 2-6. 거래대금 및 비율 검증
    elif not (당일거래대금 > 50 * 100):                # 50억 이상
        매수 = False
    elif not (전일비 > 80):
        매수 = False
    elif not (전일동시간비 > 100):
        매수 = False
    elif not (회전율 > 1.5):
        매수 = False

    # 2-7. 누적지표 검증
    elif not (누적초당매수수량(30) > 누적초당매도수량(30) * 1.15):
        매수 = False
    elif not (최고초당매수수량(30) > 최고초당매도수량(30) * 2.0):
        매수 = False

    # 2-8. 순매수금액 검증
    elif not (60 < 초당순매수금액 < 600):
        매수 = False


else:                                                # 대형주 (> 5,000억)
    # 2-1. 체결강도 모멘텀 검증 (가장 보수적)
    if not (1.4 < 체결강도모멘텀 < 2.2):
        매수 = False
    elif not (90 <= 체결강도 <= 250):
        매수 = False
    elif not (최고체결강도(30) > 최저체결강도(30) * 1.2):
        매수 = False

    # 2-2. 거래대금 가속도 검증
    elif not (1.6 < 거래대금가속도 < 5.0):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) > 100_000_000):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < 600_000_000):
        매수 = False

    # 2-3. 등락율각도 복합 검증
    elif not (7 < 등락율각도(30) < 40):
        매수 = False
    elif not (당일거래대금각도(30) > 9):
        매수 = False
    elif not (등락율각도(30) > 당일거래대금각도(30) * 0.7):
        매수 = False

    # 2-4. 가격 위치 및 등락율 검증
    elif not (1.0 <= 시가등락율 < 5.0):
        매수 = False
    elif not (3.0 <= 시가대비등락율 < 8.0):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 0.35):  # 고가 대비 65% 이상
        매수 = False
    elif not (등락율 >= 3.0):
        매수 = False

    # 2-5. 호가잔량 밸런스 분석
    elif not (매도총잔량 * 현재가 / 100_000_000 > 5):
        매수 = False
    elif not (매도총잔량 * 현재가 / 100_000_000 < 40):
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * 0.7):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 3.5):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * 0.20):
        매수 = False
    elif not (초당매도수량 < 매수총잔량 * 0.15):
        매수 = False

    # 2-6. 거래대금 및 비율 검증
    elif not (당일거래대금 > 100 * 100):               # 100억 이상
        매수 = False
    elif not (전일비 > 60):
        매수 = False
    elif not (전일동시간비 > 80):
        매수 = False
    elif not (회전율 > 1.0):
        매수 = False

    # 2-7. 누적지표 검증
    elif not (누적초당매수수량(30) > 누적초당매도수량(30) * 1.2):
        매수 = False
    elif not (최고초당매수수량(30) > 최고초당매도수량(30) * 2.5):
        매수 = False

    # 2-8. 순매수금액 검증
    elif not (80 < 초당순매수금액 < 500):
        매수 = False
```

### 매도 조건식 - C_T_935_945_M_S

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율    = ((현재가 - 시가) / 시가) * 100

# ================================
#  매도 조건
# ================================
매도 = False

# 1. 상한가 직전 익절
if 등락율 > 29.5:
    매도 = True

# 2. 손절 조건
elif 시가대비등락율 < 0 and 수익률 <= -2.5 and 현재가 < 최저현재가(int(60), int(보유시간)):
    매도 = True

# 3. 시간 기반 청산 (보유시간 120초 초과)
elif 보유시간 > 120 and 수익률 < 3.0:
    매도 = True

# 4. 고수익률 달성 후 하락 (Trailing Stop)
elif 최고수익률 > 7.0 and 수익률 < 최고수익률 * 0.55:  # 고점 대비 45% 하락
    매도 = True

# 5. 익절/손절 조건 (수익률 기반)
elif 수익률 >= 6.0 or 수익률 <= -3.0:
    매도 = True

# 6. 추세 훼손 조건 (시가총액별)
elif 시가총액 < 2000:                                 # 중소형주
    if 등락율각도(30) >= 15 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.6:
        if (현재가 / 현재가N(1) - 1) * 100 < -0.6:
            매도 = True

elif 시가총액 < 5000:                                 # 중형주
    if 등락율각도(30) >= 12 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.7:
        if (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True

else:                                                  # 대형주
    if 등락율각도(30) >= 10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.8:
        if (현재가 / 현재가N(1) - 1) * 100 < -0.4:
            매도 = True

# 7. 전략 종료 시점 강제 청산
elif 시분초 >= 94500:                                 # 09:45:00 이후
    매도 = True
```

---

## 최적화 조건식

### 매수 최적화 조건식 - C_T_935_945_M_BO

```python
# ================================
#  공통 계산 지표
# ================================
전일종가              = 현재가 / (1 + (등락율 / 100))
시가등락율            = ((시가 - 전일종가) / 전일종가) * 100
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
초당순매수금액        = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000
체결강도모멘텀        = 체결강도 / 체결강도평균(30) if 체결강도평균(30) > 0 else 0
거래대금가속도        = 초당거래대금 / 초당거래대금평균(30) if 초당거래대금평균(30) > 0 else 0

매수 = True

if not (관심종목 == 1):
    매수 = False
elif not (93500 <= 시분초 < 94500):
    매수 = False
elif not (1000 <= 현재가 <= 50000):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (초당거래대금 > 초당거래대금N(1)):
    매수 = False

elif 시가총액 < 2000:
    if not (self.vars[1][1] < 체결강도모멘텀 < self.vars[2][1]):
        매수 = False
    elif not (self.vars[3][1] <= 체결강도 <= 300):
        매수 = False
    elif not (self.vars[4][1] < 거래대금가속도 < self.vars[5][1]):
        매수 = False
    elif not (self.vars[6][1] < 등락율각도(30) < 60):
        매수 = False
    elif not (당일거래대금각도(30) > self.vars[7][1]):
        매수 = False
    elif not (self.vars[8][1] <= 시가대비등락율 < self.vars[9][1]):
        매수 = False
    elif not (등락율 >= self.vars[10][1]):
        매수 = False
    elif not (회전율 > self.vars[11][1]):
        매수 = False
    elif not (전일비 > self.vars[12][1]):
        매수 = False
    elif not (초당순매수금액 > self.vars[13][1] and 초당순매수금액 < 800):
        매수 = False

elif 시가총액 < 5000:
    if not (self.vars[14][1] < 체결강도모멘텀 < self.vars[15][1]):
        매수 = False
    elif not (self.vars[16][1] <= 체결강도 <= 280):
        매수 = False
    elif not (self.vars[17][1] < 거래대금가속도 < self.vars[18][1]):
        매수 = False
    elif not (self.vars[19][1] < 등락율각도(30) < 50):
        매수 = False
    elif not (당일거래대금각도(30) > self.vars[20][1]):
        매수 = False
    elif not (self.vars[21][1] <= 시가대비등락율 < self.vars[22][1]):
        매수 = False
    elif not (등락율 >= self.vars[23][1]):
        매수 = False
    elif not (회전율 > self.vars[24][1]):
        매수 = False
    elif not (전일비 > self.vars[25][1]):
        매수 = False
    elif not (초당순매수금액 > self.vars[26][1] and 초당순매수금액 < 600):
        매수 = False

else:
    if not (self.vars[27][1] < 체결강도모멘텀 < self.vars[28][1]):
        매수 = False
    elif not (self.vars[29][1] <= 체결강도 <= 250):
        매수 = False
    elif not (self.vars[30][1] < 거래대금가속도 < self.vars[31][1]):
        매수 = False
    elif not (self.vars[32][1] < 등락율각도(30) < 40):
        매수 = False
    elif not (당일거래대금각도(30) > self.vars[33][1]):
        매수 = False
    elif not (self.vars[34][1] <= 시가대비등락율 < self.vars[35][1]):
        매수 = False
    elif not (등락율 >= self.vars[36][1]):
        매수 = False
    elif not (회전율 > self.vars[37][1]):
        매수 = False
    elif not (전일비 > self.vars[38][1]):
        매수 = False
    elif not (초당순매수금액 > self.vars[39][1] and 초당순매수금액 < 500):
        매수 = False
```

### 매수 최적화 범위 - C_T_935_945_M_BOR

```python
# 평균 틱수 고정값
self.vars[0] = [[30], 30]  # 평균 틱수 고정값: 30, 범위 갯수: 1

# 매수 최적화 범위 - 중소형주 (< 2,000억)
self.vars[1] = [[1.1, 1.5, 0.1], 1.2]              # 체결강도모멘텀 하한: 1.1~1.5, 0.1 간격, 범위 갯수: 5
self.vars[2] = [[2.5, 3.5, 0.2], 3.0]              # 체결강도모멘텀 상한: 2.5~3.5, 0.2 간격, 범위 갯수: 6
self.vars[3] = [[60, 80, 10], 70]                  # 체결강도 하한: 60~80, 10 간격, 범위 갯수: 3
self.vars[4] = [[1.8, 2.4, 0.2], 2.0]              # 거래대금가속도 하한: 1.8~2.4, 0.2 간격, 범위 갯수: 4
self.vars[5] = [[7.0, 9.0, 0.5], 8.0]              # 거래대금가속도 상한: 7.0~9.0, 0.5 간격, 범위 갯수: 5
self.vars[6] = [[4, 6, 1], 5]                      # 등락율각도 하한: 4~6, 1 간격, 범위 갯수: 3
self.vars[7] = [[4, 6, 1], 5]                      # 당일거래대금각도 하한: 4~6, 1 간격, 범위 갯수: 3
self.vars[8] = [[1.5, 2.5, 0.5], 2.0]              # 시가대비등락율 하한: 1.5%~2.5%, 0.5% 간격, 범위 갯수: 3
self.vars[9] = [[11.0, 13.0, 1.0], 12.0]           # 시가대비등락율 상한: 11.0%~13.0%, 1.0% 간격, 범위 갯수: 3
self.vars[10] = [[1.5, 2.5, 0.5], 2.0]             # 등락율 하한: 1.5%~2.5%, 0.5% 간격, 범위 갯수: 3
self.vars[11] = [[1.5, 2.5, 0.5], 2.0]             # 회전율 하한: 1.5~2.5배, 0.5배 간격, 범위 갯수: 3
self.vars[12] = [[80, 120, 20], 100]               # 전일비 하한: 80~120%, 20% 간격, 범위 갯수: 3
self.vars[13] = [[30, 50, 10], 40]                 # 초당순매수금액 하한: 30~50백만원, 10백만원 간격, 범위 갯수: 3

# 매수 최적화 범위 - 중형주 (2,000억 ~ 5,000억)
self.vars[14] = [[1.2, 1.6, 0.1], 1.3]             # 체결강도모멘텀 하한: 1.2~1.6, 0.1 간격, 범위 갯수: 5
self.vars[15] = [[2.2, 3.0, 0.2], 2.5]             # 체결강도모멘텀 상한: 2.2~3.0, 0.2 간격, 범위 갯수: 5
self.vars[16] = [[70, 90, 10], 80]                 # 체결강도 하한: 70~90, 10 간격, 범위 갯수: 3
self.vars[17] = [[1.6, 2.2, 0.2], 1.8]             # 거래대금가속도 하한: 1.6~2.2, 0.2 간격, 범위 갯수: 4
self.vars[18] = [[5.5, 7.0, 0.5], 6.0]             # 거래대금가속도 상한: 5.5~7.0, 0.5 간격, 범위 갯수: 4
self.vars[19] = [[5, 7, 1], 6]                     # 등락율각도 하한: 5~7, 1 간격, 범위 갯수: 3
self.vars[20] = [[6, 8, 1], 7]                     # 당일거래대금각도 하한: 6~8, 1 간격, 범위 갯수: 3
self.vars[21] = [[2.0, 3.0, 0.5], 2.5]             # 시가대비등락율 하한: 2.0%~3.0%, 0.5% 간격, 범위 갯수: 3
self.vars[22] = [[9.5, 11.0, 0.5], 10.0]           # 시가대비등락율 상한: 9.5%~11.0%, 0.5% 간격, 범위 갯수: 4
self.vars[23] = [[2.0, 3.0, 0.5], 2.5]             # 등락율 하한: 2.0%~3.0%, 0.5% 간격, 범위 갯수: 3
self.vars[24] = [[1.2, 1.8, 0.3], 1.5]             # 회전율 하한: 1.2~1.8배, 0.3배 간격, 범위 갯수: 3
self.vars[25] = [[70, 90, 10], 80]                 # 전일비 하한: 70~90%, 10% 간격, 범위 갯수: 3
self.vars[26] = [[50, 70, 10], 60]                 # 초당순매수금액 하한: 50~70백만원, 10백만원 간격, 범위 갯수: 3

# 매수 최적화 범위 - 대형주 (> 5,000억)
self.vars[27] = [[1.3, 1.7, 0.1], 1.4]             # 체결강도모멘텀 하한: 1.3~1.7, 0.1 간격, 범위 갯수: 5
self.vars[28] = [[2.0, 2.6, 0.2], 2.2]             # 체결강도모멘텀 상한: 2.0~2.6, 0.2 간격, 범위 갯수: 4
self.vars[29] = [[80, 100, 10], 90]                # 체결강도 하한: 80~100, 10 간격, 범위 갯수: 3
self.vars[30] = [[1.4, 2.0, 0.2], 1.6]             # 거래대금가속도 하한: 1.4~2.0, 0.2 간격, 범위 갯수: 4
self.vars[31] = [[4.5, 6.0, 0.5], 5.0]             # 거래대금가속도 상한: 4.5~6.0, 0.5 간격, 범위 갯수: 4
self.vars[32] = [[6, 8, 1], 7]                     # 등락율각도 하한: 6~8, 1 간격, 범위 갯수: 3
self.vars[33] = [[8, 10, 1], 9]                    # 당일거래대금각도 하한: 8~10, 1 간격, 범위 갯수: 3
self.vars[34] = [[2.5, 3.5, 0.5], 3.0]             # 시가대비등락율 하한: 2.5%~3.5%, 0.5% 간격, 범위 갯수: 3
self.vars[35] = [[7.5, 9.0, 0.5], 8.0]             # 시가대비등락율 상한: 7.5%~9.0%, 0.5% 간격, 범위 갯수: 4
self.vars[36] = [[2.5, 3.5, 0.5], 3.0]             # 등락율 하한: 2.5%~3.5%, 0.5% 간격, 범위 갯수: 3
self.vars[37] = [[0.8, 1.2, 0.2], 1.0]             # 회전율 하한: 0.8~1.2배, 0.2배 간격, 범위 갯수: 3
self.vars[38] = [[50, 70, 10], 60]                 # 전일비 하한: 50~70%, 10% 간격, 범위 갯수: 3
self.vars[39] = [[70, 90, 10], 80]                 # 초당순매수금액 하한: 70~90백만원, 10백만원 간격, 범위 갯수: 3

# 매수 총 경우의 수: 5 × 6 × 3 × 4 × 5 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 5 × 5 × 3 × 4 × 4 × 3 × 3 × 3 × 4 × 3 × 3 × 3 × 3 × 5 × 4 × 3 × 4 × 4 × 3 × 3 × 3 × 4 × 3 × 3 × 3 × 3
# = 매우 큰 수 (범위 축소 또는 GA 최적화 권장)
```

### 매도 최적화 조건식 - C_T_935_945_M_SO

```python
시가대비등락율 = ((현재가 - 시가) / 시가) * 100

매도 = False

if 등락율 > self.vars[40][1]:
    매도 = True
elif 시가대비등락율 < 0 and 수익률 <= self.vars[41][1] and 현재가 < 최저현재가(int(60), int(보유시간)):
    매도 = True
elif 보유시간 > self.vars[42][1] and 수익률 < self.vars[43][1]:
    매도 = True
elif 최고수익률 > self.vars[44][1] and 수익률 < 최고수익률 * self.vars[45][1]:
    매도 = True
elif 수익률 >= self.vars[46][1] or 수익률 <= self.vars[47][1]:
    매도 = True
elif 시분초 >= 94500:
    매도 = True
```

### 매도 최적화 범위 - C_T_935_945_M_SOR

```python
# 매도 최적화 범위 (매수 변수 39 다음부터 40번부터 시작)
self.vars[40] = [[28.5, 30.0, 0.5], 29.5]          # 등락율 상한가: 28.5%~30.0%, 0.5% 간격, 범위 갯수: 4
self.vars[41] = [[-3.5, -2.0, 0.5], -2.5]          # 손실 수익률: -3.5%~-2.0%, 0.5% 간격, 범위 갯수: 4
self.vars[42] = [[100, 140, 20], 120]              # 최대 보유시간: 100~140초, 20초 간격, 범위 갯수: 3
self.vars[43] = [[2.5, 3.5, 0.5], 3.0]             # 장기보유 최소 수익률: 2.5%~3.5%, 0.5% 간격, 범위 갯수: 3
self.vars[44] = [[6.0, 8.0, 0.5], 7.0]             # Trailing Stop 발동 수익률: 6.0%~8.0%, 0.5% 간격, 범위 갯수: 5
self.vars[45] = [[0.50, 0.60, 0.05], 0.55]         # Trailing Stop 비율: 50%~60%, 5% 간격, 범위 갯수: 3
self.vars[46] = [[5.5, 6.5, 0.5], 6.0]             # 익절 수익률: 5.5%~6.5%, 0.5% 간격, 범위 갯수: 3
self.vars[47] = [[-3.5, -2.5, 0.5], -3.0]          # 손절 수익률: -3.5%~-2.5%, 0.5% 간격, 범위 갯수: 3

# 매도 총 경우의 수: 4 × 4 × 3 × 3 × 5 × 3 × 3 × 3 = 25,920
```

### 매수·매도 통합 최적화 범위 - C_T_935_945_M_OR

핵심 변수만 묶어 탐색 효율 향상:

```python
OR_INDEX = [1, 3, 4, 6, 10, 14, 16, 17, 27, 29, 30, 40, 41, 46, 47]  # 핵심 15개 변수만 선택
# 경우의 수: 5 × 3 × 4 × 3 × 3 × 5 × 3 × 4 × 5 × 3 × 4 × 4 × 4 × 3 × 3 = 약 1,866,240,000 (약 19억)
# → 범위 축소 필요 또는 GA 최적화 권장
```

### 예상 시간 계산

```python
# 매수 경우의 수: 매우 큰 수 (수조 단위 이상)
# 매도 경우의 수: 25,920
# 총 경우의 수: 매우 큰 수 × 25,920

# → 현실적으로 전체 Grid Search 불가능
# → 권장 방법:
#    1. 핵심 변수만 선택한 OR_INDEX 사용 (하지만 여전히 19억 경우의 수)
#    2. GA 최적화 사용 (아래 GAR 섹션 참고)
#    3. 2단계 최적화: 1차(넓은 범위, 큰 간격) → 2차(좁은 범위, 작은 간격)
```

### GA 최적화 범위 - C_T_935_945_M_GAR

일반 범위를 GA 리스트 형태로 변환:

```python
# GA 최적화 범위 - 중소형주 핵심 변수
self.vars[1] = [[1.1, 1.2, 1.3, 1.4, 1.5], 1.2]   # 체결강도모멘텀 하한, 범위 갯수: 5
self.vars[3] = [[60, 70, 80], 70]                  # 체결강도 하한, 범위 갯수: 3
self.vars[4] = [[1.8, 2.0, 2.2, 2.4], 2.0]         # 거래대금가속도 하한, 범위 갯수: 4
self.vars[6] = [[4, 5, 6], 5]                      # 등락율각도 하한, 범위 갯수: 3
self.vars[10] = [[1.5, 2.0, 2.5], 2.0]             # 등락율 하한, 범위 갯수: 3

# GA 최적화 범위 - 중형주 핵심 변수
self.vars[14] = [[1.2, 1.3, 1.4, 1.5, 1.6], 1.3]  # 체결강도모멘텀 하한, 범위 갯수: 5
self.vars[16] = [[70, 80, 90], 80]                 # 체결강도 하한, 범위 갯수: 3
self.vars[17] = [[1.6, 1.8, 2.0, 2.2], 1.8]        # 거래대금가속도 하한, 범위 갯수: 4

# GA 최적화 범위 - 대형주 핵심 변수
self.vars[27] = [[1.3, 1.4, 1.5, 1.6, 1.7], 1.4]  # 체결강도모멘텀 하한, 범위 갯수: 5
self.vars[29] = [[80, 90, 100], 90]                # 체결강도 하한, 범위 갯수: 3
self.vars[30] = [[1.4, 1.6, 1.8, 2.0], 1.6]        # 거래대금가속도 하한, 범위 갯수: 4

# GA 최적화 범위 - 매도 핵심 변수
self.vars[40] = [[28.5, 29.0, 29.5, 30.0], 29.5]  # 등락율 상한가, 범위 갯수: 4
self.vars[41] = [[-3.5, -3.0, -2.5, -2.0], -2.5]  # 손실 수익률, 범위 갯수: 4
self.vars[46] = [[5.5, 6.0, 6.5], 6.0]             # 익절 수익률, 범위 갯수: 3
self.vars[47] = [[-3.5, -3.0, -2.5], -3.0]         # 손절 수익률, 범위 갯수: 3
```

---

## 조건식 개선 방향 연구

### 1. 추가 지표 활용 연구

#### 1.1 거래대금가속도 세분화
- **정의**: `(초당거래대금 - 초당거래대금N(1)) / 초당거래대금N(1) * 100`
- **활용 방안**: 1틱 전 대비 거래대금 변화율로 급격한 모멘텀 변화 감지
- **적용 예시**: `거래대금가속도 > 10` → 급등 진입
- **최적화 범위**: `[[5, 20, 5], 10]`

#### 1.2 체결강도가속도
- **정의**: `(체결강도 - 체결강도N(1)) / 체결강도N(1) * 100 if 체결강도N(1) != 0 else 0`
- **활용 방안**: 체결강도 급변 감지
- **최적화 범위**: `[[3, 15, 3], 5]`

### 2. TA-Lib 보조지표 활용 연구

#### 2.1 RSI 필터 추가
- **매수 조건 추가**: `30 < RSI < 70` (과매수/과매도 구간 제외)
- **최적화 범위**:
  - RSI 하한: `[[25, 35, 5], 30]`
  - RSI 상한: `[[65, 75, 5], 70]`

#### 2.2 MACD 활용
- **매수 조건 추가**: `MACD > MACDS and MACD_N(1) <= MACDS_N(1)` (골든크로스)
- **활용 방안**: 추세 전환 확인

### 3. 구간 연산 변수 활용 연구

#### 3.1 이동평균 활용
- **매수 조건 추가**: `현재가 > 이동평균(60)` (60틱 이평선 상향)
- **최적화 범위**: 이동평균 기간 `[[30, 90, 20], 60]`

### 4. 매도 조건 고도화 연구

#### 4.1 시가총액별 Trailing Stop 차등
- 중소형주: 고점 대비 50% 하락
- 중형주: 고점 대비 45% 하락
- 대형주: 고점 대비 40% 하락

### 5. 복합 지표 조합 연구

#### 5.1 모멘텀 종합 지수
```python
모멘텀지수 = (
    체결강도모멘텀 * 0.3 +
    거래대금가속도 * 0.3 +
    등락율각도(30) / 10 * 0.2 +
    당일거래대금각도(30) / 10 * 0.2
)
```
- **활용 방안**: `모멘텀지수 > 1.5` → 강한 모멘텀
- **최적화 범위**: `[[1.2, 2.0, 0.2], 1.5]`

### 6. 시간대별 전략 세분화 연구

#### 6.1 09:35~09:40 vs 09:40~09:45 차등
- 전반부(09:35~09:40): 더 공격적 진입 조건
- 후반부(09:40~09:45): 보수적 조건 강화

### 7. 최적화 전략 개선 연구

#### 7.1 2단계 최적화
1. **1단계**: 넓은 범위, 큰 간격으로 대략적 최적 구간 탐색
2. **2단계**: 1단계 결과 주변을 좁은 범위, 작은 간격으로 정밀 탐색

#### 7.2 GA 하이브리드 전략
- GA로 1차 최적화 후 → Grid Search로 국소 최적화

### 8. 리스크 관리 강화 연구

#### 8.1 동시 보유 종목 수 제한
- 최대 동시 보유 3종목 이하

#### 8.2 연속 손실 제한
- 연속 3회 손실 시 전략 일시 중지

### 9. 백테스팅 개선 방향

#### 9.1 슬리피지 반영
- 매수: 호가 +1틱
- 매도: 호가 -1틱

#### 9.2 시장 충격 모델
- 대량 거래 시 가격 영향 반영

### 10. 구현 우선순위

**High Priority (즉시 적용)**:
1. RSI 필터 추가
2. 2단계 최적화 전략
3. 시가총액별 Trailing Stop 차등

**Medium Priority (1개월 내)**:
4. 모멘텀 종합 지수
5. 거래대금가속도 세분화
6. MACD 활용

**Low Priority (장기 연구)**:
7. 시간대별 전략 세분화
8. 슬리피지 및 시장 충격 모델
9. 동시 보유 종목 수 제한

---

## 태그

#조건식 #Tick #모멘텀전략 #체결강도 #거래대금가속도 #등락율각도 #935_945 #시가총액차등 #최적화 #GA #백테스팅

---

**Last Update: 2025-01-17**
