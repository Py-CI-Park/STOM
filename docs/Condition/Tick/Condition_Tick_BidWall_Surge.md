# 조건식 - 호가창 매수벽 급증 전략

- STOM 주식 자동거래에 사용하기 위한 조건식 문서
- [[Back_Testing_Guideline_Tick]] 을(를) 기반으로 작성한 Tick 조건식
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **장 초반 호가창 매수벽 급증 구간(09:00~09:20) 전략**을 정의한다.

- **대상 시간 구간**: 09:00:00 ~ 09:20:00 (장 초반)
- **대상 종목**: 가격대 1,000원~50,000원, 시가총액 차등 (1,500억 기준)
- **전략 타입**: 호가창 매수벽 급증 포착 (Bid Wall Surge)
- **핵심 변수**: 매수총잔량, 매도총잔량, 호가잔량비율, 매수벽강도, 초당매수수량, 초당순매수금액
- **업데이트 이력**:
  - 초기 문서 작성: 호가창 매수벽 급증 전략

## 목차
- [소개](#소개)
- [전략 개요](#전략-개요)
- [조건식](#조건식)
  - [매수 조건식](#매수-조건식)
  - [매도 조건식](#매도-조건식)
- [최적화 조건식](#최적화-조건식)
  - [매수 최적화 조건식](#매수-최적화-조건식)
  - [매수 최적화 범위 (BOR)](#매수-최적화-범위-bor)
  - [매도 최적화 조건식](#매도-최적화-조건식)
  - [매도 최적화 범위 (SOR)](#매도-최적화-범위-sor)
  - [통합 최적화 범위 (OR)](#통합-최적화-범위-or)
  - [GA 최적화 범위 (GAR)](#ga-최적화-범위-gar)
- [태그](#태그)

---

## 소개

**조건식 이름**: 호가창 매수벽 급증 전략 (Bid Wall Surge Strategy)
**타입**: 틱 데이터 기반 초단타 전략
**거래 시간**: 90000 ~ 92000 (09:00:00 ~ 09:20:00)
**목표**: 장 초반 매수호가 잔량 급증을 포착하여 급등 직전 진입

---

## 전략 개요

### 핵심 아이디어
장 초반 9시~9시20분 구간에서 매수호가 총잔량이 급증하면서 동시에 초당매수수량이 증가하는 패턴을 포착합니다. 이는 큰 손의 매수 의지를 나타내며, 급등 가능성이 높은 신호입니다.

### 주요 특징
1. **매수벽 분석**: 매수총잔량의 급증 감지
2. **호가 불균형**: 매수총잔량 > 매도총잔량 비율 확인
3. **실제 체결**: 초당매수수량이 매도잔량을 압도
4. **시가총액 차등**: 시총별 맞춤 조건 적용
5. **시간 제한**: 장 초반 20분 집중 트레이딩

### 기대 효과
- 큰 손의 매집 구간 조기 포착
- 급등 직전 저점 진입 가능
- 호가창 심리 활용한 타이밍 최적화

---

## 조건식

### 매수 조건식

```python
# 파생 변수 계산
호가잔량비율 = 매수총잔량 / (매도총잔량 or 1)
매수벽강도 = 매수총잔량 * 현재가 / 100_000_000  # 단위: 억원
초당순매수금액 = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000  # 단위: 백만원

# 시간 조건 (장 초반 20분)
if not (90000 <= 시분초 < 92000):
    매수 = False

# 가격 범위
elif not (1000 < 현재가 <= 50000):
    매수 = False

# 등락율 조건
elif not (0.5 < 등락율 <= 25.0):
    매수 = False

# VI 조건
elif not (현재가 < VI아래5호가):
    매수 = False

# 라운드피겨 회피
elif 라운드피겨위5호가이내:
    매수 = False

# 시가총액 1500억 미만
elif 시가총액 < 1500:
    # 매수벽 급증 확인
    if not (호가잔량비율 > 3.0):
        매수 = False
    elif not (매수벽강도 > 5.0):
        매수 = False
    elif not (매수총잔량 > 매수총잔량N(1) * 1.5):
        매수 = False

    # 실제 매수 체결 확인
    elif not (초당매수수량 > 매도총잔량 * 0.6):
        매수 = False
    elif not (초당순매수금액 > 50):
        매수 = False

    # 거래 활성화
    elif not (초당거래대금 > 초당거래대금평균(30) * 2.0):
        매수 = False
    elif not (체결강도 > 150):
        매수 = False

    # 가격 위치
    elif not (현재가 > 고가 - (고가 - 저가) * 0.15):
        매수 = False

    # 추가 확인
    elif not (전일비 > 30):
        매수 = False
    elif not (당일거래대금 > 10 * 100):
        매수 = False
    elif not (등락율각도(30) > 5):
        매수 = False
    elif not (최고초당매수수량(30) * 2.5 > 최고초당매도수량(30)):
        매수 = False

# 시가총액 1500~3000억
elif 시가총액 < 3000:
    if not (호가잔량비율 > 2.5):
        매수 = False
    elif not (매수벽강도 > 8.0):
        매수 = False
    elif not (매수총잔량 > 매수총잔량N(1) * 1.3):
        매수 = False

    elif not (초당매수수량 > 매도총잔량 * 0.5):
        매수 = False
    elif not (초당순매수금액 > 80):
        매수 = False

    elif not (초당거래대금 > 초당거래대금평균(30) * 1.8):
        매수 = False
    elif not (체결강도 > 140):
        매수 = False

    elif not (현재가 > 고가 - (고가 - 저가) * 0.20):
        매수 = False

    elif not (전일비 > 40):
        매수 = False
    elif not (당일거래대금 > 30 * 100):
        매수 = False
    elif not (등락율각도(30) > 7):
        매수 = False
    elif not (최고초당매수수량(30) * 2.0 > 최고초당매도수량(30)):
        매수 = False

# 시가총액 3000억 이상
else:
    if not (호가잔량비율 > 2.0):
        매수 = False
    elif not (매수벽강도 > 12.0):
        매수 = False
    elif not (매수총잔량 > 매수총잔량N(1) * 1.2):
        매수 = False

    elif not (초당매수수량 > 매도총잔량 * 0.4):
        매수 = False
    elif not (초당순매수금액 > 100):
        매수 = False

    elif not (초당거래대금 > 초당거래대금평균(30) * 1.5):
        매수 = False
    elif not (체결강도 > 130):
        매수 = False

    elif not (현재가 > 고가 - (고가 - 저가) * 0.25):
        매수 = False

    elif not (전일비 > 50):
        매수 = False
    elif not (당일거래대금 > 50 * 100):
        매수 = False
    elif not (등락율각도(30) > 8):
        매수 = False
    elif not (최고초당매수수량(30) * 1.8 > 최고초당매도수량(30)):
        매수 = False
```

### 매도 조건식

```python
# 상한가 근접
if 등락율 > 29.0:
    매도 = True

# 목표 수익
elif 수익률 >= 4.0:
    매도 = True

# 손절
elif 수익률 <= -3.5:
    매도 = True

# 고점 대비 하락
elif 최고수익률 - 수익률 >= 2.5:
    매도 = True

# 시간 경과
elif 보유시간 > 180:  # 3분
    매도 = True

# 시가총액별 매도 조건
elif 시가총액 < 1500:
    # 매수벽 붕괴
    if 매수총잔량 < 매도총잔량 * 0.8:
        매도 = True

    # 급격한 매도 체결
    elif (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.6:
        매도 = True

    # 체결강도 급락
    elif 체결강도 < 80 and 체결강도N(1) > 130:
        매도 = True

    # 가격 하락 반전
    elif 현재가 < 이동평균(60) and 현재가N(1) >= 이동평균(60, 1):
        매도 = True

elif 시가총액 < 3000:
    if 매수총잔량 < 매도총잔량 * 0.9:
        매도 = True
    elif (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.5:
        매도 = True
    elif 체결강도 < 90 and 체결강도N(1) > 130:
        매도 = True
    elif 현재가 < 이동평균(60) and 현재가N(1) >= 이동평균(60, 1):
        매도 = True

else:
    if 매수총잔량 < 매도총잔량:
        매도 = True
    elif (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.4:
        매도 = True
    elif 체결강도 < 100 and 체결강도N(1) > 130:
        매도 = True
    elif 현재가 < 이동평균(60) and 현재가N(1) >= 이동평균(60, 1):
        매도 = True
```

---

## 최적화 조건식

### 매수 최적화 조건식

```python
# 파생 변수
호가잔량비율 = 매수총잔량 / (매도총잔량 or 1)
매수벽강도 = 매수총잔량 * 현재가 / 100_000_000
초당순매수금액 = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000

if not (90000 <= 시분초 < 92000):
    매수 = False
elif not (self.vars[0] < 현재가 <= self.vars[1]):
    매수 = False
elif not (self.vars[2] < 등락율 <= self.vars[3]):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif 시가총액 < self.vars[4]:
    if not (호가잔량비율 > self.vars[5]):
        매수 = False
    elif not (매수벽강도 > self.vars[6]):
        매수 = False
    elif not (매수총잔량 > 매수총잔량N(1) * self.vars[7]):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * self.vars[8]):
        매수 = False
    elif not (초당순매수금액 > self.vars[9]):
        매수 = False
    elif not (초당거래대금 > 초당거래대금평균(30) * self.vars[10]):
        매수 = False
    elif not (체결강도 > self.vars[11]):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * self.vars[12]):
        매수 = False
    elif not (전일비 > self.vars[13]):
        매수 = False
    elif not (당일거래대금 > self.vars[14] * 100):
        매수 = False
    elif not (등락율각도(30) > self.vars[15]):
        매수 = False
    elif not (최고초당매수수량(30) * self.vars[16] > 최고초당매도수량(30)):
        매수 = False
```

### 매수 최적화 범위 (BOR)

```python
self.vars[0] = [[500, 1500, 500], 1000]           # 현재가 하한
self.vars[1] = [[30000, 60000, 10000], 50000]     # 현재가 상한
self.vars[2] = [[0.5, 2.0, 0.5], 0.5]             # 등락율 하한
self.vars[3] = [[20.0, 30.0, 5.0], 25.0]          # 등락율 상한
self.vars[4] = [[1000, 2000, 500], 1500]          # 시가총액 기준
self.vars[5] = [[2.0, 4.0, 0.5], 3.0]             # 호가잔량비율
self.vars[6] = [[3.0, 10.0, 1.0], 5.0]            # 매수벽강도
self.vars[7] = [[1.2, 2.0, 0.2], 1.5]             # 매수총잔량 증가율
self.vars[8] = [[0.4, 0.8, 0.1], 0.6]             # 초당매수/매도잔량 비율
self.vars[9] = [[30, 80, 10], 50]                 # 초당순매수금액
self.vars[10] = [[1.5, 3.0, 0.5], 2.0]            # 초당거래대금 배율
self.vars[11] = [[120, 180, 10], 150]             # 체결강도
self.vars[12] = [[0.10, 0.25, 0.05], 0.15]        # 고가대비 위치
self.vars[13] = [[20, 50, 10], 30]                # 전일비
self.vars[14] = [[5, 20, 5], 10]                  # 당일거래대금
self.vars[15] = [[3, 10, 1], 5]                   # 등락율각도
self.vars[16] = [[1.5, 3.0, 0.5], 2.5]            # 매수/매도수량 비율
```

### 매도 최적화 조건식

```python
if 등락율 > self.vars[17]:
    매도 = True
elif 수익률 >= self.vars[18]:
    매도 = True
elif 수익률 <= self.vars[19]:
    매도 = True
elif 최고수익률 - 수익률 >= self.vars[20]:
    매도 = True
elif 보유시간 > self.vars[21]:
    매도 = True
elif 시가총액 < self.vars[4]:
    if 매수총잔량 < 매도총잔량 * self.vars[22]:
        매도 = True
    elif (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[23]:
        매도 = True
    elif 체결강도 < self.vars[24] and 체결강도N(1) > self.vars[11]:
        매도 = True
    elif 현재가 < 이동평균(60) and 현재가N(1) >= 이동평균(60, 1):
        매도 = True
```

### 매도 최적화 범위 (SOR)

```python
self.vars[17] = [[28.0, 29.5, 0.5], 29.0]         # 상한가 기준
self.vars[18] = [[2.0, 6.0, 1.0], 4.0]            # 목표 수익률
self.vars[19] = [[-5.0, -2.0, 1.0], -3.5]         # 손절 수익률
self.vars[20] = [[1.5, 4.0, 0.5], 2.5]            # 고점대비 하락
self.vars[21] = [[120, 300, 60], 180]             # 보유시간 (초)
self.vars[22] = [[0.6, 1.0, 0.1], 0.8]            # 매수/매도잔량 비율
self.vars[23] = [[0.4, 0.8, 0.1], 0.6]            # 순매도/매수잔량 비율
self.vars[24] = [[60, 100, 10], 80]               # 체결강도 하한
```

### 통합 최적화 범위 (OR)

```python
# 매수 조건 변수
self.vars[0] = [[500, 1500, 500], 1000]
self.vars[1] = [[30000, 60000, 10000], 50000]
self.vars[2] = [[0.5, 2.0, 0.5], 0.5]
self.vars[3] = [[20.0, 30.0, 5.0], 25.0]
self.vars[4] = [[1000, 2000, 500], 1500]
self.vars[5] = [[2.0, 4.0, 0.5], 3.0]
self.vars[6] = [[3.0, 10.0, 1.0], 5.0]
self.vars[7] = [[1.2, 2.0, 0.2], 1.5]
self.vars[8] = [[0.4, 0.8, 0.1], 0.6]
self.vars[9] = [[30, 80, 10], 50]
self.vars[10] = [[1.5, 3.0, 0.5], 2.0]
self.vars[11] = [[120, 180, 10], 150]
self.vars[12] = [[0.10, 0.25, 0.05], 0.15]
self.vars[13] = [[20, 50, 10], 30]
self.vars[14] = [[5, 20, 5], 10]
self.vars[15] = [[3, 10, 1], 5]
self.vars[16] = [[1.5, 3.0, 0.5], 2.5]

# 매도 조건 변수
self.vars[17] = [[28.0, 29.5, 0.5], 29.0]
self.vars[18] = [[2.0, 6.0, 1.0], 4.0]
self.vars[19] = [[-5.0, -2.0, 1.0], -3.5]
self.vars[20] = [[1.5, 4.0, 0.5], 2.5]
self.vars[21] = [[120, 300, 60], 180]
self.vars[22] = [[0.6, 1.0, 0.1], 0.8]
self.vars[23] = [[0.4, 0.8, 0.1], 0.6]
self.vars[24] = [[60, 100, 10], 80]
```

### GA 최적화 범위 (GAR)

```python
self.vars[0] = [[500, 1000, 1500], 1000]
self.vars[1] = [[30000, 40000, 50000, 60000], 50000]
self.vars[2] = [[0.5, 1.0, 1.5, 2.0], 0.5]
self.vars[3] = [[20.0, 25.0, 30.0], 25.0]
self.vars[4] = [[1000, 1500, 2000], 1500]
self.vars[5] = [[2.0, 2.5, 3.0, 3.5, 4.0], 3.0]
self.vars[6] = [[3.0, 5.0, 7.0, 10.0], 5.0]
self.vars[7] = [[1.2, 1.4, 1.6, 1.8, 2.0], 1.5]
self.vars[8] = [[0.4, 0.5, 0.6, 0.7, 0.8], 0.6]
self.vars[9] = [[30, 40, 50, 60, 70, 80], 50]
self.vars[10] = [[1.5, 2.0, 2.5, 3.0], 2.0]
self.vars[11] = [[120, 135, 150, 165, 180], 150]
self.vars[12] = [[0.10, 0.15, 0.20, 0.25], 0.15]
self.vars[13] = [[20, 30, 40, 50], 30]
self.vars[14] = [[5, 10, 15, 20], 10]
self.vars[15] = [[3, 5, 7, 10], 5]
self.vars[16] = [[1.5, 2.0, 2.5, 3.0], 2.5]

self.vars[17] = [[28.0, 28.5, 29.0, 29.5], 29.0]
self.vars[18] = [[2.0, 3.0, 4.0, 5.0, 6.0], 4.0]
self.vars[19] = [[-5.0, -4.0, -3.5, -3.0, -2.0], -3.5]
self.vars[20] = [[1.5, 2.0, 2.5, 3.0, 3.5, 4.0], 2.5]
self.vars[21] = [[120, 180, 240, 300], 180]
self.vars[22] = [[0.6, 0.7, 0.8, 0.9, 1.0], 0.8]
self.vars[23] = [[0.4, 0.5, 0.6, 0.7, 0.8], 0.6]
self.vars[24] = [[60, 70, 80, 90, 100], 80]
```

---

## 태그

`#틱전략` `#장초반` `#호가창` `#매수벽` `#급증감지` `#90000-92000` `#시가총액차등` `#초단타` `#잔량분석` `#최적화`
