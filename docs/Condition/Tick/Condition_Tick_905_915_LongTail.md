# 조건식 (Condition)

- STOM 주식 자동거래에 사용하기 위한 조건식 문서
- [[Back_Testing_Guideline_Tick]] 을(를) 기반으로 작성한 Tick 조건식
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 목차
- [조건식 (Condition)](#조건식-condition)
  - [목차](#목차)
  - [소개](#소개)
  - [가이드라인](#가이드라인)
    - [저장 이름 규칙](#저장-이름-규칙)
- [Condition - Tick 905\_915 LongTail (긴 꼬리 상승)](#condition---tick-905_915-longtail-긴-꼬리-상승)
  - [전략 개요](#전략-개요)
  - [조건식](#조건식)
    - [매수 조건식 - C\_T\_905\_915\_LT\_B](#매수-조건식---c_t_905_915_lt_b)
    - [매도 조건식 - C\_T\_905\_915\_LT\_S](#매도-조건식---c_t_905_915_lt_s)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식 - C\_T\_905\_915\_LT\_BO](#매수-최적화-조건식---c_t_905_915_lt_bo)
    - [매수 최적화 범위 - C\_T\_905\_915\_LT\_BOR](#매수-최적화-범위---c_t_905_915_lt_bor)
    - [매도 최적화 조건식 - C\_T\_905\_915\_LT\_SO](#매도-최적화-조건식---c_t_905_915_lt_so)
    - [매도 최적화 범위 - C\_T\_905\_915\_LT\_SOR](#매도-최적화-범위---c_t_905_915_lt_sor)
    - [매수 매도 최적화 범위 - C\_T\_905\_915\_LT\_OR](#매수-매도-최적화-범위---c_t_905_915_lt_or)
    - [예상 시간 계산](#예상-시간-계산)
    - [GA 최적화 범위 - C\_T\_905\_915\_LT\_GAR](#ga-최적화-범위---c_t_905_915_lt_gar)
  - [조건식 개선 방향 연구](#조건식-개선-방향-연구)
  - [태그](#태그)

## 소개

이 문서는 STOM 주식 자동거래 시스템에서 사용되는 **긴 꼬리 상승 패턴** 조건식을 설명합니다.

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **긴 꼬리 상승 (Long Tail) V자 반등 전략**을 정의한다.

- **대상 시간 구간**: 09:05:00 ~ 09:15:00 (장 시작 5분 후 ~ 15분 후)
- **대상 종목**: 시가총액별 구분, 가격대 1,000원~50,000원
- **전략 타입**: 긴 아래 꼬리 + V자 반등 패턴 포착
- **핵심 변수**: 고저평균대비등락율, 초당거래대금비율, 체결강도, 등락율각도, 전일비, 회전율
- **업데이트 이력**:
  - 초기 문서 작성

**전략의 핵심 개념**:
- **패턴**: 1분봉 기준으로 아래 꼬리가 길면서 거래대금이 터지는 형태
- **원리**: 단기 하락 후 강한 매수세로 하락분을 모두 회복하며 상승하는 V자 반등 패턴
- **특징**:
  - 저가 대비 현재가 위치가 높음 (긴 아래 꼬리)
  - 초당거래대금이 평균 대비 급증
  - 매수 체결강도가 매도 체결강도를 압도
  - 등락율각도가 급격히 상승 전환

## 가이드라인

- 모든 조건식은 Python으로 작성되어 있으며, 주식 거래의 자동화를 목표로 합니다.
- 각 조건식은 특정 조건을 만족할 때 매수 또는 매도를 실행합니다.
- 최적화 조건식은 변수의 범위를 설정하여 최적의 매수/매도 시점을 찾습니다.
- 최적화 범위는 `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]` 형식으로 설정합니다.
- `self.vars[0]`은 고정값으로 설정되며, 조건식 변수는 `self.vars[1]`부터 공백 없이 사용됩니다.
- GA(유전 알고리즘) 최적화 범위 생성 방법:
  - 유전 알고리즘을 사용하여 최적의 매수/매도 시점을 찾기 위해, 각 변수의 범위를 설정합니다.
  - 각 변수는 `self.vars[정수] = [범위리스트, 최적값]` 형식으로 정의됩니다.
  - 범위리스트는 시작값부터 종료값까지 간격에 따라 생성된 값들의 집합입니다.
  - 고정값은 2단계, 3단계에서 이전 탐색에서 검출되지 않아도 돌연변이로 추가됩니다. 이는 사용자가 이미 알고 있는 최적값을 강제로 탐색하기 위함입니다. 4단계부터는 돌연변이로 추가되지 않습니다.
  - 너무 많은 변수를 입력할 경우 시간이 오래 걸리므로, 각각의 변수 범위를 10개 이하로 설정하십시오. 변수 범위의 최대값은 20개입니다.
  - 최적값 중에 최적값을 찾는 방법은 일반 최적화에서 구한 최적값을 GA에 돌연변이값으로 넣고 GA를 돌린 다음, 다시 GA에서 구한 최적값으로 일반 최적화를 돌리면 됩니다.

### 저장 이름 규칙

조건식과 관련된 다양한 테스트 및 최적화 조건을 저장할 때, 일관된 작명 규칙을 사용하여 관리의 용이성을 높일 수 있습니다. 아래는 현재 사용 중인 규칙과 함께, 향후 확장성을 고려한 제안입니다.

1. **기본 규칙**:
   - `C`: Condition을 의미합니다.
   - `T`: Tick을 의미합니다.
   - `숫자`: 실험 번호를 나타냅니다.
   - `LT`: LongTail (긴 꼬리 패턴)을 의미합니다.
   - `B`: 매수 조건식을 의미합니다.
   - `S`: 매도 조건식을 의미합니다.
   - `BO`: 매수 최적화 조건식을 의미합니다.
   - `SO`: 매도 최적화 조건식을 의미합니다.
   - `BOR`: 매수 최적화 범위를 의미합니다.
   - `SOR`: 매도 최적화 범위를 의미합니다.
   - `OR`: 매수 매도 통합 최적화 범위를 의미합니다.
   - `GAR`: GA 최적화 범위를 의미합니다.

2. **예시**:
   - `C_T_905_915_LT_B`: 905-915 긴 꼬리 패턴의 매수 조건식
   - `C_T_905_915_LT_S`: 905-915 긴 꼬리 패턴의 매도 조건식
   - `C_T_905_915_LT_BO`: 905-915 긴 꼬리 패턴의 매수 최적화 조건식
   - `C_T_905_915_LT_SO`: 905-915 긴 꼬리 패턴의 매도 최적화 조건식

---

# Condition - Tick 905_915 LongTail (긴 꼬리 상승)

## 전략 개요

### 패턴 인식 로직

**긴 꼬리 (Long Tail) 정의**:
- 1분봉(60틱) 기준으로 저가 대비 현재가가 상단에 위치
- 현재가 위치 = `(현재가 - 저가) / (고가 - 저가) * 100`
- 긴 아래 꼬리 조건: 현재가 위치 > 70% (아래 30% 영역에서 상단 70% 위치로 상승)

**거래대금 폭발 (Volume Explosion)**:
- 초당거래대금이 평균 대비 3배 이상 급증
- 누적초당매수수량이 누적초당매도수량보다 우세
- 당일거래대금각도가 급격히 상승 (10도 이상)

**V자 반등 확인**:
- 최저체결강도(60) 이후 체결강도가 100 이상으로 급상승
- 등락율각도가 -5도 이하에서 +10도 이상으로 전환
- 매도총잔량 대비 초당매수수량이 50% 이상

### 시장 상황별 전략

**소형주 (시가총액 < 3000억)**:
- 변동성이 크므로 더 보수적인 진입 조건 적용
- 체결강도 최소 80 이상 요구
- 초당순매수금액 최소 5백만원 이상

**중형주 (3000억 <= 시가총액 < 10000억)**:
- 중간 수준의 진입 조건
- 체결강도 최소 60 이상
- 초당순매수금액 최소 10백만원 이상

**대형주 (시가총액 >= 10000억)**:
- 더 완화된 진입 조건
- 체결강도 최소 50 이상
- 초당순매수금액 최소 20백만원 이상

## 조건식

### 매수 조건식 - C_T_905_915_LT_B

```python
# ================================
#  공통 계산 지표
# ================================
전일종가          = 현재가 / (1 + (등락율 / 100))                      # 단위: 원
시가등락율        = ((시가 - 전일종가) / 전일종가) * 100                # 단위: 퍼센트
시가대비등락율    = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트
초당순매수금액    = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000   # 단위: 백만원
저가대비현재가위치 = ((현재가 - 저가) / (고가 - 저가) * 100) if (고가 - 저가) != 0 else 50  # 단위: 퍼센트
꼬리길이비율      = ((고가 - 저가) / 저가 * 100) if 저가 != 0 else 0    # 단위: 퍼센트
V자반등강도       = (체결강도 - 최저체결강도(60)) / 최저체결강도(60) * 100 if 최저체결강도(60) != 0 else 0  # 단위: 퍼센트



# ================================
#  매수 조건 (긴 꼬리 V자 반등)
# ================================
매수 = True


if not (관심종목 == 1):                         # 공통 필터 – 관심종목
    매수 = False


# ---------- 09:05:00 ~ 09:15:00 (긴 꼬리 패턴) ----------
elif 90500 <= 시분초 < 91500:
    # 기본 가격 및 시간 필터
    if not (1000 < 현재가 <= 50000):
        매수 = False
    elif not (0.0 < 등락율 <= 20.0):
        매수 = False
    elif not (고저평균대비등락율 > 0):
        매수 = False
    elif not (현재가 < VI아래5호가):
        매수 = False
    elif 라운드피겨위5호가이내:
        매수 = False
    elif not (데이터길이 >= 60):                # 최소 60틱 (약 1분) 데이터 필요
        매수 = False

    # 긴 꼬리 패턴 확인
    elif not (저가대비현재가위치 > 70):          # 현재가가 고가-저가 범위의 상단 70% 이상
        매수 = False
    elif not (꼬리길이비율 > 3.0):               # 고가-저가 범위가 저가 대비 3% 이상
        매수 = False
    elif not (현재가 > 최저현재가(60) * 1.02):  # 최근 60틱 최저가 대비 2% 이상 상승
        매수 = False

    # 거래대금 폭발 확인
    elif not (초당거래대금 > 초당거래대금평균(60) * 3.0):
        매수 = False
    elif not (당일거래대금각도(30) > 10):
        매수 = False
    elif not (초당거래대금 > 초당거래대금N(1) * 1.2):
        매수 = False

    # V자 반등 확인
    elif not (V자반등강도 > 50):                 # 체결강도가 최저점 대비 50% 이상 회복
        매수 = False
    elif not (등락율각도(30) > 10):              # 등락율이 상승 전환
        매수 = False
    elif not (등락율각도(30) > 등락율각도(60)):  # 단기 각도가 장기 각도보다 가파름
        매수 = False

    # 시가총액별 세부 조건
    else:
        if 시가총액 < 3000:                      # 소형주
            if not (-2.0 <= 시가등락율 < 5.0):
                매수 = False
            elif not (1.0 <= 시가대비등락율 < 10.0):
                매수 = False
            elif not (5 < 초당순매수금액 < 1000):
                매수 = False
            elif not (전일비 > 50 and 전일동시간비 > 50):
                매수 = False
            elif not (회전율 > 1.5):
                매수 = False
            elif not (당일거래대금 > 100 * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * 0.50):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * 1.2):
                매수 = False
            elif not (체결강도 >= 80 and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(60) * 1.3):
                매수 = False

        elif 시가총액 < 10000:                   # 중형주
            if not (-1.0 <= 시가등락율 < 6.0):
                매수 = False
            elif not (1.5 <= 시가대비등락율 < 12.0):
                매수 = False
            elif not (10 < 초당순매수금액 < 2000):
                매수 = False
            elif not (전일비 > 30 and 전일동시간비 > 30):
                매수 = False
            elif not (회전율 > 1.0):
                매수 = False
            elif not (당일거래대금 > 200 * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * 0.40):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * 1.1):
                매수 = False
            elif not (체결강도 >= 60 and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(60) * 1.2):
                매수 = False

        else:                                     # 대형주
            if not (0.0 <= 시가등락율 < 8.0):
                매수 = False
            elif not (2.0 <= 시가대비등락율 < 15.0):
                매수 = False
            elif not (20 < 초당순매수금액 < 5000):
                매수 = False
            elif not (전일비 > 20 and 전일동시간비 > 20):
                매수 = False
            elif not (회전율 > 0.5):
                매수 = False
            elif not (당일거래대금 > 500 * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * 0.30):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * 1.0):
                매수 = False
            elif not (체결강도 >= 50 and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(60) * 1.1):
                매수 = False


# ---------- 09:15:00 이후 ----------
else:
    매수 = False


# ================================
#  매수 호출
# ================================
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식 - C_T_905_915_LT_S

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율    = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트
고가대비현재가위치 = ((고가 - 현재가) / (고가 - 저가) * 100) if (고가 - 저가) != 0 else 50  # 단위: 퍼센트
매도압력지수      = (초당매도수량 / 초당매수수량 * 100) if 초당매수수량 != 0 else 100  # 단위: 퍼센트



# ================================
#  매도 조건 (긴 꼬리 V자 반등)
# ================================
매도 = False


# 등락율 상한가 직전
if 등락율 > 29.0:
    매도 = True

# 급격한 하락 손절
elif 시가대비등락율 < -1.0 and 수익률 <= -2.5 and 현재가 < 최저현재가(int(30), int(보유시간)):
    매도 = True

# 보유시간 초과 손절
elif 보유시간 > 120 and 현재가 < 최저현재가(int(60), int(보유시간)):
    매도 = True

# 일반 매도 조건 (09:30:00 이전)
elif 시분초 < 93000:
    # 목표 수익률 달성 또는 손절
    if 수익률 >= 7.0 or 수익률 <= -4.0:
        매도 = True

    # 최고수익률 대비 하락
    elif 최고수익률 > 8.0 and 최고수익률 * 0.65 >= 수익률:
        매도 = True

    # 긴 꼬리 패턴의 상단 도달 (고점 근처)
    elif 고가대비현재가위치 < 20 and 매도압력지수 > 150:
        매도 = True

    # 시가총액별 매도 조건
    elif 시가총액 < 10000:
        # 등락율 각도별 매도 압력 확인
        if 등락율각도(30) >= 15 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.4 and (현재가 / 현재가N(1) - 1) * 100 < -0.4:
            매도 = True
        elif 10 <= 등락율각도(30) < 15 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.6 and (현재가 / 현재가N(1) - 1) * 100 < -0.6:
            매도 = True
        elif 5 <= 등락율각도(30) < 10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.7 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True
        elif 0 <= 등락율각도(30) < 5 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.8 and (현재가 / 현재가N(1) - 1) * 100 < -0.4:
            매도 = True
        elif 등락율각도(30) < 0 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.9 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True

        # 이동평균 이탈 매도
        elif 5.0 < 최고수익률 and 현재가N(1) >= 이동평균(60, 1) and 이동평균(60) > 현재가:
            매도 = True

        # 체결강도 급락 매도
        elif 체결강도 < 체결강도평균(30) * 0.7 and 최고수익률 > 3.0:
            매도 = True


# ================================
#  매도 호출
# ================================
if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

## 최적화 조건식

### 매수 최적화 조건식 - C_T_905_915_LT_BO

```python
# ================================
#  공통 계산 지표
# ================================
전일종가          = 현재가 / (1 + (등락율 / 100))
시가등락율        = ((시가 - 전일종가) / 전일종가) * 100
시가대비등락율    = ((현재가 - 시가) / 시가) * 100
초당순매수금액    = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000
저가대비현재가위치 = ((현재가 - 저가) / (고가 - 저가) * 100) if (고가 - 저가) != 0 else 50
꼬리길이비율      = ((고가 - 저가) / 저가 * 100) if 저가 != 0 else 0
V자반등강도       = (체결강도 - 최저체결강도(60)) / 최저체결강도(60) * 100 if 최저체결강도(60) != 0 else 0

매수 = True

if not (관심종목 == 1):
    매수 = False

elif 90500 <= 시분초 < 91500:
    if not (1000 < 현재가 <= 50000):
        매수 = False
    elif not (0.0 < 등락율 <= self.vars[1]):
        매수 = False
    elif not (고저평균대비등락율 > 0):
        매수 = False
    elif not (현재가 < VI아래5호가):
        매수 = False
    elif 라운드피겨위5호가이내:
        매수 = False
    elif not (데이터길이 >= 60):
        매수 = False
    elif not (저가대비현재가위치 > self.vars[2]):
        매수 = False
    elif not (꼬리길이비율 > self.vars[3]):
        매수 = False
    elif not (현재가 > 최저현재가(60) * self.vars[4]):
        매수 = False
    elif not (초당거래대금 > 초당거래대금평균(60) * self.vars[5]):
        매수 = False
    elif not (당일거래대금각도(30) > self.vars[6]):
        매수 = False
    elif not (초당거래대금 > 초당거래대금N(1) * self.vars[7]):
        매수 = False
    elif not (V자반등강도 > self.vars[8]):
        매수 = False
    elif not (등락율각도(30) > self.vars[9]):
        매수 = False
    elif not (등락율각도(30) > 등락율각도(60)):
        매수 = False
    else:
        if 시가총액 < 3000:
            if not (self.vars[10] <= 시가등락율 < self.vars[11]):
                매수 = False
            elif not (self.vars[12] <= 시가대비등락율 < self.vars[13]):
                매수 = False
            elif not (self.vars[14] < 초당순매수금액 < 1000):
                매수 = False
            elif not (전일비 > self.vars[15] and 전일동시간비 > self.vars[16]):
                매수 = False
            elif not (회전율 > self.vars[17]):
                매수 = False
            elif not (당일거래대금 > self.vars[18] * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * self.vars[19]):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * self.vars[20]):
                매수 = False
            elif not (체결강도 >= self.vars[21] and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(60) * self.vars[22]):
                매수 = False
        elif 시가총액 < 10000:
            if not (self.vars[23] <= 시가등락율 < self.vars[24]):
                매수 = False
            elif not (self.vars[25] <= 시가대비등락율 < self.vars[26]):
                매수 = False
            elif not (self.vars[27] < 초당순매수금액 < 2000):
                매수 = False
            elif not (전일비 > self.vars[28] and 전일동시간비 > self.vars[29]):
                매수 = False
            elif not (회전율 > self.vars[30]):
                매수 = False
            elif not (당일거래대금 > self.vars[31] * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * self.vars[32]):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * self.vars[33]):
                매수 = False
            elif not (체결강도 >= self.vars[34] and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(60) * self.vars[35]):
                매수 = False
        else:
            if not (self.vars[36] <= 시가등락율 < self.vars[37]):
                매수 = False
            elif not (self.vars[38] <= 시가대비등락율 < self.vars[39]):
                매수 = False
            elif not (self.vars[40] < 초당순매수금액 < 5000):
                매수 = False
            elif not (전일비 > self.vars[41] and 전일동시간비 > self.vars[42]):
                매수 = False
            elif not (회전율 > self.vars[43]):
                매수 = False
            elif not (당일거래대금 > self.vars[44] * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * self.vars[45]):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * self.vars[46]):
                매수 = False
            elif not (체결강도 >= self.vars[47] and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(60) * self.vars[48]):
                매수 = False
else:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위 - C_T_905_915_LT_BOR

```python
# 긴 꼬리 패턴 최적화 범위 (09:05:00~09:15:00)
self.vars[1] = [[15.0, 25.0, 2.0], 20.0]       # 등락율 상한: 15.0%에서 25.0%까지 2.0% 간격, 범위 갯수: 6
self.vars[2] = [[65, 75, 5], 70]               # 저가대비현재가위치: 65에서 75까지 5 간격, 범위 갯수: 3
self.vars[3] = [[2.0, 4.0, 0.5], 3.0]          # 꼬리길이비율: 2.0%에서 4.0%까지 0.5% 간격, 범위 갯수: 5
self.vars[4] = [[1.01, 1.03, 0.01], 1.02]      # 최저가대비상승률: 1.01에서 1.03까지 0.01 간격, 범위 갯수: 3
self.vars[5] = [[2.5, 3.5, 0.5], 3.0]          # 초당거래대금배율: 2.5배에서 3.5배까지 0.5배 간격, 범위 갯수: 3
self.vars[6] = [[8, 12, 2], 10]                # 당일거래대금각도: 8에서 12까지 2 간격, 범위 갯수: 3
self.vars[7] = [[1.1, 1.3, 0.1], 1.2]          # 초당거래대금증가율: 1.1배에서 1.3배까지 0.1배 간격, 범위 갯수: 3
self.vars[8] = [[40, 60, 10], 50]              # V자반등강도: 40에서 60까지 10 간격, 범위 갯수: 3
self.vars[9] = [[8, 12, 2], 10]                # 등락율각도: 8에서 12까지 2 간격, 범위 갯수: 3

# 소형주 (시가총액 < 3000) 최적화 범위
self.vars[10] = [[-3.0, -1.0, 1.0], -2.0]      # 시가등락율 하한: -3.0%에서 -1.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[11] = [[4.0, 6.0, 1.0], 5.0]         # 시가등락율 상한: 4.0%에서 6.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[12] = [[0.5, 1.5, 0.5], 1.0]         # 시가대비등락율 하한: 0.5%에서 1.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[13] = [[9.0, 11.0, 1.0], 10.0]       # 시가대비등락율 상한: 9.0%에서 11.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[14] = [[3, 7, 2], 5]                 # 초당순매수금액 하한: 3에서 7까지 2 간격, 범위 갯수: 3
self.vars[15] = [[40, 60, 10], 50]             # 전일비: 40에서 60까지 10 간격, 범위 갯수: 3
self.vars[16] = [[40, 60, 10], 50]             # 전일동시간비: 40에서 60까지 10 간격, 범위 갯수: 3
self.vars[17] = [[1.0, 2.0, 0.5], 1.5]         # 회전율: 1.0배에서 2.0배까지 0.5배 간격, 범위 갯수: 3
self.vars[18] = [[80, 120, 20], 100]           # 당일거래대금: 80에서 120까지 20 간격, 범위 갯수: 3
self.vars[19] = [[0.45, 0.55, 0.05], 0.50]     # 초당매수수량비율: 0.45에서 0.55까지 0.05 간격, 범위 갯수: 3
self.vars[20] = [[1.1, 1.3, 0.1], 1.2]         # 누적매수우세비율: 1.1배에서 1.3배까지 0.1배 간격, 범위 갯수: 3
self.vars[21] = [[70, 90, 10], 80]             # 체결강도 하한: 70에서 90까지 10 간격, 범위 갯수: 3
self.vars[22] = [[1.2, 1.4, 0.1], 1.3]         # 체결강도평균배율: 1.2배에서 1.4배까지 0.1배 간격, 범위 갯수: 3

# 중형주 (3000 <= 시가총액 < 10000) 최적화 범위
self.vars[23] = [[-2.0, 0.0, 1.0], -1.0]       # 시가등락율 하한: -2.0%에서 0.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[24] = [[5.0, 7.0, 1.0], 6.0]         # 시가등락율 상한: 5.0%에서 7.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[25] = [[1.0, 2.0, 0.5], 1.5]         # 시가대비등락율 하한: 1.0%에서 2.0%까지 0.5% 간격, 범위 갯수: 3
self.vars[26] = [[11.0, 13.0, 1.0], 12.0]      # 시가대비등락율 상한: 11.0%에서 13.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[27] = [[8, 12, 2], 10]               # 초당순매수금액 하한: 8에서 12까지 2 간격, 범위 갯수: 3
self.vars[28] = [[20, 40, 10], 30]             # 전일비: 20에서 40까지 10 간격, 범위 갯수: 3
self.vars[29] = [[20, 40, 10], 30]             # 전일동시간비: 20에서 40까지 10 간격, 범위 갯수: 3
self.vars[30] = [[0.8, 1.2, 0.2], 1.0]         # 회전율: 0.8배에서 1.2배까지 0.2배 간격, 범위 갯수: 3
self.vars[31] = [[150, 250, 50], 200]          # 당일거래대금: 150에서 250까지 50 간격, 범위 갯수: 3
self.vars[32] = [[0.35, 0.45, 0.05], 0.40]     # 초당매수수량비율: 0.35에서 0.45까지 0.05 간격, 범위 갯수: 3
self.vars[33] = [[1.0, 1.2, 0.1], 1.1]         # 누적매수우세비율: 1.0배에서 1.2배까지 0.1배 간격, 범위 갯수: 3
self.vars[34] = [[50, 70, 10], 60]             # 체결강도 하한: 50에서 70까지 10 간격, 범위 갯수: 3
self.vars[35] = [[1.1, 1.3, 0.1], 1.2]         # 체결강도평균배율: 1.1배에서 1.3배까지 0.1배 간격, 범위 갯수: 3

# 대형주 (시가총액 >= 10000) 최적화 범위
self.vars[36] = [[-1.0, 1.0, 1.0], 0.0]        # 시가등락율 하한: -1.0%에서 1.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[37] = [[7.0, 9.0, 1.0], 8.0]         # 시가등락율 상한: 7.0%에서 9.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[38] = [[1.5, 2.5, 0.5], 2.0]         # 시가대비등락율 하한: 1.5%에서 2.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[39] = [[14.0, 16.0, 1.0], 15.0]      # 시가대비등락율 상한: 14.0%에서 16.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[40] = [[15, 25, 5], 20]              # 초당순매수금액 하한: 15에서 25까지 5 간격, 범위 갯수: 3
self.vars[41] = [[10, 30, 10], 20]             # 전일비: 10에서 30까지 10 간격, 범위 갯수: 3
self.vars[42] = [[10, 30, 10], 20]             # 전일동시간비: 10에서 30까지 10 간격, 범위 갯수: 3
self.vars[43] = [[0.3, 0.7, 0.2], 0.5]         # 회전율: 0.3배에서 0.7배까지 0.2배 간격, 범위 갯수: 3
self.vars[44] = [[400, 600, 100], 500]         # 당일거래대금: 400에서 600까지 100 간격, 범위 갯수: 3
self.vars[45] = [[0.25, 0.35, 0.05], 0.30]     # 초당매수수량비율: 0.25에서 0.35까지 0.05 간격, 범위 갯수: 3
self.vars[46] = [[0.9, 1.1, 0.1], 1.0]         # 누적매수우세비율: 0.9배에서 1.1배까지 0.1배 간격, 범위 갯수: 3
self.vars[47] = [[40, 60, 10], 50]             # 체결강도 하한: 40에서 60까지 10 간격, 범위 갯수: 3
self.vars[48] = [[1.0, 1.2, 0.1], 1.1]         # 체결강도평균배율: 1.0배에서 1.2배까지 0.1배 간격, 범위 갯수: 3

# 매수 총 경우의 수: 6 × 3 × 5 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 = 1,162,261,467
```

### 매도 최적화 조건식 - C_T_905_915_LT_SO

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율    = ((현재가 - 시가) / 시가) * 100
고가대비현재가위치 = ((고가 - 현재가) / (고가 - 저가) * 100) if (고가 - 저가) != 0 else 50
매도압력지수      = (초당매도수량 / 초당매수수량 * 100) if 초당매수수량 != 0 else 100

매도 = False

if 등락율 > self.vars[49]:
    매도 = True
elif 시가대비등락율 < self.vars[50] and 수익률 <= self.vars[51] and 현재가 < 최저현재가(int(30), int(보유시간)):
    매도 = True
elif 보유시간 > self.vars[52] and 현재가 < 최저현재가(int(60), int(보유시간)):
    매도 = True
elif 시분초 < 93000:
    if 수익률 >= self.vars[53] or 수익률 <= self.vars[54]:
        매도 = True
    elif 최고수익률 > self.vars[55] and 최고수익률 * self.vars[56] >= 수익률:
        매도 = True
    elif 고가대비현재가위치 < self.vars[57] and 매도압력지수 > self.vars[58]:
        매도 = True
    elif 시가총액 < 10000:
        if 등락율각도(30) >= 15 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[59] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[60]:
            매도 = True
        elif 10 <= 등락율각도(30) < 15 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[61] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[62]:
            매도 = True
        elif 5 <= 등락율각도(30) < 10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[63] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[64]:
            매도 = True
        elif 0 <= 등락율각도(30) < 5 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[65] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[66]:
            매도 = True
        elif 등락율각도(30) < 0 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[67] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[68]:
            매도 = True
        elif self.vars[69] < 최고수익률 and 현재가N(1) >= 이동평균(60, 1) and 이동평균(60) > 현재가:
            매도 = True
        elif 체결강도 < 체결강도평균(30) * self.vars[70] and 최고수익률 > self.vars[71]:
            매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

### 매도 최적화 범위 - C_T_905_915_LT_SOR

```python
# 매도 최적화 범위 (매수 변수 48 다음부터 49번부터 시작)
self.vars[49] = [[28.0, 30.0, 0.5], 29.0]      # 등락율 상한가: 28.0%에서 30.0%까지 0.5% 간격, 범위 갯수: 5
self.vars[50] = [[-2.0, 0.0, 0.5], -1.0]       # 시가대비등락율 하락: -2.0%에서 0.0%까지 0.5% 간격, 범위 갯수: 5
self.vars[51] = [[-3.5, -1.5, 0.5], -2.5]      # 손실 수익률: -3.5%에서 -1.5%까지 0.5% 간격, 범위 갯수: 5
self.vars[52] = [[90, 150, 30], 120]           # 보유시간 초과: 90초에서 150초까지 30초 간격, 범위 갯수: 3
self.vars[53] = [[6.0, 8.0, 0.5], 7.0]         # 수익률 상한: 6.0%에서 8.0%까지 0.5% 간격, 범위 갯수: 5
self.vars[54] = [[-5.0, -3.0, 0.5], -4.0]      # 수익률 하한: -5.0%에서 -3.0%까지 0.5% 간격, 범위 갯수: 5
self.vars[55] = [[7.0, 9.0, 0.5], 8.0]         # 최고수익률 기준값: 7.0%에서 9.0%까지 0.5% 간격, 범위 갯수: 5
self.vars[56] = [[0.6, 0.7, 0.05], 0.65]       # 최고수익률 대비 현재 수익률 비율: 0.6에서 0.7까지 0.05 간격, 범위 갯수: 3
self.vars[57] = [[15, 25, 5], 20]              # 고가대비현재가위치: 15에서 25까지 5 간격, 범위 갯수: 3
self.vars[58] = [[140, 160, 10], 150]          # 매도압력지수: 140에서 160까지 10 간격, 범위 갯수: 3
self.vars[59] = [[0.35, 0.45, 0.05], 0.40]     # 등락율각도15이상 매도비율: 0.35에서 0.45까지 0.05 간격, 범위 갯수: 3
self.vars[60] = [[-0.5, -0.3, 0.1], -0.4]      # 등락율각도15이상 하락률: -0.5에서 -0.3까지 0.1 간격, 범위 갯수: 3
self.vars[61] = [[0.55, 0.65, 0.05], 0.60]     # 등락율각도10-15 매도비율: 0.55에서 0.65까지 0.05 간격, 범위 갯수: 3
self.vars[62] = [[-0.7, -0.5, 0.1], -0.6]      # 등락율각도10-15 하락률: -0.7에서 -0.5까지 0.1 간격, 범위 갯수: 3
self.vars[63] = [[0.65, 0.75, 0.05], 0.70]     # 등락율각도5-10 매도비율: 0.65에서 0.75까지 0.05 간격, 범위 갯수: 3
self.vars[64] = [[-0.6, -0.4, 0.1], -0.5]      # 등락율각도5-10 하락률: -0.6에서 -0.4까지 0.1 간격, 범위 갯수: 3
self.vars[65] = [[0.75, 0.85, 0.05], 0.80]     # 등락율각도0-5 매도비율: 0.75에서 0.85까지 0.05 간격, 범위 갯수: 3
self.vars[66] = [[-0.5, -0.3, 0.1], -0.4]      # 등락율각도0-5 하락률: -0.5에서 -0.3까지 0.1 간격, 범위 갯수: 3
self.vars[67] = [[0.85, 0.95, 0.05], 0.90]     # 등락율각도음수 매도비율: 0.85에서 0.95까지 0.05 간격, 범위 갯수: 3
self.vars[68] = [[-0.6, -0.4, 0.1], -0.5]      # 등락율각도음수 하락률: -0.6에서 -0.4까지 0.1 간격, 범위 갯수: 3
self.vars[69] = [[4.5, 5.5, 0.5], 5.0]         # 이동평균이탈 최고수익률: 4.5%에서 5.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[70] = [[0.6, 0.8, 0.1], 0.7]         # 체결강도급락 비율: 0.6배에서 0.8배까지 0.1배 간격, 범위 갯수: 3
self.vars[71] = [[2.5, 3.5, 0.5], 3.0]         # 체결강도급락 최고수익률: 2.5%에서 3.5%까지 0.5% 간격, 범위 갯수: 3

# 매도 총 경우의 수: 5 × 5 × 5 × 3 × 5 × 5 × 5 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 = 1,288,490,625
```

### 매수 매도 최적화 범위 - C_T_905_915_LT_OR

```python
# 평균 틱수 고정값
self.vars[0] = [[60, 60, 0], 60]               # 평균 틱수 고정값: 60 (1분), 범위 갯수: 1

# [매수 최적화 범위 - 위의 BOR과 동일하게 self.vars[1] ~ self.vars[48]]
# [매도 최적화 범위 - 위의 SOR과 동일하게 self.vars[49] ~ self.vars[71]]

# 매수 매도 총 경우의 수: 1,162,261,467 × 1,288,490,625 = 1,497,678,377,490,771,875
```

### 예상 시간 계산

각 변수의 범위 갯수를 곱하여 모든 경우의 수를 계산합니다.

- **매수 조건 변수 범위**:
  - 6 × 3 × 5 × 3 × 3 × 3 × 3 × 3 × 3 × (3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3) × (3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3) × (3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3) = 1,162,261,467
- **매도 조건 변수 범위**:
  - 5 × 5 × 5 × 3 × 5 × 5 × 5 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 = 1,288,490,625
- **총 경우의 수**:
  - 1,162,261,467 × 1,288,490,625 ≈ 1.5 × 10^18

각 경우에 1분이 걸린다고 가정하면:
- **분**: 1.5 × 10^18 분
- **시간**: 2.5 × 10^16 시간
- **일**: 1.0 × 10^15 일
- **년**: 2.8 × 10^12 년

**가정**: 각 경우의 수를 처리하는 데 1분이 소요된다고 가정하였습니다. 이는 비현실적인 시간이므로, 범위를 더 좁히거나 간격을 늘려 계산 시간을 단축해야 합니다. **GA 최적화 방식을 권장합니다.**

### GA 최적화 범위 - C_T_905_915_LT_GAR

```python
# 평균 틱수 고정값
self.vars[0] = [[60], 60]                                                      # 평균 틱수 고정값, 범위 갯수: 1

# GA 최적화 범위 - 긴 꼬리 패턴
self.vars[1] = [[15.0, 17.0, 19.0, 21.0, 23.0, 25.0], 20.0]                   # 등락율 상한, 범위 갯수: 6
self.vars[2] = [[65, 70, 75], 70]                                              # 저가대비현재가위치, 범위 갯수: 3
self.vars[3] = [[2.0, 2.5, 3.0, 3.5, 4.0], 3.0]                               # 꼬리길이비율, 범위 갯수: 5
self.vars[4] = [[1.01, 1.02, 1.03], 1.02]                                      # 최저가대비상승률, 범위 갯수: 3
self.vars[5] = [[2.5, 3.0, 3.5], 3.0]                                          # 초당거래대금배율, 범위 갯수: 3
self.vars[6] = [[8, 10, 12], 10]                                               # 당일거래대금각도, 범위 갯수: 3
self.vars[7] = [[1.1, 1.2, 1.3], 1.2]                                          # 초당거래대금증가율, 범위 갯수: 3
self.vars[8] = [[40, 50, 60], 50]                                              # V자반등강도, 범위 갯수: 3
self.vars[9] = [[8, 10, 12], 10]                                               # 등락율각도, 범위 갯수: 3

# GA 최적화 범위 - 소형주
self.vars[10] = [[-3.0, -2.0, -1.0], -2.0]                                     # 시가등락율 하한, 범위 갯수: 3
self.vars[11] = [[4.0, 5.0, 6.0], 5.0]                                         # 시가등락율 상한, 범위 갯수: 3
self.vars[12] = [[0.5, 1.0, 1.5], 1.0]                                         # 시가대비등락율 하한, 범위 갯수: 3
self.vars[13] = [[9.0, 10.0, 11.0], 10.0]                                      # 시가대비등락율 상한, 범위 갯수: 3
self.vars[14] = [[3, 5, 7], 5]                                                 # 초당순매수금액 하한, 범위 갯수: 3
self.vars[15] = [[40, 50, 60], 50]                                             # 전일비, 범위 갯수: 3
self.vars[16] = [[40, 50, 60], 50]                                             # 전일동시간비, 범위 갯수: 3
self.vars[17] = [[1.0, 1.5, 2.0], 1.5]                                         # 회전율, 범위 갯수: 3
self.vars[18] = [[80, 100, 120], 100]                                          # 당일거래대금, 범위 갯수: 3
self.vars[19] = [[0.45, 0.50, 0.55], 0.50]                                     # 초당매수수량비율, 범위 갯수: 3
self.vars[20] = [[1.1, 1.2, 1.3], 1.2]                                         # 누적매수우세비율, 범위 갯수: 3
self.vars[21] = [[70, 80, 90], 80]                                             # 체결강도 하한, 범위 갯수: 3
self.vars[22] = [[1.2, 1.3, 1.4], 1.3]                                         # 체결강도평균배율, 범위 갯수: 3

# GA 최적화 범위 - 중형주
self.vars[23] = [[-2.0, -1.0, 0.0], -1.0]                                      # 시가등락율 하한, 범위 갯수: 3
self.vars[24] = [[5.0, 6.0, 7.0], 6.0]                                         # 시가등락율 상한, 범위 갯수: 3
self.vars[25] = [[1.0, 1.5, 2.0], 1.5]                                         # 시가대비등락율 하한, 범위 갯수: 3
self.vars[26] = [[11.0, 12.0, 13.0], 12.0]                                     # 시가대비등락율 상한, 범위 갯수: 3
self.vars[27] = [[8, 10, 12], 10]                                              # 초당순매수금액 하한, 범위 갯수: 3
self.vars[28] = [[20, 30, 40], 30]                                             # 전일비, 범위 갯수: 3
self.vars[29] = [[20, 30, 40], 30]                                             # 전일동시간비, 범위 갯수: 3
self.vars[30] = [[0.8, 1.0, 1.2], 1.0]                                         # 회전율, 범위 갯수: 3
self.vars[31] = [[150, 200, 250], 200]                                         # 당일거래대금, 범위 갯수: 3
self.vars[32] = [[0.35, 0.40, 0.45], 0.40]                                     # 초당매수수량비율, 범위 갯수: 3
self.vars[33] = [[1.0, 1.1, 1.2], 1.1]                                         # 누적매수우세비율, 범위 갯수: 3
self.vars[34] = [[50, 60, 70], 60]                                             # 체결강도 하한, 범위 갯수: 3
self.vars[35] = [[1.1, 1.2, 1.3], 1.2]                                         # 체결강도평균배율, 범위 갯수: 3

# GA 최적화 범위 - 대형주
self.vars[36] = [[-1.0, 0.0, 1.0], 0.0]                                        # 시가등락율 하한, 범위 갯수: 3
self.vars[37] = [[7.0, 8.0, 9.0], 8.0]                                         # 시가등락율 상한, 범위 갯수: 3
self.vars[38] = [[1.5, 2.0, 2.5], 2.0]                                         # 시가대비등락율 하한, 범위 갯수: 3
self.vars[39] = [[14.0, 15.0, 16.0], 15.0]                                     # 시가대비등락율 상한, 범위 갯수: 3
self.vars[40] = [[15, 20, 25], 20]                                             # 초당순매수금액 하한, 범위 갯수: 3
self.vars[41] = [[10, 20, 30], 20]                                             # 전일비, 범위 갯수: 3
self.vars[42] = [[10, 20, 30], 20]                                             # 전일동시간비, 범위 갯수: 3
self.vars[43] = [[0.3, 0.5, 0.7], 0.5]                                         # 회전율, 범위 갯수: 3
self.vars[44] = [[400, 500, 600], 500]                                         # 당일거래대금, 범위 갯수: 3
self.vars[45] = [[0.25, 0.30, 0.35], 0.30]                                     # 초당매수수량비율, 범위 갯수: 3
self.vars[46] = [[0.9, 1.0, 1.1], 1.0]                                         # 누적매수우세비율, 범위 갯수: 3
self.vars[47] = [[40, 50, 60], 50]                                             # 체결강도 하한, 범위 갯수: 3
self.vars[48] = [[1.0, 1.1, 1.2], 1.1]                                         # 체결강도평균배율, 범위 갯수: 3

# GA 최적화 범위 - 매도
self.vars[49] = [[28.0, 28.5, 29.0, 29.5, 30.0], 29.0]                        # 등락율 상한가, 범위 갯수: 5
self.vars[50] = [[-2.0, -1.5, -1.0, -0.5, 0.0], -1.0]                         # 시가대비등락율 하락, 범위 갯수: 5
self.vars[51] = [[-3.5, -3.0, -2.5, -2.0, -1.5], -2.5]                        # 손실 수익률, 범위 갯수: 5
self.vars[52] = [[90, 120, 150], 120]                                          # 보유시간 초과, 범위 갯수: 3
self.vars[53] = [[6.0, 6.5, 7.0, 7.5, 8.0], 7.0]                              # 수익률 상한, 범위 갯수: 5
self.vars[54] = [[-5.0, -4.5, -4.0, -3.5, -3.0], -4.0]                        # 수익률 하한, 범위 갯수: 5
self.vars[55] = [[7.0, 7.5, 8.0, 8.5, 9.0], 8.0]                              # 최고수익률 기준값, 범위 갯수: 5
self.vars[56] = [[0.6, 0.65, 0.7], 0.65]                                       # 최고수익률 대비 현재 수익률 비율, 범위 갯수: 3
self.vars[57] = [[15, 20, 25], 20]                                             # 고가대비현재가위치, 범위 갯수: 3
self.vars[58] = [[140, 150, 160], 150]                                         # 매도압력지수, 범위 갯수: 3
self.vars[59] = [[0.35, 0.40, 0.45], 0.40]                                     # 등락율각도15이상 매도비율, 범위 갯수: 3
self.vars[60] = [[-0.5, -0.4, -0.3], -0.4]                                     # 등락율각도15이상 하락률, 범위 갯수: 3
self.vars[61] = [[0.55, 0.60, 0.65], 0.60]                                     # 등락율각도10-15 매도비율, 범위 갯수: 3
self.vars[62] = [[-0.7, -0.6, -0.5], -0.6]                                     # 등락율각도10-15 하락률, 범위 갯수: 3
self.vars[63] = [[0.65, 0.70, 0.75], 0.70]                                     # 등락율각도5-10 매도비율, 범위 갯수: 3
self.vars[64] = [[-0.6, -0.5, -0.4], -0.5]                                     # 등락율각도5-10 하락률, 범위 갯수: 3
self.vars[65] = [[0.75, 0.80, 0.85], 0.80]                                     # 등락율각도0-5 매도비율, 범위 갯수: 3
self.vars[66] = [[-0.5, -0.4, -0.3], -0.4]                                     # 등락율각도0-5 하락률, 범위 갯수: 3
self.vars[67] = [[0.85, 0.90, 0.95], 0.90]                                     # 등락율각도음수 매도비율, 범위 갯수: 3
self.vars[68] = [[-0.6, -0.5, -0.4], -0.5]                                     # 등락율각도음수 하락률, 범위 갯수: 3
self.vars[69] = [[4.5, 5.0, 5.5], 5.0]                                         # 이동평균이탈 최고수익률, 범위 갯수: 3
self.vars[70] = [[0.6, 0.7, 0.8], 0.7]                                         # 체결강도급락 비율, 범위 갯수: 3
self.vars[71] = [[2.5, 3.0, 3.5], 3.0]                                         # 체결강도급락 최고수익률, 범위 갯수: 3
```

## 조건식 개선 방향 연구

### 1. 긴 꼬리 패턴 인식 고도화

#### 1.1 꼬리 길이의 동적 평가
```python
# 현재 고정값 3.0% 대신 시가총액별 차등 적용
if 시가총액 < 3000:
    최소꼬리길이 = 4.0  # 소형주는 더 큰 변동성 요구
elif 시가총액 < 10000:
    최소꼬리길이 = 3.0  # 중형주는 중간값
else:
    최소꼬리길이 = 2.0  # 대형주는 완화

if not (꼬리길이비율 > 최소꼬리길이):
    매수 = False
```
- **활용 방안**: 시가총액별 변동성 특성을 반영한 동적 임계값
- **최적화 범위**: 소형주 `[[3.5, 5.0, 0.5], 4.0]`, 중형주 `[[2.5, 3.5, 0.5], 3.0]`, 대형주 `[[1.5, 2.5, 0.5], 2.0]`

#### 1.2 V자 반등 패턴의 다단계 확인
```python
# 3단계 V자 반등 확인
단기V자강도 = (체결강도 - 최저체결강도(30)) / 최저체결강도(30) * 100 if 최저체결강도(30) != 0 else 0
중기V자강도 = (체결강도 - 최저체결강도(60)) / 최저체결강도(60) * 100 if 최저체결강도(60) != 0 else 0
장기V자강도 = (체결강도 - 최저체결강도(90)) / 최저체결강도(90) * 100 if 최저체결강도(90) != 0 else 0

if not (단기V자강도 > 30 and 중기V자강도 > 50 and 장기V자강도 > 70):
    매수 = False
```
- **활용 방안**: 단기/중기/장기 V자 반등 강도를 종합 평가
- **최적화 범위**: 단기 `[[20, 40, 10], 30]`, 중기 `[[40, 60, 10], 50]`, 장기 `[[60, 80, 10], 70]`

### 2. 거래대금 폭발 정밀 분석

#### 2.1 거래대금 가속도 지표
```python
# 거래대금 가속도 (2차 미분 개념)
거래대금가속도1차 = (초당거래대금 - 초당거래대금N(1)) / 초당거래대금N(1) * 100 if 초당거래대금N(1) != 0 else 0
거래대금가속도2차 = (거래대금가속도1차 - 거래대금가속도1차N(1)) if 거래대금가속도1차N(1) != 0 else 0

if not (거래대금가속도1차 > 50 and 거래대금가속도2차 > 0):  # 가속도가 증가 중
    매수 = False
```
- **활용 방안**: 거래대금 증가율이 가속되는 구간 포착
- **최적화 범위**: 1차 가속도 `[[30, 70, 10], 50]`, 2차 가속도 `[[-10, 10, 5], 0]`

#### 2.2 거래대금 지속성 평가
```python
# 최근 3틱 연속 거래대금 증가 확인
거래대금지속성 = (
    (초당거래대금 > 초당거래대금N(1)) and
    (초당거래대금N(1) > 초당거래대금N(2)) and
    (초당거래대금N(2) > 초당거래대금N(3))
)

if not 거래대금지속성:
    매수 = False
```
- **활용 방안**: 일시적 급등이 아닌 지속적인 거래대금 증가 확인
- **적용 예시**: 연속 증가 틱수를 최적화 변수로 설정 `[[2, 5, 1], 3]`

### 3. TA-Lib 보조지표 활용

#### 3.1 볼린저 밴드 하단 반등 확인
```python
# 볼린저 밴드 하단 터치 후 반등
BBL터치여부 = (최저현재가(60) <= BBL * 1.005)  # 하단 0.5% 이내 터치
현재위치 = (현재가 - BBL) / (BBU - BBL) * 100 if (BBU - BBL) != 0 else 50

if not (BBL터치여부 and 현재위치 > 40):  # 하단 터치 후 중간 이상으로 반등
    매수 = False
```
- **활용 방안**: 볼린저 밴드 하단에서의 반등을 V자 패턴 보조 지표로 활용
- **최적화 범위**: 터치 범위 `[[1.000, 1.010, 0.005], 1.005]`, 현재위치 `[[30, 50, 10], 40]`

#### 3.2 RSI 과매도 구간 반등
```python
# RSI 과매도 구간에서 반등
RSI최저 = min([RSI_N(i) for i in range(60)])  # 최근 60틱 최저 RSI
RSI회복강도 = (RSI - RSI최저) if RSI최저 != 0 else 0

if not (RSI최저 < 35 and RSI > 45 and RSI회복강도 > 10):
    매수 = False
```
- **활용 방안**: RSI 과매도 구간에서 급반등 시 매수 시그널
- **최적화 범위**: RSI최저 `[[25, 40, 5], 35]`, RSI현재 `[[40, 50, 5], 45]`, 회복강도 `[[5, 15, 5], 10]`

#### 3.3 MACD 골든크로스 확인
```python
# MACD 골든크로스 (음수에서 양수로 전환)
MACD크로스 = (MACD > MACDS and MACD_N(1) <= MACDS_N(1))
MACD상승각도 = (MACD - MACD_N(5)) / 5 if MACD_N(5) != 0 else 0

if not (MACD크로스 and MACD상승각도 > 0):
    매수 = False
```
- **활용 방안**: MACD 골든크로스를 추세 전환 확인 지표로 활용
- **최적화 범위**: MACD상승각도 `[[-5, 5, 2], 0]`

### 4. 매도 전략 고도화

#### 4.1 목표가 도달 시 부분 매도
```python
# 보유수량의 50%를 목표가에서 매도, 나머지는 트레일링 스톱
if 수익률 >= 5.0 and 보유수량 == 매수수량:
    부분매도수량 = int(보유수량 * 0.5)
    self.Sell(종목코드, 종목명, 부분매도수량, 현재가, 매도호가1, 매수호가1, 강제청산=False)
    매도 = False  # 나머지는 트레일링 스톱으로 관리
elif 수익률 >= 5.0 and 보유수량 < 매수수량:
    # 이미 부분매도 완료, 트레일링 스톱 적용
    if 최고수익률 > 8.0 and 최고수익률 * 0.7 >= 수익률:
        매도 = True
```
- **활용 방안**: 리스크 분산 및 수익 극대화
- **최적화 범위**: 부분매도 수익률 `[[4.0, 6.0, 0.5], 5.0]`, 부분매도 비율 `[[0.4, 0.6, 0.1], 0.5]`

#### 4.2 시간대별 매도 전략
```python
# 09:05:00 ~ 09:10:00: 공격적 이익 실현
if 90500 <= 시분초 < 91000:
    if 수익률 >= 5.0:
        매도 = True
# 09:10:00 ~ 09:15:00: 중간 수준
elif 91000 <= 시분초 < 91500:
    if 수익률 >= 6.0:
        매도 = True
# 09:15:00 이후: 보수적 이익 실현
else:
    if 수익률 >= 7.0:
        매도 = True
```
- **활용 방안**: 시간 경과에 따른 변동성 감소를 반영한 목표 수익률 조정
- **최적화 범위**: 초반 `[[4.0, 6.0, 0.5], 5.0]`, 중반 `[[5.0, 7.0, 0.5], 6.0]`, 후반 `[[6.0, 8.0, 0.5], 7.0]`

### 5. 복합 지표 설계

#### 5.1 긴 꼬리 신뢰도 지수
```python
# 여러 지표를 종합한 긴 꼬리 패턴 신뢰도
긴꼬리신뢰도 = (
    (저가대비현재가위치 / 100) * 0.25 +
    (V자반등강도 / 100) * 0.25 +
    (초당거래대금 / 초당거래대금평균(60)) / 5 * 0.20 +
    (등락율각도(30) / 30) * 0.15 +
    (체결강도 / 체결강도평균(60)) / 2 * 0.15
)

if not (긴꼬리신뢰도 > 0.7):  # 70% 이상 신뢰도
    매수 = False
```
- **활용 방안**: 다양한 긴 꼬리 관련 지표를 종합한 복합 지수
- **최적화 범위**: `[[0.6, 0.8, 0.05], 0.7]`

#### 5.2 V자 반등 완성도 지수
```python
# V자 반등의 완성도 평가
V자완성도 = (
    (1 if 체결강도 > 최저체결강도(60) * 1.5 else 0) * 0.3 +
    (1 if 등락율각도(30) > 10 else 0) * 0.2 +
    (1 if 초당거래대금 > 초당거래대금평균(60) * 3 else 0) * 0.2 +
    (1 if 누적초당매수수량(30) > 누적초당매도수량(30) * 1.2 else 0) * 0.15 +
    (1 if 저가대비현재가위치 > 70 else 0) * 0.15
)

if not (V자완성도 >= 0.8):  # 80% 이상 완성도
    매수 = False
```
- **활용 방안**: V자 반등 패턴의 완성도를 정량화
- **최적화 범위**: `[[0.7, 0.9, 0.05], 0.8]`

### 6. 백테스팅 개선

#### 6.1 슬리피지 반영 (긴 꼬리 패턴 특화)
```python
# 급등 구간에서는 슬리피지가 더 큼
if 등락율각도(30) > 15:
    슬리피지배율 = 1.5  # 급등 시 1.5배
elif 등락율각도(30) > 10:
    슬리피지배율 = 1.2  # 상승 시 1.2배
else:
    슬리피지배율 = 1.0  # 일반

실제매수가 = 매도호가1 + (호가단위 * 0.5 * 슬리피지배율)
```

#### 6.2 시장 충격 (긴 꼬리 패턴에서 대량 매수 시)
```python
# 긴 꼬리 패턴에서 대량 매수 시 가격 상승 효과
if 매수수량 > 매도총잔량 * 0.5:
    시장충격비율 = (매수수량 / 매도총잔량 - 0.5) * 0.02
    실제매수가 = 매도호가1 * (1 + 시장충격비율)
```

### 7. 구현 우선순위

**즉시 적용 가능 (High Priority)**:
1. V자 반등 패턴 다단계 확인 (1.2)
2. RSI 과매도 구간 반등 (3.2)
3. 목표가 도달 시 부분 매도 (4.1)

**단기 적용 (Medium Priority)**:
1. 거래대금 가속도 지표 (2.1)
2. 볼린저 밴드 하단 반등 확인 (3.1)
3. 시간대별 매도 전략 (4.2)

**중장기 연구 (Low Priority)**:
1. 긴 꼬리 신뢰도 지수 (5.1)
2. V자 반등 완성도 지수 (5.2)
3. 꼬리 길이의 동적 평가 (1.1)

## 태그
- #주식트레이딩
- #틱트레이딩
- #긴꼬리패턴
- #LongTail
- #V자반등
- #매수조건
- #매도조건
- #최적화
- #유전알고리즘
- #파이썬
- #트레이딩로직
- #905_915전략
- #장초반전략
- #거래대금폭발
- #TA-Lib
- #볼린저밴드
- #RSI
- #MACD