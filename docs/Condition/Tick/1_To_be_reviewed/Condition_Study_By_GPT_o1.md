# 조건식 - Study By GPT-o1

- STOM 주식 자동거래에 사용하기 위한 틱 조건식 문서
- [[Back_Testing_Guideline_Tick]] 을(를) 기반으로 작성
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **GPT-o1 기반 연구 전략**을 정의한다.

- **대상 시간 구간**: 틱 데이터 기반 (장 전체)
- **대상 종목**: 전 종목 대상
- **전략 타입**: AI 생성 실험적 전략
- **핵심 변수**: AI 생성 조건식
- **업데이트 이력**:
  - 초기 문서 작성: GPT-o1 기반 전략

## 조건식

### 매도 조건식 (전량 매도)

```python
매도 = False  # 초기값
# 아래 trade_info 접근은 예시. 실제 인덱스나 함수는 전략마다 다름
수익금, 수익률, 최고수익률, 최저수익률, 보유수량 = self.trade_info[0][0].values()[:5]

# (1) 호가창 무너짐: 매수총잔량이 매수시점 대비 절반 이하
if 매수총잔량 < 매수총잔량N(-1) * 0.5:
    매도 = True

# (2) 체결강도 급락 + 초당매수수량 < 초당매도수량
if 체결강도 < 80 and 초당매수수량 < 초당매도수량:
    매도 = True

# (3) 단순 손절: -2% 이하
if 수익률 <= -2:
    매도 = True

# (4) 트레일링 스톱: 최고수익률이 3% 초과 시, 현재수익률이 고점의 70% 미만
#     (고점 4%→ 현재 2.8% 이하 되면 매도)
if 최고수익률 > 3 and 수익률 <= 최고수익률 * 0.7:
    매도 = True

# 매도 조건 충족 → 전량 매도
if 매도 and 보유수량 > 0:
    self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, False)

########################
# 분할 매도(부분 매도) 조건식
########################

매도 = False
매도구분 = 0   # 매도 시나리오 식별을 위한 변수
수익금, 수익률, 최고수익률, 최저수익률, 보유수량 = self.trade_info[0][0].values()[:5]

# (A) 긴급 손절 / 호가창 급변
if 매수총잔량 < 매수총잔량N(-1) * 0.5:
    매도 = True
    매도구분 = 200  # 손절청산 (전량매도)

if 체결강도 < 80 and 초당매수수량 < 초당매도수량:
    매도 = True
    매도구분 = 200

if 수익률 <= -2:
    매도 = True
    매도구분 = 200

# (B) 1차 익절 조건 (부분 매도)
# 예: 수익률 3% 이상 도달 시, 절반 매도
if 수익률 >= 3 and 보유수량 > 0:
    매도 = True
    매도구분 = 100  # 분할매도 1차

# (C) 2차 익절 조건 (남은 물량 전량 매도)
# 예: 수익률 5% 이상 되면 나머지 모두 청산
if 수익률 >= 5 and 보유수량 > 0:
    매도 = True
    매도구분 = 101  # 분할매도 2차

# (D) 최종 매도 실행
if 매도 and 보유수량 > 0:
    if 매도구분 == 200:
        # 긴급 손절 or 호가창 무너짐: 전량 청산
        self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, False)

    elif 매도구분 == 100:
        # 1차 분할매도 (절반 정도만 매도 예시)
        부분매도수량 = int(보유수량 * 0.5)
        self.Sell(종목코드, 종목명, 부분매도수량, 현재가, 매도호가1, 매수호가1, False)

    elif 매도구분 == 101:
        # 2차 분할매도: 전량 매도
        self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, False)

## 조건식 개선 방향 연구

### 1. 추가 지표 활용 연구

**우선순위: 높음**
- **호가창 두께 분석 추가**
  - 매수/매도 잔량 비율을 통한 지지/저항 강도 측정
  - 얇은 호가창 종목 필터링으로 급등락 리스크 감소
  - 구현 난이도: 낮음

- **거래대금 가속도 측정**
  - 1차 미분, 2차 미분 계산으로 거래량 가속 감지
  - 가속도가 양수일 때 매수 신호 강화
  - 구현 난이도: 중

### 2. 시간대별 전략 세분화 연구

**우선순위: 높음**
- **장 초반/중반/후반 조건 차등 적용**
  - 09:00-09:30: 갭 상승 전략 강화
  - 10:00-14:00: 모멘텀 추종 전략
  - 14:30-15:00: 단기 스캘핑 전략
  - 구현 난이도: 중

### 3. 매도 조건 고도화 연구

**우선순위: 높음**
- **동적 손절/익절 시스템**
  - 변동성 기반 손절폭 조정 (ATR 활용)
  - 트레일링 스톱 최적화
  - 구현 난이도: 중

- **부분 매도 전략**
  - 목표가 1차 도달 시 50% 매도
  - 나머지 50%는 트레일링 스톱 적용
  - 구현 난이도: 낮음

### 4. 리스크 관리 강화 연구

**우선순위: 높음**
- **허위 급등 필터링**
  - 급증 후 N초 지속 여부 확인
  - 일시적 스파이크 제거
  - 구현 난이도: 낮음

- **라운드 피겨 회피 강화**
  - 심리적 저항선 근처 진입 제한
  - 돌파 확인 후 진입
  - 구현 난이도: 낮음

### 5. 최적화 전략 개선 연구

**우선순위: 중간**
- **시가총액별 파라미터 세분화**
  - 초소형주 (1000억 미만) 별도 조건
  - 대형주 (1조 이상) 별도 조건
  - 구현 난이도: 중

- **백테스팅 기간 확대**
  - 다양한 시장 국면 반영
  - 과적합 방지
  - 구현 난이도: 낮음

### 구현 우선순위

1. **1단계 (즉시 구현)**:
   - 허위 급등 필터링
   - 호가창 두께 분석
   - 부분 매도 전략

2. **2단계 (1개월 내)**:
   - 거래대금 가속도 측정
   - 동적 손절/익절 시스템
   - 시간대별 전략 세분화

3. **3단계 (3개월 내)**:
   - 시가총액별 파라미터 세분화
   - 백테스팅 기간 확대
   - 복합 지표 개발

