# 조건식 (Condition)

- STOM 주식 자동거래에 사용하기 위한 조건식 문서
- [[Back_Testing_Guideline_Tick]] 을(를) 기반으로 작성한 Tick 조건식
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 목차
- [조건식 (Condition)](#조건식-condition)
  - [목차](#목차)
  - [소개](#소개)
  - [가이드라인](#가이드라인)
    - [저장 이름 규칙](#저장-이름-규칙)
- [Condition - Tick 910\_930 Rebound (반등 돌파)](#condition---tick-910_930-rebound-반등-돌파)
  - [전략 개요](#전략-개요)
  - [조건식](#조건식)
    - [매수 조건식 - C\_T\_910\_930\_RB\_B](#매수-조건식---c_t_910_930_rb_b)
    - [매도 조건식 - C\_T\_910\_930\_RB\_S](#매도-조건식---c_t_910_930_rb_s)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식 - C\_T\_910\_930\_RB\_BO](#매수-최적화-조건식---c_t_910_930_rb_bo)
    - [매수 최적화 범위 - C\_T\_910\_930\_RB\_BOR](#매수-최적화-범위---c_t_910_930_rb_bor)
    - [매도 최적화 조건식 - C\_T\_910\_930\_RB\_SO](#매도-최적화-조건식---c_t_910_930_rb_so)
    - [매도 최적화 범위 - C\_T\_910\_930\_RB\_SOR](#매도-최적화-범위---c_t_910_930_rb_sor)
    - [매수 매도 최적화 범위 - C\_T\_910\_930\_RB\_OR](#매수-매도-최적화-범위---c_t_910_930_rb_or)
    - [예상 시간 계산](#예상-시간-계산)
    - [GA 최적화 범위 - C\_T\_910\_930\_RB\_GAR](#ga-최적화-범위---c_t_910_930_rb_gar)
  - [조건식 개선 방향 연구](#조건식-개선-방향-연구)
  - [태그](#태그)

## 소개

이 문서는 STOM 주식 자동거래 시스템에서 사용되는 **반등 돌파 패턴** 조건식을 설명합니다.

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **장 초반 조정 후 반등 돌파 전략**을 정의한다.

- **대상 시간 구간**: 09:10:00 ~ 09:30:00 (장 시작 10분 후 ~ 30분 후)
- **대상 종목**: 시가총액별 구분, 가격대 1,000원~50,000원
- **전략 타입**: 조정 후 재상승 돌파 패턴 포착
- **핵심 변수**: 최고현재가(300), 초당거래대금비율, 체결강도, 등락율각도, 이동평균(60/120)
- **업데이트 이력**:
  - 초기 문서 작성

**전략의 핵심 개념**:
- **패턴**: 단기 하락 후 강한 매수세가 유입되어 하락분을 모두 회복하며 돌파하는 형태
- **원리**: 장 초반 과열 후 조정을 거친 종목이 재차 매수세를 받아 상승 돌파
- **특징**:
  - 이전 고점 돌파 확인 (최고현재가(300) 돌파)
  - 거래대금이 평균 대비 2배 이상 증가
  - 체결강도가 평균 이상으로 회복
  - 등락율각도가 음수에서 양수로 전환
  - 이동평균선 상향 돌파

## 가이드라인

- 모든 조건식은 Python으로 작성되어 있으며, 주식 거래의 자동화를 목표로 합니다.
- 각 조건식은 특정 조건을 만족할 때 매수 또는 매도를 실행합니다.
- 최적화 조건식은 변수의 범위를 설정하여 최적의 매수/매도 시점을 찾습니다.
- 최적화 범위는 `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]` 형식으로 설정합니다.
- `self.vars[0]`은 고정값으로 설정되며, 조건식 변수는 `self.vars[1]`부터 공백 없이 사용됩니다.
- GA(유전 알고리즘) 최적화 범위 생성 방법:
  - 유전 알고리즘을 사용하여 최적의 매수/매도 시점을 찾기 위해, 각 변수의 범위를 설정합니다.
  - 각 변수는 `self.vars[정수] = [범위리스트, 최적값]` 형식으로 정의됩니다.
  - 범위리스트는 시작값부터 종료값까지 간격에 따라 생성된 값들의 집합입니다.
  - 고정값은 2단계, 3단계에서 이전 탐색에서 검출되지 않아도 돌연변이로 추가됩니다. 이는 사용자가 이미 알고 있는 최적값을 강제로 탐색하기 위함입니다. 4단계부터는 돌연변이로 추가되지 않습니다.
  - 너무 많은 변수를 입력할 경우 시간이 오래 걸리므로, 각각의 변수 범위를 10개 이하로 설정하십시오. 변수 범위의 최대값은 20개입니다.
  - 최적값 중에 최적값을 찾는 방법은 일반 최적화에서 구한 최적값을 GA에 돌연변이값으로 넣고 GA를 돌린 다음, 다시 GA에서 구한 최적값으로 일반 최적화를 돌리면 됩니다.

### 저장 이름 규칙

조건식과 관련된 다양한 테스트 및 최적화 조건을 저장할 때, 일관된 작명 규칙을 사용하여 관리의 용이성을 높일 수 있습니다. 아래는 현재 사용 중인 규칙과 함께, 향후 확장성을 고려한 제안입니다.

1. **기본 규칙**:
   - `C`: Condition을 의미합니다.
   - `T`: Tick을 의미합니다.
   - `숫자`: 실험 번호를 나타냅니다.
   - `RB`: Rebound (반등 돌파 패턴)를 의미합니다.
   - `B`: 매수 조건식을 의미합니다.
   - `S`: 매도 조건식을 의미합니다.
   - `BO`: 매수 최적화 조건식을 의미합니다.
   - `SO`: 매도 최적화 조건식을 의미합니다.
   - `BOR`: 매수 최적화 범위를 의미합니다.
   - `SOR`: 매도 최적화 범위를 의미합니다.
   - `OR`: 매수 매도 통합 최적화 범위를 의미합니다.
   - `GAR`: GA 최적화 범위를 의미합니다.

2. **예시**:
   - `C_T_910_930_RB_B`: 910-930 반등 돌파 패턴의 매수 조건식
   - `C_T_910_930_RB_S`: 910-930 반등 돌파 패턴의 매도 조건식
   - `C_T_910_930_RB_BO`: 910-930 반등 돌파 패턴의 매수 최적화 조건식
   - `C_T_910_930_RB_SO`: 910-930 반등 돌파 패턴의 매도 최적화 조건식

---

# Condition - Tick 910_930 Rebound (반등 돌파)

## 전략 개요

### 패턴 인식 로직

**반등 돌파 (Rebound Breakout) 정의**:
- 장 초반 급등 후 조정을 거친 종목의 재상승 패턴
- 최근 5분(300틱) 이내 고점을 현재가가 돌파
- 돌파 시점에 거래대금이 평균 대비 2배 이상 증가
- 체결강도가 평균 이상으로 회복 (100 이상)

**조정 후 재상승 확인**:
- 최저체결강도(120) 이후 체결강도가 30% 이상 회복
- 등락율각도가 음수에서 양수로 전환 (하락 → 상승)
- 이동평균(60) 상향 돌파 확인
- 전일비 및 전일동시간비가 모두 양수 (전일 대비 거래량 증가)

**지지/저항 돌파 확인**:
- 최고현재가(300) 돌파: 최근 5분 고점 돌파
- 현재가 > 이동평균(60): 단기 이동평균선 돌파
- 현재가 > 이동평균(120): 중기 이동평균선 위
- VI아래5호가 이내: 과도한 급등으로 VI 발동 직전 아님

### 시장 상황별 전략

**소형주 (시가총액 < 3000억)**:
- 변동성이 크므로 더 강한 돌파 조건 요구
- 체결강도 최소 100 이상
- 초당순매수금액 최소 10백만원 이상
- 돌파 후 지속성 확인 (3틱 연속 상승)

**중형주 (3000억 <= 시가총액 < 10000억)**:
- 중간 수준의 돌파 조건
- 체결강도 최소 80 이상
- 초당순매수금액 최소 20백만원 이상

**대형주 (시가총액 >= 10000억)**:
- 더 완화된 돌파 조건
- 체결강도 최소 60 이상
- 초당순매수금액 최소 50백만원 이상

## 조건식

### 매수 조건식 - C_T_910_930_RB_B

```python
# ================================
#  공통 계산 지표
# ================================
전일종가          = 현재가 / (1 + (등락율 / 100))                      # 단위: 원
시가등락율        = ((시가 - 전일종가) / 전일종가) * 100                # 단위: 퍼센트
시가대비등락율    = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트
초당순매수금액    = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000   # 단위: 백만원
고점돌파여부      = (현재가 > 최고현재가(300)) if 데이터길이 > 300 else False  # 5분 고점 돌파
이평돌파여부      = (현재가 > 이동평균(60) and 이동평균(60) > 이동평균(60, 1))  # 이동평균 상향 돌파
체결강도회복률    = (체결강도 - 최저체결강도(120)) / 최저체결강도(120) * 100 if 최저체결강도(120) != 0 else 0  # 단위: 퍼센트
등락율전환여부    = (등락율각도(30) > 0 and 등락율각도(60) < 등락율각도(30))  # 하락에서 상승으로 전환
거래대금증가배수  = (초당거래대금 / 초당거래대금평균(120)) if 초당거래대금평균(120) != 0 else 0  # 배수



# ================================
#  매수 조건 (반등 돌파)
# ================================
매수 = True


if not (관심종목 == 1):                         # 공통 필터 – 관심종목
    매수 = False


# ---------- 09:10:00 ~ 09:30:00 (반등 돌파 패턴) ----------
elif 91000 <= 시분초 < 93000:
    # 기본 가격 및 시간 필터
    if not (1000 < 현재가 <= 50000):
        매수 = False
    elif not (0.0 < 등락율 <= 25.0):
        매수 = False
    elif not (고저평균대비등락율 > -5.0):       # 약간의 조정은 허용
        매수 = False
    elif not (현재가 < VI아래5호가):
        매수 = False
    elif 라운드피겨위5호가이내:
        매수 = False
    elif not (데이터길이 >= 300):               # 최소 300틱 (약 5분) 데이터 필요
        매수 = False

    # 돌파 패턴 확인
    elif not 고점돌파여부:                      # 최근 5분 고점 돌파 필수
        매수 = False
    elif not 이평돌파여부:                      # 이동평균 상향 돌파 필수
        매수 = False
    elif not (현재가 > 이동평균(120)):          # 중기 이동평균 위
        매수 = False

    # 거래대금 증가 확인
    elif not (거래대금증가배수 > 2.0):          # 평균 대비 2배 이상
        매수 = False
    elif not (초당거래대금 > 초당거래대금N(1) * 1.1):
        매수 = False
    elif not (당일거래대금각도(60) > 5):
        매수 = False

    # 반등 확인
    elif not (체결강도회복률 > 30):             # 최저점 대비 30% 이상 회복
        매수 = False
    elif not 등락율전환여부:                    # 하락에서 상승으로 전환
        매수 = False

    # 시가총액별 세부 조건
    else:
        if 시가총액 < 3000:                      # 소형주
            if not (-3.0 <= 시가등락율 < 8.0):
                매수 = False
            elif not (0.0 <= 시가대비등락율 < 15.0):
                매수 = False
            elif not (10 < 초당순매수금액 < 2000):
                매수 = False
            elif not (전일비 > 30 and 전일동시간비 > 30):
                매수 = False
            elif not (회전율 > 1.0):
                매수 = False
            elif not (당일거래대금 > 200 * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * 0.40):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60)):
                매수 = False
            elif not (체결강도 >= 100 and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(120)):
                매수 = False
            # 돌파 지속성 확인 (3틱 연속 상승)
            elif not (현재가 > 현재가N(1) and 현재가N(1) > 현재가N(2)):
                매수 = False

        elif 시가총액 < 10000:                   # 중형주
            if not (-2.0 <= 시가등락율 < 10.0):
                매수 = False
            elif not (0.5 <= 시가대비등락율 < 18.0):
                매수 = False
            elif not (20 < 초당순매수금액 < 3000):
                매수 = False
            elif not (전일비 > 20 and 전일동시간비 > 20):
                매수 = False
            elif not (회전율 > 0.8):
                매수 = False
            elif not (당일거래대금 > 300 * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * 0.35):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * 0.9):
                매수 = False
            elif not (체결강도 >= 80 and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(120) * 0.95):
                매수 = False

        else:                                     # 대형주
            if not (-1.0 <= 시가등락율 < 12.0):
                매수 = False
            elif not (1.0 <= 시가대비등락율 < 20.0):
                매수 = False
            elif not (50 < 초당순매수금액 < 5000):
                매수 = False
            elif not (전일비 > 10 and 전일동시간비 > 10):
                매수 = False
            elif not (회전율 > 0.5):
                매수 = False
            elif not (당일거래대금 > 500 * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * 0.30):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * 0.8):
                매수 = False
            elif not (체결강도 >= 60 and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(120) * 0.90):
                매수 = False


# ---------- 09:30:00 이후 ----------
else:
    매수 = False


# ================================
#  매수 호출
# ================================
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식 - C_T_910_930_RB_S

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율    = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트
이평이탈여부      = (현재가 < 이동평균(60) and 현재가N(1) >= 이동평균(60, 1))  # 이동평균 하향 이탈
체결강도약화여부  = (체결강도 < 체결강도평균(60) * 0.8)              # 체결강도 약화
상승동력소진      = (등락율각도(30) < 5 and 최고등락율각도(30) > 15)  # 상승 동력 소진



# ================================
#  매도 조건 (반등 돌파)
# ================================
매도 = False


# 등락율 상한가 직전
if 등락율 > 28.5:
    매도 = True

# 급격한 하락 손절
elif 시가대비등락율 < -2.0 and 수익률 <= -3.0 and 현재가 < 최저현재가(int(60), int(보유시간)):
    매도 = True

# 이동평균 하향 이탈 매도
elif 이평이탈여부 and 수익률 > 0:
    매도 = True

# 보유시간 초과 손절
elif 보유시간 > 180 and 현재가 < 최저현재가(int(90), int(보유시간)):
    매도 = True

# 일반 매도 조건 (09:40:00 이전)
elif 시분초 < 94000:
    # 목표 수익률 달성 또는 손절
    if 수익률 >= 8.0 or 수익률 <= -4.0:
        매도 = True

    # 최고수익률 대비 하락
    elif 최고수익률 > 10.0 and 최고수익률 * 0.70 >= 수익률:
        매도 = True

    # 상승 동력 소진
    elif 상승동력소진 and 최고수익률 > 5.0:
        매도 = True

    # 체결강도 급락
    elif 체결강도약화여부 and 최고수익률 > 3.0:
        매도 = True

    # 시가총액별 매도 조건
    elif 시가총액 < 10000:
        # 등락율 각도별 매도 압력 확인
        if 등락율각도(30) >= 20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.3 and (현재가 / 현재가N(1) - 1) * 100 < -0.3:
            매도 = True
        elif 10 <= 등락율각도(30) < 20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.5 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True
        elif 5 <= 등락율각도(30) < 10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.6 and (현재가 / 현재가N(1) - 1) * 100 < -0.4:
            매도 = True
        elif 0 <= 등락율각도(30) < 5 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.7 and (현재가 / 현재가N(1) - 1) * 100 < -0.3:
            매도 = True
        elif 등락율각도(30) < 0 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.8 and (현재가 / 현재가N(1) - 1) * 100 < -0.4:
            매도 = True

        # 고가 대비 하락률 매도
        elif 현재가 < 고가 * 0.97 and 최고수익률 > 6.0:
            매도 = True


# ================================
#  매도 호출
# ================================
if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

## 최적화 조건식

### 매수 최적화 조건식 - C_T_910_930_RB_BO

```python
# ================================
#  공통 계산 지표
# ================================
전일종가          = 현재가 / (1 + (등락율 / 100))
시가등락율        = ((시가 - 전일종가) / 전일종가) * 100
시가대비등락율    = ((현재가 - 시가) / 시가) * 100
초당순매수금액    = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000
고점돌파여부      = (현재가 > 최고현재가(300)) if 데이터길이 > 300 else False
이평돌파여부      = (현재가 > 이동평균(60) and 이동평균(60) > 이동평균(60, 1))
체결강도회복률    = (체결강도 - 최저체결강도(120)) / 최저체결강도(120) * 100 if 최저체결강도(120) != 0 else 0
등락율전환여부    = (등락율각도(30) > 0 and 등락율각도(60) < 등락율각도(30))
거래대금증가배수  = (초당거래대금 / 초당거래대금평균(120)) if 초당거래대금평균(120) != 0 else 0

매수 = True

if not (관심종목 == 1):
    매수 = False

elif 91000 <= 시분초 < 93000:
    if not (1000 < 현재가 <= 50000):
        매수 = False
    elif not (0.0 < 등락율 <= self.vars[1]):
        매수 = False
    elif not (고저평균대비등락율 > self.vars[2]):
        매수 = False
    elif not (현재가 < VI아래5호가):
        매수 = False
    elif 라운드피겨위5호가이내:
        매수 = False
    elif not (데이터길이 >= 300):
        매수 = False
    elif not 고점돌파여부:
        매수 = False
    elif not 이평돌파여부:
        매수 = False
    elif not (현재가 > 이동평균(120)):
        매수 = False
    elif not (거래대금증가배수 > self.vars[3]):
        매수 = False
    elif not (초당거래대금 > 초당거래대금N(1) * self.vars[4]):
        매수 = False
    elif not (당일거래대금각도(60) > self.vars[5]):
        매수 = False
    elif not (체결강도회복률 > self.vars[6]):
        매수 = False
    elif not 등락율전환여부:
        매수 = False
    else:
        if 시가총액 < 3000:
            if not (self.vars[7] <= 시가등락율 < self.vars[8]):
                매수 = False
            elif not (self.vars[9] <= 시가대비등락율 < self.vars[10]):
                매수 = False
            elif not (self.vars[11] < 초당순매수금액 < 2000):
                매수 = False
            elif not (전일비 > self.vars[12] and 전일동시간비 > self.vars[13]):
                매수 = False
            elif not (회전율 > self.vars[14]):
                매수 = False
            elif not (당일거래대금 > self.vars[15] * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * self.vars[16]):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60)):
                매수 = False
            elif not (체결강도 >= self.vars[17] and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(120)):
                매수 = False
            elif not (현재가 > 현재가N(1) and 현재가N(1) > 현재가N(2)):
                매수 = False
        elif 시가총액 < 10000:
            if not (self.vars[18] <= 시가등락율 < self.vars[19]):
                매수 = False
            elif not (self.vars[20] <= 시가대비등락율 < self.vars[21]):
                매수 = False
            elif not (self.vars[22] < 초당순매수금액 < 3000):
                매수 = False
            elif not (전일비 > self.vars[23] and 전일동시간비 > self.vars[24]):
                매수 = False
            elif not (회전율 > self.vars[25]):
                매수 = False
            elif not (당일거래대금 > self.vars[26] * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * self.vars[27]):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * self.vars[28]):
                매수 = False
            elif not (체결강도 >= self.vars[29] and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(120) * self.vars[30]):
                매수 = False
        else:
            if not (self.vars[31] <= 시가등락율 < self.vars[32]):
                매수 = False
            elif not (self.vars[33] <= 시가대비등락율 < self.vars[34]):
                매수 = False
            elif not (self.vars[35] < 초당순매수금액 < 5000):
                매수 = False
            elif not (전일비 > self.vars[36] and 전일동시간비 > self.vars[37]):
                매수 = False
            elif not (회전율 > self.vars[38]):
                매수 = False
            elif not (당일거래대금 > self.vars[39] * 100):
                매수 = False
            elif not (초당매수수량 > 매도총잔량 * self.vars[40]):
                매수 = False
            elif not (누적초당매수수량(60) > 누적초당매도수량(60) * self.vars[41]):
                매수 = False
            elif not (체결강도 >= self.vars[42] and 체결강도 <= 300):
                매수 = False
            elif not (체결강도 > 체결강도평균(120) * self.vars[43]):
                매수 = False
else:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위 - C_T_910_930_RB_BOR

```python
# 반등 돌파 패턴 최적화 범위 (09:10:00~09:30:00)
self.vars[1] = [[20.0, 30.0, 2.0], 25.0]       # 등락율 상한: 20.0%에서 30.0%까지 2.0% 간격, 범위 갯수: 6
self.vars[2] = [[-7.0, -3.0, 2.0], -5.0]       # 고저평균대비등락율: -7.0에서 -3.0까지 2.0 간격, 범위 갯수: 3
self.vars[3] = [[1.5, 2.5, 0.5], 2.0]          # 거래대금증가배수: 1.5배에서 2.5배까지 0.5배 간격, 범위 갯수: 3
self.vars[4] = [[1.05, 1.15, 0.05], 1.10]      # 초당거래대금증가율: 1.05배에서 1.15배까지 0.05배 간격, 범위 갯수: 3
self.vars[5] = [[3, 7, 2], 5]                  # 당일거래대금각도: 3에서 7까지 2 간격, 범위 갯수: 3
self.vars[6] = [[25, 35, 5], 30]               # 체결강도회복률: 25에서 35까지 5 간격, 범위 갯수: 3

# 소형주 (시가총액 < 3000) 최적화 범위
self.vars[7] = [[-4.0, -2.0, 1.0], -3.0]       # 시가등락율 하한: -4.0%에서 -2.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[8] = [[7.0, 9.0, 1.0], 8.0]          # 시가등락율 상한: 7.0%에서 9.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[9] = [[-0.5, 0.5, 0.5], 0.0]         # 시가대비등락율 하한: -0.5%에서 0.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[10] = [[14.0, 16.0, 1.0], 15.0]      # 시가대비등락율 상한: 14.0%에서 16.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[11] = [[8, 12, 2], 10]               # 초당순매수금액 하한: 8에서 12까지 2 간격, 범위 갯수: 3
self.vars[12] = [[25, 35, 5], 30]              # 전일비: 25에서 35까지 5 간격, 범위 갯수: 3
self.vars[13] = [[25, 35, 5], 30]              # 전일동시간비: 25에서 35까지 5 간격, 범위 갯수: 3
self.vars[14] = [[0.8, 1.2, 0.2], 1.0]         # 회전율: 0.8배에서 1.2배까지 0.2배 간격, 범위 갯수: 3
self.vars[15] = [[150, 250, 50], 200]          # 당일거래대금: 150에서 250까지 50 간격, 범위 갯수: 3
self.vars[16] = [[0.35, 0.45, 0.05], 0.40]     # 초당매수수량비율: 0.35에서 0.45까지 0.05 간격, 범위 갯수: 3
self.vars[17] = [[90, 110, 10], 100]           # 체결강도 하한: 90에서 110까지 10 간격, 범위 갯수: 3

# 중형주 (3000 <= 시가총액 < 10000) 최적화 범위
self.vars[18] = [[-3.0, -1.0, 1.0], -2.0]      # 시가등락율 하한: -3.0%에서 -1.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[19] = [[9.0, 11.0, 1.0], 10.0]       # 시가등락율 상한: 9.0%에서 11.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[20] = [[0.0, 1.0, 0.5], 0.5]         # 시가대비등락율 하한: 0.0%에서 1.0%까지 0.5% 간격, 범위 갯수: 3
self.vars[21] = [[17.0, 19.0, 1.0], 18.0]      # 시가대비등락율 상한: 17.0%에서 19.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[22] = [[15, 25, 5], 20]              # 초당순매수금액 하한: 15에서 25까지 5 간격, 범위 갯수: 3
self.vars[23] = [[15, 25, 5], 20]              # 전일비: 15에서 25까지 5 간격, 범위 갯수: 3
self.vars[24] = [[15, 25, 5], 20]              # 전일동시간비: 15에서 25까지 5 간격, 범위 갯수: 3
self.vars[25] = [[0.6, 1.0, 0.2], 0.8]         # 회전율: 0.6배에서 1.0배까지 0.2배 간격, 범위 갯수: 3
self.vars[26] = [[250, 350, 50], 300]          # 당일거래대금: 250에서 350까지 50 간격, 범위 갯수: 3
self.vars[27] = [[0.30, 0.40, 0.05], 0.35]     # 초당매수수량비율: 0.30에서 0.40까지 0.05 간격, 범위 갯수: 3
self.vars[28] = [[0.85, 0.95, 0.05], 0.90]     # 누적매수우세비율: 0.85에서 0.95까지 0.05 간격, 범위 갯수: 3
self.vars[29] = [[70, 90, 10], 80]             # 체결강도 하한: 70에서 90까지 10 간격, 범위 갯수: 3
self.vars[30] = [[0.90, 1.00, 0.05], 0.95]     # 체결강도평균배율: 0.90배에서 1.00배까지 0.05배 간격, 범위 갯수: 3

# 대형주 (시가총액 >= 10000) 최적화 범위
self.vars[31] = [[-2.0, 0.0, 1.0], -1.0]       # 시가등락율 하한: -2.0%에서 0.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[32] = [[11.0, 13.0, 1.0], 12.0]      # 시가등락율 상한: 11.0%에서 13.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[33] = [[0.5, 1.5, 0.5], 1.0]         # 시가대비등락율 하한: 0.5%에서 1.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[34] = [[19.0, 21.0, 1.0], 20.0]      # 시가대비등락율 상한: 19.0%에서 21.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[35] = [[40, 60, 10], 50]             # 초당순매수금액 하한: 40에서 60까지 10 간격, 범위 갯수: 3
self.vars[36] = [[5, 15, 5], 10]               # 전일비: 5에서 15까지 5 간격, 범위 갯수: 3
self.vars[37] = [[5, 15, 5], 10]               # 전일동시간비: 5에서 15까지 5 간격, 범위 갯수: 3
self.vars[38] = [[0.3, 0.7, 0.2], 0.5]         # 회전율: 0.3배에서 0.7배까지 0.2배 간격, 범위 갯수: 3
self.vars[39] = [[400, 600, 100], 500]         # 당일거래대금: 400에서 600까지 100 간격, 범위 갯수: 3
self.vars[40] = [[0.25, 0.35, 0.05], 0.30]     # 초당매수수량비율: 0.25에서 0.35까지 0.05 간격, 범위 갯수: 3
self.vars[41] = [[0.75, 0.85, 0.05], 0.80]     # 누적매수우세비율: 0.75에서 0.85까지 0.05 간격, 범위 갯수: 3
self.vars[42] = [[50, 70, 10], 60]             # 체결강도 하한: 50에서 70까지 10 간격, 범위 갯수: 3
self.vars[43] = [[0.85, 0.95, 0.05], 0.90]     # 체결강도평균배율: 0.85배에서 0.95배까지 0.05배 간격, 범위 갯수: 3

# 매수 총 경우의 수: 6 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 = 1,853,020,188,851,841
```

### 매도 최적화 조건식 - C_T_910_930_RB_SO

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율    = ((현재가 - 시가) / 시가) * 100
이평이탈여부      = (현재가 < 이동평균(60) and 현재가N(1) >= 이동평균(60, 1))
체결강도약화여부  = (체결강도 < 체결강도평균(60) * 0.8)
상승동력소진      = (등락율각도(30) < 5 and 최고등락율각도(30) > 15)

매도 = False

if 등락율 > self.vars[44]:
    매도 = True
elif 시가대비등락율 < self.vars[45] and 수익률 <= self.vars[46] and 현재가 < 최저현재가(int(60), int(보유시간)):
    매도 = True
elif 이평이탈여부 and 수익률 > 0:
    매도 = True
elif 보유시간 > self.vars[47] and 현재가 < 최저현재가(int(90), int(보유시간)):
    매도 = True
elif 시분초 < 94000:
    if 수익률 >= self.vars[48] or 수익률 <= self.vars[49]:
        매도 = True
    elif 최고수익률 > self.vars[50] and 최고수익률 * self.vars[51] >= 수익률:
        매도 = True
    elif 상승동력소진 and 최고수익률 > self.vars[52]:
        매도 = True
    elif 체결강도약화여부 and 최고수익률 > self.vars[53]:
        매도 = True
    elif 시가총액 < 10000:
        if 등락율각도(30) >= 20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[54] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[55]:
            매도 = True
        elif 10 <= 등락율각도(30) < 20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[56] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[57]:
            매도 = True
        elif 5 <= 등락율각도(30) < 10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[58] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[59]:
            매도 = True
        elif 0 <= 등락율각도(30) < 5 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[60] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[61]:
            매도 = True
        elif 등락율각도(30) < 0 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[62] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[63]:
            매도 = True
        elif 현재가 < 고가 * self.vars[64] and 최고수익률 > self.vars[65]:
            매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

### 매도 최적화 범위 - C_T_910_930_RB_SOR

```python
# 매도 최적화 범위 (매수 변수 43 다음부터 44번부터 시작)
self.vars[44] = [[28.0, 29.0, 0.5], 28.5]      # 등락율 상한가: 28.0%에서 29.0%까지 0.5% 간격, 범위 갯수: 3
self.vars[45] = [[-3.0, -1.0, 1.0], -2.0]      # 시가대비등락율 하락: -3.0%에서 -1.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[46] = [[-4.0, -2.0, 1.0], -3.0]      # 손실 수익률: -4.0%에서 -2.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[47] = [[150, 210, 30], 180]          # 보유시간 초과: 150초에서 210초까지 30초 간격, 범위 갯수: 3
self.vars[48] = [[7.0, 9.0, 1.0], 8.0]         # 수익률 상한: 7.0%에서 9.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[49] = [[-5.0, -3.0, 1.0], -4.0]      # 수익률 하한: -5.0%에서 -3.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[50] = [[9.0, 11.0, 1.0], 10.0]       # 최고수익률 기준값: 9.0%에서 11.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[51] = [[0.65, 0.75, 0.05], 0.70]     # 최고수익률 대비 현재 수익률 비율: 0.65에서 0.75까지 0.05 간격, 범위 갯수: 3
self.vars[52] = [[4.0, 6.0, 1.0], 5.0]         # 상승동력소진 최고수익률: 4.0%에서 6.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[53] = [[2.5, 3.5, 0.5], 3.0]         # 체결강도약화 최고수익률: 2.5%에서 3.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[54] = [[0.25, 0.35, 0.05], 0.30]     # 등락율각도20이상 매도비율: 0.25에서 0.35까지 0.05 간격, 범위 갯수: 3
self.vars[55] = [[-0.4, -0.2, 0.1], -0.3]      # 등락율각도20이상 하락률: -0.4에서 -0.2까지 0.1 간격, 범위 갯수: 3
self.vars[56] = [[0.45, 0.55, 0.05], 0.50]     # 등락율각도10-20 매도비율: 0.45에서 0.55까지 0.05 간격, 범위 갯수: 3
self.vars[57] = [[-0.6, -0.4, 0.1], -0.5]      # 등락율각도10-20 하락률: -0.6에서 -0.4까지 0.1 간격, 범위 갯수: 3
self.vars[58] = [[0.55, 0.65, 0.05], 0.60]     # 등락율각도5-10 매도비율: 0.55에서 0.65까지 0.05 간격, 범위 갯수: 3
self.vars[59] = [[-0.5, -0.3, 0.1], -0.4]      # 등락율각도5-10 하락률: -0.5에서 -0.3까지 0.1 간격, 범위 갯수: 3
self.vars[60] = [[0.65, 0.75, 0.05], 0.70]     # 등락율각도0-5 매도비율: 0.65에서 0.75까지 0.05 간격, 범위 갯수: 3
self.vars[61] = [[-0.4, -0.2, 0.1], -0.3]      # 등락율각도0-5 하락률: -0.4에서 -0.2까지 0.1 간격, 범위 갯수: 3
self.vars[62] = [[0.75, 0.85, 0.05], 0.80]     # 등락율각도음수 매도비율: 0.75에서 0.85까지 0.05 간격, 범위 갯수: 3
self.vars[63] = [[-0.5, -0.3, 0.1], -0.4]      # 등락율각도음수 하락률: -0.5에서 -0.3까지 0.1 간격, 범위 갯수: 3
self.vars[64] = [[0.96, 0.98, 0.01], 0.97]     # 고가대비하락 비율: 0.96배에서 0.98배까지 0.01배 간격, 범위 갯수: 3
self.vars[65] = [[5.5, 6.5, 0.5], 6.0]         # 고가대비하락 최고수익률: 5.5%에서 6.5%까지 0.5% 간격, 범위 갯수: 3

# 매도 총 경우의 수: 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 = 31,381,059,609
```

### 매수 매도 최적화 범위 - C_T_910_930_RB_OR

```python
# 평균 틱수 고정값
self.vars[0] = [[120, 120, 0], 120]            # 평균 틱수 고정값: 120 (2분), 범위 갯수: 1

# [매수 최적화 범위 - 위의 BOR과 동일하게 self.vars[1] ~ self.vars[43]]
# [매도 최적화 범위 - 위의 SOR과 동일하게 self.vars[44] ~ self.vars[65]]

# 매수 매도 총 경우의 수: 1,853,020,188,851,841 × 31,381,059,609 = 58,157,649,977,699,537,756,669,769
```

### 예상 시간 계산

각 변수의 범위 갯수를 곱하여 모든 경우의 수를 계산합니다.

- **매수 조건 변수 범위**:
  - 1,853,020,188,851,841
- **매도 조건 변수 범위**:
  - 31,381,059,609
- **총 경우의 수**:
  - 약 5.8 × 10^25

각 경우에 1분이 걸린다고 가정하면:
- **분**: 5.8 × 10^25 분
- **시간**: 9.7 × 10^23 시간
- **일**: 4.0 × 10^22 일
- **년**: 1.1 × 10^20 년

**가정**: 각 경우의 수를 처리하는 데 1분이 소요된다고 가정하였습니다. 이는 비현실적인 시간이므로, **GA 최적화 방식을 강력히 권장합니다.**

### GA 최적화 범위 - C_T_910_930_RB_GAR

```python
# 평균 틱수 고정값
self.vars[0] = [[120], 120]                                                    # 평균 틱수 고정값, 범위 갯수: 1

# GA 최적화 범위 - 반등 돌파 패턴
self.vars[1] = [[20.0, 22.0, 24.0, 26.0, 28.0, 30.0], 25.0]                   # 등락율 상한, 범위 갯수: 6
self.vars[2] = [[-7.0, -5.0, -3.0], -5.0]                                      # 고저평균대비등락율, 범위 갯수: 3
self.vars[3] = [[1.5, 2.0, 2.5], 2.0]                                          # 거래대금증가배수, 범위 갯수: 3
self.vars[4] = [[1.05, 1.10, 1.15], 1.10]                                      # 초당거래대금증가율, 범위 갯수: 3
self.vars[5] = [[3, 5, 7], 5]                                                  # 당일거래대금각도, 범위 갯수: 3
self.vars[6] = [[25, 30, 35], 30]                                              # 체결강도회복률, 범위 갯수: 3

# GA 최적화 범위 - 소형주
self.vars[7] = [[-4.0, -3.0, -2.0], -3.0]                                      # 시가등락율 하한, 범위 갯수: 3
self.vars[8] = [[7.0, 8.0, 9.0], 8.0]                                          # 시가등락율 상한, 범위 갯수: 3
self.vars[9] = [[-0.5, 0.0, 0.5], 0.0]                                         # 시가대비등락율 하한, 범위 갯수: 3
self.vars[10] = [[14.0, 15.0, 16.0], 15.0]                                     # 시가대비등락율 상한, 범위 갯수: 3
self.vars[11] = [[8, 10, 12], 10]                                              # 초당순매수금액 하한, 범위 갯수: 3
self.vars[12] = [[25, 30, 35], 30]                                             # 전일비, 범위 갯수: 3
self.vars[13] = [[25, 30, 35], 30]                                             # 전일동시간비, 범위 갯수: 3
self.vars[14] = [[0.8, 1.0, 1.2], 1.0]                                         # 회전율, 범위 갯수: 3
self.vars[15] = [[150, 200, 250], 200]                                         # 당일거래대금, 범위 갯수: 3
self.vars[16] = [[0.35, 0.40, 0.45], 0.40]                                     # 초당매수수량비율, 범위 갯수: 3
self.vars[17] = [[90, 100, 110], 100]                                          # 체결강도 하한, 범위 갯수: 3

# GA 최적화 범위 - 중형주
self.vars[18] = [[-3.0, -2.0, -1.0], -2.0]                                     # 시가등락율 하한, 범위 갯수: 3
self.vars[19] = [[9.0, 10.0, 11.0], 10.0]                                      # 시가등락율 상한, 범위 갯수: 3
self.vars[20] = [[0.0, 0.5, 1.0], 0.5]                                         # 시가대비등락율 하한, 범위 갯수: 3
self.vars[21] = [[17.0, 18.0, 19.0], 18.0]                                     # 시가대비등락율 상한, 범위 갯수: 3
self.vars[22] = [[15, 20, 25], 20]                                             # 초당순매수금액 하한, 범위 갯수: 3
self.vars[23] = [[15, 20, 25], 20]                                             # 전일비, 범위 갯수: 3
self.vars[24] = [[15, 20, 25], 20]                                             # 전일동시간비, 범위 갯수: 3
self.vars[25] = [[0.6, 0.8, 1.0], 0.8]                                         # 회전율, 범위 갯수: 3
self.vars[26] = [[250, 300, 350], 300]                                         # 당일거래대금, 범위 갯수: 3
self.vars[27] = [[0.30, 0.35, 0.40], 0.35]                                     # 초당매수수량비율, 범위 갯수: 3
self.vars[28] = [[0.85, 0.90, 0.95], 0.90]                                     # 누적매수우세비율, 범위 갯수: 3
self.vars[29] = [[70, 80, 90], 80]                                             # 체결강도 하한, 범위 갯수: 3
self.vars[30] = [[0.90, 0.95, 1.00], 0.95]                                     # 체결강도평균배율, 범위 갯수: 3

# GA 최적화 범위 - 대형주
self.vars[31] = [[-2.0, -1.0, 0.0], -1.0]                                      # 시가등락율 하한, 범위 갯수: 3
self.vars[32] = [[11.0, 12.0, 13.0], 12.0]                                     # 시가등락율 상한, 범위 갯수: 3
self.vars[33] = [[0.5, 1.0, 1.5], 1.0]                                         # 시가대비등락율 하한, 범위 갯수: 3
self.vars[34] = [[19.0, 20.0, 21.0], 20.0]                                     # 시가대비등락율 상한, 범위 갯수: 3
self.vars[35] = [[40, 50, 60], 50]                                             # 초당순매수금액 하한, 범위 갯수: 3
self.vars[36] = [[5, 10, 15], 10]                                              # 전일비, 범위 갯수: 3
self.vars[37] = [[5, 10, 15], 10]                                              # 전일동시간비, 범위 갯수: 3
self.vars[38] = [[0.3, 0.5, 0.7], 0.5]                                         # 회전율, 범위 갯수: 3
self.vars[39] = [[400, 500, 600], 500]                                         # 당일거래대금, 범위 갯수: 3
self.vars[40] = [[0.25, 0.30, 0.35], 0.30]                                     # 초당매수수량비율, 범위 갯수: 3
self.vars[41] = [[0.75, 0.80, 0.85], 0.80]                                     # 누적매수우세비율, 범위 갯수: 3
self.vars[42] = [[50, 60, 70], 60]                                             # 체결강도 하한, 범위 갯수: 3
self.vars[43] = [[0.85, 0.90, 0.95], 0.90]                                     # 체결강도평균배율, 범위 갯수: 3

# GA 최적화 범위 - 매도
self.vars[44] = [[28.0, 28.5, 29.0], 28.5]                                     # 등락율 상한가, 범위 갯수: 3
self.vars[45] = [[-3.0, -2.0, -1.0], -2.0]                                     # 시가대비등락율 하락, 범위 갯수: 3
self.vars[46] = [[-4.0, -3.0, -2.0], -3.0]                                     # 손실 수익률, 범위 갯수: 3
self.vars[47] = [[150, 180, 210], 180]                                         # 보유시간 초과, 범위 갯수: 3
self.vars[48] = [[7.0, 8.0, 9.0], 8.0]                                         # 수익률 상한, 범위 갯수: 3
self.vars[49] = [[-5.0, -4.0, -3.0], -4.0]                                     # 수익률 하한, 범위 갯수: 3
self.vars[50] = [[9.0, 10.0, 11.0], 10.0]                                      # 최고수익률 기준값, 범위 갯수: 3
self.vars[51] = [[0.65, 0.70, 0.75], 0.70]                                     # 최고수익률 대비 현재 수익률 비율, 범위 갯수: 3
self.vars[52] = [[4.0, 5.0, 6.0], 5.0]                                         # 상승동력소진 최고수익률, 범위 갯수: 3
self.vars[53] = [[2.5, 3.0, 3.5], 3.0]                                         # 체결강도약화 최고수익률, 범위 갯수: 3
self.vars[54] = [[0.25, 0.30, 0.35], 0.30]                                     # 등락율각도20이상 매도비율, 범위 갯수: 3
self.vars[55] = [[-0.4, -0.3, -0.2], -0.3]                                     # 등락율각도20이상 하락률, 범위 갯수: 3
self.vars[56] = [[0.45, 0.50, 0.55], 0.50]                                     # 등락율각도10-20 매도비율, 범위 갯수: 3
self.vars[57] = [[-0.6, -0.5, -0.4], -0.5]                                     # 등락율각도10-20 하락률, 범위 갯수: 3
self.vars[58] = [[0.55, 0.60, 0.65], 0.60]                                     # 등락율각도5-10 매도비율, 범위 갯수: 3
self.vars[59] = [[-0.5, -0.4, -0.3], -0.4]                                     # 등락율각도5-10 하락률, 범위 갯수: 3
self.vars[60] = [[0.65, 0.70, 0.75], 0.70]                                     # 등락율각도0-5 매도비율, 범위 갯수: 3
self.vars[61] = [[-0.4, -0.3, -0.2], -0.3]                                     # 등락율각도0-5 하락률, 범위 갯수: 3
self.vars[62] = [[0.75, 0.80, 0.85], 0.80]                                     # 등락율각도음수 매도비율, 범위 갯수: 3
self.vars[63] = [[-0.5, -0.4, -0.3], -0.4]                                     # 등락율각도음수 하락률, 범위 갯수: 3
self.vars[64] = [[0.96, 0.97, 0.98], 0.97]                                     # 고가대비하락 비율, 범위 갯수: 3
self.vars[65] = [[5.5, 6.0, 6.5], 6.0]                                         # 고가대비하락 최고수익률, 범위 갯수: 3
```

## 조건식 개선 방향 연구

### 1. 돌파 패턴 정밀화

#### 1.1 다중 저항선 돌파 확인
```python
# 여러 시간대의 고점을 동시에 돌파하는지 확인
단기고점돌파 = (현재가 > 최고현재가(60))   # 1분 고점
중기고점돌파 = (현재가 > 최고현재가(180))  # 3분 고점
장기고점돌파 = (현재가 > 최고현재가(300))  # 5분 고점

돌파강도 = (
    (1 if 단기고점돌파 else 0) * 0.3 +
    (1 if 중기고점돌파 else 0) * 0.3 +
    (1 if 장기고점돌파 else 0) * 0.4
)

if not (돌파강도 >= 0.7):  # 70% 이상 돌파 강도
    매수 = False
```
- **활용 방안**: 여러 시간대 고점을 동시에 돌파할 때 진정한 돌파로 인식
- **최적화 범위**: 돌파강도 임계값 `[[0.6, 0.8, 0.1], 0.7]`

#### 1.2 돌파 후 지지 확인
```python
# 돌파 후 다시 저항선 아래로 떨어지지 않는지 확인
돌파가격 = 최고현재가(300)
돌파후지지 = (현재가 >= 돌파가격 * 0.995)  # 돌파가 대비 0.5% 이내 유지

if not 돌파후지지:
    매수 = False
```
- **활용 방안**: 거짓 돌파(false breakout) 방지
- **최적화 범위**: 지지 비율 `[[0.990, 1.000, 0.005], 0.995]`

### 2. 이동평균선 활용 강화

#### 2.1 다중 이동평균선 정렬
```python
# 단기, 중기, 장기 이동평균선이 모두 정배열인지 확인
단기이평 = 이동평균(60)   # 1분
중기이평 = 이동평균(120)  # 2분
장기이평 = 이동평균(180)  # 3분

이평정배열 = (단기이평 > 중기이평 > 장기이평)

if not 이평정배열:
    매수 = False
```
- **활용 방안**: 상승 추세 확인 강화
- **적용 예시**: 모든 이동평균선이 상향 정렬 시에만 매수

#### 2.2 이동평균선 기울기 확인
```python
# 이동평균선이 상승 중인지 확인
이평기울기 = (이동평균(60) - 이동평균(60, 10)) / 이동평균(60, 10) * 100

if not (이평기울기 > 0.5):  # 0.5% 이상 상승 기울기
    매수 = False
```
- **활용 방안**: 횡보가 아닌 명확한 상승 추세 확인
- **최적화 범위**: 이평기울기 `[[0.3, 0.7, 0.1], 0.5]`

### 3. 체결강도 분석 고도화

#### 3.1 체결강도 추세 확인
```python
# 체결강도가 지속적으로 상승 중인지 확인
체결강도추세점수 = 0
for i in range(1, 6):
    if 체결강도N(i-1) > 체결강도N(i):
        체결강도추세점수 += 1

if not (체결강도추세점수 >= 4):  # 최근 5틱 중 4틱 이상 상승
    매수 = False
```
- **활용 방안**: 일시적 급등이 아닌 지속적인 매수세 확인
- **최적화 범위**: 요구 점수 `[[3, 5, 1], 4]`

#### 3.2 체결강도 변동성 필터
```python
# 체결강도 변동성이 과도하지 않은지 확인
체결강도변동성 = (최고체결강도(60) - 최저체결강도(60)) / 체결강도평균(60) * 100

if not (체결강도변동성 < 150):  # 평균 대비 변동성 150% 이내
    매수 = False
```
- **활용 방안**: 과도한 변동성으로 인한 위험 회피
- **최적화 범위**: 변동성 상한 `[[120, 180, 20], 150]`

### 4. TA-Lib 보조지표 통합

#### 4.1 MACD 히스토그램 상승 확인
```python
# MACD 히스토그램이 증가 중인지 확인
MACD히스토그램상승 = (MACDH > MACDH_N(1) and MACDH_N(1) > MACDH_N(2))

if not MACD히스토그램상승:
    매수 = False
```
- **활용 방안**: 추세 강화 확인
- **적용 예시**: MACD 히스토그램이 연속 3틱 상승 시 매수

#### 4.2 RSI 중립 구간 확인
```python
# RSI가 과매수/과매도 구간이 아닌지 확인
RSI중립구간 = (40 < RSI < 70)

if not RSI중립구간:
    매수 = False
```
- **활용 방안**: 과매수 구간 진입 방지
- **최적화 범위**: RSI 하한 `[[35, 45, 5], 40]`, RSI 상한 `[[65, 75, 5], 70]`

### 5. 매도 전략 고도화

#### 5.1 트레일링 스톱 구현
```python
# 최고점 대비 일정 비율 하락 시 매도
트레일링스톱비율 = 0.95  # 최고점 대비 5% 하락

if 현재가 < 최고현재가(int(보유시간)) * 트레일링스톱비율:
    매도 = True
```
- **활용 방안**: 수익 극대화 및 손실 최소화
- **최적화 범위**: 트레일링 비율 `[[0.93, 0.97, 0.01], 0.95]`

#### 5.2 시간 기반 차등 매도
```python
# 보유시간에 따라 목표 수익률 차등 적용
if 보유시간 < 60:  # 1분 이내
    목표수익률 = 5.0
elif 보유시간 < 120:  # 2분 이내
    목표수익률 = 7.0
else:  # 2분 이상
    목표수익률 = 8.0

if 수익률 >= 목표수익률:
    매도 = True
```
- **활용 방안**: 보유시간에 따른 유연한 매도 전략
- **최적화 범위**: 단기 목표 `[[4.0, 6.0, 0.5], 5.0]`, 중기 목표 `[[6.0, 8.0, 0.5], 7.0]`, 장기 목표 `[[7.0, 9.0, 0.5], 8.0]`

### 6. 복합 지표 설계

#### 6.1 돌파 신뢰도 지수
```python
# 여러 지표를 종합한 돌파 신뢰도
돌파신뢰도 = (
    (1 if 고점돌파여부 else 0) * 0.25 +
    (1 if 이평돌파여부 else 0) * 0.20 +
    (거래대금증가배수 / 5) * 0.20 +
    (체결강도회복률 / 100) * 0.20 +
    (1 if 등락율전환여부 else 0) * 0.15
)

if not (돌파신뢰도 > 0.75):  # 75% 이상 신뢰도
    매수 = False
```
- **활용 방안**: 다양한 돌파 관련 지표를 종합한 복합 지수
- **최적화 범위**: `[[0.70, 0.85, 0.05], 0.75]`

#### 6.2 추세 지속성 지수
```python
# 상승 추세의 지속 가능성 평가
추세지속성 = (
    (등락율각도(30) / 30) * 0.3 +
    (당일거래대금각도(60) / 30) * 0.2 +
    (체결강도 / 체결강도평균(120)) * 0.3 +
    (1 if 이평정배열 else 0) * 0.2
)

if not (추세지속성 > 0.7):
    매수 = False
```
- **활용 방안**: 추세의 지속 가능성을 정량화
- **최적화 범위**: `[[0.65, 0.80, 0.05], 0.7]`

### 7. 구현 우선순위

**즉시 적용 가능 (High Priority)**:
1. 돌파 후 지지 확인 (1.2)
2. RSI 중립 구간 확인 (4.2)
3. 트레일링 스톱 구현 (5.1)

**단기 적용 (Medium Priority)**:
1. 다중 이동평균선 정렬 (2.1)
2. 체결강도 추세 확인 (3.1)
3. 시간 기반 차등 매도 (5.2)

**중장기 연구 (Low Priority)**:
1. 돌파 신뢰도 지수 (6.1)
2. 추세 지속성 지수 (6.2)
3. 다중 저항선 돌파 확인 (1.1)

## 태그
- #주식트레이딩
- #틱트레이딩
- #반등돌파패턴
- #Rebound
- #고점돌파
- #매수조건
- #매도조건
- #최적화
- #유전알고리즘
- #파이썬
- #트레이딩로직
- #910_930전략
- #장중전략
- #이동평균돌파
- #TA-Lib
- #MACD
- #RSI
- #체결강도