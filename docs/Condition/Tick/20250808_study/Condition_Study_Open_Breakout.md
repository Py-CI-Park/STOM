# Condition - Study Open Breakout (장초 고가 돌파)

- 목적: 시초 이후 일정 시간이 지난 뒤, 거래량/거래대금이 동반되며 당일 최고가를 갱신(돌파)하는 순간에 한해 매수 시그널을 발생시키는 조건식
- 기준 문서: [Back_Testing_Guideline_Tick.md](mdc:Guideline/Back_Testing_Guideline_Tick.md)
- 사용 변수 표기 준수: 단일값은 그대로 또는 `변수명N(1)`, 구간 연산은 `함수명(구간틱수, [이전])` 형식

## 매수 조건식 (장초 고가 돌파)

```python
# 장초(시초 후) 시간 구간 제한: 09:05:00 이상 09:25:00 미만
if not (시분초 >= 90500):
    매수 = False
elif not (시분초 < 92500):
    매수 = False

# 기본 유동성/변동성 필터
elif not (1000 < 현재가 <= 30000):
    매수 = False
elif not (1.0 <= 등락율 <= 20.0):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False

# 거래대금 모멘텀: 직전 대비 증가 및 평균 대비 우위
elif not (초당거래대금 > 초당거래대금N(1)):
    매수 = False
elif not (초당거래대금평균(30) > 0 and 초당거래대금 / (초당거래대금평균(30) or 1) >= 1.5):
    매수 = False

# 거래량/수급 우위
elif not (초당매수수량 > 초당매도수량):
    매수 = False
elif not (최고초당매수수량(30) > 최고초당매도수량(30)):
    매수 = False
elif not (체결강도 >= 체결강도평균(30) + 10):
    매수 = False

# 장초 유의미한 거래 규모 확보
elif not (당일거래대금 > 5 * 100):
    매수 = False
elif not (전일동시간비 > 30):
    매수 = False

# 당일 최고가 돌파 이벤트 검증
# - 당일 고가가 직전 대비 갱신되었고(고가 > 고가N(1)), 현재가가 고가(=갱신된 최고가)와 동일한 시점만 허용
elif not (고가 > 고가N(1)):
    매수 = False
elif not (현재가 == 고가):
    매수 = False
```

## 메모

- 본 조건식은 “돌파 순간”만을 포착하기 위해 `고가 > 고가N(1)` 및 `현재가 == 고가`를 함께 사용합니다.
- 과도한 급등 스파이크 진입을 줄이기 위해 평균 대비 거래대금 비율(≥ 1.5), 수급 우위(체결강도, 초당매수/매도 우위) 조건을 동반합니다.
- 필요 시 종목 특성에 맞게 시간 창(90500~92500)과 임계치(거래대금 비율, 체결강도 우위 등)를 조정하십시오.

## 매도 조건식 (장초 고가 돌파 이후 관리)

```python
매도 = False

# 상한가 근접 즉시 청산
if 등락율 > 29.5:
    매도 = True

# 기본 수익/손절 및 피크아웃 관리
elif 3.0 <= 수익률:
    매도 = True
elif 수익률 <= -3.0:
    매도 = True
elif 최고수익률 > 2.5 and 수익률 < 최고수익률 * 0.8:
    매도 = True

# 수급 역전 + 단기 하락 모멘텀
elif (초당매도수량 - 초당매수수량) >= 매수총잔량 * 60/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -50:
    매도 = True

# 이동평균(60) 하향 돌파 시 추세 전환
elif 현재가N(1) >= 이동평균(60, 1) and 이동평균(60) > 현재가:
    매도 = True
```

## 실행 (매수/매도 체결)

```python
# 매수 실행
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)

# 매도 실행
if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```
