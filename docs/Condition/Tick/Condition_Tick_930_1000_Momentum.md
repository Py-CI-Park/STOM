# 조건식 (Condition)

- STOM 주식 자동거래에 사용하기 위한 조건식 문서
- Back_Testing_Guideline_Tick.md 가이드라인을 준수하여 작성

## 목차
- [조건식 (Condition)](#조건식-condition)
  - [목차](#목차)
  - [소개](#소개)
  - [가이드라인](#가이드라인)
    - [저장 이름 규칙](#저장-이름-규칙)
- [Condition - Tick 930\_1000 Momentum](#condition---tick-930_1000-momentum)
  - [전략 개요](#전략-개요)
  - [조건식](#조건식)
    - [매수 조건식 - C\_T\_930\_1000\_M\_B](#매수-조건식---c_t_930_1000_m_b)
    - [매도 조건식 - C\_T\_930\_1000\_M\_S](#매도-조건식---c_t_930_1000_m_s)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식 - C\_T\_930\_1000\_M\_BO](#매수-최적화-조건식---c_t_930_1000_m_bo)
    - [매수 최적화 범위 - C\_T\_930\_1000\_M\_BOR](#매수-최적화-범위---c_t_930_1000_m_bor)
    - [매도 최적화 조건식 - C\_T\_930\_1000\_M\_SO](#매도-최적화-조건식---c_t_930_1000_m_so)
    - [매도 최적화 범위 - C\_T\_930\_1000\_M\_SOR](#매도-최적화-범위---c_t_930_1000_m_sor)
    - [매수 매도 최적화 범위 - C\_T\_930\_1000\_M\_OR](#매수-매도-최적화-범위---c_t_930_1000_m_or)
    - [예상 시간 계산](#예상-시간-계산)
    - [GA 최적화 범위 - C\_T\_930\_1000\_M\_GAR](#ga-최적화-범위---c_t_930_1000_m_gar)
  - [조건식 개선 방향 연구](#조건식-개선-방향-연구)
  - [태그](#태그)

## 소개

이 문서는 STOM 주식 자동거래 시스템에서 09:30:00 ~ 10:00:00 구간의 모멘텀 지속 전략을 연구하기 위한 조건식과 최적화 범위를 제공합니다. 장 시작 30분 이후 안정화되는 구간에서 지속적인 상승 모멘텀을 포착하여 진입하는 전략입니다.

본 문서는 다음 문서들의 형식을 준수합니다:
- docs/Guideline/Back_Testing_Guideline_Tick.md
- docs/Condition/Tick/Condition_Tick_900_930_Composite_Study.md
- docs/Condition/Tick/Condition_Tick_902_905_update_2.md

## 가이드라인

- 모든 조건식은 Python 스타일의 의사코드로 작성되어 있으며, STOM 백테스터가 인식하는 변수/함수 규칙을 따릅니다.
- 조건식은 시간대별로 분기하며, 각 분기에서 추가 필터를 적용합니다.
- 최적화 조건식은 `self.vars[i]`로 치환하여 탐색 범위를 별도로 정의합니다.
- 최적화 범위 포맷: `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]`
- 변수/함수 표기 및 사용 규칙은 Back_Testing_Guideline_Tick.md를 따릅니다.

### 저장 이름 규칙

조건식 저장 및 관리 편의를 위해 다음 규칙을 사용합니다.

1. 기본 규칙:
   - `C`: Condition
   - `T`: Tick
   - `930_1000`: 시간대 (09:30~10:00)
   - `M`: Momentum (모멘텀 전략)
   - `B`/`S`: 매수/매도 조건식
   - `BO`/`SO`: 매수/매도 최적화 조건식
   - `BOR`/`SOR`: 매수/매도 최적화 범위
   - `OR`: 매수/매도 통합 최적화 범위
   - `GAR`: GA 최적화 범위

2. 예시:
   - `C_T_930_1000_M_B`, `C_T_930_1000_M_S`
   - `C_T_930_1000_M_BO`, `C_T_930_1000_M_SO`
   - `C_T_930_1000_M_BOR`, `C_T_930_1000_M_SOR`, `C_T_930_1000_M_OR`, `C_T_930_1000_M_GAR`

---

# Condition - Tick 930_1000 Momentum

## 전략 개요

장 시작 30분(09:00~09:30) 이후 안정화 구간에서 지속적인 상승 모멘텀을 보이는 종목을 포착하는 전략입니다.

주요 특징:
- 09:30:00 ~ 10:00:00: 초기 급등 이후 안정적인 상승세 지속 확인
- 체결강도 지속성: 일시적 급등이 아닌 지속적인 매수세 확인
- 거래대금 각도: 안정적인 우상향 패턴 검증
- 이동평균 정배열: 단기/중기/장기 이평선 정배열 확인
- TA-Lib 보조지표: RSI, MACD 활용 과매수/과매도 구간 회피

## 조건식

### 매수 조건식 - C_T_930_1000_M_B

```python
# ================================
#  공통 계산 지표
# ================================
전일종가              = 현재가 / (1 + (등락율 / 100))                                     # 단위: 원
시가등락율            = ((시가 - 전일종가) / 전일종가) * 100                               # 단위: 퍼센트
시가대비등락율        = ((현재가 - 시가) / 시가) * 100                                     # 단위: 퍼센트
초당순매수금액        = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000                  # 단위: 백만원
모멘텀지속성          = (등락율각도(60) > 0 and 등락율각도(120) > 0)                       # 지속적인 상승
체결강도안정성        = (체결강도평균(60) > 100 and 체결강도평균(120) > 100)               # 안정적 매수세
이평정배열여부        = (이동평균(30) > 이동평균(60) and 이동평균(60) > 이동평균(120))     # 이평선 정배열
가격이평상회여부      = (현재가 > 이동평균(30) and 이동평균(30) > 이동평균(30, 1))         # 가격이 이평 위 + 이평 상승

# TA-Lib 지표
RSI_14               = RSI if 'RSI' in globals() or 'RSI' in dir() else 50
MACD_상향여부        = (MACD > MACDS and MACD > 0) if ('MACD' in globals() and 'MACDS' in globals()) else False


# ================================
#  매수 조건
# ================================
매수 = True

# 공통 필터 – 관심종목, 시간 범위, 가격/VI 안전장치
if not (관심종목 == 1):
    매수 = False
elif not (93000 <= 시분초 < 100000):
    매수 = False
elif not (1000 < 현재가 <= 30000):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (데이터길이 >= 300):                          # 최소 5분(300초) 데이터 확보
    매수 = False

# 등락율 및 모멘텀 필터
elif not (1.0 < 등락율 <= 15.0):
    매수 = False
elif not (고저평균대비등락율 > 0):
    매수 = False
elif not 모멘텀지속성:
    매수 = False
elif not 체결강도안정성:
    매수 = False

# 시가총액별 세부 조건
elif 시가총액 < 3000:
    if not (0.5 <= 시가등락율 < 10.0):
        매수 = False
    elif not (2.0 <= 시가대비등락율 < 10.0):
        매수 = False
    elif not (10 < 초당순매수금액 < 500):
        매수 = False
    elif not (현재가 > (고가 - (고가 - 저가) * 0.15)):
        매수 = False
    elif not (전일비 > 5 and 전일동시간비 > 10):
        매수 = False
    elif not (회전율 > 1.0):
        매수 = False
    elif not (당일거래대금 > 100 * 100):
        매수 = False
    elif not (등락율각도(60) > 2 and 등락율각도(60) < 25):
        매수 = False
    elif not (당일거래대금각도(60) > 2 and 당일거래대금각도(60) < 25):
        매수 = False
    elif not (전일비각도(60) > 0 and 전일비각도(60) < 20):
        매수 = False
    elif not (초당거래대금 / 초당거래대금평균(60) > 1.2):
        매수 = False
    elif not (초당거래대금 / 초당거래대금평균(60) < 5.0):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * 0.30):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * 2.0):
        매수 = False
    elif not (체결강도 >= 80 and 체결강도 <= 300):
        매수 = False
    elif not 이평정배열여부:
        매수 = False
    elif not 가격이평상회여부:
        매수 = False
    elif not (최고체결강도(60) > 체결강도평균(60) * 1.5):
        매수 = False
    elif not (누적초당매수수량(60) > 누적초당매도수량(60) * 1.1):
        매수 = False
    # TA-Lib 필터
    elif (RSI_14 is not None) and not (40 <= RSI_14 <= 75):
        매수 = False
    elif MACD_상향여부 is False:
        매수 = False

else:
    if not (0.5 <= 시가등락율 < 10.0):
        매수 = False
    elif not (2.0 <= 시가대비등락율 < 10.0):
        매수 = False
    elif not (10 < 초당순매수금액 < 500):
        매수 = False
    elif not (현재가 > (고가 - (고가 - 저가) * 0.15)):
        매수 = False
    elif not (전일비 > 5 and 전일동시간비 > 10):
        매수 = False
    elif not (회전율 > 1.0):
        매수 = False
    elif not (당일거래대금 > 100 * 100):
        매수 = False
    elif not (등락율각도(60) > 2 and 등락율각도(60) < 25):
        매수 = False
    elif not (당일거래대금각도(60) > 2 and 당일거래대금각도(60) < 25):
        매수 = False
    elif not (전일비각도(60) > 0 and 전일비각도(60) < 20):
        매수 = False
    elif not (초당거래대금 / 초당거래대금평균(60) > 1.2):
        매수 = False
    elif not (초당거래대금 / 초당거래대금평균(60) < 5.0):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * 0.30):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * 2.0):
        매수 = False
    elif not (체결강도 >= 80 and 체결강도 <= 300):
        매수 = False
    elif not 이평정배열여부:
        매수 = False
    elif not 가격이평상회여부:
        매수 = False
    elif not (최고체결강도(60) > 체결강도평균(60) * 1.5):
        매수 = False
    elif not (누적초당매수수량(60) > 누적초당매도수량(60) * 1.1):
        매수 = False
    # TA-Lib 필터
    elif (RSI_14 is not None) and not (40 <= RSI_14 <= 75):
        매수 = False
    elif MACD_상향여부 is False:
        매수 = False


# ================================
#  매수 호출
# ================================
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식 - C_T_930_1000_M_S

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
단기하락률            = (현재가 / max(현재가N(1), 1) - 1) * 100
이평역전여부          = (현재가 < 이동평균(30)) or (이동평균(30) < 이동평균(60))
급락신호              = (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.6 and 단기하락률 < -0.5
모멘텀약화신호        = (등락율각도(30) < 0 and 당일거래대금각도(30) < 0)
체결강도약화여부      = (체결강도 < 체결강도평균(30) * 0.8)

매도 = False

# 상한가 부근 안전장치
if 등락율 > 29.5:
    매도 = True

# 목표 수익/손절
elif 수익률 >= 4.0:
    매도 = True
elif 수익률 <= -3.5:
    매도 = True

# 트레일링 스톱
elif 최고수익률 > 5.0 and 최고수익률 - 수익률 >= 2.5:
    매도 = True

# 시간별 보유 청산
elif 보유시간 > 300 and 수익률 < 1.0:                   # 5분 이상 보유 시 1% 미만이면 청산
    매도 = True
elif 보유시간 > 600 and 수익률 < 2.0:                   # 10분 이상 보유 시 2% 미만이면 청산
    매도 = True

# 위험 신호 기반 조기 청산
elif 급락신호:
    매도 = True
elif 이평역전여부 and 체결강도약화여부:
    매도 = True
elif 모멘텀약화신호 and 수익률 < 2.0:
    매도 = True

# TA-Lib 기반 과매수 청산
elif 'RSI' in globals():
    if RSI > 80 and 수익률 > 2.0:
        매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

## 최적화 조건식

### 매수 최적화 조건식 - C_T_930_1000_M_BO

```python
# ================================
#  공통 계산 지표
# ================================
전일종가              = 현재가 / (1 + (등락율 / 100))
시가등락율            = ((시가 - 전일종가) / 전일종가) * 100
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
초당순매수금액        = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000
모멘텀지속성          = (등락율각도(60) > 0 and 등락율각도(120) > 0)
체결강도안정성        = (체결강도평균(60) > self.vars[13] and 체결강도평균(120) > self.vars[13])
이평정배열여부        = (이동평균(30) > 이동평균(60) and 이동평균(60) > 이동평균(120))
가격이평상회여부      = (현재가 > 이동평균(30) and 이동평균(30) > 이동평균(30, 1))

# TA-Lib 지표
RSI_14               = RSI if 'RSI' in globals() or 'RSI' in dir() else 50
MACD_상향여부        = (MACD > MACDS and MACD > 0) if ('MACD' in globals() and 'MACDS' in globals()) else True

매수 = True

if not (관심종목 == 1):
    매수 = False
elif not (93000 <= 시분초 < 100000):
    매수 = False
elif not (self.vars[1] < 현재가 <= self.vars[2]):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (데이터길이 >= self.vars[3]):
    매수 = False

elif not (self.vars[4] < 등락율 <= self.vars[5]):
    매수 = False
elif not (고저평균대비등락율 > 0):
    매수 = False
elif not 모멘텀지속성:
    매수 = False
elif not 체결강도안정성:
    매수 = False

elif 시가총액 < self.vars[6]:
    if not (self.vars[7] <= 시가등락율 < self.vars[8]):
        매수 = False
    elif not (self.vars[9] <= 시가대비등락율 < self.vars[10]):
        매수 = False
    elif not (self.vars[11] < 초당순매수금액 < self.vars[12]):
        매수 = False
    elif not (현재가 > (고가 - (고가 - 저가) * self.vars[14] / 100)):
        매수 = False
    elif not (전일비 > self.vars[15] and 전일동시간비 > self.vars[16]):
        매수 = False
    elif not (회전율 > self.vars[17]):
        매수 = False
    elif not (당일거래대금 > self.vars[18] * 100):
        매수 = False
    elif not (등락율각도(60) > self.vars[19] and 등락율각도(60) < self.vars[20]):
        매수 = False
    elif not (당일거래대금각도(60) > self.vars[21] and 당일거래대금각도(60) < self.vars[22]):
        매수 = False
    elif not (전일비각도(60) > self.vars[23] and 전일비각도(60) < self.vars[24]):
        매수 = False
    elif not (초당거래대금 / 초당거래대금평균(60) > self.vars[25]):
        매수 = False
    elif not (초당거래대금 / 초당거래대금평균(60) < self.vars[26]):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * self.vars[27]):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * self.vars[28]):
        매수 = False
    elif not (체결강도 >= self.vars[29] and 체결강도 <= 300):
        매수 = False
    elif not 이평정배열여부:
        매수 = False
    elif not 가격이평상회여부:
        매수 = False
    elif not (최고체결강도(60) > 체결강도평균(60) * self.vars[30]):
        매수 = False
    elif not (누적초당매수수량(60) > 누적초당매도수량(60) * self.vars[31]):
        매수 = False
    elif (RSI_14 is not None) and not (self.vars[32] <= RSI_14 <= self.vars[33]):
        매수 = False
    elif MACD_상향여부 is False:
        매수 = False

else:
    if not (self.vars[7] <= 시가등락율 < self.vars[8]):
        매수 = False
    elif not (self.vars[9] <= 시가대비등락율 < self.vars[10]):
        매수 = False
    elif not (self.vars[11] < 초당순매수금액 < self.vars[12]):
        매수 = False
    elif not (현재가 > (고가 - (고가 - 저가) * self.vars[14] / 100)):
        매수 = False
    elif not (전일비 > self.vars[15] and 전일동시간비 > self.vars[16]):
        매수 = False
    elif not (회전율 > self.vars[17]):
        매수 = False
    elif not (당일거래대금 > self.vars[18] * 100):
        매수 = False
    elif not (등락율각도(60) > self.vars[19] and 등락율각도(60) < self.vars[20]):
        매수 = False
    elif not (당일거래대금각도(60) > self.vars[21] and 당일거래대금각도(60) < self.vars[22]):
        매수 = False
    elif not (전일비각도(60) > self.vars[23] and 전일비각도(60) < self.vars[24]):
        매수 = False
    elif not (초당거래대금 / 초당거래대금평균(60) > self.vars[25]):
        매수 = False
    elif not (초당거래대금 / 초당거래대금평균(60) < self.vars[26]):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * self.vars[27]):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * self.vars[28]):
        매수 = False
    elif not (체결강도 >= self.vars[29] and 체결강도 <= 300):
        매수 = False
    elif not 이평정배열여부:
        매수 = False
    elif not 가격이평상회여부:
        매수 = False
    elif not (최고체결강도(60) > 체결강도평균(60) * self.vars[30]):
        매수 = False
    elif not (누적초당매수수량(60) > 누적초당매도수량(60) * self.vars[31]):
        매수 = False
    elif (RSI_14 is not None) and not (self.vars[32] <= RSI_14 <= self.vars[33]):
        매수 = False
    elif MACD_상향여부 is False:
        매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위 - C_T_930_1000_M_BOR

```python
# 평균 틱수 및 기본 범위
self.vars[0]  = [[60, 60, 0], 60]                 # 평균 틱수 고정
self.vars[1]  = [[1000, 2000, 500], 1000]         # 현재가 하한
self.vars[2]  = [[20000, 35000, 5000], 30000]     # 현재가 상한
self.vars[3]  = [[240, 360, 60], 300]             # 최소 데이터길이(초)

# 등락율 범위
self.vars[4]  = [[0.5, 2.0, 0.5], 1.0]            # 등락율 하한
self.vars[5]  = [[12.0, 18.0, 2.0], 15.0]         # 등락율 상한

# 시가총액 기준
self.vars[6]  = [[2500, 3500, 500], 3000]         # 시가총액 기준(억원)

# 시가/시가대비 등락율
self.vars[7]  = [[0.0, 1.5, 0.5], 0.5]            # 시가등락율 하한
self.vars[8]  = [[8.0, 12.0, 1.0], 10.0]          # 시가등락율 상한
self.vars[9]  = [[1.5, 3.0, 0.5], 2.0]            # 시가대비등락율 하한
self.vars[10] = [[8.0, 12.0, 1.0], 10.0]          # 시가대비등락율 상한

# 초당순매수금액
self.vars[11] = [[5, 15, 5], 10]                  # 초당순매수금액 하한(백만원)
self.vars[12] = [[400, 600, 100], 500]            # 초당순매수금액 상한(백만원)

# 체결강도 기준값
self.vars[13] = [[80, 120, 20], 100]              # 체결강도평균 하한

# 고가 대비 현재가 위치
self.vars[14] = [[10, 20, 5], 15]                 # 고가 대비 하락 허용폭(%)

# 전일비 / 전일동시간비
self.vars[15] = [[3, 7, 2], 5]                    # 전일비 하한
self.vars[16] = [[5, 15, 5], 10]                  # 전일동시간비 하한

# 회전율
self.vars[17] = [[0.5, 1.5, 0.5], 1.0]            # 회전율 하한

# 당일거래대금
self.vars[18] = [[80, 120, 20], 100]              # 당일거래대금 하한(백만원)

# 등락율각도(60)
self.vars[19] = [[1, 3, 1], 2]                    # 등락율각도(60) 하한
self.vars[20] = [[20, 30, 5], 25]                 # 등락율각도(60) 상한

# 당일거래대금각도(60)
self.vars[21] = [[1, 3, 1], 2]                    # 당일거래대금각도(60) 하한
self.vars[22] = [[20, 30, 5], 25]                 # 당일거래대금각도(60) 상한

# 전일비각도(60)
self.vars[23] = [[-2, 2, 2], 0]                   # 전일비각도(60) 하한
self.vars[24] = [[15, 25, 5], 20]                 # 전일비각도(60) 상한

# 초당거래대금 비율
self.vars[25] = [[1.1, 1.5, 0.2], 1.2]            # 초당거래대금/평균(60) 하한
self.vars[26] = [[4.0, 6.0, 1.0], 5.0]            # 초당거래대금/평균(60) 상한

# 호가 잔량 비율
self.vars[27] = [[0.25, 0.35, 0.05], 0.30]        # 초당매수수량/(매도총잔량) 하한
self.vars[28] = [[1.5, 2.5, 0.5], 2.0]            # 매도총잔량/(매수총잔량) 상한

# 체결강도
self.vars[29] = [[70, 90, 10], 80]                # 체결강도 하한

# 체결강도 비율
self.vars[30] = [[1.3, 1.7, 0.2], 1.5]            # 최고체결강도(60)/평균 비율

# 누적 수량 비율
self.vars[31] = [[1.0, 1.3, 0.1], 1.1]            # 누적매수/누적매도 비율 하한

# RSI 범위
self.vars[32] = [[35, 45, 5], 40]                 # RSI 하한
self.vars[33] = [[70, 80, 5], 75]                 # RSI 상한

# 경우의 수 예시(대략):
# 변수 33개, 각 변수당 평균 3개 후보 = 3^33 (매우 큰 수)
# 단계별 탐색(1단계 넓게 → 2단계 좁게) 권장
```

### 매도 최적화 조건식 - C_T_930_1000_M_SO

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
단기하락률            = (현재가 / max(현재가N(1), 1) - 1) * 100
이평역전여부          = (현재가 < 이동평균(30)) or (이동평균(30) < 이동평균(60))
체결강도약화여부      = (체결강도 < 체결강도평균(30) * self.vars[41])
모멘텀약화신호        = (등락율각도(30) < 0 and 당일거래대금각도(30) < 0)

매도 = False

if 등락율 > self.vars[34]:
    매도 = True
elif 수익률 >= self.vars[35]:
    매도 = True
elif 수익률 <= self.vars[36]:
    매도 = True
elif 최고수익률 > self.vars[37] and 최고수익률 - 수익률 >= self.vars[38]:
    매도 = True
elif 보유시간 > self.vars[39] and 수익률 < self.vars[40]:
    매도 = True
elif 보유시간 > self.vars[39] * 2 and 수익률 < self.vars[40] * 2:
    매도 = True
elif (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[42] and 단기하락률 < -self.vars[43]:
    매도 = True
elif 이평역전여부 and 체결강도약화여부:
    매도 = True
elif 모멘텀약화신호 and 수익률 < self.vars[44]:
    매도 = True
elif 'RSI' in globals():
    if RSI > self.vars[45] and 수익률 > self.vars[46]:
        매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

### 매도 최적화 범위 - C_T_930_1000_M_SOR

```python
self.vars[34] = [[28.5, 30.0, 0.5], 29.5]        # 등락율 상한가 근접치
self.vars[35] = [[3.5, 5.0, 0.5], 4.0]           # 목표 수익률
self.vars[36] = [[-4.5, -2.5, 0.5], -3.5]        # 손절 수익률
self.vars[37] = [[4.0, 6.0, 1.0], 5.0]           # 최고수익률 기준값
self.vars[38] = [[2.0, 3.5, 0.5], 2.5]           # 트레일링 허용 하락폭
self.vars[39] = [[240, 360, 60], 300]            # 보유시간 기준(초)
self.vars[40] = [[0.5, 1.5, 0.5], 1.0]           # 보유시간별 최소수익률
self.vars[41] = [[0.7, 0.9, 0.1], 0.8]           # 체결강도 약화 비율
self.vars[42] = [[0.5, 0.7, 0.1], 0.6]           # 매도 잔량 우위 임계
self.vars[43] = [[0.3, 0.7, 0.2], 0.5]           # 단기 하락률 임계
self.vars[44] = [[1.5, 2.5, 0.5], 2.0]           # 모멘텀약화 시 수익률 기준
self.vars[45] = [[75, 85, 5], 80]                # RSI 과매수 기준
self.vars[46] = [[1.5, 2.5, 0.5], 2.0]           # RSI 과매수 시 최소수익률

# 매도 변수 경우의 수: 13개 변수, 각 평균 3개 후보
```

### 매수 매도 최적화 범위 - C_T_930_1000_M_OR

```python
# OR 모드는 BOR + SOR를 하나로 합친 형태입니다.
# 실험 시 단계별(넓게→좁게) 탐색을 권장합니다.

# BOR (vars[0] ~ vars[33]) 복사
self.vars[0]  = [[60, 60, 0], 60]
self.vars[1]  = [[1000, 2000, 500], 1000]
self.vars[2]  = [[20000, 35000, 5000], 30000]
self.vars[3]  = [[240, 360, 60], 300]
self.vars[4]  = [[0.5, 2.0, 0.5], 1.0]
self.vars[5]  = [[12.0, 18.0, 2.0], 15.0]
self.vars[6]  = [[2500, 3500, 500], 3000]
self.vars[7]  = [[0.0, 1.5, 0.5], 0.5]
self.vars[8]  = [[8.0, 12.0, 1.0], 10.0]
self.vars[9]  = [[1.5, 3.0, 0.5], 2.0]
self.vars[10] = [[8.0, 12.0, 1.0], 10.0]
self.vars[11] = [[5, 15, 5], 10]
self.vars[12] = [[400, 600, 100], 500]
self.vars[13] = [[80, 120, 20], 100]
self.vars[14] = [[10, 20, 5], 15]
self.vars[15] = [[3, 7, 2], 5]
self.vars[16] = [[5, 15, 5], 10]
self.vars[17] = [[0.5, 1.5, 0.5], 1.0]
self.vars[18] = [[80, 120, 20], 100]
self.vars[19] = [[1, 3, 1], 2]
self.vars[20] = [[20, 30, 5], 25]
self.vars[21] = [[1, 3, 1], 2]
self.vars[22] = [[20, 30, 5], 25]
self.vars[23] = [[-2, 2, 2], 0]
self.vars[24] = [[15, 25, 5], 20]
self.vars[25] = [[1.1, 1.5, 0.2], 1.2]
self.vars[26] = [[4.0, 6.0, 1.0], 5.0]
self.vars[27] = [[0.25, 0.35, 0.05], 0.30]
self.vars[28] = [[1.5, 2.5, 0.5], 2.0]
self.vars[29] = [[70, 90, 10], 80]
self.vars[30] = [[1.3, 1.7, 0.2], 1.5]
self.vars[31] = [[1.0, 1.3, 0.1], 1.1]
self.vars[32] = [[35, 45, 5], 40]
self.vars[33] = [[70, 80, 5], 75]

# SOR (vars[34] ~ vars[46])
self.vars[34] = [[28.5, 30.0, 0.5], 29.5]
self.vars[35] = [[3.5, 5.0, 0.5], 4.0]
self.vars[36] = [[-4.5, -2.5, 0.5], -3.5]
self.vars[37] = [[4.0, 6.0, 1.0], 5.0]
self.vars[38] = [[2.0, 3.5, 0.5], 2.5]
self.vars[39] = [[240, 360, 60], 300]
self.vars[40] = [[0.5, 1.5, 0.5], 1.0]
self.vars[41] = [[0.7, 0.9, 0.1], 0.8]
self.vars[42] = [[0.5, 0.7, 0.1], 0.6]
self.vars[43] = [[0.3, 0.7, 0.2], 0.5]
self.vars[44] = [[1.5, 2.5, 0.5], 2.0]
self.vars[45] = [[75, 85, 5], 80]
self.vars[46] = [[1.5, 2.5, 0.5], 2.0]
```

### 예상 시간 계산

- 매수 변수: 33개 (각 변수당 평균 3개 후보)
- 매도 변수: 13개 (각 변수당 평균 3개 후보)
- 전체 경우의 수는 기하급수적으로 증가합니다.
- 1단계: 각 변수 후보 수를 2~3개로 제한하여 최적 영역 탐색
- 2단계: 1단계 결과 중심으로 촘촘히 재탐색
- 3단계: GA 최적화로 최종 미세 조정
- 단계별 탐색을 통해 시간을 절약하면서 최적값을 찾는 것을 권장합니다.

### GA 최적화 범위 - C_T_930_1000_M_GAR

일반 최적화에서 확보한 최적값들을 중심으로, GA에서는 리스트 기반 후보 집합으로 전환합니다.

```python
# 기본 범위
self.vars[1]  = [[1000, 1500, 2000], 1000]
self.vars[2]  = [[25000, 30000, 35000], 30000]
self.vars[3]  = [[240, 300, 360], 300]

# 등락율
self.vars[4]  = [[0.5, 1.0, 1.5, 2.0], 1.0]
self.vars[5]  = [[12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0], 15.0]

# 시가총액
self.vars[6]  = [[2500, 3000, 3500], 3000]

# 시가등락율
self.vars[7]  = [[0.0, 0.5, 1.0, 1.5], 0.5]
self.vars[8]  = [[8.0, 9.0, 10.0, 11.0, 12.0], 10.0]

# 시가대비등락율
self.vars[9]  = [[1.5, 2.0, 2.5, 3.0], 2.0]
self.vars[10] = [[8.0, 9.0, 10.0, 11.0, 12.0], 10.0]

# 초당순매수금액
self.vars[11] = [[5, 10, 15], 10]
self.vars[12] = [[400, 450, 500, 550, 600], 500]

# 체결강도
self.vars[13] = [[80, 100, 120], 100]
self.vars[29] = [[70, 80, 90], 80]

# 각도 관련
self.vars[19] = [[1, 2, 3], 2]
self.vars[20] = [[20, 25, 30], 25]
self.vars[21] = [[1, 2, 3], 2]
self.vars[22] = [[20, 25, 30], 25]

# RSI
self.vars[32] = [[35, 40, 45], 40]
self.vars[33] = [[70, 75, 80], 75]

# 매도 조건
self.vars[35] = [[3.5, 4.0, 4.5, 5.0], 4.0]
self.vars[36] = [[-4.5, -4.0, -3.5, -3.0, -2.5], -3.5]
self.vars[37] = [[4.0, 5.0, 6.0], 5.0]
self.vars[38] = [[2.0, 2.5, 3.0, 3.5], 2.5]

# (나머지 변수 생략 - 실사용 시 추가)
```

---

## 조건식 개선 방향 연구

1) **볼린저밴드 활용**
   - BBU/BBM/BBL을 이용한 과매수/과매도 구간 판별
   - 밴드 상단 돌파 후 복귀 시 매도 신호 강화

2) **MACD 히스토그램 분석**
   - MACD 히스토그램의 감소세를 조기 매도 신호로 활용
   - MACD/MACDS 골든크로스를 매수 필터로 추가

3) **체결강도 가속도 지표**
   - 체결강도의 1차/2차 미분을 통한 가속도 분석
   - 체결강도 감소 가속화 시 조기 청산

4) **시간대별 세분화**
   - 09:30~09:40 / 09:40~09:50 / 09:50~10:00 세분화
   - 각 구간별 다른 임계값 적용

5) **리스크 관리 강화**
   - 동시 보유 종목 수 제한
   - 일일 최대 손실 한도 설정
   - 연속 손실 횟수 제한

6) **최적화 프로세스 개선**
   - 1단계: 넓은 범위 탐색 (간격 크게)
   - 2단계: 좁은 범위 정밀 탐색
   - 3단계: GA 최적화
   - 4단계: 재검증 및 워크포워드 테스트

## 태그

- #주식트레이딩
- #틱트레이딩
- #매수조건
- #매도조건
- #최적화
- #유전알고리즘
- #파이썬
- #트레이딩로직
- #930_1000전략
- #모멘텀전략
- #TA-Lib
- #RSI
- #MACD
- #이동평균
- #체결강도
- #리스크관리

---

**Last Update: 2025-01-17**
