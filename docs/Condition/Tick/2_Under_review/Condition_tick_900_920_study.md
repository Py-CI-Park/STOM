# 조건식(Condition) - 학습용 (Level 1+2 활성화)

- STOM 주식 자동거래에 사용하기 위한 학습용 조건식 문서
- [[Back_Testing_Guideline_Tick]] 을(를) 기반으로 작성한 Tick 조건식
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서
- **현재 상태**: Level 1 (기본 필터) + Level 2 (거래대금, 전일비, 회전율, 시간 청산) 활성화

## 목차

- [조건식(Condition) - 학습용 (Level 1+2 활성화)](#조건식condition---학습용-level-12-활성화)
  - [목차](#목차)
  - [개요](#개요)
    - [학습 목표](#학습-목표)
    - [단계별 학습 방법](#단계별-학습-방법)
  - [가이드라인](#가이드라인)
    - [이름 규칙](#이름-규칙)
- [Condition - Tick 900\_920 Study](#condition---tick-900_920-study)
  - [조건식](#조건식)
    - [매수 조건식 - C\_T\_900\_920\_STUDY\_B](#매수-조건식---c_t_900_920_study_b)
    - [매도 조건식 - C\_T\_900\_920\_STUDY\_S](#매도-조건식---c_t_900_920_study_s)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식 - C\_T\_900\_920\_STUDY\_BO](#매수-최적화-조건식---c_t_900_920_study_bo)
    - [매수 최적화 범위 - C\_T\_900\_920\_STUDY\_BOR](#매수-최적화-범위---c_t_900_920_study_bor)
    - [매도 최적화 조건식 - C\_T\_900\_920\_STUDY\_SO](#매도-최적화-조건식---c_t_900_920_study_so)
    - [매도 최적화 범위 - C\_T\_900\_920\_STUDY\_SOR](#매도-최적화-범위---c_t_900_920_study_sor)
    - [매수·매도 통합 최적화 범위 - C\_T\_900\_920\_STUDY\_OR](#매수매도-통합-최적화-범위---c_t_900_920_study_or)
    - [예상 시간 계산](#예상-시간-계산)
    - [GA 최적화 범위 - C\_T\_900\_920\_STUDY\_GAR](#ga-최적화-범위---c_t_900_920_study_gar)
  - [태그](#태그)

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **장 초반 09:00:00 ~ 09:20:00 (Tick 데이터)** 구간에 사용하는 **학습용** 조건식을 정의한다.

- **대상 시간 구간**: 09:00:00 ~ 09:20:00
- **대상 종목**: 관심종목
- **전략 타입**: 기본 모멘텀 추종 전략 (학습용 단순 버전)
- **현재 활성화**: Level 1 + Level 2 (거래대금, 전일비, 회전율, 시간 기반 청산)
- **핵심 변수**: 체결강도, 등락율, 당일거래대금, 초당거래대금, 전일비, 회전율

### 학습 목표

1. **기본 조건식 구조 이해**: 매수/매도 조건의 기본 패턴 학습
2. **단계별 조건 추가**: 주석 해제를 통해 점진적으로 복잡도 증가
3. **백테스팅 실습**: 간단한 조건으로 빠른 백테스팅 및 결과 확인
4. **최적화 이해**: 변수 최적화 과정 및 범위 설정 방법 학습

### 단계별 학습 방법

**Step 1: 기본 조건만 사용 (Level 1)** ✅ 완료
- 관심종목, 가격대, 체결강도, 등락율만 사용
- 가장 단순한 조건으로 백테스팅 수행
- 결과 분석: 매매 횟수, 승률, 수익률 확인

**Step 2: 거래대금 및 거래량 조건 추가 (Level 2)** ✅ 현재 단계
- Level 2 활성화 완료
- 거래대금 조건: 당일거래대금, 초당거래대금, 초당거래대금평균비율
- 거래량 조건: 전일비, 회전율
- 시간 기반 청산 조건: 09:20 강제청산, 보유시간 600초(10분)
- 유동성 필터 및 거래 활성도 필터의 효과 확인 중

**Step 3: 추세 지표 추가 (Level 3)**
- `# [Level 3]` 주석 해제
- 고저평균대비등락율, 등락율각도 추가
- 추세 필터링 효과 분석

**Step 4: 고급 지표 추가 (Level 4)**
- `# [Level 4]` 주석 해제
- 체결강도평균, 거래대금각도 등 구간 연산 추가
- 복합 지표의 시너지 효과 확인

**Step 5: 리스크 관리 추가 (Level 5)**
- `# [Level 5]` 주석 해제
- VI 호가, 라운드 피겨, 호가 잔량 분석
- 리스크 관리 효과 측정

## 가이드라인

- 모든 조건식은 Python 코드로 구현되며, 백테스팅을 전제로 작성한다.

- **조건식 기본 구조** (필수 요소):
  1. **매수 조건 변수 초기화**: `매수 = True`
  2. **매도 조건 변수 초기화**: `매도 = False`
  3. **조건식 평가**: if/elif 구조로 조건 확인
  4. **매수/매도 호출 (필수)**:
     - 매수: `if 매수: self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)`
     - 매도: `if 매도: self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)`

- **중요 변수명**:
  - ✅ `보유시간` - 주식 보유 시간 (초 단위, Seconds)
  - ❌ `보유틱수` - **존재하지 않는 변수명** (사용 금지)
  - 예: `보유시간 >= 600` → 600초(10분) 보유

- 조건식 평가 순서:
  1. **Level 1**: 기본 필터 (관심종목, 가격, 체결강도, 등락율)
  2. **Level 2**: 거래대금 및 거래량 필터 (당일거래대금, 초당거래대금, 전일비, 회전율)
  3. **Level 3**: 추세 필터 (고저평균대비등락율, 등락율각도)
  4. **Level 4**: 고급 지표 (체결강도평균, 거래대금각도)
  5. **Level 5**: 리스크 관리 (VI 호가, 라운드 피겨, 호가 잔량)

- 최적화 조건식:
  - 동일한 논리를 사용하되, 임계값을 `self.vars[i]`로 치환
  - 각 변수는 `self.vars[정수] = [[시작값, 종료값, 간격], 기본값]` 형식
  - GA 최적화는 `self.vars[정수] = [[값1, 값2, ...], 기본값]` 형식
  - **매수/매도 호출은 동일하게 유지** (최적화와 무관)

- 학습 권장사항:
  - 각 레벨별로 백테스팅을 수행하여 결과 비교
  - 조건 추가 시 매매 횟수 및 수익률 변화 관찰
  - 과최적화(overfitting) 주의
  - 매수/매도 호출 코드는 반드시 포함

### 이름 규칙

- `C`: Condition
- `T`: Tick
- `900_920`: 09:00~09:20 전략
- `STUDY`: 학습용 버전
- `B`: 매수 조건식
- `S`: 매도 조건식
- `BO`: 매수 최적화 조건식
- `SO`: 매도 최적화 조건식
- `BOR`: 매수 최적화 범위
- `SOR`: 매도 최적화 범위
- `OR`: 매수·매도 통합 최적화 범위
- `GAR`: GA 최적화 범위

예시:
- `C_T_900_920_STUDY_B`: 09:00~09:20 Tick 학습용 매수 조건식
- `C_T_900_920_STUDY_BO`: 09:00~09:20 Tick 학습용 매수 최적화 조건식

---

# Condition - Tick 900_920 Study

## 조건식

### 매수 조건식 - C_T_900_920_STUDY_B

장 초반 20분 구간에서 **기본적인 모멘텀 조건**과 **거래대금/거래량 필터**를 적용하여 학습한다.

**현재 활성화 조건**:
- Level 1: 관심종목, 가격대, 체결강도, 등락율
- Level 2: 당일거래대금, 초당거래대금, 초당거래대금평균비율, 전일비, 회전율

```python

# ================================
#  공통 계산 지표
# ================================
전일종가          = 현재가 / (1 + (등락율 / 100))                      # 단위: 원
시가등락율        = ((시가 - 전일종가) / 전일종가) * 100                # 단위: 퍼센트
시가대비등락율    = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트
초당순매수금액    = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000   # 단위: 백만원
# ------------------------------------------------
#  New 지표 (미사용 시 주석 처리)
#    · 누적거래대금비율 · 초당순매수비율 · 거래대금/체결강도 가속도 등
# ------------------------------------------------

# ================================
#  매수 조건 (학습용 - 단계별 활성화)
# ================================
매수 = True


# ========================================
#  Level 1: 기본 필터 (필수 조건)
# ========================================

# 1. 공통 필터
if not (관심종목 == 1):                         # 관심종목 필터
    매수 = False
elif not (1000 <= 현재가 <= 50000):              # 가격대 필터 (1,000원 ~ 50,000원)
    매수 = False
elif not (당일거래대금 >= 5 * 100):             # 최소 당일거래대금 500 백만 이상
    매수 = False

# 2. 기본 추세/모멘텀 필터
elif not (등락율 >= 0.0):                       # 최소 등락율 0% 이상
    매수 = False
elif not (고저평균대비등락율 > 0):               # 고가·저가 평균 대비 현재가 위치
    매수 = False

# 3. 리스크 관리 필터
elif not (현재가 < VI아래5호가):                # VI 발동 리스크 회피
    매수 = False
elif 라운드피겨위5호가이내:                     # 라운드 피겨 저항 회피
    매수 = False


# ========================================
#  Level 2: 거래대금 및 거래량 필터 (활성화됨)
# ========================================

# [Level 2] 당일거래대금 필터 (최소 5 억(500 백만) 이상)
elif not (당일거래대금 >= 5 * 100):
    매수 = False

# [Level 2] 초당거래대금 필터 (최소 1천 이상 연속)
elif not (초당거래대금 >= 1 * 10 and 초당거래대금N(1) >= 1 * 10 ):
    매수 = False

# [Level 2] 초당거래대금 평균 대비 (30틱 평균 대비 > 2.0배)
elif not (초당거래대금 / 초당거래대금평균(30) > 2.0):
    매수 = False

# [Level 2] 전일비 필터 (전일 거래량 대비 > 50%)
elif not (전일비 > 0.5):
    매수 = False

# [Level 2] 회전율 필터 (상장주식수 대비 > 1.0%)
elif not (회전율 > 1.0):
    매수 = False


# ========================================
#  Level 3: 추세 필터 (주석 해제하여 활성화)
# ========================================

# [Level 3] 고저평균 대비 위치 (현재가가 고저평균 위에 있음)
# elif not (고저평균대비등락율 > 0):
#     매수 = False

# [Level 3] 등락율 각도 (30틱 기준 각도 > 3)
# elif not (등락율각도(30) > 3):
#     매수 = False


# ========================================
#  Level 4: 고급 지표 (주석 해제하여 활성화)
# ========================================

# [Level 4] 체결강도 평균 대비 (30틱 평균 대비 > 1.2배)
# elif not (체결강도 / 체결강도평균(30) > 1.2):
#     매수 = False

# [Level 4] 거래대금 각도 (30틱 기준 각도 > 5)
# elif not (당일거래대금각도(30) > 5):
#     매수 = False

# [Level 4] 전일비 필터 (전일 거래량 대비)
# elif not (전일비 > 50):
#     매수 = False


# ========================================
#  Level 5: 리스크 관리 (주석 해제하여 활성화)
# ========================================

# [Level 5] VI 발동 리스크 회피
# elif not (현재가 < VI아래5호가):
#     매수 = False

# [Level 5] 라운드 피겨 저항 회피
# elif 라운드피겨위5호가이내:
#     매수 = False

# [Level 5] 호가 잔량 분석 (매수 압력 확인)
# elif not (매수총잔량 > 매도총잔량 * 0.8):
#     매수 = False


# ================================
#  매수 호출
# ================================
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식 - C_T_900_920_STUDY_S

기본적인 손절/익절 및 시간 기반 청산 조건을 적용한다.

**현재 활성화 조건**:
- Level 1: 손절 (-3%), 익절 (+5%)
- Level 2: 시간 청산 (09:20 이후), 보유시간 청산 (600초/10분 초과)

```python
# ================================
#  매도 조건 (학습용 - 단계별 활성화)
# ================================
매도 = False


# ========================================
#  Level 1: 기본 손절/익절 (필수 조건)
# ========================================

# 1-1. 손절 (-4%)
if 수익률 <= -4.0:
    매도 = True

# 1-2. 익절 (+5%)
elif 수익률 >= 5.0:
    매도 = True


# ========================================
#  Level 2: 시간 기반 청산 (활성화됨)
# ========================================

# [Level 2] 09:20 이후 강제 청산
elif 시분초 >= 92000:
    매도 = True

# [Level 2] 보유 시간 600초(10분) 초과 시 청산
elif 보유시간 >= 600:
    매도 = True


# ========================================
#  Level 3: 추세 훼손 감지 (주석 해제하여 활성화)
# ========================================

# [Level 3] 체결강도 급락 (30틱 평균 대비 0.7배 이하)
# elif 체결강도 / 체결강도평균(30) < 0.7:
#     매도 = True

# [Level 3] 등락율 각도 하락 (30틱 기준 각도 < 0)
# elif 등락율각도(30) < 0:
#     매도 = True


# ========================================
#  Level 4: Trailing Stop (주석 해제하여 활성화)
# ========================================

# [Level 4] 최고수익률 대비 2% 이상 하락 시 청산
# elif 최고수익률 - 수익률 >= 2.0:
#     매도 = True


# ========================================
#  Level 5: 급격한 변화 감지 (주석 해제하여 활성화)
# ========================================

# [Level 5] 초당거래대금 급감 (30틱 평균 대비 0.5배 이하)
# elif 초당거래대금 / 초당거래대금평균(30) < 0.5:
#     매도 = True

# [Level 5] VI 발동 위험 근접
# elif 현재가 >= VI아래5호가:
#     매도 = True


# ================================
#  매도 호출
# ================================
if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

## 최적화 조건식

### 매수 최적화 조건식 - C_T_900_920_STUDY_BO

매수 조건식의 임계값을 `self.vars[i]`로 치환하여 최적화를 수행한다.

**소스코드 참조**:
- 파일: `stock/kiwoom_strategy_tick.py`
- 라인: 해당 전략의 buy_condition 메서드

```python
# ================================
#  매수 조건 (최적화용)
# ================================
매수 = True


# ========================================
#  Level 1: 기본 필터
# ========================================

# 1-1. 관심종목 필터
if not (관심종목 == 1):
    매수 = False

# 1-2. 가격대 필터
elif not (self.vars[0] <= 현재가 <= self.vars[1]):
    매수 = False

# 1-3. 체결강도 필터
elif not (체결강도 >= self.vars[2]):
    매수 = False

# 1-4. 등락율 필터
elif not (등락율 >= self.vars[3]):
    매수 = False


# ========================================
#  Level 2: 거래대금 및 거래량 필터 (활성화됨)
# ========================================

# [Level 2] 당일거래대금 필터
elif not (당일거래대금 >= self.vars[4]):
    매수 = False

# [Level 2] 초당거래대금 필터
elif not (초당거래대금 >= self.vars[5]):
    매수 = False

# [Level 2] 초당거래대금 평균 대비
elif not (초당거래대금 / 초당거래대금평균(30) > self.vars[12]):
    매수 = False

# [Level 2] 전일비 필터
elif not (전일비 > self.vars[13]):
    매수 = False

# [Level 2] 회전율 필터
elif not (회전율 > self.vars[14]):
    매수 = False


# ========================================
#  Level 3: 추세 필터
# ========================================

# [Level 3] 고저평균 대비 위치
# elif not (고저평균대비등락율 > self.vars[6]):
#     매수 = False

# [Level 3] 등락율 각도
# elif not (등락율각도(30) > self.vars[7]):
#     매수 = False


# ========================================
#  Level 4: 고급 지표
# ========================================

# [Level 4] 체결강도 평균 대비
# elif not (체결강도 / 체결강도평균(30) > self.vars[8]):
#     매수 = False

# [Level 4] 거래대금 각도
# elif not (당일거래대금각도(30) > self.vars[9]):
#     매수 = False

# [Level 4] 전일비 필터
# elif not (전일비 > self.vars[10]):
#     매수 = False


# ========================================
#  Level 5: 리스크 관리
# ========================================

# [Level 5] VI 발동 리스크 회피
# elif not (현재가 < VI아래5호가):
#     매수 = False

# [Level 5] 라운드 피겨 저항 회피
# elif 라운드피겨위5호가이내:
#     매수 = False

# [Level 5] 호가 잔량 분석
# elif not (매수총잔량 > 매도총잔량 * self.vars[11]):
#     매수 = False


# ================================
#  매수 호출
# ================================
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위 - C_T_900_920_STUDY_BOR

각 변수의 최적화 범위를 정의한다.

**형식**: `self.vars[정수] = [[시작값, 종료값, 간격], 기본값]`

```python
# Level 1: 기본 필터
self.vars[0]  = [[1000, 1000, 100], 1000]           # 최소 가격
self.vars[1]  = [[50000, 50000, 5000], 50000]       # 최대 가격
self.vars[2]  = [[80, 120, 10], 100]                # 최소 체결강도
self.vars[3]  = [[0.5, 2.0, 0.5], 1.0]              # 최소 등락율

# Level 2: 거래대금 및 거래량 필터
self.vars[4]  = [[3_000_000_000, 10_000_000_000, 1_000_000_000], 5_000_000_000]  # 최소 당일거래대금
self.vars[5]  = [[200_000_000, 500_000_000, 100_000_000], 300_000_000]            # 최소 초당거래대금
self.vars[12] = [[1.5, 3.0, 0.5], 2.0]              # 초당거래대금평균 비율
self.vars[13] = [[30, 100, 10], 50]                 # 최소 전일비
self.vars[14] = [[0.5, 2.0, 0.5], 1.0]              # 최소 회전율

# Level 3: 추세 필터
self.vars[6]  = [[-1, 1, 0.5], 0]                   # 고저평균대비등락율 임계값
self.vars[7]  = [[2, 5, 1], 3]                      # 등락율각도 임계값

# Level 4: 고급 지표
self.vars[8]  = [[1.0, 1.5, 0.1], 1.2]              # 체결강도평균 비율
self.vars[9]  = [[3, 8, 1], 5]                      # 거래대금각도 임계값
self.vars[10] = [[30, 100, 10], 50]                 # 최소 전일비

# Level 5: 리스크 관리
self.vars[11] = [[0.5, 1.0, 0.1], 0.8]              # 호가잔량 비율
```

### 매도 최적화 조건식 - C_T_900_920_STUDY_SO

매도 조건식의 임계값을 `self.vars[i]`로 치환하여 최적화를 수행한다.

**소스코드 참조**:
- 파일: `stock/kiwoom_strategy_tick.py`
- 라인: 해당 전략의 sell_condition 메서드

```python
# ================================
#  매도 조건 (최적화용)
# ================================
매도 = False


# ========================================
#  Level 1: 기본 손절/익절
# ========================================

# 1-1. 손절
if 수익률 <= self.vars[20]:
    매도 = True

# 1-2. 익절
elif 수익률 >= self.vars[21]:
    매도 = True


# ========================================
#  Level 2: 시간 기반 청산 (활성화됨)
# ========================================

# [Level 2] 시간 기반 청산
elif 시분초 >= self.vars[22]:
    매도 = True

# [Level 2] 보유 시간 초과 (초 단위)
elif 보유시간 >= self.vars[23]:
    매도 = True


# ========================================
#  Level 3: 추세 훼손 감지
# ========================================

# [Level 3] 체결강도 급락
# elif 체결강도 / 체결강도평균(30) < self.vars[24]:
#     매도 = True

# [Level 3] 등락율 각도 하락
# elif 등락율각도(30) < self.vars[25]:
#     매도 = True


# ========================================
#  Level 4: Trailing Stop
# ========================================

# [Level 4] 최고수익률 대비 하락
# elif 최고수익률 - 수익률 >= self.vars[26]:
#     매도 = True


# ========================================
#  Level 5: 급격한 변화 감지
# ========================================

# [Level 5] 초당거래대금 급감
# elif 초당거래대금 / 초당거래대금평균(30) < self.vars[27]:
#     매도 = True

# [Level 5] VI 발동 위험 근접
# elif 현재가 >= VI아래5호가:
#     매도 = True


# ================================
#  매도 호출
# ================================
if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

### 매도 최적화 범위 - C_T_900_920_STUDY_SOR

각 변수의 최적화 범위를 정의한다.

**형식**: `self.vars[정수] = [[시작값, 종료값, 간격], 기본값]`

```python
# Level 1: 기본 손절/익절
self.vars[20] = [[-5.0, -1.0, 1.0], -3.0]           # 손절 비율
self.vars[21] = [[3.0, 8.0, 1.0], 5.0]              # 익절 비율

# Level 2: 시간 기반 청산
self.vars[22] = [[91500, 92500, 500], 92000]        # 청산 시간
self.vars[23] = [[300, 900, 100], 600]              # 최대 보유시간(초)

# Level 3: 추세 훼손 감지
self.vars[24] = [[0.5, 0.9, 0.1], 0.7]              # 체결강도평균 비율
self.vars[25] = [[-2, 1, 1], 0]                     # 등락율각도 임계값

# Level 4: Trailing Stop
self.vars[26] = [[1.0, 3.0, 0.5], 2.0]              # Trailing Stop 비율

# Level 5: 급격한 변화 감지
self.vars[27] = [[0.3, 0.7, 0.1], 0.5]              # 초당거래대금평균 비율
```

### 매수·매도 통합 최적화 범위 - C_T_900_920_STUDY_OR

주요 10개 변수만 선별하여 통합 최적화를 수행한다.

**형식**: `self.vars[정수] = [[시작값, 종료값, 간격], 기본값]`

```python
# 매수 조건 주요 변수 (7개 - Level 2 확장)
self.vars[2]  = [[80, 120, 10], 100]                # 최소 체결강도
self.vars[3]  = [[0.5, 2.0, 0.5], 1.0]              # 최소 등락율
self.vars[4]  = [[3_000_000_000, 10_000_000_000, 1_000_000_000], 5_000_000_000]  # 최소 당일거래대금
self.vars[5]  = [[200_000_000, 500_000_000, 100_000_000], 300_000_000]            # 최소 초당거래대금
self.vars[12] = [[1.5, 3.0, 0.5], 2.0]              # 초당거래대금평균 비율
self.vars[13] = [[30, 100, 10], 50]                 # 최소 전일비
self.vars[14] = [[0.5, 2.0, 0.5], 1.0]              # 최소 회전율

# 매도 조건 주요 변수 (4개 - Level 2 포함)
self.vars[20] = [[-5.0, -1.0, 1.0], -3.0]           # 손절 비율
self.vars[21] = [[3.0, 8.0, 1.0], 5.0]              # 익절 비율
self.vars[22] = [[91500, 92500, 500], 92000]        # 청산 시간
self.vars[23] = [[300, 900, 100], 600]              # 최대 보유시간(초)
```

### 예상 시간 계산

**그리드 서치 최적화**:

**현재 활성화: Level 1 + Level 2 (거래대금, 전일비, 회전율 포함)**

조합 수 계산 (OR 섹션 기준):
- 매수 변수 7개: 5 × 4 × 8 × 4 × 4 × 8 × 4 = 163,840
  - vars[2]: 체결강도 (80~120, 10간격) = 5개
  - vars[3]: 등락율 (0.5~2.0, 0.5간격) = 4개
  - vars[4]: 당일거래대금 (30억~100억, 10억간격) = 8개
  - vars[5]: 초당거래대금 (2억~5억, 1억간격) = 4개
  - vars[12]: 초당거래대금평균비율 (1.5~3.0, 0.5간격) = 4개
  - vars[13]: 전일비 (30~100, 10간격) = 8개
  - vars[14]: 회전율 (0.5~2.0, 0.5간격) = 4개

- 매도 변수 4개: 5 × 6 × 3 × 7 = 630
  - vars[20]: 손절 (-5.0~-1.0, 1.0간격) = 5개
  - vars[21]: 익절 (3.0~8.0, 1.0간격) = 6개
  - vars[22]: 청산시간 (91500~92500, 500간격) = 3개
  - vars[23]: 보유시간 (300~900초, 100간격) = 7개

- **전체 조합: 163,840 × 630 = 103,219,200 조합**

예상 시간 (1조합당 0.01초 가정):
- 103,219,200 × 0.01초 = 1,032,192초 = **약 286시간 (12일)**

⚠️ **주의**: 조합 수가 매우 많아 그리드 서치는 비현실적입니다.

**권장 최적화 전략**:

1. **1단계 (완료)**: Level 1만 활성화
   - 매수 4개 × 매도 2개 = 600조합 (약 10분)

2. **2단계 (현재)**: 부분 최적화 권장
   - **Option A**: 매수 변수 중 3-4개만 선택하여 최적화
     - 예: vars[2,3,4,13] = 5×4×8×8 = 1,280 조합
     - 매도 4개 포함: 1,280 × 630 = 806,400 조합 (약 134분)

   - **Option B**: GA(유전 알고리즘) 최적화 사용 ✅ 권장
     - 전체 변수 탐색 가능
     - 시간: 약 30분~2시간 (세대 수에 따라)

3. **3단계**: 최적값 발견 후 미세 조정
   - GA로 발견한 최적값 주변 범위만 그리드 서치

**실용적 접근법**:
```python
# 단계별 최적화 예시
# Step 1: 핵심 변수만 (vars[2,3,20,21])
# Step 2: 거래대금 추가 (vars[4,5])
# Step 3: 거래량 추가 (vars[13,14])
# Step 4: 시간 조건 추가 (vars[22,23])
```

### GA 최적화 범위 - C_T_900_920_STUDY_GAR

유전 알고리즘(GA) 최적화를 위한 변수 범위를 정의한다.

**형식**: `self.vars[정수] = [[값1, 값2, ...], 기본값]`

```python
# Level 1: 기본 필터
self.vars[0]  = [[1000], 1000]                      # 최소 가격 (고정)
self.vars[1]  = [[50000], 50000]                    # 최대 가격 (고정)
self.vars[2]  = [[80, 90, 100, 110, 120], 100]      # 최소 체결강도
self.vars[3]  = [[0.5, 1.0, 1.5, 2.0], 1.0]         # 최소 등락율

# Level 2: 거래대금 및 거래량 필터
self.vars[4]  = [[3_000_000_000, 5_000_000_000, 7_000_000_000, 10_000_000_000], 5_000_000_000]  # 최소 당일거래대금
self.vars[5]  = [[200_000_000, 300_000_000, 400_000_000, 500_000_000], 300_000_000]            # 최소 초당거래대금
self.vars[12] = [[1.5, 2.0, 2.5, 3.0], 2.0]         # 초당거래대금평균 비율
self.vars[13] = [[30, 50, 70, 100], 50]             # 최소 전일비
self.vars[14] = [[0.5, 1.0, 1.5, 2.0], 1.0]         # 최소 회전율

# Level 3: 추세 필터
self.vars[6]  = [[-1, 0, 1], 0]                     # 고저평균대비등락율 임계값
self.vars[7]  = [[2, 3, 4, 5], 3]                   # 등락율각도 임계값

# Level 4: 고급 지표
self.vars[8]  = [[1.0, 1.1, 1.2, 1.3, 1.4, 1.5], 1.2]  # 체결강도평균 비율
self.vars[9]  = [[3, 4, 5, 6, 7, 8], 5]             # 거래대금각도 임계값
self.vars[10] = [[30, 50, 70, 100], 50]             # 최소 전일비

# Level 5: 리스크 관리
self.vars[11] = [[0.5, 0.6, 0.7, 0.8, 0.9, 1.0], 0.8]  # 호가잔량 비율

# 매도 조건
self.vars[20] = [[-5.0, -4.0, -3.0, -2.0, -1.0], -3.0]  # 손절 비율
self.vars[21] = [[3.0, 4.0, 5.0, 6.0, 7.0, 8.0], 5.0]   # 익절 비율
self.vars[22] = [[91500, 92000, 92500], 92000]           # 청산 시간
self.vars[23] = [[300, 400, 500, 600, 700, 800, 900], 600]  # 최대 보유시간(초)
self.vars[24] = [[0.5, 0.6, 0.7, 0.8, 0.9], 0.7]        # 체결강도평균 비율
self.vars[25] = [[-2, -1, 0, 1], 0]                      # 등락율각도 임계값
self.vars[26] = [[1.0, 1.5, 2.0, 2.5, 3.0], 2.0]        # Trailing Stop 비율
self.vars[27] = [[0.3, 0.4, 0.5, 0.6, 0.7], 0.5]        # 초당거래대금평균 비율
```

## 태그

#조건식 #Tick #장초반 #모멘텀 #학습용 #단계별 #백테스팅 #최적화
