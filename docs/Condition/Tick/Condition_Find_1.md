# 조건식 찾기 (Condition Finding)

- STOM 주식 자동거래에 사용하기 위한 틱 조건식 문서
- [[Back_Testing_Guideline_Tick]] 을(를) 기반으로 작성
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **틱 기반 조건식 찾기 전략**을 정의한다.

- **대상 시간 구간**: 09:00:00 ~ 15:30:00 (장 전체)
- **대상 종목**: 시가총액 3,000억 차등 기준
- **전략 타입**: 틱 기반 종합 탐색 전략
- **핵심 변수**: 초당거래대금, 체결강도, 등락율, 호가정보
- **업데이트 이력**:
  - 초기 문서 작성: 틱 기반 조건식 찾기 전략

## 제한조건
```
# 백테스팅 실행 시 다음 제한조건을 반드시 준수해야 합니다:
# 1. 가이드라인에 명시된 변수와 함수만 사용해야 합니다.
# 2. 조합된 변수는 직접 사용할 수 없으며, 기본 변수의 조합으로 표현해야 합니다.
# 3. 매수조건은 반드시 'not (조건)' 형태로 작성해야 합니다(False 조건).
# 4. 매도조건은 반드시 '조건' 형태로 작성해야 합니다(True 조건).
# 5. 조건식은 반드시 한 줄에 하나씩 작성해야 합니다.
# 6. '< > <= >= == !=' 같은 비교 연산자와 'and or not' 같은 논리 연산자만 사용합니다.
# 7. 복잡한 비교(a < b < c)는 명시적으로 분리해야 합니다(a < b and b < c).
# 8. 0으로 나누는 오류를 방지하기 위해 분모에 작은 값(예: 0.0001)을 더하는 것이 좋습니다.
# 9. 변수명은 정확하게 사용해야 하며, 오타가 있으면 시스템이 인식하지 못합니다.
# 10. 과도하게 복잡한 산술식은 백테스팅 성능에 영향을 줄 수 있습니다.
```

## 가이드라인
```
# 조건 편집기 작성 방법 안내
# 한줄에 하나의 조건을 작성해야하며
# "if" 와 ":"를 제외하고 조건을 작성해야합니다.
# 하한 조건일 경우 너무 낮은 값보다는 높아야합니다.
# 상한 조건일 경우 너무 높은 값보다는 낮아야합니다.
# 매수조건은 False 조건을 작성하십시오.
# 매도조건은 True 조건을 작성하십시오.
# 구분용으로 조건이 없는 빈칸을 입력할 수 있으며
# "# 조건설명" 형태로 주석을 추가하실 수 있습니다.
# 사용자의 조건 설정에 따라 유용한 조합이 나올수도
# 무의미한 조합이 나올수도 있습니다.
# 조건이 무조건 많다고 좋은 것은 아니니
# 대충 만든 조건 보다는 의미있는 조건들로
# 설정개수보다 최소 두배 이상의 조건을 작성하십시오.
```

## 매수 조건식 예제
```python
# 등락율 및 현재가
not (현재가 > 시가)
not (고저평균대비등락율 >= 0)
not (3 <= 등락율 <= 25)

# 거래대금
not (당일거래대금 >= 2000)
not (초당거래대금 >= 100)
not (초당거래대금 > 초당거래대금평균(30))
not (초당거래대금평균(30) > 초당거래대금평균(30, 1))

# 초당매도수수량
not (초당매수수량 > 초당매도수량)
not (초당매수수량 > 초당매수수량N(1))

# 이동평균선
not (이동평균(60) > 이동평균(60, 1))

# 체결강도
not (체결강도 >= 체결강도평균(30) + 3)

# 호가정보
not (매도총잔량 > 매수총잔량)
not (매도잔량1 > 매수잔량1)
```

## 매도 조건식 예제
```python
# 수익률
수익률 <= -2
수익률 >= 3
최고수익률 > 3 and 수익률 < 최고수익률 * 0.75

# 등락율
등락율 > 29
고저평균대비등락율 < 0

# 기타
보유시간 > 1800
체결강도 <= 최고체결강도(30) - 5
매도총잔량 < 매수총잔량
```

## 매수 조건식
```python
# 일반 선결 조건
not (관심종목 == 1)                                  # 관심종목이 아닌 종목만 매수 대상                       [순수 변수]
not (1000 < 현재가 <= 30000)                         # 현재가가 1,000원~30,000원 범위 내 종목만 매수 대상     [순수 변수]
not (1.0 < 등락율 <= 20.0)                           # 등락율이 1%~20% 범위 내 종목만 매수 대상             [순수 변수]
not (고저평균대비등락율 > 0)                          # 고저평균 대비 등락율이 0 이하인 종목만 매수 대상      [순수 변수]
not (현재가 < VI아래5호가)                            # VI아래5호가보다 현재가가 높은 종목만 매수 대상        [순수 변수]
not (초당거래대금 > 초당거래대금N(1) * 1.5)            # 초당거래대금이 직전보다 50% 이상 급증하지 않은 종목   [순수 변수]
라운드피겨위5호가이내                                  # 라운드피겨 가격대 상위 5호가 이내인 종목              [순수 변수]

# 시간 조건(91000 이전)
not (시분초 < 91000)                                 # 장 시작 후 일정 시간(9시 10분) 이후 매수 대상         [순수 변수]

# 등락율 관련 조건
not (1.0 <= (현재가 / 시가 - 1) * 100 and (현재가 / 시가 - 1) * 100 < 10.0)   # 시가 대비 현재가 등락율 1%~10% 범위 종목    [조합 변수: 시가등락율]
not (1.0 <= (현재가 / 시가 - 1) * 100 and (현재가 / 시가 - 1) * 100 < 8.0)    # 시가 대비 현재가 등락율 1%~8% 범위 종목     [조합 변수: 시가대비등락율]

# 매매량 및 거래대금 조건
not (30 < (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000 and (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000 < 300)   # 초당 순매수금액 3천만~3억원 범위  [조합 변수: 초당순매수금액]
not (현재가 > (고가 - (고가 - 저가) *10 / 100))      # 현재가가 고가에서 10% 이상 하락한 종목만 매수 대상    [순수 변수]
not (전일비 > 10)                                   # 전일 대비 거래량 비율 10% 이하 종목만 매수 대상       [순수 변수]
not (전일동시간비 > 100)                              # 전일 동시간 대비 거래량 100% 이하 종목만 매수 대상    [순수 변수]
not (회전율 > 1)                                     # 회전율 1% 이하 종목만 매수 대상                      [순수 변수]
not (당일거래대금 > 3 * 100)                          # 당일거래대금 300억 이하 종목만 매수 대상             [순수 변수]

# 기울기/각도 조건
not (등락율각도(30) > -2 and 등락율각도(30) < 10)      # 등락율 각도가 -2~10도 범위 내 종목만 매수 대상      [순수 변수]
not (전일비각도(30) > 0 and 전일비각도(30) < 50)       # 전일비 각도가 0~50도 범위 내 종목만 매수 대상       [순수 변수]

# 거래대금 조건
not (초당거래대금 / 초당거래대금평균(30) > 1)           # 초당거래대금이 평균보다 큰 종목만 매수 대상          [순수 변수]
not (초당거래대금 - 초당거래대금평균(30) < 1000)        # 초당거래대금이 평균보다 10억 이상 큰 종목만 매수 대상 [순수 변수]

# 눌림목 조건
not (이동평균(60) > 이동평균(60, 10))                  # 60틱 이동평균이 10틱 전보다 상승한 종목만 매수 대상   [순수 변수]
not (현재가 < 이동평균(20) and 현재가 > 이동평균(20, 1)) # 현재가가 20틱 이평선 아래서 반등 시작하는 종목      [순수 변수]
not (현재가 < 이동평균(10) and 체결강도 > 체결강도N(1) * 1.1) # 현재가가 이평 아래지만 체결강도 상승 종목     [순수 변수]
not (현재가 < 이동평균(5) and 현재가 > 현재가N(3) and 체결강도 > 100) # 단기 이평 아래서 반등하는 종목       [순수 변수]
not (최고현재가(30) > 현재가 * 1.02 and 현재가 > 현재가N(5)) # 조정 후 반등 조짐 보이는 종목                [순수 변수]

# 상향 돌파 조건
not (현재가 > 이동평균(20) and 현재가N(1) < 이동평균(20, 1)) # 현재가가 20틱 이평선을 상향 돌파하는 종목     [순수 변수]
not (현재가 > 이동평균(60) and 현재가N(3) < 이동평균(60, 3)) # 현재가가 60틱 이평선을 상향 돌파하는 종목     [순수 변수]
not (체결강도 > 체결강도평균(30) + 15 and 현재가 > 이동평균(5)) # 체결강도 강하고 이평선 위에 있는 종목       [순수 변수]
not (등락율각도(30) > 20 and 현재가 > 이동평균(10))      # 등락율 각도가 가파르고 이평선 위에 있는 종목       [순수 변수]
not (초당거래대금 > 초당거래대금평균(60) * 2 and 현재가 > 현재가N(5)) # 거래대금 급증하고 상승 추세인 종목    [순수 변수]

# 볼륨/강도 급증 조건
not (초당거래대금 > 초당거래대금N(1) * 2 and 초당거래대금N(1) > 초당거래대금N(2) * 1.5) # 연속적인 거래대금 급증 종목 [순수 변수]
not (초당매수수량 > 초당매수수량N(1) * 3)                # 초당매수수량이 직전보다 3배 이상 급증한 종목        [순수 변수]
not (초당매수수량 > 3 * 초당매도수량)                    # 매수수량이 매도수량보다 3배 이상 많은 종목          [순수 변수]
not (체결강도 > 체결강도N(2) * 1.5 and 체결강도 > 120)   # 체결강도가 급등하고 120 이상인 강한 종목           [순수 변수]
not (최고체결강도(10) > 체결강도평균(30) * 1.8)           # 최근 체결강도가 평균보다 80% 이상 높은 종목        [순수 변수]

# 이격도 및 캔들 패턴 조건
not (현재가 < 이동평균(5) * 0.97 and 체결강도 > 130)     # 현재가가 이평 대비 3% 이상 이격된 강한 종목        [순수 변수]
not (최저현재가(20) == 현재가N(10) and 현재가 > 현재가N(5)) # 이중 바닥 형성 후 반등하는 종목                [순수 변수]
not (현재가 > 고가 - (고가 - 저가) * 0.2 and 등락율 > 2) # 고가 근처에서 강세 보이는 종목                   [순수 변수]
not ((시가 - 저가) * 2 < (고가 - 시가) and 등락율 > 0)   # 강한 상승 캔들 패턴을 보이는 종목                [순수 변수]
not (현재가 > 시가 * 1.01 and 체결강도 > 110)            # 시가 대비 상승하고 체결강도 강한 종목             [순수 변수]

# 호가 불균형 조건
not (매도총잔량 < 매수총잔량 * 0.6)                      # 매수잔량이 매도잔량보다 67% 이상 많은 종목         [순수 변수]
not (매도잔량1 < 매수잔량1 * 0.5)                        # 1호가 매수잔량이 매도잔량보다 2배 이상 많은 종목    [순수 변수]
not (매도총잔량 < 매도총잔량N(5) * 0.7 and 매수총잔량 > 매수총잔량N(5)) # 매도잔량 감소, 매수잔량 증가 종목  [순수 변수]
# not ((매수잔량1 / 매도잔량1) > ((매수잔량1N(10)) / (매도잔량1N(10) + 0.0001)) * 1.5) # 매수/매도 비율 급증 종목 [조합 변수: 비율 계산]
not (매수호가1 > 매수호가1N(5) and 매도호가1 == 매도호가1N(5)) # 매수호가 상승, 매도호가 유지되는 종목        [순수 변수]

# 매수세력 우위 조건
not ((초당매수수량 - 초당매도수량) > (누적초당매수수량(30) / 30) * 0.3)  # 순매수량이 평균보다 높은 종목     [조합 변수: 누적매수량 평균 계산]
not (체결강도 > 최고체결강도(60) * 0.9 and 체결강도 > 체결강도평균(30) * 1.2)  # 체결강도가 상대적으로 강한 종목 [순수 변수]
not ((초당매수수량 - 초당매도수량) * 현재가 / 1_000_000 > ((누적초당매수수량(30) - 누적초당매도수량(30)) / 30) * 현재가 / 1_000_000 * 2)  # 순매수금액이 평균보다 높은 종목 [조합 변수: 누적매수금액 평균 계산]
not (누적초당매수수량(30) > 누적초당매도수량(30) * 1.4)    # 누적 매수수량이 매도수량보다 40% 이상 많은 종목    [순수 변수]
not (초당매수수량 > 매도총잔량 * 0.4)                     # 초당매수수량이 매도잔량의 40% 이상인 종목         [순수 변수]

# 매수 타이밍 조건
not (등락율각도(10) > 등락율각도(30) * 1.5 and 등락율각도(10) > 5) # 단기 등락율 각도가 급증하는 종목        [순수 변수]
not (전일비각도(10) > 전일비각도(30) and 전일비각도(10) > 0) # 단기 전일비 각도가 증가하는 종목              [순수 변수]
not (체결강도 > 체결강도N(1) and 체결강도N(1) > 체결강도N(2) and 체결강도N(2) > 체결강도N(3)) # 연속 체결강도 상승 종목 [순수 변수]
not (최저체결강도(20) > 90 and 체결강도 > 체결강도평균(20)) # 체결강도가 하방 지지되고 평균 이상인 종목        [순수 변수]
not (현재가 > 현재가N(1) and 현재가N(1) > 현재가N(2) and 현재가N(2) > 현재가N(3)) # 연속 가격 상승 종목    [순수 변수]

# 매수 잔량 조건
not (매수총잔량 * 2 > 매도총잔량)                         # 매수잔량이 매도잔량의 절반 이상인 종목            [순수 변수]
not ((매도호가1 - 매수호가1) < 호가단위 * 2)              # 매수호가와 매도호가의 차이가 좁은 종목            [순수 변수]
```


## 매도 조건식
```python
# 상한가 근접 조건
등락율 > 29.5

# 시간대 조건 (90500 이전)
시분초 < 90500 and 5 <= 수익률
시분초 < 90500 and 수익률 <= -4.0
시분초 < 90500 and 최고수익률 > 3 and 최고수익률 * 0.7 >= 수익률
시분초 < 90500 and 보유시간 > 600 and 수익률 < 1

# 시간대 조건 (91000 이전)
시분초 < 91000 and 5 <= 수익률
시분초 < 91000 and 수익률 <= -4.0
시분초 < 91000 and 최고수익률 > 3 and 최고수익률 * 0.7 >= 수익률
시분초 < 91000 and 보유시간 > 300 and 수익률 < 1

# 시간대 조건 (91500 이전)
시분초 < 91500 and 5 <= 수익률
시분초 < 91500 and 수익률 <= -4.0
시분초 < 91500 and 최고수익률 > 3 and 최고수익률 * 0.7 >= 수익률
시분초 < 91500 and 보유시간 > 300 and 수익률 < 1

# 시가총액 조건
시가총액 < 2500000 and -1 < 수익률 <= 15 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.8  # 중소형 종목에서 매도세 우위이고 수익 중일 때 매도  [순수 변수]
시가총액 < 2500000 and 수익률 < -2 and 체결강도N(1) > 체결강도평균(30,1) and 체결강도평균(30,1) > 체결강도  # 중소형 종목 손실 상태에서 체결강도 하락 시 매도  [순수 변수]
시가총액 < 2500000 and 3 < 최고수익률 and 현재가N(1) >= 이동평균(60, 1) and 이동평균(60) > 현재가  # 중소형 종목에서 이평선 하향 돌파 시 매도  [순수 변수]

# 수익 실현 조건
수익률 >= 2.0 and 체결강도 < 체결강도N(1) and 체결강도N(1) < 체결강도N(2)  # 수익률 2% 이상이고 체결강도 연속 하락 시 매도    [조합 변수: 연속 비교]
수익률 >= 1.5 and 현재가 < 현재가N(1) and 현재가N(1) < 현재가N(2)  # 수익률 1.5% 이상이고 현재가 연속 하락 시 매도    [조합 변수: 연속 비교]
수익률 >= 1.0 and 체결강도 < 체결강도평균(10) and 초당거래대금 < 초당거래대금평균(10)  # 수익률 1%이고 체결강도/거래대금 약화 시 매도  [순수 변수]
수익률 >= 3.0 and 보유시간 > 180                          # 수익률 3% 이상이고 3분 이상 보유했으면 매도          [순수 변수]
최고수익률 > 2.5 and 수익률 < 최고수익률 * 0.8             # 최고수익률의 80% 미만으로 하락 시 매도               [순수 변수]
최고수익률 >= 4.0 and 수익률 <= 최고수익률 * 0.7           # 최고수익률의 70% 미만으로 하락 시 매도               [순수 변수]

# 손절 조건
수익률 <= -1.0 and 체결강도 < 체결강도평균(20)             # 손실 1% 이상이고 체결강도 약화 시 손절               [순수 변수]
수익률 <= -1.5 and 초당매도수량 > 초당매수수량 * 1.5        # 손실 1.5% 이상이고 매도수량 증가 시 손절            [순수 변수]
수익률 <= -2.0 and 현재가 < 이동평균(10)                   # 손실 2% 이상이고 이동평균 아래로 하락 시 손절        [순수 변수]
수익률 <= -0.8 and 보유시간 > 300 and 현재가 < 현재가N(5)   # 약한 손실에 장기 보유하고 하락 추세면 손절          [순수 변수]
수익률 < -1.2 and 등락율각도(30) < -10                     # 손실 1.2% 이상이고 등락율 각도 급락 시 손절          [순수 변수]

# 추세 반전 기반 매도 조건
체결강도 < 체결강도평균(30) * 0.7 and 수익률 > 0.5         # 체결강도 급락하고 이익 중일 때 매도                  [순수 변수]
초당매도수량 > 초당매수수량 * 2 and 수익률 > 0             # 매도수량이 매수수량보다 두 배 이상이고 이익 중일 때    [순수 변수]
현재가 < 이동평균(10) and 이동평균(10) < 이동평균(10, 1) and 수익률 > 0.3  # 이동평균 하향 돌파하고 이익 중일 때 [순수 변수]
초당거래대금 < 초당거래대금평균(30) * 0.6 and 수익률 > 0    # 초당거래대금 급감하고 이익 중일 때 매도              [순수 변수]
등락율각도(20) < -15 and 수익률 > 0.2                      # 등락율 각도 급락하고 이익 중일 때 매도               [순수 변수]

# 호가 불균형 기반 매도 조건
매도총잔량 < 매수총잔량 * 0.4 and 매도총잔량 < 매도총잔량N(5) * 0.7 and 수익률 > 0.5  # 매도잔량 급감하고 이익 중일 때 [순수 변수]
매도잔량1 > 매도잔량1N(1) * 2 and 매수잔량1 < 매수잔량1N(1) and 수익률 > 0  # 매도잔량 급증, 매수잔량 감소 시 매도 [순수 변수]
매수호가1 < 매수호가1N(3) and 수익률 > 0.3                 # 매수호가 하락하고 이익 중일 때 매도                  [순수 변수]
매도총잔량 > 매수총잔량 * 2 and 초당매도수량 > 초당매수수량 and 수익률 > 0  # 매도세가 강하고 이익 중일 때 매도    [순수 변수]
매도잔량1 > 매수잔량1 * 3 and 수익률 > 0.4                 # 1호가 매도잔량이 매수잔량보다 3배 이상이고 이익 중일 때 [순수 변수]

# 볼륨 변화 기반 매도 조건
초당거래대금 < 초당거래대금N(1) * 0.6 and 수익률 > 0.7     # 초당거래대금 급감하고 이익 중일 때 매도              [순수 변수]
초당거래대금 > 초당거래대금N(1) * 3 and 수익률 > 0.5       # 초당거래대금 급증하고 이익 중일 때 매도              [순수 변수]
초당매도수량 > (누적초당매도수량(30) / 30) * 2 and 수익률 > 0.3  # 초당매도수량 급증하고 이익 중일 때 매도      [조합 변수: 누적매도량 평균 계산]
최고초당매수수량(10) < 최고초당매수수량(10, 10) * 0.5 and 수익률 > 0.4  # 최고 매수수량 급감하고 이익 중일 때    [순수 변수]
초당거래대금 < 초당거래대금평균(60) * 0.4 and 보유시간 > 120 and 수익률 > 0  # 초당거래대금 급감하고 2분 이상 보유 시 [순수 변수]

# 타이밍 기반 매도 조건
체결강도 < 최저체결강도(20) * 1.2 and 수익률 > 0.6         # 체결강도가 최저치 근처로 하락하고 이익 중일 때        [순수 변수]
시분초 > 145000 and 수익률 > 0.2                           # 장 마감 임박하고 이익 중일 때 매도                   [순수 변수]
보유시간 > 600 and 수익률 < 0.5                            # 10분 이상 보유했는데 수익률이 낮을 때 매도           [순수 변수]
((현재가N(1) - 현재가) / 현재가 * 100) > 0.2 and 수익률 > 0.4  # 직전 틱 대비 0.2% 이상 하락하고 이익 중일 때    [조합 변수: 가격변동률]
최고수익률 > 1.0 and 수익률 < 0 and 보유시간 > 180         # 최고수익률 1% 이상 기록했으나 손실 전환되면 매도      [순수 변수]

# 최저가 돌파
현재가 < 최저현재가(int(180),int(보유시간)) and 데이터길이 > 180  # 보유 후 최저가 돌파 시 매도(180틱 기준)     [순수 변수]
현재가 < 최저현재가(int(120),int(보유시간)) and 데이터길이 > 120  # 보유 후 최저가 돌파 시 매도(120틱 기준)     [순수 변수]
현재가 < 최저현재가(int(60),int(보유시간)) and 데이터길이 > 60    # 보유 후 최저가 돌파 시 매도(60틱 기준)      [순수 변수]
```

## 참고사항
- 각 조건에는 [순수 변수] 또는 [조합 변수: 설명] 형태로 변수 유형을 표시했습니다.
- 순수 변수는 Back_Testing_Guideline.md에 직접 명시된 변수입니다.
- 조합 변수는 여러 기본 변수를 조합하여 만든 표현식입니다.
- 모든 조건은 백테스팅 시스템에서 오류 없이 실행될 수 있도록 가이드라인에 맞게 작성되었습니다.

**최종 업데이트: 2023-05-16 (0으로 나누기 오류 수정)**

## 최적화 조건식

### 매수 최적화 조건식 - C_F1_T_BO

```python
초당순매수금액 = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000

# 일반 선결 조건
if not (관심종목 == 1):
    매수 = False
elif not (self.vars[0] < 현재가 <= self.vars[1]):    # 현재가 범위 최적화
    매수 = False
elif not (self.vars[2] < 등락율 <= self.vars[3]):     # 등락율 범위 최적화
    매수 = False
elif not (고저평균대비등락율 > 0):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif not (초당거래대금 > 초당거래대금N(1) * self.vars[4]):  # 초당거래대금 급등 배수 최적화
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (시분초 < 91000):
    매수 = False
elif not (초당순매수금액 > self.vars[5] and 초당순매수금액 < self.vars[6]):  # 초당순매수금액 범위 최적화
    매수 = False
elif not (전일비 > self.vars[7]):  # 전일비 최적화
    매수 = False
elif not (회전율 > self.vars[8]):  # 회전율 최적화
    매수 = False
elif not (당일거래대금 > self.vars[9]):  # 당일거래대금 최적화
    매수 = False
elif not (체결강도 >= self.vars[10]):  # 체결강도 최적화
    매수 = False
```

### 매도 최적화 조건식 - C_F1_T_SO

```python
# 상한가 근접 조건
if 등락율 > self.vars[20]:  # 최대 등락율 최적화
    매도 = True
# 시간대별 수익 목표
elif 시분초 < 90500 and self.vars[21] <= 수익률:  # 초반 목표수익률 최적화
    매도 = True
elif 시분초 < 90500 and 수익률 <= self.vars[22]:  # 초반 손절수익률 최적화
    매도 = True
elif 시분초 < 91000 and self.vars[23] <= 수익률:  # 중반 목표수익률 최적화
    매도 = True
elif 시분초 < 91000 and 수익률 <= self.vars[24]:  # 중반 손절수익률 최적화
    매도 = True
# 일반 수익 실현
elif 수익률 >= self.vars[25]:  # 일반 목표수익률 최적화
    매도 = True
elif 수익률 <= self.vars[26]:  # 일반 손절수익률 최적화
    매도 = True
elif 최고수익률 > self.vars[27] and 수익률 < 최고수익률 * self.vars[28]:  # 고점 대비 하락 비율 최적화
    매도 = True
elif 보유시간 > self.vars[29]:  # 보유시간 제한 최적화
    매도 = True
```

### 매수·매도 통합 최적화 범위 - C_F1_T_OR

```python
# BOR 핵심 변수 (6개)
self.vars[0] = [[800, 1000, 1200], 1000]          # 현재가 하한
self.vars[1] = [[25000, 30000, 35000], 30000]     # 현재가 상한
self.vars[2] = [[0.5, 1.0, 1.5], 1.0]             # 등락율 하한
self.vars[3] = [[18.0, 20.0, 22.0], 20.0]         # 등락율 상한
self.vars[4] = [[1.3, 1.5, 1.7], 1.5]             # 초당거래대금 급등 배수
self.vars[10] = [[95, 105, 115], 105]             # 체결강도

# SOR 핵심 변수 (4개)
self.vars[20] = [[28.5, 29.5, 30.0], 29.5]        # 최대 등락율
self.vars[25] = [[1.5, 2.0, 2.5], 2.0]            # 일반 목표수익률
self.vars[26] = [[-2.5, -2.0, -1.5], -2.0]        # 일반 손절수익률
self.vars[29] = [[1200, 1800, 2400], 1800]        # 보유시간 제한(초)

# 총 경우의 수: 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 = 59,049
```

### 매수 최적화 범위 - C_F1_T_BOR

```python
self.vars[0] = [[800, 1200, 100], 1000]           # 현재가 하한
self.vars[1] = [[25000, 35000, 2500], 30000]      # 현재가 상한
self.vars[2] = [[0.5, 1.5, 0.25], 1.0]            # 등락율 하한
self.vars[3] = [[18.0, 22.0, 1.0], 20.0]          # 등락율 상한
self.vars[4] = [[1.3, 1.7, 0.1], 1.5]             # 초당거래대금 급등 배수
self.vars[5] = [[20, 40, 5], 30]                  # 초당순매수금액 하한
self.vars[6] = [[250, 350, 25], 300]              # 초당순매수금액 상한
self.vars[7] = [[8, 12, 1], 10]                   # 전일비
self.vars[8] = [[0.8, 1.2, 0.1], 1.0]             # 회전율
self.vars[9] = [[200, 400, 50], 300]              # 당일거래대금
self.vars[10] = [[95, 115, 5], 105]               # 체결강도
```

### 매도 최적화 범위 - C_F1_T_SOR

```python
self.vars[20] = [[28.5, 30.0, 0.5], 29.5]         # 최대 등락율
self.vars[21] = [[4.0, 6.0, 0.5], 5.0]            # 초반(90500) 목표수익률
self.vars[22] = [[-5.0, -3.0, 0.5], -4.0]         # 초반(90500) 손절수익률
self.vars[23] = [[4.0, 6.0, 0.5], 5.0]            # 중반(91000) 목표수익률
self.vars[24] = [[-5.0, -3.0, 0.5], -4.0]         # 중반(91000) 손절수익률
self.vars[25] = [[1.5, 2.5, 0.25], 2.0]           # 일반 목표수익률
self.vars[26] = [[-2.5, -1.5, 0.25], -2.0]        # 일반 손절수익률
self.vars[27] = [[2.0, 3.0, 0.25], 2.5]           # 고점 기준 수익률
self.vars[28] = [[0.7, 0.9, 0.05], 0.8]           # 고점 대비 하락 비율
self.vars[29] = [[1200, 2400, 300], 1800]         # 보유시간 제한(초)
```

### GA 최적화 범위 - C_F1_T_GAR

```python
self.vars[0] = [[800, 900, 1000, 1100, 1200], 1000]
self.vars[1] = [[25000, 27500, 30000, 32500, 35000], 30000]
self.vars[2] = [[0.5, 0.75, 1.0, 1.25, 1.5], 1.0]
self.vars[3] = [[18.0, 19.0, 20.0, 21.0, 22.0], 20.0]
self.vars[4] = [[1.3, 1.4, 1.5, 1.6, 1.7], 1.5]
self.vars[5] = [[20, 25, 30, 35, 40], 30]
self.vars[6] = [[250, 275, 300, 325, 350], 300]
self.vars[7] = [[8, 9, 10, 11, 12], 10]
self.vars[8] = [[0.8, 0.9, 1.0, 1.1, 1.2], 1.0]
self.vars[9] = [[200, 250, 300, 350, 400], 300]
self.vars[10] = [[95, 100, 105, 110, 115], 105]
self.vars[20] = [[28.5, 29.0, 29.5, 30.0], 29.5]
self.vars[21] = [[4.0, 4.5, 5.0, 5.5, 6.0], 5.0]
self.vars[22] = [[-5.0, -4.5, -4.0, -3.5, -3.0], -4.0]
self.vars[23] = [[4.0, 4.5, 5.0, 5.5, 6.0], 5.0]
self.vars[24] = [[-5.0, -4.5, -4.0, -3.5, -3.0], -4.0]
self.vars[25] = [[1.5, 1.75, 2.0, 2.25, 2.5], 2.0]
self.vars[26] = [[-2.5, -2.25, -2.0, -1.75, -1.5], -2.0]
self.vars[27] = [[2.0, 2.25, 2.5, 2.75, 3.0], 2.5]
self.vars[28] = [[0.7, 0.75, 0.8, 0.85, 0.9], 0.8]
self.vars[29] = [[1200, 1500, 1800, 2100, 2400], 1800]
```

## 조건식 개선 방향 연구

### 1. 추가 지표 활용 연구

**우선순위: 높음**
- **호가창 두께 분석 추가**
  - 매수/매도 잔량 비율을 통한 지지/저항 강도 측정
  - 얇은 호가창 종목 필터링으로 급등락 리스크 감소
  - 구현 난이도: 낮음

- **거래대금 가속도 측정**
  - 1차 미분, 2차 미분 계산으로 거래량 가속 감지
  - 가속도가 양수일 때 매수 신호 강화
  - 구현 난이도: 중

### 2. 시간대별 전략 세분화 연구

**우선순위: 높음**
- **장 초반/중반/후반 조건 차등 적용**
  - 09:00-09:30: 갭 상승 전략 강화
  - 10:00-14:00: 모멘텀 추종 전략
  - 14:30-15:00: 단기 스캘핑 전략
  - 구현 난이도: 중

### 3. 매도 조건 고도화 연구

**우선순위: 높음**
- **동적 손절/익절 시스템**
  - 변동성 기반 손절폭 조정 (ATR 활용)
  - 트레일링 스톱 최적화
  - 구현 난이도: 중

- **부분 매도 전략**
  - 목표가 1차 도달 시 50% 매도
  - 나머지 50%는 트레일링 스톱 적용
  - 구현 난이도: 낮음

### 4. 리스크 관리 강화 연구

**우선순위: 높음**
- **허위 급등 필터링**
  - 급증 후 N초 지속 여부 확인
  - 일시적 스파이크 제거
  - 구현 난이도: 낮음

- **라운드 피겨 회피 강화**
  - 심리적 저항선 근처 진입 제한
  - 돌파 확인 후 진입
  - 구현 난이도: 낮음

### 5. 최적화 전략 개선 연구

**우선순위: 중간**
- **시가총액별 파라미터 세분화**
  - 초소형주 (1000억 미만) 별도 조건
  - 대형주 (1조 이상) 별도 조건
  - 구현 난이도: 중

- **백테스팅 기간 확대**
  - 다양한 시장 국면 반영
  - 과적합 방지
  - 구현 난이도: 낮음

### 구현 우선순위

1. **1단계 (즉시 구현)**:
   - 허위 급등 필터링
   - 호가창 두께 분석
   - 부분 매도 전략

2. **2단계 (1개월 내)**:
   - 거래대금 가속도 측정
   - 동적 손절/익절 시스템
   - 시간대별 전략 세분화

3. **3단계 (3개월 내)**:
   - 시가총액별 파라미터 세분화
   - 백테스팅 기간 확대
   - 복합 지표 개발

