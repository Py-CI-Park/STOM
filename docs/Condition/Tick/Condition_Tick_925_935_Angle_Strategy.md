# 조건식 (Condition) - Tick 기반 각도 전략

- STOM 주식 자동거래에 사용하기 위한 조건식 문서
- [Back_Testing_Guideline_Tick](../../Guideline/Back_Testing_Guideline_Tick.md) 을(를) 기반으로 작성한 Tick 조건식
- [Condition_Document_Template_Guideline](../../Guideline/Condition_Document_Template_Guideline.md) 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 목차
- [조건식 (Condition) - Tick 기반 각도 전략](#조건식-condition---tick-기반-각도-전략)
  - [목차](#목차)
  - [개요](#개요)
  - [가이드라인](#가이드라인)
    - [변수·이름 규칙](#변수이름-규칙)
- [Condition - Tick 925\_935 Angle Strategy](#condition---tick-925_935-angle-strategy)
  - [조건식](#조건식)
    - [매수 조건식 - C\_T\_925\_935\_AS\_B](#매수-조건식---c_t_925_935_as_b)
    - [매도 조건식 - C\_T\_925\_935\_AS\_S](#매도-조건식---c_t_925_935_as_s)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식 - C\_T\_925\_935\_AS\_BO](#매수-최적화-조건식---c_t_925_935_as_bo)
    - [매수 최적화 범위 - C\_T\_925\_935\_AS\_BOR](#매수-최적화-범위---c_t_925_935_as_bor)
    - [매도 최적화 조건식 - C\_T\_925\_935\_AS\_SO](#매도-최적화-조건식---c_t_925_935_as_so)
    - [매도 최적화 범위 - C\_T\_925\_935\_AS\_SOR](#매도-최적화-범위---c_t_925_935_as_sor)
    - [매수·매도 통합 최적화 범위 - C\_T\_925\_935\_AS\_OR](#매수매도-통합-최적화-범위---c_t_925_935_as_or)
    - [예상 시간 계산](#예상-시간-계산)
    - [GA 최적화 범위 - C\_T\_925\_935\_AS\_GAR](#ga-최적화-범위---c_t_925_935_as_gar)
  - [조건식 개선 방향 연구](#조건식-개선-방향-연구)
  - [태그](#태그)

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **장 초반 09:25:00 ~ 09:35:00 (Tick 데이터)** 구간에 사용하는 **각도 지표 중심 전략** 조건식을 정의합니다.

- **대상 구간**: 09:25:00 ~ 09:35:00 (장초 후반부 10분)
- **대상 종목**: 시가총액 차등 (1,500억 / 2,500억 / 그 이상)
- **전략 타입**: 각도 지표 복합 활용 + 체결강도 변동성 + 호가잔량 밸런스
- **핵심 변수**: 등락율각도, 전일비각도, 당일거래대금각도, 체결강도 변동성, 누적지표

**전략의 핵심 아이디어**:
1. **각도 지표 삼각 검증**: 등락율각도, 전일비각도, 당일거래대금각도를 동시에 활용하여 추세의 강도와 지속성을 3중으로 검증
2. **체결강도 변동성 필터**: 최고체결강도 - 최저체결강도로 변동성을 측정하여 과도한 변동성 종목 제외
3. **호가잔량 밸런스 분석**: 매도총잔량과 매수총잔량의 균형을 분석하여 건전한 거래 환경 확인
4. **누적지표 활용**: 누적초당매수수량과 누적초당매도수량으로 지속적인 매수세 검증
5. **시가총액 차등 전략**: 소형주/중형주/대형주별 맞춤 조건 적용

## 가이드라인

- 모든 조건식은 Python으로 작성되어 있으며, 주식 거래의 자동화를 목표로 합니다.
- 각 조건식은 특정 조건을 만족할 때 매수 또는 매도를 실행합니다.
- 최적화 조건식은 변수의 범위를 설정하여 최적의 매수/매도 시점을 찾습니다.
- 최적화 범위는 `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]` 형식으로 설정합니다.
- `self.vars[0]`은 고정값으로 설정되며, 조건식 변수는 `self.vars[1]`부터 공백 없이 사용됩니다.

### 변수·이름 규칙

1. **기본 규칙**:
   - `C`: Condition을 의미
   - `T`: Tick을 의미
   - `925_935`: 09:25:00 ~ 09:35:00 시간대
   - `AS`: Angle Strategy (각도 전략)
   - `B`: 매수 조건식
   - `S`: 매도 조건식
   - `BO`: 매수 최적화 조건식
   - `SO`: 매도 최적화 조건식
   - `BOR`: 매수 최적화 범위
   - `SOR`: 매도 최적화 범위
   - `OR`: 매수·매도 통합 최적화 범위
   - `GAR`: GA 최적화 범위

2. **예시**:
   - `C_T_925_935_AS_B`: 925_935 각도 전략 매수 조건식
   - `C_T_925_935_AS_S`: 925_935 각도 전략 매도 조건식
   - `C_T_925_935_AS_BO`: 925_935 각도 전략 매수 최적화 조건식
   - `C_T_925_935_AS_SO`: 925_935 각도 전략 매도 최적화 조건식

---

# Condition - Tick 925_935 Angle Strategy

## 조건식

### 매수 조건식 - C_T_925_935_AS_B

```python
# ================================
#  공통 계산 지표
# ================================
전일종가              = 현재가 / (1 + (등락율 / 100))                      # 단위: 원
시가등락율            = ((시가 - 전일종가) / 전일종가) * 100                # 단위: 퍼센트
시가대비등락율        = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트
초당순매수금액        = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000   # 단위: 백만원
체결강도변동성        = 최고체결강도(30) - 최저체결강도(30)                 # 30틱 체결강도 변동폭
매도총잔량금액        = 매도총잔량 * 현재가 / 100_000_000                  # 단위: 억원
매수총잔량금액        = 매수총잔량 * 현재가 / 100_000_000                  # 단위: 억원


# ================================
#  매수 조건
# ================================
매수 = True

# 1. 공통 필터
if not (관심종목 == 1):
    매수 = False
elif not (92500 <= 시분초 < 93500):                # 09:25:00 ~ 09:35:00
    매수 = False
elif not (1000 <= 현재가 <= 50000):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (초당거래대금 > 초당거래대금N(1)):          # 거래대금 증가 확인
    매수 = False


# 2. 시가총액별 차등 조건
elif 시가총액 < 1500:                               # 소형주 (< 1,500억)
    # 2-1. 각도 지표 복합 검증
    if not (4 < 등락율각도(30) < 70):                # 등락율 상승각도
        매수 = False
    elif not (등락율각도(30) > 전일비각도(30)):      # 등락율각도 > 전일비각도
        매수 = False
    elif not (당일거래대금각도(30) > 5):              # 거래대금 증가 각도
        매수 = False

    # 2-2. 체결강도 변동성 필터
    elif not (10 < 체결강도변동성 < 200):             # 적정 변동성 범위
        매수 = False
    elif not (50 <= 체결강도 <= 300):
        매수 = False
    elif not (체결강도 > 체결강도평균(30)):
        매수 = False

    # 2-3. 가격 위치 검증
    elif not (시가등락율 >= 0):                       # 시가 이상 등락
        매수 = False
    elif not (0.5 <= 시가대비등락율 < 12):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 0.20):  # 고가 대비 80% 이상
        매수 = False

    # 2-4. 호가잔량 밸런스 분석
    elif not (1 < 매도총잔량금액 < 10):                # 1억 ~ 10억
        매수 = False
    elif not (0.5 < 매수총잔량금액 < 15):              # 0.5억 ~ 15억
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * 3):            # 매수잔량 우위
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 2):            # 과도한 매수잔량 제외
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * 0.30):       # 초당매수 > 매도잔량 30%
        매수 = False

    # 2-5. 거래대금 및 비율 검증
    elif not (당일거래대금 > 10 * 100):                # 10억 이상
        매수 = False
    elif not (전일비 > 80):                            # 전일 대비 80% 이상
        매수 = False
    elif not (전일동시간비 > 100):                     # 전일 동시간 대비 100% 이상
        매수 = False
    elif not (회전율 > 1.5):
        매수 = False

    # 2-6. 초당거래대금 가속도 검증
    elif not (2.0 < 초당거래대금 / 초당거래대금평균(30) < 10):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < 1000 * 100_000_000):  # 과도한 급등 제외
        매수 = False

    # 2-7. 누적지표 검증 (지속성)
    elif not (누적초당매수수량(30) * 0.4 < 누적초당매도수량(30) < 누적초당매수수량(30) * 1.2):
        매수 = False
    elif not (최고초당매수수량(30) * 2 > 최고초당매도수량(30)):
        매수 = False

    # 2-8. 순매수금액 검증
    elif not (30 < 초당순매수금액 < 1000):             # 30백만원 ~ 1,000백만원
        매수 = False


elif 시가총액 < 2500:                               # 중형주 (1,500억 ~ 2,500억)
    # 2-1. 각도 지표 복합 검증 (소형주보다 보수적)
    if not (6 < 등락율각도(30) < 60):
        매수 = False
    elif not (등락율각도(30) > 전일비각도(30) * 1.1):  # 등락율각도가 전일비각도보다 10% 이상 높아야
        매수 = False
    elif not (당일거래대금각도(30) > 8):
        매수 = False

    # 2-2. 체결강도 변동성 필터
    elif not (15 < 체결강도변동성 < 180):
        매수 = False
    elif not (60 <= 체결강도 <= 280):
        매수 = False
    elif not (체결강도 > 체결강도평균(30) * 1.05):    # 평균 대비 5% 이상
        매수 = False

    # 2-3. 가격 위치 검증
    elif not (시가등락율 >= 0.5):                      # 시가 대비 0.5% 이상
        매수 = False
    elif not (1.0 <= 시가대비등락율 < 10):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 0.25):  # 고가 대비 75% 이상
        매수 = False

    # 2-4. 호가잔량 밸런스 분석
    elif not (2 < 매도총잔량금액 < 20):                # 2억 ~ 20억
        매수 = False
    elif not (1 < 매수총잔량금액 < 30):                # 1억 ~ 30억
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * 4):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 2):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * 0.25):
        매수 = False

    # 2-5. 거래대금 및 비율 검증
    elif not (당일거래대금 > 30 * 100):                # 30억 이상
        매수 = False
    elif not (전일비 > 60):
        매수 = False
    elif not (전일동시간비 > 80):
        매수 = False
    elif not (회전율 > 1.2):
        매수 = False

    # 2-6. 초당거래대금 가속도 검증
    elif not (1.8 < 초당거래대금 / 초당거래대금평균(30) < 8):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < 800 * 100_000_000):
        매수 = False

    # 2-7. 누적지표 검증
    elif not (누적초당매수수량(30) * 0.5 < 누적초당매도수량(30) < 누적초당매수수량(30) * 1.0):
        매수 = False
    elif not (최고초당매수수량(30) * 2.5 > 최고초당매도수량(30)):
        매수 = False

    # 2-8. 순매수금액 검증
    elif not (50 < 초당순매수금액 < 800):
        매수 = False


else:                                                # 대형주 (> 2,500억)
    # 2-1. 각도 지표 복합 검증 (가장 보수적)
    if not (8 < 등락율각도(30) < 50):
        매수 = False
    elif not (등락율각도(30) > 전일비각도(30) * 1.2):  # 등락율각도가 전일비각도보다 20% 이상 높아야
        매수 = False
    elif not (당일거래대금각도(30) > 10):
        매수 = False

    # 2-2. 체결강도 변동성 필터
    elif not (20 < 체결강도변동성 < 150):
        매수 = False
    elif not (70 <= 체결강도 <= 250):
        매수 = False
    elif not (체결강도 > 체결강도평균(30) * 1.1):     # 평균 대비 10% 이상
        매수 = False

    # 2-3. 가격 위치 검증
    elif not (시가등락율 >= 1.0):                      # 시가 대비 1% 이상
        매수 = False
    elif not (1.5 <= 시가대비등락율 < 8):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 0.30):  # 고가 대비 70% 이상
        매수 = False

    # 2-4. 호가잔량 밸런스 분석
    elif not (5 < 매도총잔량금액 < 50):                # 5억 ~ 50억
        매수 = False
    elif not (3 < 매수총잔량금액 < 60):                # 3억 ~ 60억
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * 5):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 3):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * 0.20):
        매수 = False

    # 2-5. 거래대금 및 비율 검증
    elif not (당일거래대금 > 100 * 100):               # 100억 이상
        매수 = False
    elif not (전일비 > 50):
        매수 = False
    elif not (전일동시간비 > 60):
        매수 = False
    elif not (회전율 > 0.8):
        매수 = False

    # 2-6. 초당거래대금 가속도 검증
    elif not (1.5 < 초당거래대금 / 초당거래대금평균(30) < 6):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < 600 * 100_000_000):
        매수 = False

    # 2-7. 누적지표 검증
    elif not (누적초당매수수량(30) * 0.6 < 누적초당매도수량(30) < 누적초당매수수량(30) * 0.9):
        매수 = False
    elif not (최고초당매수수량(30) * 3 > 최고초당매도수량(30)):
        매수 = False

    # 2-8. 순매수금액 검증
    elif not (80 < 초당순매수금액 < 600):
        매수 = False


# ================================
#  매수 호출
# ================================
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식 - C_T_925_935_AS_S

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율        = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트
체결강도변동성        = 최고체결강도(30) - 최저체결강도(30)                 # 30틱 체결강도 변동폭


# ================================
#  매도 조건
# ================================
매도 = False

# 1. 상한가 직전 익절
if 등락율 > 29.0:
    매도 = True

# 2. 기본 손절 (시가 대비 하락)
elif 시가대비등락율 < 0 and 수익률 <= -2.5:
    매도 = True

# 3. 보유시간 기반 손절
elif 보유시간 > 90 and 수익률 < 0:                      # 90초(1.5분) 보유 시 손실이면 청산
    매도 = True

# 4. Trailing Stop (최고수익률 기반)
elif 최고수익률 > 6.0 and 최고수익률 * 0.65 >= 수익률:  # 최고점 대비 65% 이하로 떨어지면
    매도 = True

# 5. 시가총액별 차등 매도 조건
elif 시가총액 < 1500:                                    # 소형주
    # 5-1. 각도 급락 감지
    if 등락율각도(30) < -15 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.4:
        매도 = True

    # 5-2. 각도 구간별 세밀 매도
    elif 15 <= 등락율각도(30) < 25:                      # 급등 후 조정
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.5 and (현재가 / 현재가N(1) - 1) * 100 < -0.6:
            매도 = True
    elif 5 <= 등락율각도(30) < 15:                       # 완만한 상승
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.7 and (현재가 / 현재가N(1) - 1) * 100 < -0.8:
            매도 = True
    elif -5 <= 등락율각도(30) < 5:                       # 횡보
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.6 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True

    # 5-3. 체결강도 급락
    elif 체결강도 < 체결강도평균(30) * 0.7 and 체결강도변동성 > 150:
        매도 = True

    # 5-4. 익절 (시간대별)
    elif 보유시간 < 60:                                  # 1분 이내
        if 수익률 >= 4.0:
            매도 = True
    elif 보유시간 < 180:                                 # 3분 이내
        if 수익률 >= 5.5:
            매도 = True
    else:                                                # 3분 이상
        if 수익률 >= 7.0:
            매도 = True


elif 시가총액 < 2500:                                    # 중형주
    # 5-1. 각도 급락 감지
    if 등락율각도(30) < -12 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.5:
        매도 = True

    # 5-2. 각도 구간별 세밀 매도
    elif 15 <= 등락율각도(30) < 25:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.6 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True
    elif 5 <= 등락율각도(30) < 15:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.8 and (현재가 / 현재가N(1) - 1) * 100 < -0.7:
            매도 = True
    elif -5 <= 등락율각도(30) < 5:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.7 and (현재가 / 현재가N(1) - 1) * 100 < -0.4:
            매도 = True

    # 5-3. 체결강도 급락
    elif 체결강도 < 체결강도평균(30) * 0.75 and 체결강도변동성 > 130:
        매도 = True

    # 5-4. 익절 (시간대별)
    elif 보유시간 < 60:
        if 수익률 >= 3.5:
            매도 = True
    elif 보유시간 < 180:
        if 수익률 >= 5.0:
            매도 = True
    else:
        if 수익률 >= 6.5:
            매도 = True


else:                                                    # 대형주
    # 5-1. 각도 급락 감지
    if 등락율각도(30) < -10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.6:
        매도 = True

    # 5-2. 각도 구간별 세밀 매도
    elif 15 <= 등락율각도(30) < 25:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.7 and (현재가 / 현재가N(1) - 1) * 100 < -0.4:
            매도 = True
    elif 5 <= 등락율각도(30) < 15:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.9 and (현재가 / 현재가N(1) - 1) * 100 < -0.6:
            매도 = True
    elif -5 <= 등락율각도(30) < 5:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * 0.8 and (현재가 / 현재가N(1) - 1) * 100 < -0.3:
            매도 = True

    # 5-3. 체결강도 급락
    elif 체결강도 < 체결강도평균(30) * 0.8 and 체결강도변동성 > 100:
        매도 = True

    # 5-4. 익절 (시간대별)
    elif 보유시간 < 60:
        if 수익률 >= 3.0:
            매도 = True
    elif 보유시간 < 180:
        if 수익률 >= 4.5:
            매도 = True
    else:
        if 수익률 >= 6.0:
            매도 = True


# ================================
#  매도 호출
# ================================
if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

## 최적화 조건식

### 매수 최적화 조건식 - C_T_925_935_AS_BO

```python
# ================================
#  공통 계산 지표
# ================================
전일종가              = 현재가 / (1 + (등락율 / 100))
시가등락율            = ((시가 - 전일종가) / 전일종가) * 100
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
초당순매수금액        = (초당매수수량 - 초당매도수량) * 현재가 / 1_000_000
체결강도변동성        = 최고체결강도(30) - 최저체결강도(30)
매도총잔량금액        = 매도총잔량 * 현재가 / 100_000_000
매수총잔량금액        = 매수총잔량 * 현재가 / 100_000_000

매수 = True

if not (관심종목 == 1):
    매수 = False
elif not (92500 <= 시분초 < 93500):
    매수 = False
elif not (1000 <= 현재가 <= 50000):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (초당거래대금 > 초당거래대금N(1)):
    매수 = False

elif 시가총액 < 1500:                               # 소형주
    if not (self.vars[1] < 등락율각도(30) < self.vars[2]):
        매수 = False
    elif not (등락율각도(30) > 전일비각도(30)):
        매수 = False
    elif not (당일거래대금각도(30) > self.vars[3]):
        매수 = False
    elif not (self.vars[4] < 체결강도변동성 < self.vars[5]):
        매수 = False
    elif not (self.vars[6] <= 체결강도 <= self.vars[7]):
        매수 = False
    elif not (체결강도 > 체결강도평균(30)):
        매수 = False
    elif not (시가등락율 >= self.vars[8]):
        매수 = False
    elif not (self.vars[9] <= 시가대비등락율 < self.vars[10]):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * self.vars[11]):
        매수 = False
    elif not (self.vars[12] < 매도총잔량금액 < self.vars[13]):
        매수 = False
    elif not (self.vars[14] < 매수총잔량금액 < self.vars[15]):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * self.vars[16]):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * self.vars[17]):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * self.vars[18]):
        매수 = False
    elif not (당일거래대금 > self.vars[19] * 100):
        매수 = False
    elif not (전일비 > self.vars[20]):
        매수 = False
    elif not (전일동시간비 > self.vars[21]):
        매수 = False
    elif not (회전율 > self.vars[22]):
        매수 = False
    elif not (self.vars[23] < 초당거래대금 / 초당거래대금평균(30) < self.vars[24]):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < self.vars[25] * 100_000_000):
        매수 = False
    elif not (누적초당매수수량(30) * self.vars[26] < 누적초당매도수량(30) < 누적초당매수수량(30) * self.vars[27]):
        매수 = False
    elif not (최고초당매수수량(30) * self.vars[28] > 최고초당매도수량(30)):
        매수 = False
    elif not (self.vars[29] < 초당순매수금액 < self.vars[30]):
        매수 = False

elif 시가총액 < 2500:                               # 중형주
    if not (self.vars[31] < 등락율각도(30) < self.vars[32]):
        매수 = False
    elif not (등락율각도(30) > 전일비각도(30) * self.vars[33]):
        매수 = False
    elif not (당일거래대금각도(30) > self.vars[34]):
        매수 = False
    elif not (self.vars[35] < 체결강도변동성 < self.vars[36]):
        매수 = False
    elif not (self.vars[37] <= 체결강도 <= self.vars[38]):
        매수 = False
    elif not (체결강도 > 체결강도평균(30) * self.vars[39]):
        매수 = False
    elif not (시가등락율 >= self.vars[40]):
        매수 = False
    elif not (self.vars[41] <= 시가대비등락율 < self.vars[42]):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * self.vars[43]):
        매수 = False
    elif not (self.vars[44] < 매도총잔량금액 < self.vars[45]):
        매수 = False
    elif not (self.vars[46] < 매수총잔량금액 < self.vars[47]):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * self.vars[48]):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * self.vars[49]):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * self.vars[50]):
        매수 = False
    elif not (당일거래대금 > self.vars[51] * 100):
        매수 = False
    elif not (전일비 > self.vars[52]):
        매수 = False
    elif not (전일동시간비 > self.vars[53]):
        매수 = False
    elif not (회전율 > self.vars[54]):
        매수 = False
    elif not (self.vars[55] < 초당거래대금 / 초당거래대금평균(30) < self.vars[56]):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < self.vars[57] * 100_000_000):
        매수 = False
    elif not (누적초당매수수량(30) * self.vars[58] < 누적초당매도수량(30) < 누적초당매수수량(30) * self.vars[59]):
        매수 = False
    elif not (최고초당매수수량(30) * self.vars[60] > 최고초당매도수량(30)):
        매수 = False
    elif not (self.vars[61] < 초당순매수금액 < self.vars[62]):
        매수 = False

else:                                                # 대형주
    if not (self.vars[63] < 등락율각도(30) < self.vars[64]):
        매수 = False
    elif not (등락율각도(30) > 전일비각도(30) * self.vars[65]):
        매수 = False
    elif not (당일거래대금각도(30) > self.vars[66]):
        매수 = False
    elif not (self.vars[67] < 체결강도변동성 < self.vars[68]):
        매수 = False
    elif not (self.vars[69] <= 체결강도 <= self.vars[70]):
        매수 = False
    elif not (체결강도 > 체결강도평균(30) * self.vars[71]):
        매수 = False
    elif not (시가등락율 >= self.vars[72]):
        매수 = False
    elif not (self.vars[73] <= 시가대비등락율 < self.vars[74]):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * self.vars[75]):
        매수 = False
    elif not (self.vars[76] < 매도총잔량금액 < self.vars[77]):
        매수 = False
    elif not (self.vars[78] < 매수총잔량금액 < self.vars[79]):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * self.vars[80]):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * self.vars[81]):
        매수 = False
    elif not (초당매수수량 > 매도총잔량 * self.vars[82]):
        매수 = False
    elif not (당일거래대금 > self.vars[83] * 100):
        매수 = False
    elif not (전일비 > self.vars[84]):
        매수 = False
    elif not (전일동시간비 > self.vars[85]):
        매수 = False
    elif not (회전율 > self.vars[86]):
        매수 = False
    elif not (self.vars[87] < 초당거래대금 / 초당거래대금평균(30) < self.vars[88]):
        매수 = False
    elif not (초당거래대금 - 초당거래대금평균(30) < self.vars[89] * 100_000_000):
        매수 = False
    elif not (누적초당매수수량(30) * self.vars[90] < 누적초당매도수량(30) < 누적초당매수수량(30) * self.vars[91]):
        매수 = False
    elif not (최고초당매수수량(30) * self.vars[92] > 최고초당매도수량(30)):
        매수 = False
    elif not (self.vars[93] < 초당순매수금액 < self.vars[94]):
        매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위 - C_T_925_935_AS_BOR

```python
# ================================
#  소형주 변수 (< 1,500억)
# ================================
self.vars[1]  = [[2, 6, 1], 4]                          # 등락율각도 하한, 범위 갯수: 5
self.vars[2]  = [[60, 80, 5], 70]                       # 등락율각도 상한, 범위 갯수: 5
self.vars[3]  = [[3, 8, 1], 5]                          # 당일거래대금각도 하한, 범위 갯수: 6
self.vars[4]  = [[5, 15, 2], 10]                        # 체결강도변동성 하한, 범위 갯수: 6
self.vars[5]  = [[180, 220, 10], 200]                   # 체결강도변동성 상한, 범위 갯수: 5
self.vars[6]  = [[40, 60, 5], 50]                       # 체결강도 하한, 범위 갯수: 5
self.vars[7]  = [[280, 320, 10], 300]                   # 체결강도 상한, 범위 갯수: 5
self.vars[8]  = [[-0.5, 1.0, 0.5], 0]                   # 시가등락율 하한, 범위 갯수: 4
self.vars[9]  = [[0.3, 0.8, 0.1], 0.5]                  # 시가대비등락율 하한, 범위 갯수: 6
self.vars[10] = [[10, 15, 1], 12]                       # 시가대비등락율 상한, 범위 갯수: 6
self.vars[11] = [[0.15, 0.25, 0.05], 0.20]              # 고가 대비 위치, 범위 갯수: 3
self.vars[12] = [[0.5, 2.0, 0.5], 1]                    # 매도총잔량금액 하한 (억), 범위 갯수: 4
self.vars[13] = [[8, 12, 1], 10]                        # 매도총잔량금액 상한 (억), 범위 갯수: 5
self.vars[14] = [[0.3, 0.8, 0.1], 0.5]                  # 매수총잔량금액 하한 (억), 범위 갯수: 6
self.vars[15] = [[12, 18, 2], 15]                       # 매수총잔량금액 상한 (억), 범위 갯수: 4
self.vars[16] = [[2.5, 3.5, 0.5], 3]                    # 매도총잔량 상한 배수, 범위 갯수: 3
self.vars[17] = [[1.5, 2.5, 0.5], 2]                    # 매수총잔량 상한 배수, 범위 갯수: 3
self.vars[18] = [[0.25, 0.35, 0.05], 0.30]              # 초당매수수량 비율, 범위 갯수: 3
self.vars[19] = [[5, 15, 2], 10]                        # 당일거래대금 하한 (억), 범위 갯수: 6
self.vars[20] = [[60, 100, 10], 80]                     # 전일비 하한, 범위 갯수: 5
self.vars[21] = [[80, 120, 10], 100]                    # 전일동시간비 하한, 범위 갯수: 5
self.vars[22] = [[1.0, 2.0, 0.25], 1.5]                 # 회전율 하한, 범위 갯수: 5
self.vars[23] = [[1.5, 2.5, 0.25], 2.0]                 # 초당거래대금 비율 하한, 범위 갯수: 5
self.vars[24] = [[8, 12, 1], 10]                        # 초당거래대금 비율 상한, 범위 갯수: 5
self.vars[25] = [[800, 1200, 100], 1000]                # 초당거래대금 차이 상한, 범위 갯수: 5
self.vars[26] = [[0.3, 0.5, 0.05], 0.4]                 # 누적초당매수수량 하한 비율, 범위 갯수: 5
self.vars[27] = [[1.0, 1.4, 0.1], 1.2]                  # 누적초당매수수량 상한 비율, 범위 갯수: 5
self.vars[28] = [[1.5, 2.5, 0.25], 2]                   # 최고초당매수수량 배수, 범위 갯수: 5
self.vars[29] = [[20, 40, 5], 30]                       # 초당순매수금액 하한 (백만), 범위 갯수: 5
self.vars[30] = [[800, 1200, 100], 1000]                # 초당순매수금액 상한 (백만), 범위 갯수: 5

# ================================
#  중형주 변수 (1,500억 ~ 2,500억)
# ================================
self.vars[31] = [[4, 8, 1], 6]                          # 등락율각도 하한, 범위 갯수: 5
self.vars[32] = [[50, 70, 5], 60]                       # 등락율각도 상한, 범위 갯수: 5
self.vars[33] = [[1.05, 1.15, 0.05], 1.1]               # 등락율각도 전일비각도 배수, 범위 갯수: 3
self.vars[34] = [[6, 10, 1], 8]                         # 당일거래대금각도 하한, 범위 갯수: 5
self.vars[35] = [[10, 20, 2], 15]                       # 체결강도변동성 하한, 범위 갯수: 6
self.vars[36] = [[160, 200, 10], 180]                   # 체결강도변동성 상한, 범위 갯수: 5
self.vars[37] = [[50, 70, 5], 60]                       # 체결강도 하한, 범위 갯수: 5
self.vars[38] = [[260, 300, 10], 280]                   # 체결강도 상한, 범위 갯수: 5
self.vars[39] = [[1.0, 1.1, 0.05], 1.05]                # 체결강도 평균 배수, 범위 갯수: 3
self.vars[40] = [[0.3, 0.7, 0.2], 0.5]                  # 시가등락율 하한, 범위 갯수: 3
self.vars[41] = [[0.8, 1.2, 0.1], 1.0]                  # 시가대비등락율 하한, 범위 갯수: 5
self.vars[42] = [[9, 11, 0.5], 10]                      # 시가대비등락율 상한, 범위 갯수: 5
self.vars[43] = [[0.20, 0.30, 0.05], 0.25]              # 고가 대비 위치, 범위 갯수: 3
self.vars[44] = [[1.5, 2.5, 0.5], 2]                    # 매도총잔량금액 하한 (억), 범위 갯수: 3
self.vars[45] = [[18, 22, 2], 20]                       # 매도총잔량금액 상한 (억), 범위 갯수: 3
self.vars[46] = [[0.8, 1.2, 0.2], 1]                    # 매수총잔량금액 하한 (억), 범위 갯수: 3
self.vars[47] = [[28, 32, 2], 30]                       # 매수총잔량금액 상한 (억), 범위 갯수: 3
self.vars[48] = [[3.5, 4.5, 0.5], 4]                    # 매도총잔량 상한 배수, 범위 갯수: 3
self.vars[49] = [[1.5, 2.5, 0.5], 2]                    # 매수총잔량 상한 배수, 범위 갯수: 3
self.vars[50] = [[0.20, 0.30, 0.05], 0.25]              # 초당매수수량 비율, 범위 갯수: 3
self.vars[51] = [[25, 35, 5], 30]                       # 당일거래대금 하한 (억), 범위 갯수: 3
self.vars[52] = [[50, 70, 10], 60]                      # 전일비 하한, 범위 갯수: 3
self.vars[53] = [[70, 90, 10], 80]                      # 전일동시간비 하한, 범위 갯수: 3
self.vars[54] = [[1.0, 1.4, 0.2], 1.2]                  # 회전율 하한, 범위 갯수: 3
self.vars[55] = [[1.5, 2.0, 0.25], 1.8]                 # 초당거래대금 비율 하한, 범위 갯수: 3
self.vars[56] = [[7, 9, 1], 8]                          # 초당거래대금 비율 상한, 범위 갯수: 3
self.vars[57] = [[700, 900, 100], 800]                  # 초당거래대금 차이 상한, 범위 갯수: 3
self.vars[58] = [[0.4, 0.6, 0.1], 0.5]                  # 누적초당매수수량 하한 비율, 범위 갯수: 3
self.vars[59] = [[0.9, 1.1, 0.1], 1.0]                  # 누적초당매수수량 상한 비율, 범위 갯수: 3
self.vars[60] = [[2.0, 3.0, 0.5], 2.5]                  # 최고초당매수수량 배수, 범위 갯수: 3
self.vars[61] = [[40, 60, 10], 50]                      # 초당순매수금액 하한 (백만), 범위 갯수: 3
self.vars[62] = [[700, 900, 100], 800]                  # 초당순매수금액 상한 (백만), 범위 갯수: 3

# ================================
#  대형주 변수 (> 2,500억)
# ================================
self.vars[63] = [[6, 10, 1], 8]                         # 등락율각도 하한, 범위 갯수: 5
self.vars[64] = [[45, 55, 2], 50]                       # 등락율각도 상한, 범위 갯수: 6
self.vars[65] = [[1.15, 1.25, 0.05], 1.2]               # 등락율각도 전일비각도 배수, 범위 갯수: 3
self.vars[66] = [[8, 12, 1], 10]                        # 당일거래대금각도 하한, 범위 갯수: 5
self.vars[67] = [[15, 25, 2], 20]                       # 체결강도변동성 하한, 범위 갯수: 6
self.vars[68] = [[140, 160, 5], 150]                    # 체결강도변동성 상한, 범위 갯수: 5
self.vars[69] = [[60, 80, 5], 70]                       # 체결강도 하한, 범위 갯수: 5
self.vars[70] = [[240, 260, 5], 250]                    # 체결강도 상한, 범위 갯수: 5
self.vars[71] = [[1.05, 1.15, 0.05], 1.1]               # 체결강도 평균 배수, 범위 갯수: 3
self.vars[72] = [[0.8, 1.2, 0.2], 1.0]                  # 시가등락율 하한, 범위 갯수: 3
self.vars[73] = [[1.3, 1.7, 0.2], 1.5]                  # 시가대비등락율 하한, 범위 갯수: 3
self.vars[74] = [[7, 9, 0.5], 8]                        # 시가대비등락율 상한, 범위 갯수: 5
self.vars[75] = [[0.25, 0.35, 0.05], 0.30]              # 고가 대비 위치, 범위 갯수: 3
self.vars[76] = [[4, 6, 1], 5]                          # 매도총잔량금액 하한 (억), 범위 갯수: 3
self.vars[77] = [[45, 55, 5], 50]                       # 매도총잔량금액 상한 (억), 범위 갯수: 3
self.vars[78] = [[2.5, 3.5, 0.5], 3]                    # 매수총잔량금액 하한 (억), 범위 갯수: 3
self.vars[79] = [[55, 65, 5], 60]                       # 매수총잔량금액 상한 (억), 범위 갯수: 3
self.vars[80] = [[4.5, 5.5, 0.5], 5]                    # 매도총잔량 상한 배수, 범위 갯수: 3
self.vars[81] = [[2.5, 3.5, 0.5], 3]                    # 매수총잔량 상한 배수, 범위 갯수: 3
self.vars[82] = [[0.15, 0.25, 0.05], 0.20]              # 초당매수수량 비율, 범위 갯수: 3
self.vars[83] = [[90, 110, 10], 100]                    # 당일거래대금 하한 (억), 범위 갯수: 3
self.vars[84] = [[45, 55, 5], 50]                       # 전일비 하한, 범위 갯수: 3
self.vars[85] = [[55, 65, 5], 60]                       # 전일동시간비 하한, 범위 갯수: 3
self.vars[86] = [[0.7, 0.9, 0.1], 0.8]                  # 회전율 하한, 범위 갯수: 3
self.vars[87] = [[1.3, 1.7, 0.2], 1.5]                  # 초당거래대금 비율 하한, 범위 갯수: 3
self.vars[88] = [[5.5, 6.5, 0.5], 6]                    # 초당거래대금 비율 상한, 범위 갯수: 3
self.vars[89] = [[550, 650, 50], 600]                   # 초당거래대금 차이 상한, 범위 갯수: 3
self.vars[90] = [[0.55, 0.65, 0.05], 0.6]               # 누적초당매수수량 하한 비율, 범위 갯수: 3
self.vars[91] = [[0.85, 0.95, 0.05], 0.9]               # 누적초당매수수량 상한 비율, 범위 갯수: 3
self.vars[92] = [[2.5, 3.5, 0.5], 3]                    # 최고초당매수수량 배수, 범위 갯수: 3
self.vars[93] = [[70, 90, 10], 80]                      # 초당순매수금액 하한 (백만), 범위 갯수: 3
self.vars[94] = [[550, 650, 50], 600]                   # 초당순매수금액 상한 (백만), 범위 갯수: 3

# 매수 총 경우의 수 (근사치):
# 소형주: 5×5×6×6×5×5×5×4×6×6×3×4×5×6×4×3×3×3×6×5×5×5×5×5×5×5×5×5×5×5 ≈ 수십억
# 중형주: 5×5×3×5×6×5×5×5×3×3×5×5×3×3×3×3×3×3×3×3×3×3×3×3×3×3×3×3×3 ≈ 수억
# 대형주: 5×6×3×5×6×5×5×5×3×3×3×5×3×3×3×3×3×3×3×3×3×3×3×3×3×3×3×3 ≈ 수억
```

### 매도 최적화 조건식 - C_T_925_935_AS_SO

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
체결강도변동성        = 최고체결강도(30) - 최저체결강도(30)

매도 = False

if 등락율 > self.vars[95]:
    매도 = True
elif 시가대비등락율 < 0 and 수익률 <= self.vars[96]:
    매도 = True
elif 보유시간 > self.vars[97] and 수익률 < 0:
    매도 = True
elif 최고수익률 > self.vars[98] and 최고수익률 * self.vars[99] >= 수익률:
    매도 = True

elif 시가총액 < 1500:
    if 등락율각도(30) < self.vars[100] and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[101]:
        매도 = True
    elif 15 <= 등락율각도(30) < 25:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[102] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[103]:
            매도 = True
    elif 5 <= 등락율각도(30) < 15:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[104] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[105]:
            매도 = True
    elif -5 <= 등락율각도(30) < 5:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[106] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[107]:
            매도 = True
    elif 체결강도 < 체결강도평균(30) * self.vars[108] and 체결강도변동성 > self.vars[109]:
        매도 = True
    elif 보유시간 < 60:
        if 수익률 >= self.vars[110]:
            매도 = True
    elif 보유시간 < 180:
        if 수익률 >= self.vars[111]:
            매도 = True
    else:
        if 수익률 >= self.vars[112]:
            매도 = True

elif 시가총액 < 2500:
    if 등락율각도(30) < self.vars[113] and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[114]:
        매도 = True
    elif 15 <= 등락율각도(30) < 25:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[115] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[116]:
            매도 = True
    elif 5 <= 등락율각도(30) < 15:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[117] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[118]:
            매도 = True
    elif -5 <= 등락율각도(30) < 5:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[119] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[120]:
            매도 = True
    elif 체결강도 < 체결강도평균(30) * self.vars[121] and 체결강도변동성 > self.vars[122]:
        매도 = True
    elif 보유시간 < 60:
        if 수익률 >= self.vars[123]:
            매도 = True
    elif 보유시간 < 180:
        if 수익률 >= self.vars[124]:
            매도 = True
    else:
        if 수익률 >= self.vars[125]:
            매도 = True

else:
    if 등락율각도(30) < self.vars[126] and (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[127]:
        매도 = True
    elif 15 <= 등락율각도(30) < 25:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[128] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[129]:
            매도 = True
    elif 5 <= 등락율각도(30) < 15:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[130] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[131]:
            매도 = True
    elif -5 <= 등락율각도(30) < 5:
        if (초당매도수량 - 초당매수수량) >= 매수총잔량 * self.vars[132] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[133]:
            매도 = True
    elif 체결강도 < 체결강도평균(30) * self.vars[134] and 체결강도변동성 > self.vars[135]:
        매도 = True
    elif 보유시간 < 60:
        if 수익률 >= self.vars[136]:
            매도 = True
    elif 보유시간 < 180:
        if 수익률 >= self.vars[137]:
            매도 = True
    else:
        if 수익률 >= self.vars[138]:
            매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

### 매도 최적화 범위 - C_T_925_935_AS_SOR

```python
# ================================
#  공통 매도 변수
# ================================
self.vars[95]  = [[28.5, 29.5, 0.5], 29.0]              # 등락율 상한, 범위 갯수: 3
self.vars[96]  = [[-3.0, -2.0, 0.5], -2.5]              # 손절 수익률, 범위 갯수: 3
self.vars[97]  = [[60, 120, 30], 90]                    # 보유시간 손절 (초), 범위 갯수: 3
self.vars[98]  = [[5.5, 6.5, 0.5], 6.0]                 # Trailing Stop 기준 최고수익률, 범위 갯수: 3
self.vars[99]  = [[0.60, 0.70, 0.05], 0.65]             # Trailing Stop 비율, 범위 갯수: 3

# ================================
#  소형주 매도 변수
# ================================
self.vars[100] = [[-18, -12, 3], -15]                   # 등락율각도 급락 기준, 범위 갯수: 3
self.vars[101] = [[0.35, 0.45, 0.05], 0.4]              # 급락 시 매도수량 비율, 범위 갯수: 3
self.vars[102] = [[0.45, 0.55, 0.05], 0.5]              # 15~25도 매도수량 비율, 범위 갯수: 3
self.vars[103] = [[-0.7, -0.5, 0.1], -0.6]              # 15~25도 가격 변화율, 범위 갯수: 3
self.vars[104] = [[0.65, 0.75, 0.05], 0.7]              # 5~15도 매도수량 비율, 범위 갯수: 3
self.vars[105] = [[-0.9, -0.7, 0.1], -0.8]              # 5~15도 가격 변화율, 범위 갯수: 3
self.vars[106] = [[0.55, 0.65, 0.05], 0.6]              # -5~5도 매도수량 비율, 범위 갯수: 3
self.vars[107] = [[-0.6, -0.4, 0.1], -0.5]              # -5~5도 가격 변화율, 범위 갯수: 3
self.vars[108] = [[0.65, 0.75, 0.05], 0.7]              # 체결강도 평균 비율, 범위 갯수: 3
self.vars[109] = [[140, 160, 10], 150]                  # 체결강도변동성 기준, 범위 갯수: 3
self.vars[110] = [[3.5, 4.5, 0.5], 4.0]                 # 1분 이내 익절, 범위 갯수: 3
self.vars[111] = [[5.0, 6.0, 0.5], 5.5]                 # 3분 이내 익절, 범위 갯수: 3
self.vars[112] = [[6.5, 7.5, 0.5], 7.0]                 # 3분 이상 익절, 범위 갯수: 3

# ================================
#  중형주 매도 변수
# ================================
self.vars[113] = [[-15, -9, 3], -12]                    # 등락율각도 급락 기준, 범위 갯수: 3
self.vars[114] = [[0.45, 0.55, 0.05], 0.5]              # 급락 시 매도수량 비율, 범위 갯수: 3
self.vars[115] = [[0.55, 0.65, 0.05], 0.6]              # 15~25도 매도수량 비율, 범위 갯수: 3
self.vars[116] = [[-0.6, -0.4, 0.1], -0.5]              # 15~25도 가격 변화율, 범위 갯수: 3
self.vars[117] = [[0.75, 0.85, 0.05], 0.8]              # 5~15도 매도수량 비율, 범위 갯수: 3
self.vars[118] = [[-0.8, -0.6, 0.1], -0.7]              # 5~15도 가격 변화율, 범위 갯수: 3
self.vars[119] = [[0.65, 0.75, 0.05], 0.7]              # -5~5도 매도수량 비율, 범위 갯수: 3
self.vars[120] = [[-0.5, -0.3, 0.1], -0.4]              # -5~5도 가격 변화율, 범위 갯수: 3
self.vars[121] = [[0.70, 0.80, 0.05], 0.75]             # 체결강도 평균 비율, 범위 갯수: 3
self.vars[122] = [[120, 140, 10], 130]                  # 체결강도변동성 기준, 범위 갯수: 3
self.vars[123] = [[3.0, 4.0, 0.5], 3.5]                 # 1분 이내 익절, 범위 갯수: 3
self.vars[124] = [[4.5, 5.5, 0.5], 5.0]                 # 3분 이내 익절, 범위 갯수: 3
self.vars[125] = [[6.0, 7.0, 0.5], 6.5]                 # 3분 이상 익절, 범위 갯수: 3

# ================================
#  대형주 매도 변수
# ================================
self.vars[126] = [[-12, -8, 2], -10]                    # 등락율각도 급락 기준, 범위 갯수: 3
self.vars[127] = [[0.55, 0.65, 0.05], 0.6]              # 급락 시 매도수량 비율, 범위 갯수: 3
self.vars[128] = [[0.65, 0.75, 0.05], 0.7]              # 15~25도 매도수량 비율, 범위 갯수: 3
self.vars[129] = [[-0.5, -0.3, 0.1], -0.4]              # 15~25도 가격 변화율, 범위 갯수: 3
self.vars[130] = [[0.85, 0.95, 0.05], 0.9]              # 5~15도 매도수량 비율, 범위 갯수: 3
self.vars[131] = [[-0.7, -0.5, 0.1], -0.6]              # 5~15도 가격 변화율, 범위 갯수: 3
self.vars[132] = [[0.75, 0.85, 0.05], 0.8]              # -5~5도 매도수량 비율, 범위 갯수: 3
self.vars[133] = [[-0.4, -0.2, 0.1], -0.3]              # -5~5도 가격 변화율, 범위 갯수: 3
self.vars[134] = [[0.75, 0.85, 0.05], 0.8]              # 체결강도 평균 비율, 범위 갯수: 3
self.vars[135] = [[95, 105, 5], 100]                    # 체결강도변동성 기준, 범위 갯수: 3
self.vars[136] = [[2.8, 3.2, 0.2], 3.0]                 # 1분 이내 익절, 범위 갯수: 3
self.vars[137] = [[4.3, 4.7, 0.2], 4.5]                 # 3분 이내 익절, 범위 갯수: 3
self.vars[138] = [[5.8, 6.2, 0.2], 6.0]                 # 3분 이상 익절, 범위 갯수: 3

# 매도 총 경우의 수: 3×3×3×3×3 × (3×3×3×3×3×3×3×3×3×3×3×3×3) × 3개 티어 ≈ 수억
```

### 매수·매도 통합 최적화 범위 - C_T_925_935_AS_OR

```python
# 평균 틱수 고정값
self.vars[0] = [[30], 30]                               # 평균 틱수 고정값, 범위 갯수: 1

# 소형주 핵심 변수 (10개 선택)
self.vars[1]  = [[2, 6, 1], 4]                          # 등락율각도 하한
self.vars[2]  = [[60, 80, 5], 70]                       # 등락율각도 상한
self.vars[3]  = [[3, 8, 1], 5]                          # 당일거래대금각도 하한
self.vars[6]  = [[40, 60, 5], 50]                       # 체결강도 하한
self.vars[9]  = [[0.3, 0.8, 0.1], 0.5]                  # 시가대비등락율 하한
self.vars[18] = [[0.25, 0.35, 0.05], 0.30]              # 초당매수수량 비율
self.vars[22] = [[1.0, 2.0, 0.25], 1.5]                 # 회전율 하한
self.vars[23] = [[1.5, 2.5, 0.25], 2.0]                 # 초당거래대금 비율 하한
self.vars[29] = [[20, 40, 5], 30]                       # 초당순매수금액 하한
self.vars[30] = [[800, 1200, 100], 1000]                # 초당순매수금액 상한

# 공통 매도 변수 (5개)
self.vars[95]  = [[28.5, 29.5, 0.5], 29.0]              # 등락율 상한
self.vars[96]  = [[-3.0, -2.0, 0.5], -2.5]              # 손절 수익률
self.vars[98]  = [[5.5, 6.5, 0.5], 6.0]                 # Trailing Stop 기준
self.vars[99]  = [[0.60, 0.70, 0.05], 0.65]             # Trailing Stop 비율
self.vars[110] = [[3.5, 4.5, 0.5], 4.0]                 # 소형주 1분 익절

# 통합 핵심 변수 인덱스
OR_INDEX = [1, 2, 3, 6, 9, 18, 22, 23, 29, 30, 95, 96, 98, 99, 110]

# 통합 총 경우의 수: 5×5×6×5×6×3×5×5×5×5 × 3×3×3×3×3 ≈ 150만
```

### 예상 시간 계산

각 변수의 범위 개수를 곱하여 모든 경우의 수를 계산합니다.

- **매수 조건 변수 범위** (소형주 기준):
  - 5×5×6×6×5×5×5×4×6×6×3×4×5×6×4×3×3×3×6×5×5×5×5×5×5×5×5×5×5×5 ≈ 수십억

- **매도 조건 변수 범위**:
  - 공통: 3×3×3×3×3 = 243
  - 소형주: 3×3×3×3×3×3×3×3×3×3×3×3×3 = 1,594,323
  - 총 매도: 243 × 1,594,323 ≈ 387,432

- **총 경우의 수** (소형주만):
  - 수십억 × 387,432 ≈ 수조 이상

각 경우에 1분이 걸린다고 가정하면:
- **비현실적인 시간**: 수만 년 이상

**가정**: 각 경우의 수를 처리하는 데 1분이 소요된다고 가정하였습니다. 이는 비현실적인 시간이므로, **계층적 최적화 전략** 또는 **GA 최적화**를 사용해야 합니다.

### GA 최적화 범위 - C_T_925_935_AS_GAR

```python
# 평균 틱수 고정값
self.vars[0] = [[30], 30]                                                      # 평균 틱수 고정값, 범위 갯수: 1

# ================================
#  소형주 GA 범위 (핵심 변수 20개)
# ================================
self.vars[1]  = [[2, 3, 4, 5, 6], 4]                                           # 등락율각도 하한, 범위 갯수: 5
self.vars[2]  = [[60, 65, 70, 75, 80], 70]                                     # 등락율각도 상한, 범위 갯수: 5
self.vars[3]  = [[3, 4, 5, 6, 7, 8], 5]                                        # 당일거래대금각도 하한, 범위 갯수: 6
self.vars[4]  = [[5, 7, 10, 12, 15], 10]                                       # 체결강도변동성 하한, 범위 갯수: 5
self.vars[5]  = [[180, 190, 200, 210, 220], 200]                               # 체결강도변동성 상한, 범위 갯수: 5
self.vars[6]  = [[40, 45, 50, 55, 60], 50]                                     # 체결강도 하한, 범위 갯수: 5
self.vars[7]  = [[280, 290, 300, 310, 320], 300]                               # 체결강도 상한, 범위 갯수: 5
self.vars[8]  = [[-0.5, 0, 0.5, 1.0], 0]                                       # 시가등락율 하한, 범위 갯수: 4
self.vars[9]  = [[0.3, 0.4, 0.5, 0.6, 0.7, 0.8], 0.5]                          # 시가대비등락율 하한, 범위 갯수: 6
self.vars[10] = [[10, 11, 12, 13, 14, 15], 12]                                 # 시가대비등락율 상한, 범위 갯수: 6
self.vars[11] = [[0.15, 0.20, 0.25], 0.20]                                     # 고가 대비 위치, 범위 갯수: 3
self.vars[18] = [[0.25, 0.30, 0.35], 0.30]                                     # 초당매수수량 비율, 범위 갯수: 3
self.vars[19] = [[5, 7, 10, 12, 15], 10]                                       # 당일거래대금 하한 (억), 범위 갯수: 5
self.vars[20] = [[60, 70, 80, 90, 100], 80]                                    # 전일비 하한, 범위 갯수: 5
self.vars[21] = [[80, 90, 100, 110, 120], 100]                                 # 전일동시간비 하한, 범위 갯수: 5
self.vars[22] = [[1.0, 1.25, 1.5, 1.75, 2.0], 1.5]                             # 회전율 하한, 범위 갯수: 5
self.vars[23] = [[1.5, 1.75, 2.0, 2.25, 2.5], 2.0]                             # 초당거래대금 비율 하한, 범위 갯수: 5
self.vars[24] = [[8, 9, 10, 11, 12], 10]                                       # 초당거래대금 비율 상한, 범위 갯수: 5
self.vars[29] = [[20, 25, 30, 35, 40], 30]                                     # 초당순매수금액 하한 (백만), 범위 갯수: 5
self.vars[30] = [[800, 900, 1000, 1100, 1200], 1000]                           # 초당순매수금액 상한 (백만), 범위 갯수: 5

# ================================
#  공통 매도 GA 범위 (핵심 변수 10개)
# ================================
self.vars[95]  = [[28.5, 29.0, 29.5], 29.0]                                    # 등락율 상한, 범위 갯수: 3
self.vars[96]  = [[-3.0, -2.5, -2.0], -2.5]                                    # 손절 수익률, 범위 갯수: 3
self.vars[97]  = [[60, 90, 120], 90]                                           # 보유시간 손절 (초), 범위 갯수: 3
self.vars[98]  = [[5.5, 6.0, 6.5], 6.0]                                        # Trailing Stop 기준, 범위 갯수: 3
self.vars[99]  = [[0.60, 0.65, 0.70], 0.65]                                    # Trailing Stop 비율, 범위 갯수: 3
self.vars[100] = [[-18, -15, -12], -15]                                        # 소형주 급락 각도, 범위 갯수: 3
self.vars[102] = [[0.45, 0.50, 0.55], 0.5]                                     # 소형주 15~25도 매도비율, 범위 갯수: 3
self.vars[108] = [[0.65, 0.70, 0.75], 0.7]                                     # 소형주 체결강도 비율, 범위 갯수: 3
self.vars[110] = [[3.5, 4.0, 4.5], 4.0]                                        # 소형주 1분 익절, 범위 갯수: 3
self.vars[111] = [[5.0, 5.5, 6.0], 5.5]                                        # 소형주 3분 익절, 범위 갯수: 3

# GA 총 경우의 수 (소형주 핵심변수): 5×5×6×5×5×5×5×4×6×6×3×3×5×5×5×5×5×5×5×5 × 3×3×3×3×3×3×3×3×3×3 ≈ 수백억
# 실제 GA는 전체 탐색이 아닌 진화 알고리즘이므로 훨씬 빠름
```

## 조건식 개선 방향 연구

### 1. 추가 각도 지표 활용 연구

#### 1.1 체결강도각도 추가
```python
체결강도각도 = (체결강도 - 체결강도N(30)) / 30 * 100  # 사용자 정의 계산
```
- **활용 방안**: 체결강도의 변화 추세를 각도로 표현
- **적용 예시**: `체결강도각도(30) > 5` → 체결강도 상승 추세
- **최적화 범위**: `[[3, 10, 1], 5]`

#### 1.2 호가잔량각도
```python
호가잔량각도 = (매수총잔량 - 매도총잔량) / (매수총잔량 + 매도총잔량) * 100
```
- **활용 방안**: 호가잔량 불균형을 각도 형태로 표현
- **적용 예시**: `호가잔량각도 > 20` → 매수우위
- **최적화 범위**: `[[15, 30, 5], 20]`

### 2. TA-Lib 보조지표 활용 연구

#### 2.1 RSI 과매수/과매도 필터
```python
if not (30 < RSI < 70):
    매수 = False
```
- **활용 방안**: 과매수/과매도 구간 진입 방지
- **적용 전략**: 공통 필터로 추가
- **최적화 범위**: RSI 하한 `[[25, 35, 5], 30]`, RSI 상한 `[[65, 75, 5], 70]`

#### 2.2 MACD 골든크로스
```python
if not (MACD > MACDS and MACDN(1) <= MACDSN(1)):
    매수 = False
```
- **활용 방안**: MACD 골든크로스 진입 확인
- **최적화 범위**: MACD 차이값 `[[-5, 5, 1], 0]`

### 3. 구간 연산 변수 심화 활용

#### 3.1 이동평균 돌파 확인
```python
if not (현재가 > 이동평균(30) and 현재가N(1) <= 이동평균(30, 1)):
    매수 = False
```
- **활용 방안**: 이동평균선 돌파 시점 포착
- **최적화 범위**: 이동평균 기간 `[[20, 60, 10], 30]`

#### 3.2 체결강도 패턴 분석
```python
체결강도상승패턴 = (체결강도 > 체결강도평균(30) and
                  체결강도평균(10) > 체결강도평균(30))
```
- **활용 방안**: 단기/장기 체결강도 상승 패턴 확인

### 4. 매도 조건 고도화 연구

#### 4.1 동적 손절 (변동성 기반)
```python
if 체결강도변동성 > 150:
    손절기준 = -3.5  # 변동성 높을 때 손절폭 확대
else:
    손절기준 = -2.5  # 정상 손절
```

#### 4.2 시간대별 익절 목표 세분화
```python
# 09:25~09:30: 빠른 익절
if 시분초 < 93000:
    if 보유시간 < 30 and 수익률 >= 3.0:
        매도 = True
# 09:30~09:35: 여유 있는 익절
else:
    if 보유시간 < 60 and 수익률 >= 5.0:
        매도 = True
```

### 5. 복합 지표 조합 연구

#### 5.1 각도 종합 지수
```python
각도종합지수 = (
    등락율각도(30) * 0.4 +
    전일비각도(30) * 0.3 +
    당일거래대금각도(30) * 0.3
)

if not (각도종합지수 > 15):
    매수 = False
```
- **최적화 범위**: `[[12, 20, 2], 15]`

#### 5.2 거래 건전성 지수
```python
거래건전성 = (
    (매수총잔량 / (매수총잔량 + 매도총잔량)) * 0.4 +
    (체결강도 / 300) * 0.3 +
    (전일비 / 200) * 0.3
)

if not (거래건전성 > 0.6):
    매수 = False
```

### 6. 시간대별 전략 세분화 연구

#### 6.1 시간대 미세 분할
```python
# 09:25~09:28 (초기)
if 92500 <= 시분초 < 92800:
    # 보수적 조건

# 09:28~09:32 (중반)
elif 92800 <= 시분초 < 93200:
    # 적극적 조건

# 09:32~09:35 (후반)
else:
    # 조정 조건
```

### 7. 최적화 전략 개선 연구

#### 7.1 계층적 최적화 로드맵
1. **Level 1**: 공통 필터 변수 (5개) - 1시간
2. **Level 2**: 소형주 각도 변수 (10개) - 하루
3. **Level 3**: 소형주 전체 (30개) - 일주일
4. **Level 4**: 3티어 핵심 변수 (50개) - 2주
5. **Level 5**: 전체 변수 (138개) - GA 사용

#### 7.2 2단계 최적화 전략
1. **1단계**: 넓은 범위로 대략적 최적 영역 탐색
2. **2단계**: 1단계 결과 주변을 촘촘하게 재탐색

### 8. 리스크 관리 강화 연구

#### 8.1 각도 급락 조기 경보
```python
if 등락율각도(10) < -20 and 등락율각도(30) > 10:
    매도 = True  # 단기 급락 감지
```

#### 8.2 거래량 급감 감지
```python
if 초당거래대금 < 초당거래대금평균(30) * 0.3:
    매도 = True  # 거래량 급감 시 청산
```

### 9. 백테스팅 개선 방향

#### 9.1 시간대별 성과 분석
- 09:25~09:28, 09:28~09:32, 09:32~09:35 구간별 수익률 분석

#### 9.2 시가총액별 성과 비교
- 소형주/중형주/대형주별 승률, 평균 수익률 비교

#### 9.3 각도 범위별 성과 분석
- 등락율각도 4~10도, 10~20도, 20~70도 구간별 성과 비교

### 10. 구현 우선순위

#### 10.1 즉시 적용 가능 (High Priority)
1. RSI 필터 추가 (2.1)
2. 동적 손절 (4.1)
3. 계층적 최적화 (7.1)

#### 10.2 단기 적용 (Medium Priority, 1~2주)
1. 각도 종합 지수 (5.1)
2. 시간대 세분화 (6.1)
3. 이동평균 돌파 (3.1)

#### 10.3 중장기 연구 (Low Priority, 1~2개월)
1. 거래 건전성 지수 (5.2)
2. MACD 골든크로스 (2.2)
3. 체결강도각도 개발 (1.1)

## 태그
- #주식트레이딩
- #틱트레이딩
- #각도전략
- #체결강도변동성
- #호가잔량분석
- #누적지표
- #시가총액차등
- #매수조건
- #매도조건
- #최적화
- #유전알고리즘
- #파이썬
- #트레이딩로직
- #925_935전략
- #장초후반부
