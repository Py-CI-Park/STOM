# 조건식 찾기 - 분봉 버전 (Condition Finding - Minute Version)

- STOM 주식 자동거래에 사용하기 위한 분봉 조건식 문서
- [[Back_Testing_Guideline_Min]] 을(를) 기반으로 작성
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **분봉 기반 조건식 찾기 전략**을 정의한다.

- **대상 시간 구간**: 09:30:00 ~ 15:30:00 (장 안정화 이후 전체)
- **대상 종목**: 가격대 1,000~30,000원, 시가총액 2,500억 차등 기준
- **전략 타입**: 분봉 기반 종합 탐색 전략 (눌림목, 상향 돌파, 볼륨 급증, 호가 불균형)
- **핵심 변수**: 분당거래대금, 분당순매수금액, 체결강도, 이동평균, 등락율각도, 호가잔량, TA-Lib 지표
- **업데이트 이력**:
  - 2025-07-13: 초기 문서 작성 (틱→분봉 변환 버전)

## 제한조건
```
# 백테스팅 실행 시 다음 제한조건을 반드시 준수해야 합니다:
# 1. Back_Testing_Guideline_Min.md에 명시된 변수와 함수만 사용해야 합니다.
# 2. 조합된 변수는 직접 사용할 수 없으며, 기본 변수의 조합으로 표현해야 합니다.
# 3. 매수조건은 반드시 'not (조건)' 형태로 작성해야 합니다(False 조건).
# 4. 매도조건은 반드시 '조건' 형태로 작성해야 합니다(True 조건).
# 5. 조건식은 반드시 한 줄에 하나씩 작성해야 합니다.
# 6. '< > <= >= == !=' 같은 비교 연산자와 'and or not' 같은 논리 연산자만 사용합니다.
# 7. 복잡한 비교(a < b < c)는 명시적으로 분리해야 합니다(a < b and b < c).
# 8. 0으로 나누는 오류를 방지하기 위해 분모에 작은 값(예: 0.0001)을 더하는 것이 좋습니다.
# 9. 변수명은 정확하게 사용해야 하며, 오타가 있으면 시스템이 인식하지 못합니다.
# 10. 과도하게 복잡한 산술식은 백테스팅 성능에 영향을 줄 수 있습니다.
```

## 가이드라인
```
# 조건 편집기 작성 방법 안내
# 한줄에 하나의 조건을 작성해야하며
# "if" 와 ":"를 제외하고 조건을 작성해야합니다.
# 하한 조건일 경우 너무 낮은 값보다는 높아야합니다.
# 상한 조건일 경우 너무 높은 값보다는 낮아야합니다.
# 매수조건은 False 조건을 작성하십시오.
# 매도조건은 True 조건을 작성하십시오.
# 구분용으로 조건이 없는 빈칸을 입력할 수 있으며
# "# 조건설명" 형태로 주석을 추가하실 수 있습니다.
# 사용자의 조건 설정에 따라 유용한 조합이 나올수도
# 무의미한 조합이 나올수도 있습니다.
# 조건이 무조건 많다고 좋은 것은 아니니
# 대충 만든 조건 보다는 의미있는 조건들로
# 설정개수보다 최소 두배 이상의 조건을 작성하십시오.
```

## 매수 조건식 예제
```python
# 등락율 및 현재가
not (현재가 > 시가)
not (고저평균대비등락율 >= 0)
not (3 <= 등락율 <= 25)

# 거래대금
not (당일거래대금 >= 2000)
not (분당거래대금 >= 5)
not (분당거래대금 > 분당거래대금평균(30))
not (분당거래대금평균(30) > 분당거래대금평균(30, 1))

# 분당매도수수량
not (분당매수수량 > 분당매도수량)
not (분당매수수량 > 분당매수수량N(1))

# 이동평균선
not (이동평균(60) > 이동평균(60, 1))

# 체결강도
not (체결강도 >= 체결강도평균(30) + 3)

# 호가정보
not (매도총잔량 > 매수총잔량)
not (매도잔량1 > 매수잔량1)
```

## 매도 조건식 예제
```python
# 수익률
수익률 <= -2
수익률 >= 3
최고수익률 > 3 and 수익률 < 최고수익률 * 0.75

# 등락율
등락율 > 29
고저평균대비등락율 < 0

# 기타
보유시간 > 30
체결강도 <= 최고체결강도(30) - 5
매도총잔량 < 매수총잔량
```

## 매수 조건식
```python
# 일반 선결 조건
매수 = False

# 기본 필터링 조건
if not (관심종목 == 1):                                  # 관심종목이 아닌 종목만 매수 대상                       [순수 변수]
    매수 = False
elif not (1000 < 현재가 <= 30000):                         # 현재가가 1,000원~30,000원 범위 내 종목만 매수 대상     [순수 변수]
    매수 = False
elif not (1.0 < 등락율 <= 20.0):                           # 등락율이 1%~20% 범위 내 종목만 매수 대상             [순수 변수]
    매수 = False
elif not (고저평균대비등락율 > 0):                          # 고저평균 대비 등락율이 0 이하인 종목만 매수 대상      [순수 변수]
    매수 = False
elif not (현재가 < VI아래5호가):                            # VI아래5호가보다 현재가가 높은 종목만 매수 대상        [순수 변수]
    매수 = False
elif not (분당거래대금 > 분당거래대금N(1) * 1.2):            # 분당거래대금이 직전보다 20% 이상 급증하지 않은 종목   [순수 변수]
    매수 = False
elif 라운드피겨위5호가이내:                                  # 라운드피겨 가격대 상위 5호가 이내인 종목              [순수 변수]
    매수 = False

# 시간 조건(93000 이후)
elif not (시분초 >= 93000):                                 # 장 시작 후 30분(9시 30분) 이후 매수 대상           [순수 변수]
    매수 = False

# 등락율 관련 조건
elif not (1.0 <= (분봉시가 / 시가 - 1) * 100 and (분봉시가 / 시가 - 1) * 100 < 8.0):    # 시가 대비 분봉시가 등락율 1%~8% 범위 종목     [조합 변수: 시가대비분봉시가등락율]
    매수 = False

# 매매량 및 거래대금 조건
elif not (5 < (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000 and (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000 < 50):   # 분당 순매수금액 500만~5000만원 범위  [조합 변수: 분당순매수금액]
    매수 = False
elif not (현재가 > (고가 - (고가 - 저가) * 8 / 100)):      # 현재가가 고가에서 8% 이상 하락한 종목만 매수 대상     [순수 변수]
    매수 = False
elif not (전일비 > 10):                                   # 전일 대비 거래량 비율 10% 이하 종목만 매수 대상       [순수 변수]
    매수 = False
elif not (전일동시간비 > 100):                              # 전일 동시간 대비 거래량 100% 이하 종목만 매수 대상    [순수 변수]
    매수 = False
elif not (회전율 > 1):                                     # 회전율 1% 이하 종목만 매수 대상                      [순수 변수]
    매수 = False
elif not (당일거래대금 > 3 * 100):                          # 당일거래대금 300억 이하 종목만 매수 대상             [순수 변수]
    매수 = False

# 기울기/각도 조건
elif not (등락율각도(20) > -2 and 등락율각도(20) < 10):      # 등락율 각도가 -2~10도 범위 내 종목만 매수 대상      [순수 변수]
    매수 = False
elif not (전일비각도(20) > 0 and 전일비각도(20) < 50):       # 전일비 각도가 0~50도 범위 내 종목만 매수 대상       [순수 변수]
    매수 = False

# 거래대금 조건
elif not (분당거래대금 / 분당거래대금평균(20) > 1):           # 분당거래대금이 평균보다 큰 종목만 매수 대상          [순수 변수]
    매수 = False
elif not (분당거래대금 - 분당거래대금평균(20) < 20):          # 분당거래대금이 평균보다 20백만 이상 큰 종목만 매수 대상 [순수 변수]
    매수 = False

# 눌림목 조건
elif not (이동평균(60) > 이동평균(60, 5)):                   # 60분 이동평균이 5분 전보다 상승한 종목만 매수 대상   [순수 변수]
    매수 = False
elif not (현재가 < 이동평균(20) and 현재가 > 이동평균(20, 1)): # 현재가가 20분 이평선 아래서 반등 시작하는 종목      [순수 변수]
    매수 = False
elif not (현재가 < 이동평균(10) and 체결강도 > 체결강도N(1) * 1.1): # 현재가가 이평 아래지만 체결강도 상승 종목     [순수 변수]
    매수 = False
elif not (현재가 < 이동평균(5) and 현재가 > 현재가N(2) and 체결강도 > 100): # 단기 이평 아래서 반등하는 종목       [순수 변수]
    매수 = False
elif not (최고현재가(20) > 현재가 * 1.02 and 현재가 > 현재가N(3)): # 조정 후 반등 조짐 보이는 종목                [순수 변수]
    매수 = False

# 상향 돌파 조건
elif not (현재가 > 이동평균(20) and 현재가N(1) < 이동평균(20, 1)): # 현재가가 20분 이평선을 상향 돌파하는 종목     [순수 변수]
    매수 = False
elif not (현재가 > 이동평균(60) and 현재가N(2) < 이동평균(60, 2)): # 현재가가 60분 이평선을 상향 돌파하는 종목     [순수 변수]
    매수 = False
elif not (체결강도 > 체결강도평균(20) + 15 and 현재가 > 이동평균(5)): # 체결강도 강하고 이평선 위에 있는 종목       [순수 변수]
    매수 = False
elif not (등락율각도(20) > 20 and 현재가 > 이동평균(10)):      # 등락율 각도가 가파르고 이평선 위에 있는 종목       [순수 변수]
    매수 = False
elif not (분당거래대금 > 분당거래대금평균(30) * 1.5 and 현재가 > 현재가N(3)): # 거래대금 급증하고 상승 추세인 종목    [순수 변수]
    매수 = False

# 볼륨/강도 급증 조건
elif not (분당거래대금 > 분당거래대금N(1) * 1.5 and 분당거래대금N(1) > 분당거래대금N(2) * 1.2): # 연속적인 거래대금 급증 종목 [순수 변수]
    매수 = False
elif not (분당매수수량 > 분당매수수량N(1) * 2):                # 분당매수수량이 직전보다 2배 이상 급증한 종목        [순수 변수]
    매수 = False
elif not (분당매수수량 > 2 * 분당매도수량):                    # 매수수량이 매도수량보다 2배 이상 많은 종목          [순수 변수]
    매수 = False
elif not (체결강도 > 체결강도N(1) * 1.3 and 체결강도 > 120):   # 체결강도가 급등하고 120 이상인 강한 종목           [순수 변수]
    매수 = False
elif not (최고체결강도(5) > 체결강도평균(20) * 1.5):           # 최근 체결강도가 평균보다 50% 이상 높은 종목        [순수 변수]
    매수 = False

# 이격도 및 캔들 패턴 조건
elif not (현재가 < 이동평균(5) * 0.98 and 체결강도 > 130):     # 현재가가 이평 대비 2% 이상 이격된 강한 종목        [순수 변수]
    매수 = False
elif not (최저현재가(10) == 현재가N(5) and 현재가 > 현재가N(3)): # 이중 바닥 형성 후 반등하는 종목                [순수 변수]
    매수 = False
elif not (현재가 > 고가 - (고가 - 저가) * 0.2 and 등락율 > 2): # 고가 근처에서 강세 보이는 종목                   [순수 변수]
    매수 = False
elif not ((분봉시가 - 분봉저가) * 2 < (분봉고가 - 분봉시가) and 등락율 > 0):   # 강한 상승 캔들 패턴을 보이는 종목                [순수 변수]
    매수 = False
elif not (현재가 > 분봉시가 * 1.005 and 체결강도 > 110):        # 분봉시가 대비 상승하고 체결강도 강한 종목         [순수 변수]
    매수 = False

# 호가 불균형 조건
elif not (매도총잔량 < 매수총잔량 * 0.7):                      # 매수잔량이 매도잔량보다 43% 이상 많은 종목         [순수 변수]
    매수 = False
elif not (매도잔량1 < 매수잔량1 * 0.6):                        # 1호가 매수잔량이 매도잔량보다 67% 이상 많은 종목    [순수 변수]
    매수 = False
elif not (매도총잔량 < 매도총잔량N(3) * 0.8 and 매수총잔량 > 매수총잔량N(3)): # 매도잔량 감소, 매수잔량 증가 종목  [순수 변수]
    매수 = False
elif not (매수호가1 > 매수호가1N(3) and 매도호가1 == 매도호가1N(3)): # 매수호가 상승, 매도호가 유지되는 종목        [순수 변수]
    매수 = False

# 매수세력 우위 조건
elif not ((분당매수수량 - 분당매도수량) > (누적분당매수수량(20) / 20) * 0.3):  # 순매수량이 평균보다 높은 종목     [조합 변수: 누적매수량 평균 계산]
    매수 = False
elif not (체결강도 > 최고체결강도(30) * 0.9 and 체결강도 > 체결강도평균(20) * 1.2):  # 체결강도가 상대적으로 강한 종목 [순수 변수]
    매수 = False
elif not (누적분당매수수량(20) > 누적분당매도수량(20) * 1.3):    # 누적 매수수량이 매도수량보다 30% 이상 많은 종목    [순수 변수]
    매수 = False
elif not (분당매수수량 > 매도총잔량 * 0.2):                     # 분당매수수량이 매도잔량의 20% 이상인 종목         [순수 변수]
    매수 = False

# 매수 타이밍 조건
elif not (등락율각도(5) > 등락율각도(20) * 1.3 and 등락율각도(5) > 5): # 단기 등락율 각도가 급증하는 종목        [순수 변수]
    매수 = False
elif not (전일비각도(5) > 전일비각도(20) and 전일비각도(5) > 0): # 단기 전일비 각도가 증가하는 종목              [순수 변수]
    매수 = False
elif not (체결강도 > 체결강도N(1) and 체결강도N(1) > 체결강도N(2) and 체결강도N(2) > 체결강도N(3)): # 연속 체결강도 상승 종목 [순수 변수]
    매수 = False
elif not (최저체결강도(10) > 90 and 체결강도 > 체결강도평균(10)): # 체결강도가 하방 지지되고 평균 이상인 종목        [순수 변수]
    매수 = False
elif not (현재가 > 현재가N(1) and 현재가N(1) > 현재가N(2) and 현재가N(2) > 현재가N(3)): # 연속 가격 상승 종목    [순수 변수]
    매수 = False

# 매수 잔량 조건
elif not (매수총잔량 * 1.5 > 매도총잔량):                       # 매수잔량이 매도잔량의 67% 이상인 종목            [순수 변수]
    매수 = False
elif not ((매도호가1 - 매수호가1) <= 호가단위 * 2):              # 매수호가와 매도호가의 차이가 좁은 종목            [순수 변수]
    매수 = False

# TA-Lib 지표 조건 추가
elif not (RSI > 30 and RSI < 70):                              # RSI 과매수/과매도 구간 회피                    [TA-Lib]
    매수 = False
elif not (MACD > MACDS and MACD_N(1) <= MACDS_N(1)):           # MACD 골든크로스                             [TA-Lib]
    매수 = False
elif not (현재가 > BBL and 현재가 < BBU):                       # 볼린저밴드 중간 영역                        [TA-Lib]
    매수 = False

# 최종 매수 실행
else:
    매수 = True
```

## 매도 조건식
```python
매도 = False

# 상한가 근접 조건
if 등락율 > 29.5:
    매도 = True

# 시간대 조건 (90500 이전)
elif 시분초 < 90500 and 수익률 >= 4:
    매도 = True
elif 시분초 < 90500 and 수익률 <= -3.0:
    매도 = True
elif 시분초 < 90500 and 최고수익률 > 2.5 and 수익률 <= 최고수익률 * 0.75:
    매도 = True
elif 시분초 < 90500 and 보유시간 > 10 and 수익률 < 1:
    매도 = True

# 시간대 조건 (91000 이전)
elif 시분초 < 91000 and 수익률 >= 4:
    매도 = True
elif 시분초 < 91000 and 수익률 <= -3.0:
    매도 = True
elif 시분초 < 91000 and 최고수익률 > 2.5 and 수익률 <= 최고수익률 * 0.75:
    매도 = True
elif 시분초 < 91000 and 보유시간 > 5 and 수익률 < 1:
    매도 = True

# 시간대 조건 (91500 이전)
elif 시분초 < 91500 and 수익률 >= 4:
    매도 = True
elif 시분초 < 91500 and 수익률 <= -3.0:
    매도 = True
elif 시분초 < 91500 and 최고수익률 > 2.5 and 수익률 <= 최고수익률 * 0.75:
    매도 = True
elif 시분초 < 91500 and 보유시간 > 5 and 수익률 < 1:
    매도 = True

# 시가총액 조건
elif 시가총액 < 2500 and -1 < 수익률 <= 15 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.5:  # 중소형 종목에서 매도세 우위이고 수익 중일 때 매도  [순수 변수]
    매도 = True
elif 시가총액 < 2500 and 수익률 < -2 and 체결강도N(1) > 체결강도평균(20,1) and 체결강도평균(20,1) > 체결강도:  # 중소형 종목 손실 상태에서 체결강도 하락 시 매도  [순수 변수]
    매도 = True
elif 시가총액 < 2500 and 최고수익률 > 2.5 and 현재가N(1) >= 이동평균(30, 1) and 이동평균(30) > 현재가:  # 중소형 종목에서 이평선 하향 돌파 시 매도  [순수 변수]
    매도 = True

# 수익 실현 조건
elif 수익률 >= 1.5 and 체결강도 < 체결강도N(1) and 체결강도N(1) < 체결강도N(2):  # 수익률 1.5% 이상이고 체결강도 연속 하락 시 매도    [조합 변수: 연속 비교]
    매도 = True
elif 수익률 >= 1.0 and 현재가 < 현재가N(1) and 현재가N(1) < 현재가N(2):  # 수익률 1% 이상이고 현재가 연속 하락 시 매도    [조합 변수: 연속 비교]
    매도 = True
elif 수익률 >= 0.8 and 체결강도 < 체결강도평균(5) and 분당거래대금 < 분당거래대금평균(5):  # 수익률 0.8%이고 체결강도/거래대금 약화 시 매도  [순수 변수]
    매도 = True
elif 수익률 >= 2.5 and 보유시간 > 3:                          # 수익률 2.5% 이상이고 3분 이상 보유했으면 매도          [순수 변수]
    매도 = True
elif 최고수익률 > 2.0 and 수익률 < 최고수익률 * 0.8:             # 최고수익률의 80% 미만으로 하락 시 매도               [순수 변수]
    매도 = True
elif 최고수익률 >= 3.5 and 수익률 <= 최고수익률 * 0.7:           # 최고수익률의 70% 미만으로 하락 시 매도               [순수 변수]
    매도 = True

# 손절 조건
elif 수익률 <= -0.8 and 체결강도 < 체결강도평균(10):             # 손실 0.8% 이상이고 체결강도 약화 시 손절               [순수 변수]
    매도 = True
elif 수익률 <= -1.2 and 분당매도수량 > 분당매수수량 * 1.3:        # 손실 1.2% 이상이고 매도수량 증가 시 손절            [순수 변수]
    매도 = True
elif 수익률 <= -1.5 and 현재가 < 이동평균(5):                   # 손실 1.5% 이상이고 이동평균 아래로 하락 시 손절        [순수 변수]
    매도 = True
elif 수익률 <= -0.6 and 보유시간 > 5 and 현재가 < 현재가N(3):   # 약한 손실에 장기 보유하고 하락 추세면 손절          [순수 변수]
    매도 = True
elif 수익률 < -1.0 and 등락율각도(20) < -10:                     # 손실 1% 이상이고 등락율 각도 급락 시 손절          [순수 변수]
    매도 = True

# 추세 반전 기반 매도 조건
elif 체결강도 < 체결강도평균(20) * 0.8 and 수익률 > 0.4:         # 체결강도 급락하고 이익 중일 때 매도                  [순수 변수]
    매도 = True
elif 분당매도수량 > 분당매수수량 * 1.8 and 수익률 > 0:             # 매도수량이 매수수량보다 1.8배 이상이고 이익 중일 때    [순수 변수]
    매도 = True
elif 현재가 < 이동평균(5) and 이동평균(5) < 이동평균(5, 1) and 수익률 > 0.2:  # 이동평균 하향 돌파하고 이익 중일 때 [순수 변수]
    매도 = True
elif 분당거래대금 < 분당거래대금평균(20) * 0.7 and 수익률 > 0:    # 분당거래대금 급감하고 이익 중일 때 매도              [순수 변수]
    매도 = True
elif 등락율각도(10) < -12 and 수익률 > 0.1:                      # 등락율 각도 급락하고 이익 중일 때 매도               [순수 변수]
    매도 = True

# 호가 불균형 기반 매도 조건
elif 매도총잔량 < 매수총잔량 * 0.5 and 매도총잔량 < 매도총잔량N(3) * 0.8 and 수익률 > 0.4:  # 매도잔량 급감하고 이익 중일 때 [순수 변수]
    매도 = True
elif 매도잔량1 > 매도잔량1N(1) * 1.8 and 매수잔량1 < 매수잔량1N(1) and 수익률 > 0:  # 매도잔량 급증, 매수잔량 감소 시 매도 [순수 변수]
    매도 = True
elif 매수호가1 < 매수호가1N(2) and 수익률 > 0.2:                 # 매수호가 하락하고 이익 중일 때 매도                  [순수 변수]
    매도 = True
elif 매도총잔량 > 매수총잔량 * 1.8 and 분당매도수량 > 분당매수수량 and 수익률 > 0:  # 매도세가 강하고 이익 중일 때 매도    [순수 변수]
    매도 = True

# 볼륨 변화 기반 매도 조건
elif 분당거래대금 < 분당거래대금N(1) * 0.7 and 수익률 > 0.5:     # 분당거래대금 급감하고 이익 중일 때 매도              [순수 변수]
    매도 = True
elif 분당거래대금 > 분당거래대금N(1) * 2.5 and 수익률 > 0.4:       # 분당거래대금 급증하고 이익 중일 때 매도              [순수 변수]
    매도 = True
elif 분당매도수량 > (누적분당매도수량(20) / 20) * 1.8 and 수익률 > 0.2:  # 분당매도수량 급증하고 이익 중일 때 매도      [조합 변수: 누적매도량 평균 계산]
    매도 = True
elif 최고분당매수수량(5) < 최고분당매수수량(5, 5) * 0.6 and 수익률 > 0.3:  # 최고 매수수량 급감하고 이익 중일 때    [순수 변수]
    매도 = True
elif 분당거래대금 < 분당거래대금평균(30) * 0.5 and 보유시간 > 2 and 수익률 > 0:  # 분당거래대금 급감하고 2분 이상 보유 시 [순수 변수]
    매도 = True

# 타이밍 기반 매도 조건
elif 체결강도 < 최저체결강도(10) * 1.1 and 수익률 > 0.5:         # 체결강도가 최저치 근처로 하락하고 이익 중일 때        [순수 변수]
    매도 = True
elif 시분초 > 145000 and 수익률 > 0.1:                           # 장 마감 임박하고 이익 중일 때 매도                   [순수 변수]
    매도 = True
elif 보유시간 > 10 and 수익률 < 0.4:                            # 10분 이상 보유했는데 수익률이 낮을 때 매도           [순수 변수]
    매도 = True
elif 최고수익률 > 0.8 and 수익률 < 0 and 보유시간 > 3:         # 최고수익률 0.8% 이상 기록했으나 손실 전환되면 매도      [순수 변수]
    매도 = True

# TA-Lib 지표 기반 매도
elif RSI > 75 and 수익률 > 0.3:                                # RSI 과매수 구간에서 이익 실현                   [TA-Lib]
    매도 = True
elif MACD < MACDS and MACD_N(1) >= MACDS_N(1) and 수익률 > 0.2: # MACD 데드크로스에서 이익 실현                  [TA-Lib]
    매도 = True
elif 현재가 < BBM and 현재가N(1) >= BBM_N(1) and 수익률 > 0.1:   # 볼린저밴드 중심선 하향 돌파 시 매도             [TA-Lib]
    매도 = True

# 최저가 돌파
elif 현재가 < 최저현재가(30, 보유시간) and 데이터길이 > 30:  # 보유 후 최저가 돌파 시 매도(30분 기준)     [순수 변수]
    매도 = True
elif 현재가 < 최저현재가(20, 보유시간) and 데이터길이 > 20:  # 보유 후 최저가 돌파 시 매도(20분 기준)     [순수 변수]
    매도 = True
elif 현재가 < 최저현재가(10, 보유시간) and 데이터길이 > 10:    # 보유 후 최저가 돌파 시 매도(10분 기준)      [순수 변수]
    매도 = True
```

## 참고사항
- 각 조건에는 [순수 변수] 또는 [조합 변수: 설명] 형태로 변수 유형을 표시했습니다.
- 순수 변수는 Back_Testing_Guideline_Min.md에 직접 명시된 변수입니다.
- 조합 변수는 여러 기본 변수를 조합하여 만든 표현식입니다.
- 틱 데이터의 초당 단위를 분당 단위로 변환하여 적용했습니다.
- 분봉 데이터에서 사용 가능한 TA-Lib 지표들을 추가로 활용했습니다.
- 모든 조건은 백테스팅 시스템에서 오류 없이 실행될 수 있도록 가이드라인에 맞게 작성되었습니다.

**최종 업데이트: 2025-07-13 (틱→분봉 변환 버전)**

## 최적화 조건식

### 매수 최적화 조건식 - C_Find_1_Min_BO

```python
# 일반 선결 조건
매수 = False

# 기본 필터링 조건
if not (관심종목 == 1):
    매수 = False
elif not (self.vars[0] < 현재가 <= self.vars[1]):                             # 현재가 범위 최적화
    매수 = False
elif not (self.vars[2] < 등락율 <= self.vars[3]):                            # 등락율 범위 최적화
    매수 = False
elif not (고저평균대비등락율 > 0):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif not (분당거래대금 > 분당거래대금N(1) * self.vars[4]):                   # 분당거래대금 비율 최적화
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False

# 시간 조건
elif not (시분초 >= 93000):
    매수 = False

# 등락율 관련 조건
elif not (self.vars[5] <= (분봉시가 / 시가 - 1) * 100 and (분봉시가 / 시가 - 1) * 100 < self.vars[6]):   # 시가대비분봉시가등락율 범위 최적화
    매수 = False

# 매매량 및 거래대금 조건
elif not (self.vars[7] < (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000 and (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000 < self.vars[8]):   # 분당순매수금액 범위 최적화
    매수 = False
elif not (현재가 > (고가 - (고가 - 저가) * self.vars[9] / 100)):           # 고가대비하락폭 최적화
    매수 = False
elif not (전일비 > self.vars[10]):                                          # 전일비 하한 최적화
    매수 = False
elif not (전일동시간비 > self.vars[11]):                                    # 전일동시간비 하한 최적화
    매수 = False
elif not (회전율 > self.vars[12]):                                          # 회전율 하한 최적화
    매수 = False
elif not (당일거래대금 > self.vars[13] * 100):                              # 당일거래대금 하한 최적화
    매수 = False

# 기울기/각도 조건
elif not (self.vars[14] < 등락율각도(20) and 등락율각도(20) < self.vars[15]):  # 등락율각도 범위 최적화
    매수 = False
elif not (self.vars[16] < 전일비각도(20) and 전일비각도(20) < self.vars[17]):   # 전일비각도 범위 최적화
    매수 = False

# 거래대금 조건
elif not (분당거래대금 / 분당거래대금평균(20) > self.vars[18]):              # 분당거래대금 비율 최적화
    매수 = False
elif not (분당거래대금 - 분당거래대금평균(20) < self.vars[19]):              # 분당거래대금 증가폭 최적화
    매수 = False

# TA-Lib 지표 조건
elif not (self.vars[20] < RSI and RSI < self.vars[21]):                     # RSI 범위 최적화
    매수 = False
elif not (MACD > MACDS and MACD_N(1) <= MACDS_N(1)):
    매수 = False
elif not (현재가 > BBL and 현재가 < BBU):
    매수 = False

# 최종 매수 실행
else:
    매수 = True
```

### 매수 최적화 범위 - C_Find_1_Min_BOR

```python
self.vars[0]  = [[800, 1200, 200], 1000]               # 범위갯수: 3   # 현재가 하한 (원)
self.vars[1]  = [[25000, 35000, 5000], 30000]          # 범위갯수: 3   # 현재가 상한 (원)
self.vars[2]  = [[0.5, 1.5, 0.5], 1.0]                 # 범위갯수: 3   # 등락율 하한 (%)
self.vars[3]  = [[18.0, 22.0, 2.0], 20.0]              # 범위갯수: 3   # 등락율 상한 (%)
self.vars[4]  = [[1.1, 1.3, 0.1], 1.2]                 # 범위갯수: 3   # 분당거래대금/직전 비율
self.vars[5]  = [[0.5, 1.5, 0.5], 1.0]                 # 범위갯수: 3   # 시가대비분봉시가등락율 하한 (%)
self.vars[6]  = [[7.0, 9.0, 1.0], 8.0]                 # 범위갯수: 3   # 시가대비분봉시가등락율 상한 (%)
self.vars[7]  = [[3, 7, 2], 5]                         # 범위갯수: 3   # 분당순매수금액 하한 (백만원)
self.vars[8]  = [[40, 60, 10], 50]                     # 범위갯수: 3   # 분당순매수금액 상한 (백만원)
self.vars[9]  = [[6, 10, 2], 8]                        # 범위갯수: 3   # 고가대비하락폭 (%)
self.vars[10] = [[5, 15, 5], 10]                       # 범위갯수: 3   # 전일비 하한 (%)
self.vars[11] = [[80, 120, 20], 100]                   # 범위갯수: 3   # 전일동시간비 하한 (%)
self.vars[12] = [[0.5, 1.5, 0.5], 1.0]                 # 범위갯수: 3   # 회전율 하한 (%)
self.vars[13] = [[250, 350, 50], 300]                  # 범위갯수: 3   # 당일거래대금 하한 (억원)
self.vars[14] = [[-4, 0, 2], -2]                       # 범위갯수: 3   # 등락율각도 하한 (도)
self.vars[15] = [[8, 12, 2], 10]                       # 범위갯수: 3   # 등락율각도 상한 (도)
self.vars[16] = [[-5, 5, 5], 0]                        # 범위갯수: 3   # 전일비각도 하한 (도)
self.vars[17] = [[45, 55, 5], 50]                      # 범위갯수: 3   # 전일비각도 상한 (도)
self.vars[18] = [[0.9, 1.1, 0.1], 1.0]                 # 범위갯수: 3   # 분당거래대금/평균 비율
self.vars[19] = [[15, 25, 5], 20]                      # 범위갯수: 3   # 분당거래대금 증가폭 (백만원)
self.vars[20] = [[25, 35, 5], 30]                      # 범위갯수: 3   # RSI 하한
self.vars[21] = [[65, 75, 5], 70]                      # 범위갯수: 3   # RSI 상한

# 총 경우의 수: 3^22 = 31,381,059,609 (GA 최적화 필수)
```

### 매도 최적화 조건식 - C_Find_1_Min_SO

```python
매도 = False

# 상한가 근접 조건
if 등락율 > 29.5:
    매도 = True

# 시간대별 수익률 조건 (90500 이전)
elif 시분초 < 90500 and 수익률 >= self.vars[0]:                             # 목표 수익률 최적화
    매도 = True
elif 시분초 < 90500 and 수익률 <= self.vars[1]:                             # 손절 수익률 최적화
    매도 = True
elif 시분초 < 90500 and 최고수익률 > self.vars[2] and 수익률 <= 최고수익률 * self.vars[3]:  # 고점 대비 하락 최적화
    매도 = True
elif 시분초 < 90500 and 보유시간 > self.vars[4] and 수익률 < self.vars[5]:   # 장기 보유 손절 최적화
    매도 = True

# 체결강도 기반 매도
elif 체결강도 < 체결강도평균(20) * self.vars[6] and 수익률 > self.vars[7]:   # 체결강도 약화 기준 최적화
    매도 = True

# 추세 반전 기반 매도
elif 분당매도수량 > 분당매수수량 * self.vars[8] and 수익률 > 0:              # 매도수량 비율 최적화
    매도 = True

# 호가 불균형 기반 매도
elif 매도총잔량 < 매수총잔량 * self.vars[9] and 수익률 > self.vars[10]:     # 잔량 비율 최적화
    매도 = True

# TA-Lib 지표 기반 매도
elif RSI > self.vars[11] and 수익률 > self.vars[12]:                        # RSI 과매수 기준 최적화
    매도 = True
elif MACD < MACDS and MACD_N(1) >= MACDS_N(1) and 수익률 > self.vars[13]:   # MACD 데드크로스 수익률 최적화
    매도 = True

# 최저가 돌파
elif 현재가 < 최저현재가(30, 보유시간) and 데이터길이 > 30:
    매도 = True
```

### 매도 최적화 범위 - C_Find_1_Min_SOR

```python
self.vars[0]  = [[3.5, 4.5, 0.5], 4.0]                 # 범위갯수: 3   # 목표 수익률 (%)
self.vars[1]  = [[-3.5, -2.5, 0.5], -3.0]              # 범위갯수: 3   # 손절 수익률 (%)
self.vars[2]  = [[2.0, 3.0, 0.5], 2.5]                 # 범위갯수: 3   # 최고수익률 기준 (%)
self.vars[3]  = [[0.70, 0.80, 0.05], 0.75]             # 범위갯수: 3   # 고점 대비 비율
self.vars[4]  = [[8, 12, 2], 10]                       # 범위갯수: 3   # 장기 보유 시간 (분)
self.vars[5]  = [[0.5, 1.5, 0.5], 1.0]                 # 범위갯수: 3   # 장기 보유 손절 기준 (%)
self.vars[6]  = [[0.75, 0.85, 0.05], 0.80]             # 범위갯수: 3   # 체결강도 비율
self.vars[7]  = [[0.3, 0.5, 0.1], 0.4]                 # 범위갯수: 3   # 체결강도 약화 시 수익률 (%)
self.vars[8]  = [[1.6, 2.0, 0.2], 1.8]                 # 범위갯수: 3   # 매도수량 비율
self.vars[9]  = [[0.4, 0.6, 0.1], 0.5]                 # 범위갯수: 3   # 잔량 비율
self.vars[10] = [[0.3, 0.5, 0.1], 0.4]                 # 범위갯수: 3   # 잔량 불균형 시 수익률 (%)
self.vars[11] = [[73, 77, 2], 75]                      # 범위갯수: 3   # RSI 과매수 기준
self.vars[12] = [[0.2, 0.4, 0.1], 0.3]                 # 범위갯수: 3   # RSI 과매수 시 수익률 (%)
self.vars[13] = [[0.1, 0.3, 0.1], 0.2]                 # 범위갯수: 3   # MACD 데드크로스 수익률 (%)

# 총 경우의 수: 3^14 = 4,782,969
```

### 매수·매도 통합 최적화 범위 - C_Find_1_Min_OR

```python
# 매수 핵심 변수 (7개)
self.vars[0]  = [[800, 1200, 200], 1000]               # 범위갯수: 3   # 현재가 하한 (원)
self.vars[1]  = [[25000, 35000, 5000], 30000]          # 범위갯수: 3   # 현재가 상한 (원)
self.vars[2]  = [[0.5, 1.5, 0.5], 1.0]                 # 범위갯수: 3   # 등락율 하한 (%)
self.vars[3]  = [[18.0, 22.0, 2.0], 20.0]              # 범위갯수: 3   # 등락율 상한 (%)
self.vars[4]  = [[3, 7, 2], 5]                         # 범위갯수: 3   # 분당순매수금액 하한 (백만원)
self.vars[5]  = [[40, 60, 10], 50]                     # 범위갯수: 3   # 분당순매수금액 상한 (백만원)
self.vars[6]  = [[25, 35, 5], 30]                      # 범위갯수: 3   # RSI 하한

# 매도 핵심 변수 (4개)
self.vars[7]  = [[3.5, 4.5, 0.5], 4.0]                 # 범위갯수: 3   # 목표 수익률 (%)
self.vars[8]  = [[-3.5, -2.5, 0.5], -3.0]              # 범위갯수: 3   # 손절 수익률 (%)
self.vars[9]  = [[0.70, 0.80, 0.05], 0.75]             # 범위갯수: 3   # 고점 대비 비율
self.vars[10] = [[73, 77, 2], 75]                      # 범위갯수: 3   # RSI 과매수 기준

# 총 경우의 수: 3^11 = 177,147
```

### 유전 알고리즘 범위 - C_Find_1_Min_GAR

```python
# 매수 핵심 변수 (7개)
self.vars[0]  = [[800, 1000, 1200], 1000]              # 현재가 하한 (원)
self.vars[1]  = [[25000, 30000, 35000], 30000]         # 현재가 상한 (원)
self.vars[2]  = [[0.5, 1.0, 1.5], 1.0]                 # 등락율 하한 (%)
self.vars[3]  = [[18.0, 20.0, 22.0], 20.0]             # 등락율 상한 (%)
self.vars[4]  = [[3, 5, 7], 5]                         # 분당순매수금액 하한 (백만원)
self.vars[5]  = [[40, 50, 60], 50]                     # 분당순매수금액 상한 (백만원)
self.vars[6]  = [[25, 30, 35], 30]                     # RSI 하한

# 매도 핵심 변수 (4개)
self.vars[7]  = [[3.5, 4.0, 4.5], 4.0]                 # 목표 수익률 (%)
self.vars[8]  = [[-3.5, -3.0, -2.5], -3.0]             # 손절 수익률 (%)
self.vars[9]  = [[0.70, 0.75, 0.80], 0.75]             # 고점 대비 비율
self.vars[10] = [[73, 75, 77], 75]                     # RSI 과매수 기준

# 세대 수 × 개체 수: 예) 20세대 × 50개체 = 1,000회
```

## 조건식 개선 방향 연구

### 1. 추가 지표 활용 연구

**우선순위: 높음**
- **TA-Lib 지표 조합 확대**
  - ADX (추세 강도) + DMI (방향성) 조합
  - Ichimoku Cloud (일목균형표) 활용
  - 구현 난이도: 중

- **변동성 지표 추가**
  - ATR (Average True Range) 기반 손절폭 설정
  - Bollinger Band Width로 변동성 확대 구간 포착
  - 구현 난이도: 낮음

### 2. 시간대별 전략 세분화 연구

**우선순위: 높음**
- **장 시간대별 분봉 전략 차등화**
  - 09:00-10:00: 5분봉 전략
  - 10:00-14:00: 10분봉 전략
  - 14:00-15:00: 3분봉 전략
  - 구현 난이도: 중

### 3. 매도 조건 고도화 연구

**우선순위: 높음**
- **TA-Lib 매도 신호 강화**
  - MACD 데드크로스 + RSI 과매수 조합
  - Stochastic %K/%D 하향 교차 시 매도
  - 구현 난이도: 낮음

- **이동평균선 이탈 기반 매도**
  - 5MA 하향 돌파 시 경고
  - 20MA 하향 돌파 시 청산
  - 구현 난이도: 낮음

### 4. 리스크 관리 강화 연구

**우선순위: 높음**
- **다중 시간프레임 분석**
  - 1분봉 + 5분봉 + 10분봉 동시 확인
  - 상위 시간프레임 추세와 부합 시만 진입
  - 구현 난이도: 중

- **거래량 프로파일 분석**
  - 가격대별 거래량 분포 확인
  - 고거래량 구간 지지/저항 활용
  - 구현 난이도: 높음

### 5. 최적화 전략 개선 연구

**우선순위: 중간**
- **TA-Lib 파라미터 최적화**
  - RSI 기간: 14 → 10~20 범위 탐색
  - MACD (12,26,9) → (8,17,9) 등 변형 테스트
  - 구현 난이도: 중

- **기계학습 기반 지표 가중치 최적화**
  - 각 TA-Lib 지표의 예측력 평가
  - 가중치 동적 조정
  - 구현 난이도: 높음

### 구현 우선순위

1. **1단계 (즉시 구현)**:
   - 변동성 지표 추가 (ATR, BB Width)
   - TA-Lib 매도 신호 강화
   - 이동평균선 이탈 기반 매도

2. **2단계 (1개월 내)**:
   - TA-Lib 지표 조합 확대 (ADX, DMI, Ichimoku)
   - 시간대별 분봉 전략 차등화
   - 다중 시간프레임 분석

3. **3단계 (3개월 내)**:
   - TA-Lib 파라미터 최적화
   - 거래량 프로파일 분석
   - 기계학습 기반 최적화

