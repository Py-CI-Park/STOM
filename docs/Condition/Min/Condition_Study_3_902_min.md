---
tags: [StockTrading, AutomatedTrading, MinuteBacktesting, ConditionStrategy, Optimization, GeneticAlgorithm]
---

# 조건식 (Condition) - 분봉(Minute) 기반

- STOM 주식 자동거래에 사용하기 위한 분봉 조건식 문서
- [[Back_Testing_Guideline_Min]] 을(를) 기반으로 작성
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 📋 Answer Instructions

This document adapts the `Condition_Study_3_902.md` for minute-based (1-minute candlestick) backtesting, based on the guidelines provided in `Back_Testing_Guideline_Min.md`. The original conditions have been modified to use minute-based variables and technical indicators suitable for 1-minute candlestick data. The document retains the structure and naming conventions of the original, with adjustments to align with minute-based backtesting requirements.

---

## 목차
- [[#조건식 (Condition) - 분봉 백테스팅]]
  - [[#📋 Answer Instructions]]
  - [[#목차]]
  - [[#소개]]
  - [[#가이드라인]]
    - [[#저장 이름 규칙]]
- [[#Condition - Study 3 (Min)]]
  - [[#조건식]]
    - [[#매수 조건식 - C_S_3_B_902_Min]]
    - [[#매도 조건식 - C_S_3_S_902_Min]]
  - [[#최적화 조건식]]
    - [[#매수 최적화 조건식 - C_S_2_BO_T_Min]]
    - [[#매수 최적화 범위 - C_S_2_BOR_T_Min]]
    - [[#매도 최적화 조건식 - C_S_2_SO_T_Min]]
    - [[#매도 최적화 범위 - C_S_2_SOR_T1_Min]]
    - [[#매수 매도 최적화 범위 - C_S_2_OR_T1_Min]]
    - [[#매수 매도 최적화 범위 - C_S_2_OR_T1_2_Min]]
    - [[#매수 매도 최적화 범위 - C_S_2_OR_T1T_Min]]
    - [[#예상 시간 계산]]
    - [[#GA 최적화 범위 - C_S_2_GAR_T_Min]]

---

## 소개

이 문서는 STOM 주식 자동거래 시스템에서 1분봉 데이터를 활용한 백테스팅을 위해 작성된 조건식입니다. 기존 `Condition_Study_3_902.md`의 틱 데이터 기반 조건식을 분봉 데이터에 맞게 변환하였으며, `Back_Testing_Guideline_Min.md`에 명시된 변수와 기술적 지표를 사용합니다. 각 조건식은 매수 및 매도 전략을 포함하며, 최적화된 변수 설정을 통해 성능을 향상시킵니다.

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **분봉 기반 갭상승 + 거래대금 가속 전략 (Study 3)**을 정의한다.

- **대상 시간 구간**: 09:02:00 이전 (개장 초반)
- **대상 종목**: 시가총액 3,000억 미만, 가격대 1,000원~50,000원
- **전략 타입**: 갭상승 + 거래대금 가속 모멘텀 포착
- **핵심 변수**: RSI, 시가등락율, 시가대비등락율, 분당순매수금액, 당일거래대금각도, 체결강도, 회전율
- **업데이트 이력**:
  - 2025-07-15: 분봉 버전 작성 (Tick 조건식을 분봉으로 변환)

---

## 가이드라인

- 모든 조건식은 Python으로 작성되었으며, 1분봉 데이터를 기반으로 주식 거래 자동화를 목표로 합니다.
- 각 조건식은 특정 조건을 만족할 때 매수 또는 매도를 실행합니다.
- 최적화 조건식은 변수의 범위를 설정하여 최적의 매수/매도 시점을 찾습니다.
- 최적화 범위는 `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]` 형식으로 설정합니다.
- **분봉 데이터 특화**:
  - 틱 데이터 대신 1분봉 데이터(분봉시가, 분봉고가, 분봉저가 등)를 사용.
  - TA-Lib 보조지표(MACD, RSI, Bollinger Bands 등)를 활용하여 트렌드 및 모멘텀 분석 가능.
- GA(유전 알고리즘) 최적화 범위 생성 방법:
  - 유전 알고리즘을 사용하여 최적의 매수/매도 시점을 찾기 위해 변수 범위를 설정.
  - 각 변수는 `self.vars[정수] = [범위리스트, 고정값]` 형식으로 정의.
  - 범위리스트는 탐색할 값들을 나열하며, 고정값은 하나의 수로 입력.
  - 고정값은 2단계, 3단계에서 돌연변이로 추가되며, 4단계부터는 추가되지 않음.
  - 변수 범위는 10개 이하, 최대 20개로 제한하여 계산 효율성을 높임.
  - 최적값은 일반 최적화 결과를 GA에 돌연변이로 추가한 후, GA 결과를 다시 일반 최적화에 반영.

### 저장 이름 규칙

1. **기본 규칙**:
   - `C`: Condition
   - `S`: Study
   - `숫자`: 실험 번호
   - `B`: 매수 조건식
   - `S`: 매도 조건식
   - `BO`: 매수 최적화 조건식
   - `SO`: 매도 최적화 조건식
   - `OR`: 매수 매도 통합 최적화 범위
   - `GAR`: GA 최적화 범위
   - `T`: Test
   - `Min`: 분봉 데이터 기반 조건식

2. **예시**:
   - `C_S_3_B_902_Min`: 세 번째 실험의 분봉 매수 조건식
   - `C_S_2_BO_T_Min`: 세 번째 실험의 분봉 매수 최적화 조건식
   - `C_S_2_OR_T1_Min`: 세 번째 실험의 분봉 매수 매도 통합 최적화 범위

3. **확장성 고려**:
   - 날짜 또는 버전 추가: `C_S_3_B_20250715_Min`, `C_S_3_B_v1.0_Min`
   - 설명 추가: `C_S_3_B_HighVolatility_Min`
   - 프로젝트 구분: `ProjA_C_S_3_B_Min`

---

# Condition - Study 3 (Min)

## 조건식

### 매수 조건식 - C_S_3_B_902_Min

```python
# 분봉 기반 변수 정의
전일종가 = 현재가 / (1 + (등락율 / 100))  # 단위: 원
시가등락율 = ((분봉시가 - 전일종가) / 전일종가) * 100  # 단위: 퍼센트
시가대비등락율 = ((현재가 - 분봉시가) / 분봉시가) * 100  # 단위: 퍼센트
분당순매수금액 = (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000  # 단위: 백만원
누적거래대금비율 = 당일거래대금 / (시가총액 * 회전율 / 100) * 100 if (시가총액 * 회전율 / 100) != 0 else 0

매수 = True

# 공통 선결 조건
if not (관심종목 == 1):
    매수 = False
elif not (1000 < 현재가 <= 50000):
    매수 = False
elif not (1.0 < 등락율 <= 8.0):
    매수 = False
elif not (고저평균대비등락율 > 0):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (분당거래대금 > 분당거래대금N(1) * 1.0):
    매수 = False
elif not (RSI < 70):
    매수 = False
elif 시분초 < 90200:
    if 시가총액 < 3000:
        if not (1.0 <= 시가등락율 < 4.0):
            매수 = False
        elif not (0.5 <= 시가대비등락율 < 8.0):
            매수 = False
        elif not (1 < 분당순매수금액 < 1000):
            매수 = False
        elif not (현재가 > (분봉고가 - (분봉고가 - 분봉저가) * 20 / 100)):
            매수 = False
        elif not (누적거래대금비율 > 5):
            매수 = False
        elif not (전일비 > 0):
            매수 = False
        elif not (전일동시간비 > 0):
            매수 = False
        elif not (회전율 > 2):
            매수 = False
        elif not (당일거래대금 > 5 * 100):
            매수 = False
        elif not (당일거래대금각도(30) > 1 and 당일거래대금각도(30) < 30):
            매수 = False
        elif not (분당거래대금 / 분당거래대금평균(30) > 3.0):
            매수 = False
        elif not (분당매수수량 > 매도총잔량 * 10 / 100):
            매수 = False
        elif not (매도총잔량 > 매수총잔량 * 0.1):
            매수 = False
        elif not (체결강도 >= 100 and 체결강도 <= 300):
            매수 = False
    else:
        매수 = False
else:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

**변경사항**:
- `초당` 변수를 `분당` 변수로 변경 (예: `초당매수수량` → `분당매수수량`, `초당거래대금` → `분당거래대금`).
- `시가`를 `분봉시가`로 변경하여 1분봉 기준 시가를 사용.
- `고가`, `저가`를 `분봉고가`, `분봉저가`로 변경.
- TA-Lib 지표(`RSI`)를 활용하여 모멘텀 조건 유지.
- 시간 조건(`시분초`)은 그대로 유지하되, 분봉 데이터의 시간 단위에 맞게 해석.

---

### 매도 조건식 - C_S_3_S_902_Min

```python
# 분봉 기반 변수 정의
시가대비등락율 = ((현재가 - 분봉시가) / 분봉시가) * 100  # 단위: 퍼센트

매도 = False

if 등락율 > 29.5:
    매도 = True
elif 보유시간 > 60 and 현재가 < 최저현재가(60, 보유시간):
    매도 = True
elif 시가대비등락율 < 0 and 수익률 <= -2.0 and 현재가 < 최저현재가(60, 보유시간):
    매도 = True
elif 시분초 < 93000:
    if 4 <= 수익률:
        매도 = True
    elif 수익률 <= -4.0:
        매도 = True
    elif 최고수익률 > 4 and 최고수익률 * 0.6 >= 수익률:
        매도 = True
    elif 시가총액 < 10000:
        if 등락율각도(30) >= 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.5 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True
        elif 등락율각도(30) < 10 and 등락율각도(30) >= 5 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.7 and (현재가 / 현재가N(1) - 1) * 100 < -0.7:
            매도 = True
        elif 등락율각도(30) < 5 and 등락율각도(30) >= 0 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.8 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True
        elif 4 < 최고수익률 and 현재가N(1) >= 이동평균(60, 1) and 이동평균(60) > 현재가:
            매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

**변경사항**:
- `초당매수수량`, `초당매도수량`을 `분당매수수량`, `분당매도수량`으로 변경.
- `시가대비등락율` 계산 시 `분봉시가` 사용.
- `최저현재가`와 `이동평균`을 분봉 데이터 기준으로 유지.
- `보유시간`은 분 단위로 해석 (예: 60 → 60분).
- TA-Lib 지표(`이동평균`)를 활용하여 추세 반전 신호 유지.

---

## 최적화 조건식

### 매수 최적화 조건식 - C_S_2_BO_T_Min

```python
# 분봉 기반 변수 정의
분당순매수금액 = (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000  # 단위: 백만원
전일종가 = 현재가 / (1 + (등락율 / 100))  # 단위: 원
시가등락율 = ((분봉시가 - 전일종가) / 전일종가) * 100  # 단위: 퍼센트
시가대비등락율 = ((현재가 - 분봉시가) / 분봉시가) * 100  # 단위: 퍼센트
누적거래대금비율 = 당일거래대금 / (시가총액 * 회전율 / 100) * 100 if (시가총액 * 회전율 / 100) != 0 else 0

매수 = True

# 공통 선결 조건
if not (관심종목 == 1):
    매수 = False
elif not (1000 < 현재가 <= 30000):
    매수 = False
elif not (1.0 < 등락율 <= self.vars[10]):
    매수 = False
elif not (고저평균대비등락율 > 0):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif not (분당거래대금 > 분당거래대금N(1) * self.vars[11]):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (RSI < self.vars[12]):
    매수 = False
elif 시분초 < self.vars[13]:
    if 시가총액 < 5000:
        if not (1.0 <= 시가등락율 < self.vars[14]):
            매수 = False
        elif not (1.0 <= 시가대비등락율 < self.vars[15]):
            매수 = False
        elif not (30 < 분당순매수금액 < 300):
            매수 = False
        elif not (현재가 > (분봉고가 - (분봉고가 - 분봉저가) * self.vars[16] / 100)):
            매수 = False
        elif not (누적거래대금비율 > self.vars[17]):
            매수 = False
        elif not (전일비 > self.vars[18]):
            매수 = False
        elif not (전일동시간비 > 100):
            매수 = False
        elif not (회전율 > self.vars[19]):
            매수 = False
        elif not (당일거래대금 > 3 * 100):
            매수 = False
        elif not (등락율각도(30) > -2 and 등락율각도(30) < 10):
            매수 = False
        elif not (전일비각도(30) > 0 and 전일비각도(30) < 50):
            매수 = False
        elif not (최고분당매수수량(30) > 최고분당매도수량(30) * self.vars[20]):
            매수 = False
        elif not (분당거래대금 / 분당거래대금평균(30) > self.vars[21]):
            매수 = False
        elif not (분당매수수량 > 매도총잔량 * self.vars[22] / 100):
            매수 = False
        elif not (매수총잔량 > 매도총잔량 * self.vars[23]):
            매수 = False
        elif not (매수잔량1 > 매도잔량1 * self.vars[24]):
            매수 = False
        elif not (누적분당매수수량(30) > 누적분당매도수량(30) * self.vars[25]):
            매수 = False
    else:
        매수 = False
else:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

**변경사항**:
- `초당` 변수를 `분당` 변수로 변경.
- `분봉시가`, `분봉고가`, `분봉저가` 사용.
- TA-Lib 지표(`RSI`, `이동평균`)를 활용하여 조건 최적화.

---

### 매수 최적화 범위 - C_S_2_BOR_T_Min

```python
# 매수 최적화 범위
self.vars[10] = [[15.0, 20.0, 5.0], 15.0]      # 등락율 범위: 15.0%~20.0%, 간격 5.0%
self.vars[11] = [[1.0, 2.0, 0.5], 1.5]         # 분당거래대금 증가율: 1.0배~2.0배, 간격 0.5배
self.vars[12] = [[65, 75, 5], 70]              # RSI 범위: 65~75, 간격 5
self.vars[13] = [[91000, 92000, 500], 91000]   # 시분초 범위: 09:10:00~09:20:00, 간격 5분
self.vars[14] = [[6.0, 10.0, 1.0], 10.0]       # 시가등락율 범위: 6.0%~10.0%, 간격 1.0%
self.vars[15] = [[7.0, 9.0, 1.0], 8.0]         # 시가대비등락율 범위: 7.0%~9.0%, 간격 1.0%
self.vars[16] = [[10, 30, 10], 10]             # 분봉고가 대비 현재가 비율: 10%~30%, 간격 10%
self.vars[17] = [[5, 25, 10], 5]               # 누적거래대금비율: 5%~25%, 간격 10%
self.vars[18] = [[10, 20, 10], 10]             # 전일비 범위: 10%~20%, 간격 10%
self.vars[19] = [[0.5, 2.0, 0.5], 1.0]         # 회전율 범위: 0.5배~2.0배, 간격 0.5배
self.vars[20] = [[0.5, 1.5, 0.5], 0.5]         # 최고분당매수수량 대비 최고분당매도수량 비율: 0.5배~1.5배, 간격 0.5배
self.vars[21] = [[1.5, 3.5, 1.0], 1.5]         # 분당거래대금 대비 분당거래대금평균 비율: 1.5배~3.5배, 간격 1.0배
self.vars[22] = [[20, 40, 10], 20]             # 분당매수수량 대비 매도총잔량 비율: 20%~40%, 간격 10%
self.vars[23] = [[0.5, 0.25, -0.25], 0.5]      # 매수총잔량 대비 매도총잔량 비율: 0.5배~0.25배, 간격 -0.25배
self.vars[24] = [[1.5, 2.5, 0.5], 1.5]         # 매수잔량1 대비 매도잔량1 비율: 1.5배~2.5배, 간격 0.5배
self.vars[25] = [[1, 3, 1], 1]                 # 누적분당매수수량 대비 누적분당매도수량 비율: 1배~3배, 간격 1배
# 매수 총 경우의 수: (2 x 3 x 3 x 3 x 5 x 3 x 3 x 3 x 2 x 4 x 3 x 3 x 3 x 3 x 3 x 3 = 42,515,280)
```

**변경사항**:
- 변수 이름 업데이트 (`초당` → `분당`).
- 범위와 간격은 원본 유지, 분봉 데이터에 맞게 해석.

---

### 매도 최적화 조건식 - C_S_2_SO_T_Min

```python
매도 = False

if 등락율 > 29.5:
    매도 = True
elif 시분초 < 93000:
    if self.vars[1] <= 수익률:
        매도 = True
    elif 수익률 <= self.vars[2]:
        매도 = True
    elif 최고수익률 > self.vars[3] and 최고수익률 * self.vars[4] >= 수익률:
        매도 = True
    elif 보유시간 > self.vars[5] and 수익률 < self.vars[6]:
        매도 = True
    elif 시가총액 < 2500000:
        if (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.8 and (현재가 / 현재가N(1) - 1) * 100 < self.vars[7]:
            매도 = True
        elif 수익률 < self.vars[8] and 체결강도N(1) > 체결강도평균(30, 1) > 체결강도:
            매도 = True
        elif self.vars[9] < 최고수익률 and 현재가N(1) >= 이동평균(60, 1) and 이동평균(60) > 현재가:
            매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

**변경사항**:
- `초당` 변수를 `분당` 변수로 변경.
- `보유시간`은 분 단위로 해석.
- TA-Lib 지표(`이동평균`, `체결강도평균`)를 활용.

---

### 매도 최적화 범위 - C_S_2_SOR_T1_Min

```python
# 매도 최적화 범위
self.vars[0] = [[30, 30, 0], 30]               # 고정값: 30
self.vars[1] = [[4.0, 6.0, 1.0], 5.0]          # 수익률 조건: 4.0%~6.0%, 간격 1.0%
self.vars[2] = [[-4.0, -2.0, 1.0], -4.0]       # 손실 수익률 조건: -4.0%~-2.0%, 간격 1.0%
self.vars[3] = [[2.0, 4.0, 1.0], 3.0]          # 최고수익률 기준값: 2.0%~4.0%, 간격 1.0%
self.vars[4] = [[0.6, 0.8, 0.1], 0.7]          # 최고수익률 대비 현재 수익률 비율: 0.6~0.8, 간격 0.1
self.vars[5] = [[300, 1200, 300], 600]         # 보유시간 조건: 300분~1200분, 간격 300분
self.vars[6] = [[-1.0, 1.0, 1.0], 1.0]         # 보유시간 초과 시 수익률 하한: -1.0%~1.0%, 간격 1.0%
self.vars[7] = [[-0.1, -0.2, -0.05], -0.1]     # 현재가 변화율 하한: -0.1%~-0.2%, 간격 -0.05%
self.vars[8] = [[-2.0, 0, 1], -1.0]            # 손실 수익률 조건: -2.0%~0%, 간격 1%
self.vars[9] = [[2.0, 4.0, 1.0], 3.0]          # 최고수익률 조건: 2.0%~4.0%, 간격 1.0%
# 매도 총 경우의 수: (1 x 3 x 3 x 3 x 3 x 4 x 3 x 3 x 3 x 3 = 26,244)
```

**변경사항**:
- `보유시간` 범위를 분 단위로 조정 (초 → 분).
- 기타 범위는 원본 유지.

---

### 매수 매도 최적화 범위 - C_S_2_OR_T1_Min

```python
# 매도 최적화 범위
self.vars[0] = [[30, 30, 0], 30]
self.vars[1] = [[4.0, 6.0, 1.0], 5.0]
self.vars[2] = [[-4.0, -2.0, 1.0], -4.0]
self.vars[3] = [[2.0, 4.0, 1.0], 3.0]
self.vars[4] = [[0.6, 0.8, 0.1], 0.7]
self.vars[5] = [[300, 1200, 300], 600]
self.vars[6] = [[-1.0, 1.0, 1.0], 1.0]
self.vars[7] = [[-0.1, -0.2, -0.05], -0.1]
self.vars[8] = [[-2.0, 0, 1], -1.0]
self.vars[9] = [[2.0, 4.0, 1.0], 3.0]
# 매도 총 경우의 수: (1 x 3 x 3 x 3 x 3 x 4 x 3 x 3 x 3 x 3 = 26,244)

# 매수 최적화 범위
self.vars[10] = [[15.0, 20.0, 5.0], 15.0]
self.vars[11] = [[1.0, 2.0, 0.5], 1.5]
self.vars[12] = [[65, 75, 5], 70]
self.vars[13] = [[91000, 92000, 500], 91000]
self.vars[14] = [[6.0, 10.0, 1.0], 10.0]
self.vars[15] = [[7.0, 9.0, 1.0], 8.0]
self.vars[16] = [[10, 30, 10], 10]
self.vars[17] = [[5, 25, 10], 5]
self.vars[18] = [[10, 20, 10], 10]
self.vars[19] = [[0.5, 2.0, 0.5], 1.0]
self.vars[20] = [[0.5, 1.5, 0.5], 0.5]
self.vars[21] = [[1.5, 3.5, 1.0], 1.5]
self.vars[22] = [[20, 40, 10], 20]
self.vars[23] = [[0.5, 0.25, -0.25], 0.5]
self.vars[24] = [[1.5, 2.5, 0.5], 1.5]
self.vars[25] = [[1, 3, 1], 1]
# 매수 총 경우의 수: (2 x 3 x 3 x 3 x 5 x 3 x 3 x 3 x 2 x 4 x 3 x 3 x 3 x 3 x 3 x 3 = 42,515,280)

# 매수 매도 총 경우의 수: (26,244 x 42,515,280 = 1,115,771,008,320)
```

---

### 매수 매도 최적화 범위 - C_S_2_OR_T1_2_Min

```python
# 매도 최적화 범위
self.vars[0] = [[30, 30, 0], 30]
self.vars[1] = [[1.0, 7.0, 1.0], 0.5]
self.vars[2] = [[-5.0, -1.0, 0.5], -4.0]
self.vars[3] = [[1.0, 6.0, 1.0], 0.5]
self.vars[4] = [[0.6, 0.8, 0.05], 0.7]
self.vars[5] = [[60, 1200, 60], 600]
self.vars[6] = [[-4.0, 1.0, 0.5], 1.0]
self.vars[7] = [[-0.05, -0.3, -0.05], -0.1]
self.vars[8] = [[-3.0, 0, 0.5], -1.0]
self.vars[9] = [[1.0, 5.0, 0.5], 3.0]
# 매도 총 경우의 수: (1 x 7 x 9 x 6 x 5 x 20 x 11 x 6 x 7 x 9 = 157,172,400)

# 매수 최적화 범위
self.vars[10] = [[15.0, 20.0, 1.0], 15.0]
self.vars[11] = [[1.0, 5.0, 0.5], 1.5]
self.vars[12] = [[75, 80, 5], 75]
self.vars[13] = [[91000, 91000, 0], 91000]
self.vars[14] = [[4.0, 10.0, 0.5], 10.0]
self.vars[15] = [[5.0, 9.0, 0.5], 8.0]
self.vars[16] = [[10, 50, 5], 10]
self.vars[17] = [[5, 10, 5], 5]
self.vars[18] = [[5, 20, 5], 10]
self.vars[19] = [[0.5, 2.0, 0.5], 1.0]
self.vars[20] = [[0.5, 2.0, 0.5], 0.5]
self.vars[21] = [[1.0, 4.0, 0.5], 1.5]
self.vars[22] = [[10, 25, 5], 20]
self.vars[23] = [[0.25, 1, 0.25], 0.5]
self.vars[24] = [[1.0, 2.0, 0.5], 1.5]
self.vars[25] = [[1.0, 2.0, 0.5], 1]
# 매수 총 경우의 수: (6 x 9 x 2 x 1 x 13 x 9 x 9 x 2 x 4 x 4 x 4 x 7 x 4 x 4 x 3 x 3 = 55,024,220,160)

# 매수 매도 총 경우의 수: (157,172,400 × 55,024,220,160 ≈ 8.65 × 10^18)
```

---

### 매수 매도 최적화 범위 - C_S_2_OR_T1T_Min

```python
# 매도 최적화 범위
self.vars[0] = [[30, 30, 0], 30]
self.vars[1] = [[4.0, 6.0, 1.0], 5.0]
self.vars[2] = [[-4.0, -4.0, 0], -4.0]
self.vars[3] = [[3.0, 3.0, 0], 3.0]
self.vars[4] = [[0.7, 0.7, 0], 0.7]
self.vars[5] = [[600, 600, 0], 600]
self.vars[6] = [[1.0, 1.0, 0], 1.0]
self.vars[7] = [[-0.1, -0.1, 0], -0.1]
self.vars[8] = [[-1.0, -1.0, 0], -1.0]
self.vars[9] = [[3.0, 3.0, 0], 3.0]

# 매수 최적화 범위
self.vars[10] = [[10.0, 20.0, 5.0], 15.0]
self.vars[11] = [[1.5, 1.5, 0], 1.5]
self.vars[12] = [[80, 80, 0], 80]
self.vars[13] = [[91000, 91000, 0], 91000]
self.vars[14] = [[10.0, 10.0, 0], 10.0]
self.vars[15] = [[8.0, 8.0, 0], 8.0]
self.vars[16] = [[10, 10, 0], 10]
self.vars[17] = [[5, 5, 0], 5]
self.vars[18] = [[10, 10, 0], 10]
self.vars[19] = [[1.0, 1.0, 0], 1.0]
self.vars[20] = [[0.5, 0.5, 0], 0.5]
self.vars[21] = [[1.5, 1.5, 0], 1.5]
self.vars[22] = [[20, 20, 0], 20]
self.vars[23] = [[0.5, 0.5, 0], 0.5]
self.vars[24] = [[1.5, 1.5, 0], 1.5]
self.vars[25] = [[1, 1, 0], 1]
```

---

### 예상 시간 계산

- **매도 조건 변수 범위**: 
  - 3 × 3 × 3 × 3 × 4 × 3 × 3 × 3 × 3 = 26,244
- **매수 조건 변수 범위**: 
  - 2 × 3 × 3 × 3 × 5 × 3 × 3 × 3 × 2 × 4 × 3 × 3 × 3 × 3 × 3 × 3 = 42,515,280
- **총 경우의 수**: 
  - 26,244 × 42,515,280 = 1,115,771,008,320

각 경우에 1분이 걸린다고 가정하면:
- **분**: 1,115,771,008,320 분
- **시간**: 1,115,771,008,320 / 60 ≈ 18,596,183,472 시간
- **일**: 18,596,183,472 / 24 ≈ 774,841,811 일
- **년**: 774,841,811 / 365 ≈ 2,122,580 년

**가정**: 각 경우의 수를 처리하는 데 1분 소요. 이는 비현실적인 시간이므로, 범위를 좁히거나 간격을 조정해야 함.

---

### GA 최적화 범위 - C_S_2_GAR_T_Min

- **GA 최적화 변환 방법 및 원리**:
  - 기존 범위는 `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]` 형식.
  - GA 최적화에서는 `self.vars[정수] = [전체 리스트, 최적값]`로 변환.
  - 예: `self.vars[1] = [[0, 10, 1], 3]` → `self.vars[1] = [[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10], 3]`.
  - 유전 알고리즘은 자연 선택, 교차, 돌연변이를 통해 최적값 탐색.
  - 탐색 공간을 명시적으로 정의하여 효율적인 최적화 수행.

```python
# GA 최적화 범위 예시 (매수 변수 10번 예시)
self.vars[10] = [[15.0, 16.0, 17.0, 18.0, 19.0, 20.0], 15.0]  # 등락율
self.vars[11] = [[1.0, 1.5, 2.0], 1.5]  # 분당거래대금 증가율
# ... (다른 변수들도 유사하게 변환)
```

---

## 조건식 개선 방향 연구

### 1. TA-Lib 보조지표 활용 연구

**우선순위: 높음**
- **MACD 추가 활용**
  - MACD 골든크로스/데드크로스 신호를 매수/매도 조건에 추가
  - MACD 히스토그램 증가/감소 추세 확인
  - 구현 난이도: 낮음

**우선순위: 높음**
- **볼린저 밴드 활용**
  - 볼린저 밴드 상단/하단 돌파 확인
  - 밴드폭(BB Width) 기반 변동성 측정
  - 구현 난이도: 낮음

**우선순위: 중간**
- **Stochastic Oscillator 활용**
  - %K, %D 라인 교차 확인
  - 과매수/과매도 구간 추가 검증
  - 구현 난이도: 중

### 2. 시간대별 전략 세분화 연구

**우선순위: 높음**
- **09:00~09:02 vs 09:02~09:05 세분화**
  - 초반 2분과 후속 3분의 시장 특성 차이 반영
  - 각 구간별 다른 RSI 임계값 적용
  - 구현 난이도: 낮음

### 3. 매도 조건 고도화 연구

**우선순위: 높음**
- **보유시간 기반 동적 손익 조정**
  - 보유시간 60분 이상: 목표 수익률 낮춤 (빠른 청산)
  - 최고수익률 대비 하락폭 임계값 동적 조정
  - 구현 난이도: 중

**우선순위: 중간**
- **등락율각도 기반 추세 약화 감지**
  - 등락율각도(30) 급격한 하락 시 조기 청산
  - 당일거래대금각도(30) 하락과 결합 확인
  - 구현 난이도: 낮음

### 4. 리스크 관리 강화 연구

**우선순위: 높음**
- **최저현재가 추적 강화**
  - 최저현재가(60) 업데이트 주기를 30분으로 단축
  - 최저가 대비 일정 비율 하락 시 즉시 청산
  - 구현 난이도: 낮음

**우선순위: 중간**
- **변동성 기반 진입 회피**
  - ATR(Average True Range) 기반 변동성 측정
  - 고변동성 구간 진입 회피 또는 보수적 진입
  - 구현 난이도: 중

### 5. 최적화 전략 개선 연구

**우선순위: 높음**
- **변수 간격 축소**
  - 현재 간격이 너무 넓어 최적값 놓칠 가능성
  - 1단계: 넓은 간격으로 대략적인 영역 탐색
  - 2단계: 좁은 간격으로 정밀 탐색
  - 구현 난이도: 낮음

**우선순위: 중간**
- **교차검증 추가**
  - 기간별 분할 백테스팅 (train/validation/test split)
  - 과최적화(overfitting) 방지
  - 구현 난이도: 중

### 구현 우선순위

1. **1단계 (즉시 구현)**:
   - MACD 추가 활용
   - 볼린저 밴드 활용
   - 시간대별 세분화 (09:00~09:02 / 09:02~09:05)
   - 최저현재가 추적 강화

2. **2단계 (1개월 내)**:
   - 보유시간 기반 동적 손익 조정
   - 등락율각도 기반 추세 약화 감지
   - 변수 간격 축소 (2단계 최적화)

3. **3단계 (3개월 내)**:
   - Stochastic Oscillator 활용
   - 변동성 기반 진입 회피 (ATR)
   - 교차검증 추가

---

## 태그

- #주식트레이딩
- #분봉트레이딩
- #매수조건
- #매도조건
- #최적화
- #유전알고리즘
- #파이썬
- #트레이딩로직
- #분봉백테스팅
- #RSI
- #MACD
- #갭상승전략
- #리스크관리

---

**Last Update**: 2025-07-15

**참고 문서**: `Back_Testing_Guideline_Min.md`, `Condition_Study_3_902.md`

