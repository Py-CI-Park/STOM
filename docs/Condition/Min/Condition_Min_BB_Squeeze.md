---
tags: [StockTrading, AutomatedTrading, MinuteBacktesting, BollingerBand, Squeeze, Breakout, ConditionStrategy, Optimization]
---

# 조건식 (Condition) - 분봉 백테스팅

## 📋 Answer Instructions

This document presents a Bollinger Band Squeeze Breakout strategy for minute-based (1-minute candlestick) backtesting, based on the guidelines provided in `Back_Testing_Guideline_Min.md`. The strategy identifies periods of low volatility (squeeze) followed by significant breakouts.

---

## 목차
- [[#조건식 (Condition) - 분봉 백테스팅]]
  - [[#📋 Answer Instructions]]
  - [[#목차]]
  - [[#소개]]
  - [[#가이드라인]]
    - [[#저장 이름 규칙]]
- [[#Condition - Bollinger Band Squeeze Breakout (볼린저밴드 압축 돌파)]]
  - [[#전략 개요]]
  - [[#조건식]]
    - [[#매수 조건식 - C_M_BB_SQ_B]]
    - [[#매도 조건식 - C_M_BB_SQ_S]]
  - [[#최적화 조건식]]
    - [[#매수 최적화 조건식 - C_M_BB_SQ_BO]]
    - [[#매수 최적화 범위 - C_M_BB_SQ_BOR]]
    - [[#매도 최적화 조건식 - C_M_BB_SQ_SO]]
    - [[#매도 최적화 범위 - C_M_BB_SQ_SOR]]
    - [[#매수 매도 최적화 범위 - C_M_BB_SQ_OR]]
    - [[#예상 시간 계산]]
    - [[#GA 최적화 범위 - C_M_BB_SQ_GAR]]
  - [[#태그]]

---

## 소개

이 문서는 STOM 주식 자동거래 시스템에서 1분봉 데이터를 활용한 **볼린저밴드 압축 돌파** 전략 조건식입니다. 이 전략은 변동성이 낮은 구간(압축)에서 높은 구간(돌파)으로 전환되는 시점을 포착하여 매수하는 패턴입니다.

**전략의 핵심 개념**:
- **패턴**: 볼린저밴드 폭이 좁아진 후(압축) 가격이 상단밴드를 돌파하며 확장
- **원리**: 낮은 변동성 후 높은 변동성이 발생하며, 방향성이 명확해지는 시점 포착
- **특징**:
  - 볼린저밴드 폭이 최근 평균 대비 70% 이하로 수축
  - 현재가가 볼린저밴드 상단(BBU)을 상향 돌파
  - RSI가 50 이상으로 상승 모멘텀 확인
  - MACD 히스토그램이 양수 전환
  - 분당거래대금이 평균 대비 2배 이상 증가

---

## 가이드라인

- 모든 조건식은 Python으로 작성되었으며, 1분봉 데이터를 기반으로 주식 거래 자동화를 목표로 합니다.
- 각 조건식은 특정 조건을 만족할 때 매수 또는 매도를 실행합니다.
- 최적화 조건식은 변수의 범위를 설정하여 최적의 매수/매도 시점을 찾습니다.
- 최적화 범위는 `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]` 형식으로 설정합니다.
- **분봉 데이터 특화**:
  - 1분봉 데이터(분봉시가, 분봉고가, 분봉저가, 현재가)를 사용.
  - TA-Lib 보조지표(Bollinger Bands, MACD, RSI, ATR 등)를 활용하여 변동성 및 추세 분석.
- GA(유전 알고리즘) 최적화 범위 생성 방법:
  - 유전 알고리즘을 사용하여 최적의 매수/매도 시점을 찾기 위해 변수 범위를 설정.
  - 각 변수는 `self.vars[정수] = [범위리스트, 고정값]` 형식으로 정의.
  - 범위리스트는 탐색할 값들을 나열하며, 고정값은 하나의 수로 입력.
  - 변수 범위는 10개 이하, 최대 20개로 제한하여 계산 효율성을 높임.

### 저장 이름 규칙

1. **기본 규칙**:
   - `C`: Condition
   - `M`: Minute (분봉)
   - `BB_SQ`: Bollinger Band Squeeze (볼린저밴드 압축 돌파)
   - `B`: 매수 조건식
   - `S`: 매도 조건식
   - `BO`: 매수 최적화 조건식
   - `SO`: 매도 최적화 조건식
   - `OR`: 매수 매도 통합 최적화 범위
   - `GAR`: GA 최적화 범위

2. **예시**:
   - `C_M_BB_SQ_B`: 볼린저밴드 압축 돌파 패턴의 매수 조건식
   - `C_M_BB_SQ_S`: 볼린저밴드 압축 돌파 패턴의 매도 조건식
   - `C_M_BB_SQ_BO`: 볼린저밴드 압축 돌파 패턴의 매수 최적화 조건식

3. **확장성 고려**:
   - 날짜 또는 버전 추가: `C_M_BB_SQ_B_20250117`, `C_M_BB_SQ_B_v1.0`
   - 설명 추가: `C_M_BB_SQ_B_LowVol`
   - 프로젝트 구분: `ProjA_C_M_BB_SQ_B`

---

# Condition - Bollinger Band Squeeze Breakout (볼린저밴드 압축 돌파)

## 전략 개요

### 패턴 인식 로직

**볼린저밴드 압축 (Bollinger Band Squeeze) 정의**:
- 볼린저밴드 상단(BBU)과 하단(BBL)의 폭이 최근 평균 대비 70% 이하로 수축
- 변동성 지표(ATR)가 최근 평균 대비 60% 이하로 감소
- 가격이 볼린저밴드 중심선(BBM) 근처에서 횡보

**돌파 확인**:
- 현재가가 볼린저밴드 상단(BBU)을 상향 돌파
- 1분봉 전에는 BBU 아래였으나 현재 BBU 위로 진입
- 돌파 시점에 거래량 급증 (분당거래대금이 평균 대비 2배 이상)
- RSI가 50 이상으로 상승 모멘텀
- MACD 히스토그램이 양수이며 증가 추세

**추세 지속성 확인**:
- 이동평균(20분)이 상승 추세 (현재 > 1분봉 전)
- 분당매수수량이 분당매도수량 대비 1.3배 이상
- 체결강도가 110 이상
- 현재가가 분봉고가 대비 10% 이내

### 시장 상황별 전략

**소형주 (시가총액 < 3000억)**:
- 높은 변동성으로 인해 더 명확한 돌파 신호 요구
- RSI 최소 55 이상
- 분당거래대금 평균 대비 2.5배 이상
- 체결강도 최소 120 이상

**중형주 (3000억 <= 시가총액 < 10000억)**:
- 중간 수준의 돌파 조건
- RSI 최소 52 이상
- 분당거래대금 평균 대비 2.0배 이상
- 체결강도 최소 110 이상

**대형주 (시가총액 >= 10000억)**:
- 안정적인 돌파 패턴 선호
- RSI 최소 50 이상
- 분당거래대금 평균 대비 1.8배 이상
- 체결강도 최소 100 이상

## 조건식

### 매수 조건식 - C_M_BB_SQ_B

```python
# ================================
#  공통 계산 지표
# ================================
전일종가          = 현재가 / (1 + (등락율 / 100))                      # 단위: 원
볼린저밴드폭      = (BBU - BBL) / BBM * 100 if BBM != 0 else 0         # 단위: 퍼센트
볼린저밴드폭평균  = (최고분봉고가(20) - 최저분봉저가(20)) / 이동평균(20) * 100 if 이동평균(20) != 0 else 0
압축여부          = (볼린저밴드폭 < 볼린저밴드폭평균 * 0.7)              # 평균 대비 70% 이하
돌파여부          = (현재가 > BBU and 현재가N(1) <= BBU_N(1))          # BBU 상향 돌파
분당순매수금액    = (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000   # 단위: 백만원
거래대금증가배수  = (분당거래대금 / 분당거래대금평균(30)) if 분당거래대금평균(30) != 0 else 0
MACD상승여부      = (MACD > 0 and MACD > MACD_N(1))
RSI상승모멘텀     = (RSI > 50 and RSI > RSI_N(1))
이평상승추세      = (이동평균(20) > 이동평균(20, 1))



# ================================
#  매수 조건 (볼린저밴드 압축 돌파)
# ================================
매수 = True


if not (관심종목 == 1):                         # 공통 필터 – 관심종목
    매수 = False


# ---------- 시간대 제한 (09:10:00 ~ 14:50:00) ----------
elif not (91000 <= 시분초 < 145000):
    매수 = False


# ---------- 기본 가격 필터 ----------
elif not (1000 < 현재가 <= 100000):
    매수 = False
elif not (-1.0 < 등락율 <= 25.0):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False


# ---------- 데이터 길이 확인 (최소 30분봉 필요) ----------
elif not (데이터길이 >= 30):
    매수 = False


# ---------- 볼린저밴드 압축 및 돌파 확인 ----------
elif not 돌파여부:                              # BBU 상향 돌파 필수
    매수 = False
elif not (현재가 > BBM):                        # 중심선 위
    매수 = False


# ---------- 거래량 증가 확인 ----------
elif not (거래대금증가배수 >= 2.0):              # 평균 대비 2배 이상
    매수 = False
elif not (분당거래대금 > 분당거래대금N(1) * 1.2):
    매수 = False


# ---------- 기술적 지표 확인 ----------
elif not RSI상승모멘텀:                         # RSI 상승 모멘텀
    매수 = False
elif not MACD상승여부:                          # MACD 양수 및 상승
    매수 = False
elif not 이평상승추세:                          # 이동평균 상승 추세
    매수 = False
elif not (ATR < ATR_N(10)):                     # 변동성 증가 시작
    매수 = False


# ---------- 매수세 우위 확인 ----------
elif not (분당매수수량 > 분당매도수량 * 1.3):
    매수 = False
elif not (체결강도 >= 110):
    매수 = False


# ---------- 가격 위치 확인 ----------
elif not (현재가 > 분봉고가 * 0.90):            # 분봉고가 대비 10% 이내
    매수 = False
elif not (현재가 < 최고분봉고가(20) * 1.05):    # 과열 방지
    매수 = False


# ---------- 시가총액별 세부 조건 ----------
else:
    if 시가총액 < 3000:                           # 소형주
        if not (10 < 분당순매수금액 < 3000):
            매수 = False
        elif not (RSI >= 55 and RSI <= 75):
            매수 = False
        elif not (전일비 > 30 and 전일동시간비 > 30):
            매수 = False
        elif not (회전율 > 2.0):
            매수 = False
        elif not (당일거래대금 > 300 * 100):
            매수 = False
        elif not (거래대금증가배수 >= 2.5):
            매수 = False
        elif not (체결강도 >= 120 and 체결강도 <= 300):
            매수 = False
        elif not (등락율각도(20) > 2):
            매수 = False
        elif not (MACD > MACDS):                  # MACD 골든크로스
            매수 = False

    elif 시가총액 < 10000:                        # 중형주
        if not (30 < 분당순매수금액 < 5000):
            매수 = False
        elif not (RSI >= 52 and RSI <= 75):
            매수 = False
        elif not (전일비 > 20 and 전일동시간비 > 20):
            매수 = False
        elif not (회전율 > 1.5):
            매수 = False
        elif not (당일거래대금 > 500 * 100):
            매수 = False
        elif not (거래대금증가배수 >= 2.0):
            매수 = False
        elif not (체결강도 >= 110 and 체결강도 <= 300):
            매수 = False
        elif not (등락율각도(20) > 1):
            매수 = False
        elif not (MACD > MACDS):
            매수 = False

    else:                                         # 대형주
        if not (50 < 분당순매수금액 < 10000):
            매수 = False
        elif not (RSI >= 50 and RSI <= 70):
            매수 = False
        elif not (전일비 > 10 and 전일동시간비 > 10):
            매수 = False
        elif not (회전율 > 1.0):
            매수 = False
        elif not (당일거래대금 > 1000 * 100):
            매수 = False
        elif not (거래대금증가배수 >= 1.8):
            매수 = False
        elif not (체결강도 >= 100 and 체결강도 <= 300):
            매수 = False
        elif not (등락율각도(20) > 0.5):
            매수 = False
        elif not (MACD > MACDS * 0.9):
            매수 = False


# ================================
#  매수 호출
# ================================
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식 - C_M_BB_SQ_S

```python
# ================================
#  공통 계산 지표
# ================================
볼린저상단이탈여부  = (현재가 < BBU and 현재가N(1) >= BBU_N(1))         # BBU 하향 이탈
RSI과매수여부       = (RSI > 75)
MACD하락여부        = (MACD < MACDS and MACD_N(1) >= MACDS_N(1))     # MACD 데드크로스
이평하락추세        = (이동평균(20) < 이동평균(20, 1))
체결강도약화여부    = (체결강도 < 100 and 체결강도 < 체결강도평균(20))



# ================================
#  매도 조건 (볼린저밴드 압축 돌파)
# ================================
매도 = False


# 등락율 상한가 직전
if 등락율 > 28.0:
    매도 = True

# 목표 수익률 달성
elif 수익률 >= 7.0:
    매도 = True

# 손절
elif 수익률 <= -3.0:
    매도 = True

# 최고수익률 대비 하락
elif 최고수익률 > 10.0 and 최고수익률 * 0.70 >= 수익률:
    매도 = True

# 보유시간 초과
elif 보유시간 > 180:                            # 3시간(180분) 초과
    매도 = True

# 볼린저밴드 상단 이탈
elif 볼린저상단이탈여부 and 수익률 > 2.0:
    매도 = True

# RSI 과매수 구간 진입
elif RSI과매수여부 and 최고수익률 > 5.0:
    매도 = True

# MACD 데드크로스
elif MACD하락여부 and 수익률 > 3.0:
    매도 = True

# 이동평균 하향 이탈
elif 이평하락추세 and 현재가 < 이동평균(20) and 수익률 > 2.0:
    매도 = True

# 체결강도 약화
elif 체결강도약화여부 and 최고수익률 > 4.0:
    매도 = True

# 시가총액별 매도 조건
elif 시가총액 < 10000:
    # 등락율 각도별 매도 압력 확인
    if 등락율각도(20) >= 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.4 and (현재가 / 현재가N(1) - 1) * 100 < -0.3:
        매도 = True
    elif 5 <= 등락율각도(20) < 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.5 and (현재가 / 현재가N(1) - 1) * 100 < -0.4:
        매도 = True
    elif 0 <= 등락율각도(20) < 5 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.6 and (현재가 / 현재가N(1) - 1) * 100 < -0.3:
        매도 = True
    elif 등락율각도(20) < 0 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.7 and (현재가 / 현재가N(1) - 1) * 100 < -0.4:
        매도 = True

    # 고가 대비 하락률 매도
    elif 현재가 < 분봉고가 * 0.95 and 최고수익률 > 6.0:
        매도 = True


# ================================
#  매도 호출
# ================================
if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

## 최적화 조건식

### 매수 최적화 조건식 - C_M_BB_SQ_BO

```python
# ================================
#  공통 계산 지표
# ================================
전일종가          = 현재가 / (1 + (등락율 / 100))
볼린저밴드폭      = (BBU - BBL) / BBM * 100 if BBM != 0 else 0
볼린저밴드폭평균  = (최고분봉고가(20) - 최저분봉저가(20)) / 이동평균(20) * 100 if 이동평균(20) != 0 else 0
압축여부          = (볼린저밴드폭 < 볼린저밴드폭평균 * self.vars[2])
돌파여부          = (현재가 > BBU and 현재가N(1) <= BBU_N(1))
분당순매수금액    = (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000
거래대금증가배수  = (분당거래대금 / 분당거래대금평균(30)) if 분당거래대금평균(30) != 0 else 0
MACD상승여부      = (MACD > 0 and MACD > MACD_N(1))
RSI상승모멘텀     = (RSI > self.vars[3] and RSI > RSI_N(1))
이평상승추세      = (이동평균(20) > 이동평균(20, 1))

매수 = True

if not (관심종목 == 1):
    매수 = False
elif not (91000 <= 시분초 < 145000):
    매수 = False
elif not (1000 < 현재가 <= 100000):
    매수 = False
elif not (-1.0 < 등락율 <= self.vars[1]):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (데이터길이 >= 30):
    매수 = False
elif not 돌파여부:
    매수 = False
elif not (현재가 > BBM):
    매수 = False
elif not (거래대금증가배수 >= self.vars[4]):
    매수 = False
elif not (분당거래대금 > 분당거래대금N(1) * self.vars[5]):
    매수 = False
elif not RSI상승모멘텀:
    매수 = False
elif not MACD상승여부:
    매수 = False
elif not 이평상승추세:
    매수 = False
elif not (ATR < ATR_N(10)):
    매수 = False
elif not (분당매수수량 > 분당매도수량 * self.vars[6]):
    매수 = False
elif not (체결강도 >= self.vars[7]):
    매수 = False
elif not (현재가 > 분봉고가 * self.vars[8]):
    매수 = False
elif not (현재가 < 최고분봉고가(20) * self.vars[9]):
    매수 = False
else:
    if 시가총액 < 3000:
        if not (self.vars[10] < 분당순매수금액 < 3000):
            매수 = False
        elif not (RSI >= self.vars[11] and RSI <= 75):
            매수 = False
        elif not (전일비 > self.vars[12] and 전일동시간비 > self.vars[13]):
            매수 = False
        elif not (회전율 > self.vars[14]):
            매수 = False
        elif not (당일거래대금 > self.vars[15] * 100):
            매수 = False
        elif not (거래대금증가배수 >= self.vars[16]):
            매수 = False
        elif not (체결강도 >= self.vars[17] and 체결강도 <= 300):
            매수 = False
        elif not (등락율각도(20) > self.vars[18]):
            매수 = False
        elif not (MACD > MACDS):
            매수 = False
    elif 시가총액 < 10000:
        if not (self.vars[19] < 분당순매수금액 < 5000):
            매수 = False
        elif not (RSI >= self.vars[20] and RSI <= 75):
            매수 = False
        elif not (전일비 > self.vars[21] and 전일동시간비 > self.vars[22]):
            매수 = False
        elif not (회전율 > self.vars[23]):
            매수 = False
        elif not (당일거래대금 > self.vars[24] * 100):
            매수 = False
        elif not (거래대금증가배수 >= self.vars[25]):
            매수 = False
        elif not (체결강도 >= self.vars[26] and 체결강도 <= 300):
            매수 = False
        elif not (등락율각도(20) > self.vars[27]):
            매수 = False
        elif not (MACD > MACDS):
            매수 = False
    else:
        if not (self.vars[28] < 분당순매수금액 < 10000):
            매수 = False
        elif not (RSI >= self.vars[29] and RSI <= 70):
            매수 = False
        elif not (전일비 > self.vars[30] and 전일동시간비 > self.vars[31]):
            매수 = False
        elif not (회전율 > self.vars[32]):
            매수 = False
        elif not (당일거래대금 > self.vars[33] * 100):
            매수 = False
        elif not (거래대금증가배수 >= self.vars[34]):
            매수 = False
        elif not (체결강도 >= self.vars[35] and 체결강도 <= 300):
            매수 = False
        elif not (등락율각도(20) > self.vars[36]):
            매수 = False
        elif not (MACD > MACDS * self.vars[37]):
            매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위 - C_M_BB_SQ_BOR

```python
# 볼린저밴드 압축 돌파 패턴 최적화 범위
self.vars[1] = [[22.0, 28.0, 3.0], 25.0]         # 등락율 상한: 22.0%에서 28.0%까지 3.0% 간격, 범위 갯수: 3
self.vars[2] = [[0.6, 0.8, 0.1], 0.7]            # 압축비율: 0.6배에서 0.8배까지 0.1배 간격, 범위 갯수: 3
self.vars[3] = [[48, 54, 3], 50]                 # RSI 하한: 48에서 54까지 3 간격, 범위 갯수: 3
self.vars[4] = [[1.8, 2.2, 0.2], 2.0]            # 거래대금증가배수: 1.8배에서 2.2배까지 0.2배 간격, 범위 갯수: 3
self.vars[5] = [[1.15, 1.25, 0.05], 1.20]        # 분당거래대금증가율: 1.15배에서 1.25배까지 0.05배 간격, 범위 갯수: 3
self.vars[6] = [[1.2, 1.4, 0.1], 1.3]            # 분당매수우세비율: 1.2배에서 1.4배까지 0.1배 간격, 범위 갯수: 3
self.vars[7] = [[105, 115, 5], 110]              # 체결강도 하한: 105에서 115까지 5 간격, 범위 갯수: 3
self.vars[8] = [[0.88, 0.92, 0.02], 0.90]        # 분봉고가대비비율: 0.88배에서 0.92배까지 0.02배 간격, 범위 갯수: 3
self.vars[9] = [[1.03, 1.07, 0.02], 1.05]        # 최고분봉고가대비비율: 1.03배에서 1.07배까지 0.02배 간격, 범위 갯수: 3

# 소형주 (시가총액 < 3000) 최적화 범위
self.vars[10] = [[8, 12, 2], 10]                 # 분당순매수금액 하한: 8에서 12까지 2 간격, 범위 갯수: 3
self.vars[11] = [[53, 57, 2], 55]                # RSI 하한: 53에서 57까지 2 간격, 범위 갯수: 3
self.vars[12] = [[25, 35, 5], 30]                # 전일비: 25에서 35까지 5 간격, 범위 갯수: 3
self.vars[13] = [[25, 35, 5], 30]                # 전일동시간비: 25에서 35까지 5 간격, 범위 갯수: 3
self.vars[14] = [[1.8, 2.2, 0.2], 2.0]           # 회전율: 1.8배에서 2.2배까지 0.2배 간격, 범위 갯수: 3
self.vars[15] = [[250, 350, 50], 300]            # 당일거래대금: 250에서 350까지 50 간격, 범위 갯수: 3
self.vars[16] = [[2.3, 2.7, 0.2], 2.5]           # 거래대금증가배수: 2.3배에서 2.7배까지 0.2배 간격, 범위 갯수: 3
self.vars[17] = [[115, 125, 5], 120]             # 체결강도 하한: 115에서 125까지 5 간격, 범위 갯수: 3
self.vars[18] = [[1.5, 2.5, 0.5], 2.0]           # 등락율각도: 1.5에서 2.5까지 0.5 간격, 범위 갯수: 3

# 중형주 (3000 <= 시가총액 < 10000) 최적화 범위
self.vars[19] = [[25, 35, 5], 30]                # 분당순매수금액 하한: 25에서 35까지 5 간격, 범위 갯수: 3
self.vars[20] = [[50, 54, 2], 52]                # RSI 하한: 50에서 54까지 2 간격, 범위 갯수: 3
self.vars[21] = [[15, 25, 5], 20]                # 전일비: 15에서 25까지 5 간격, 범위 갯수: 3
self.vars[22] = [[15, 25, 5], 20]                # 전일동시간비: 15에서 25까지 5 간격, 범위 갯수: 3
self.vars[23] = [[1.3, 1.7, 0.2], 1.5]           # 회전율: 1.3배에서 1.7배까지 0.2배 간격, 범위 갯수: 3
self.vars[24] = [[450, 550, 50], 500]            # 당일거래대금: 450에서 550까지 50 간격, 범위 갯수: 3
self.vars[25] = [[1.8, 2.2, 0.2], 2.0]           # 거래대금증가배수: 1.8배에서 2.2배까지 0.2배 간격, 범위 갯수: 3
self.vars[26] = [[105, 115, 5], 110]             # 체결강도 하한: 105에서 115까지 5 간격, 범위 갯수: 3
self.vars[27] = [[0.5, 1.5, 0.5], 1.0]           # 등락율각도: 0.5에서 1.5까지 0.5 간격, 범위 갯수: 3

# 대형주 (시가총액 >= 10000) 최적화 범위
self.vars[28] = [[45, 55, 5], 50]                # 분당순매수금액 하한: 45에서 55까지 5 간격, 범위 갯수: 3
self.vars[29] = [[48, 52, 2], 50]                # RSI 하한: 48에서 52까지 2 간격, 범위 갯수: 3
self.vars[30] = [[5, 15, 5], 10]                 # 전일비: 5에서 15까지 5 간격, 범위 갯수: 3
self.vars[31] = [[5, 15, 5], 10]                 # 전일동시간비: 5에서 15까지 5 간격, 범위 갯수: 3
self.vars[32] = [[0.8, 1.2, 0.2], 1.0]           # 회전율: 0.8배에서 1.2배까지 0.2배 간격, 범위 갯수: 3
self.vars[33] = [[900, 1100, 100], 1000]         # 당일거래대금: 900에서 1100까지 100 간격, 범위 갯수: 3
self.vars[34] = [[1.6, 2.0, 0.2], 1.8]           # 거래대금증가배수: 1.6배에서 2.0배까지 0.2배 간격, 범위 갯수: 3
self.vars[35] = [[95, 105, 5], 100]              # 체결강도 하한: 95에서 105까지 5 간격, 범위 갯수: 3
self.vars[36] = [[0.3, 0.7, 0.2], 0.5]           # 등락율각도: 0.3에서 0.7까지 0.2 간격, 범위 갯수: 3
self.vars[37] = [[0.85, 0.95, 0.05], 0.90]       # MACD비율: 0.85배에서 0.95배까지 0.05배 간격, 범위 갯수: 3

# 매수 총 경우의 수: 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 = 22,876,792,454,961
```

### 매도 최적화 조건식 - C_M_BB_SQ_SO

```python
# ================================
#  공통 계산 지표
# ================================
볼린저상단이탈여부  = (현재가 < BBU and 현재가N(1) >= BBU_N(1))
RSI과매수여부       = (RSI > self.vars[45])
MACD하락여부        = (MACD < MACDS and MACD_N(1) >= MACDS_N(1))
이평하락추세        = (이동평균(20) < 이동평균(20, 1))
체결강도약화여부    = (체결강도 < self.vars[46] and 체결강도 < 체결강도평균(20))

매도 = False

if 등락율 > self.vars[38]:
    매도 = True
elif 수익률 >= self.vars[39]:
    매도 = True
elif 수익률 <= self.vars[40]:
    매도 = True
elif 최고수익률 > self.vars[41] and 최고수익률 * self.vars[42] >= 수익률:
    매도 = True
elif 보유시간 > self.vars[43]:
    매도 = True
elif 볼린저상단이탈여부 and 수익률 > self.vars[44]:
    매도 = True
elif RSI과매수여부 and 최고수익률 > self.vars[47]:
    매도 = True
elif MACD하락여부 and 수익률 > self.vars[48]:
    매도 = True
elif 이평하락추세 and 현재가 < 이동평균(20) and 수익률 > self.vars[49]:
    매도 = True
elif 체결강도약화여부 and 최고수익률 > self.vars[50]:
    매도 = True
elif 시가총액 < 10000:
    if 등락율각도(20) >= 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * self.vars[51] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[52]:
        매도 = True
    elif 5 <= 등락율각도(20) < 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * self.vars[53] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[54]:
        매도 = True
    elif 0 <= 등락율각도(20) < 5 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * self.vars[55] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[56]:
        매도 = True
    elif 등락율각도(20) < 0 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * self.vars[57] and (현재가 / 현재가N(1) - 1) * 100 < self.vars[58]:
        매도 = True
    elif 현재가 < 분봉고가 * self.vars[59] and 최고수익률 > self.vars[60]:
        매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

### 매도 최적화 범위 - C_M_BB_SQ_SOR

```python
# 매도 최적화 범위 (매수 변수 37 다음부터 38번부터 시작)
self.vars[38] = [[27.0, 29.0, 1.0], 28.0]        # 등락율 상한가: 27.0%에서 29.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[39] = [[6.0, 8.0, 1.0], 7.0]           # 수익률 상한: 6.0%에서 8.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[40] = [[-4.0, -2.0, 1.0], -3.0]        # 수익률 하한: -4.0%에서 -2.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[41] = [[9.0, 11.0, 1.0], 10.0]         # 최고수익률 기준값: 9.0%에서 11.0%까지 1.0% 간격, 범위 갯수: 3
self.vars[42] = [[0.65, 0.75, 0.05], 0.70]       # 최고수익률 대비 현재 수익률 비율: 0.65에서 0.75까지 0.05 간격, 범위 갯수: 3
self.vars[43] = [[150, 210, 30], 180]            # 보유시간 초과: 150분에서 210분까지 30분 간격, 범위 갯수: 3
self.vars[44] = [[1.5, 2.5, 0.5], 2.0]           # 볼린저이탈시수익률: 1.5%에서 2.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[45] = [[73, 77, 2], 75]                # RSI과매수기준: 73에서 77까지 2 간격, 범위 갯수: 3
self.vars[46] = [[95, 105, 5], 100]              # 체결강도약화기준: 95에서 105까지 5 간격, 범위 갯수: 3
self.vars[47] = [[4.5, 5.5, 0.5], 5.0]           # RSI과매수시최고수익률: 4.5%에서 5.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[48] = [[2.5, 3.5, 0.5], 3.0]           # MACD하락시수익률: 2.5%에서 3.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[49] = [[1.5, 2.5, 0.5], 2.0]           # 이평하락시수익률: 1.5%에서 2.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[50] = [[3.5, 4.5, 0.5], 4.0]           # 체결강도약화시최고수익률: 3.5%에서 4.5%까지 0.5% 간격, 범위 갯수: 3
self.vars[51] = [[0.35, 0.45, 0.05], 0.40]       # 등락율각도10이상매도비율: 0.35에서 0.45까지 0.05 간격, 범위 갯수: 3
self.vars[52] = [[-0.4, -0.2, 0.1], -0.3]        # 등락율각도10이상하락률: -0.4에서 -0.2까지 0.1 간격, 범위 갯수: 3
self.vars[53] = [[0.45, 0.55, 0.05], 0.50]       # 등락율각도5-10매도비율: 0.45에서 0.55까지 0.05 간격, 범위 갯수: 3
self.vars[54] = [[-0.5, -0.3, 0.1], -0.4]        # 등락율각도5-10하락률: -0.5에서 -0.3까지 0.1 간격, 범위 갯수: 3
self.vars[55] = [[0.55, 0.65, 0.05], 0.60]       # 등락율각도0-5매도비율: 0.55에서 0.65까지 0.05 간격, 범위 갯수: 3
self.vars[56] = [[-0.4, -0.2, 0.1], -0.3]        # 등락율각도0-5하락률: -0.4에서 -0.2까지 0.1 간격, 범위 갯수: 3
self.vars[57] = [[0.65, 0.75, 0.05], 0.70]       # 등락율각도음수매도비율: 0.65에서 0.75까지 0.05 간격, 범위 갯수: 3
self.vars[58] = [[-0.5, -0.3, 0.1], -0.4]        # 등락율각도음수하락률: -0.5에서 -0.3까지 0.1 간격, 범위 갯수: 3
self.vars[59] = [[0.93, 0.97, 0.02], 0.95]       # 분봉고가대비하락비율: 0.93배에서 0.97배까지 0.02배 간격, 범위 갯수: 3
self.vars[60] = [[5.5, 6.5, 0.5], 6.0]           # 고가대비하락시최고수익률: 5.5%에서 6.5%까지 0.5% 간격, 범위 갯수: 3

# 매도 총 경우의 수: 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 × 3 = 94,143,178,827
```

### 매수 매도 최적화 범위 - C_M_BB_SQ_OR

```python
# 평균 분봉수 고정값
self.vars[0] = [[20, 20, 0], 20]                 # 평균 분봉수 고정값: 20분, 범위 갯수: 1

# [매수 최적화 범위 - 위의 BOR과 동일하게 self.vars[1] ~ self.vars[37]]
# [매도 최적화 범위 - 위의 SOR과 동일하게 self.vars[38] ~ self.vars[60]]

# 매수 매도 총 경우의 수: 22,876,792,454,961 × 94,143,178,827 ≈ 2.15 × 10^24
```

### 예상 시간 계산

각 변수의 범위 갯수를 곱하여 모든 경우의 수를 계산합니다.

- **매수 조건 변수 범위**:
  - 22,876,792,454,961
- **매도 조건 변수 범위**:
  - 94,143,178,827
- **총 경우의 수**:
  - 약 2.15 × 10^24

각 경우에 1분이 걸린다고 가정하면:
- **분**: 2.15 × 10^24 분
- **시간**: 3.58 × 10^22 시간
- **일**: 1.49 × 10^21 일
- **년**: 4.09 × 10^18 년

**가정**: 각 경우의 수를 처리하는 데 1분 소요. 이는 비현실적인 시간이므로, **GA 최적화 방식을 강력히 권장합니다.**

### GA 최적화 범위 - C_M_BB_SQ_GAR

```python
# 평균 분봉수 고정값
self.vars[0] = [[20], 20]                                                      # 평균 분봉수 고정값, 범위 갯수: 1

# GA 최적화 범위 - 볼린저밴드 압축 돌파 패턴
self.vars[1] = [[22.0, 25.0, 28.0], 25.0]                                      # 등락율 상한, 범위 갯수: 3
self.vars[2] = [[0.6, 0.7, 0.8], 0.7]                                          # 압축비율, 범위 갯수: 3
self.vars[3] = [[48, 50, 54], 50]                                              # RSI 하한, 범위 갯수: 3
self.vars[4] = [[1.8, 2.0, 2.2], 2.0]                                          # 거래대금증가배수, 범위 갯수: 3
self.vars[5] = [[1.15, 1.20, 1.25], 1.20]                                      # 분당거래대금증가율, 범위 갯수: 3
self.vars[6] = [[1.2, 1.3, 1.4], 1.3]                                          # 분당매수우세비율, 범위 갯수: 3
self.vars[7] = [[105, 110, 115], 110]                                          # 체결강도 하한, 범위 갯수: 3
self.vars[8] = [[0.88, 0.90, 0.92], 0.90]                                      # 분봉고가대비비율, 범위 갯수: 3
self.vars[9] = [[1.03, 1.05, 1.07], 1.05]                                      # 최고분봉고가대비비율, 범위 갯수: 3

# GA 최적화 범위 - 소형주
self.vars[10] = [[8, 10, 12], 10]                                              # 분당순매수금액 하한, 범위 갯수: 3
self.vars[11] = [[53, 55, 57], 55]                                             # RSI 하한, 범위 갯수: 3
self.vars[12] = [[25, 30, 35], 30]                                             # 전일비, 범위 갯수: 3
self.vars[13] = [[25, 30, 35], 30]                                             # 전일동시간비, 범위 갯수: 3
self.vars[14] = [[1.8, 2.0, 2.2], 2.0]                                         # 회전율, 범위 갯수: 3
self.vars[15] = [[250, 300, 350], 300]                                         # 당일거래대금, 범위 갯수: 3
self.vars[16] = [[2.3, 2.5, 2.7], 2.5]                                         # 거래대금증가배수, 범위 갯수: 3
self.vars[17] = [[115, 120, 125], 120]                                         # 체결강도 하한, 범위 갯수: 3
self.vars[18] = [[1.5, 2.0, 2.5], 2.0]                                         # 등락율각도, 범위 갯수: 3

# GA 최적화 범위 - 중형주
self.vars[19] = [[25, 30, 35], 30]                                             # 분당순매수금액 하한, 범위 갯수: 3
self.vars[20] = [[50, 52, 54], 52]                                             # RSI 하한, 범위 갯수: 3
self.vars[21] = [[15, 20, 25], 20]                                             # 전일비, 범위 갯수: 3
self.vars[22] = [[15, 20, 25], 20]                                             # 전일동시간비, 범위 갯수: 3
self.vars[23] = [[1.3, 1.5, 1.7], 1.5]                                         # 회전율, 범위 갯수: 3
self.vars[24] = [[450, 500, 550], 500]                                         # 당일거래대금, 범위 갯수: 3
self.vars[25] = [[1.8, 2.0, 2.2], 2.0]                                         # 거래대금증가배수, 범위 갯수: 3
self.vars[26] = [[105, 110, 115], 110]                                         # 체결강도 하한, 범위 갯수: 3
self.vars[27] = [[0.5, 1.0, 1.5], 1.0]                                         # 등락율각도, 범위 갯수: 3

# GA 최적화 범위 - 대형주
self.vars[28] = [[45, 50, 55], 50]                                             # 분당순매수금액 하한, 범위 갯수: 3
self.vars[29] = [[48, 50, 52], 50]                                             # RSI 하한, 범위 갯수: 3
self.vars[30] = [[5, 10, 15], 10]                                              # 전일비, 범위 갯수: 3
self.vars[31] = [[5, 10, 15], 10]                                              # 전일동시간비, 범위 갯수: 3
self.vars[32] = [[0.8, 1.0, 1.2], 1.0]                                         # 회전율, 범위 갯수: 3
self.vars[33] = [[900, 1000, 1100], 1000]                                      # 당일거래대금, 범위 갯수: 3
self.vars[34] = [[1.6, 1.8, 2.0], 1.8]                                         # 거래대금증가배수, 범위 갯수: 3
self.vars[35] = [[95, 100, 105], 100]                                          # 체결강도 하한, 범위 갯수: 3
self.vars[36] = [[0.3, 0.5, 0.7], 0.5]                                         # 등락율각도, 범위 갯수: 3
self.vars[37] = [[0.85, 0.90, 0.95], 0.90]                                     # MACD비율, 범위 갯수: 3

# GA 최적화 범위 - 매도
self.vars[38] = [[27.0, 28.0, 29.0], 28.0]                                     # 등락율 상한가, 범위 갯수: 3
self.vars[39] = [[6.0, 7.0, 8.0], 7.0]                                         # 수익률 상한, 범위 갯수: 3
self.vars[40] = [[-4.0, -3.0, -2.0], -3.0]                                     # 수익률 하한, 범위 갯수: 3
self.vars[41] = [[9.0, 10.0, 11.0], 10.0]                                      # 최고수익률 기준값, 범위 갯수: 3
self.vars[42] = [[0.65, 0.70, 0.75], 0.70]                                     # 최고수익률 대비 현재 수익률 비율, 범위 갯수: 3
self.vars[43] = [[150, 180, 210], 180]                                         # 보유시간 초과, 범위 갯수: 3
self.vars[44] = [[1.5, 2.0, 2.5], 2.0]                                         # 볼린저이탈시수익률, 범위 갯수: 3
self.vars[45] = [[73, 75, 77], 75]                                             # RSI과매수기준, 범위 갯수: 3
self.vars[46] = [[95, 100, 105], 100]                                          # 체결강도약화기준, 범위 갯수: 3
self.vars[47] = [[4.5, 5.0, 5.5], 5.0]                                         # RSI과매수시최고수익률, 범위 갯수: 3
self.vars[48] = [[2.5, 3.0, 3.5], 3.0]                                         # MACD하락시수익률, 범위 갯수: 3
self.vars[49] = [[1.5, 2.0, 2.5], 2.0]                                         # 이평하락시수익률, 범위 갯수: 3
self.vars[50] = [[3.5, 4.0, 4.5], 4.0]                                         # 체결강도약화시최고수익률, 범위 갯수: 3
self.vars[51] = [[0.35, 0.40, 0.45], 0.40]                                     # 등락율각도10이상매도비율, 범위 갯수: 3
self.vars[52] = [[-0.4, -0.3, -0.2], -0.3]                                     # 등락율각도10이상하락률, 범위 갯수: 3
self.vars[53] = [[0.45, 0.50, 0.55], 0.50]                                     # 등락율각도5-10매도비율, 범위 갯수: 3
self.vars[54] = [[-0.5, -0.4, -0.3], -0.4]                                     # 등락율각도5-10하락률, 범위 갯수: 3
self.vars[55] = [[0.55, 0.60, 0.65], 0.60]                                     # 등락율각도0-5매도비율, 범위 갯수: 3
self.vars[56] = [[-0.4, -0.3, -0.2], -0.3]                                     # 등락율각도0-5하락률, 범위 갯수: 3
self.vars[57] = [[0.65, 0.70, 0.75], 0.70]                                     # 등락율각도음수매도비율, 범위 갯수: 3
self.vars[58] = [[-0.5, -0.4, -0.3], -0.4]                                     # 등락율각도음수하락률, 범위 갯수: 3
self.vars[59] = [[0.93, 0.95, 0.97], 0.95]                                     # 분봉고가대비하락비율, 범위 갯수: 3
self.vars[60] = [[5.5, 6.0, 6.5], 6.0]                                         # 고가대비하락시최고수익률, 범위 갯수: 3
```

## 태그
- #주식트레이딩
- #분봉트레이딩
- #볼린저밴드
- #BollingerBand
- #Squeeze
- #Breakout
- #압축돌파
- #변동성전략
- #매수조건
- #매도조건
- #최적화
- #유전알고리즘
- #파이썬
- #트레이딩로직
- #MACD
- #RSI
- #ATR
- #기술적분석

---

**Last Update**: 2025-01-17

**참고 문서**: `Back_Testing_Guideline_Min.md`, `Back_Testing_Guideline_Tick.md`
