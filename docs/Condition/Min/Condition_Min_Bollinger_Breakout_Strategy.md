# 조건식 (Condition) - 분봉(Minute) 기반

- STOM 주식 자동거래에 사용하기 위한 분봉 조건식 문서
- [[Back_Testing_Guideline_Min]] 을(를) 기반으로 작성
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 목차
- [조건식 (Condition)](#조건식-condition)
  - [목차](#목차)
  - [소개](#소개)
  - [가이드라인](#가이드라인)
    - [저장 이름 규칙](#저장-이름-규칙)
- [Condition - Min Bollinger Breakout Strategy](#condition---min-bollinger-breakout-strategy)
  - [전략 개요](#전략-개요)
  - [조건식](#조건식)
    - [매수 조건식 - C_M_930_1500_BBS_B](#매수-조건식---c_m_930_1500_bbs_b)
    - [매도 조건식 - C_M_930_1500_BBS_S](#매도-조건식---c_m_930_1500_bbs_s)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식 - C_M_930_1500_BBS_BO](#매수-최적화-조건식---c_m_930_1500_bbs_bo)
    - [매수 최적화 범위 - C_M_930_1500_BBS_BOR](#매수-최적화-범위---c_m_930_1500_bbs_bor)
    - [매도 최적화 조건식 - C_M_930_1500_BBS_SO](#매도-최적화-조건식---c_m_930_1500_bbs_so)
    - [매도 최적화 범위 - C_M_930_1500_BBS_SOR](#매도-최적화-범위---c_m_930_1500_bbs_sor)
    - [매수 매도 최적화 범위 - C_M_930_1500_BBS_OR](#매수-매도-최적화-범위---c_m_930_1500_bbs_or)
    - [예상 시간 계산](#예상-시간-계산)
    - [GA 최적화 범위 - C_M_930_1500_BBS_GAR](#ga-최적화-범위---c_m_930_1500_bbs_gar)
  - [조건식 개선 방향 연구](#조건식-개선-방향-연구)
  - [태그](#태그)

## 소개

이 문서는 STOM 주식 자동거래 시스템에서 09:30:00 ~ 15:00:00 전 구간의 Bollinger Breakout Strategy(볼린저 밴드 돌파 전략)를 실험하기 위한 조건식과 최적화 범위를 제공합니다.

볼린저 밴드는 가격의 변동성을 측정하는 기술적 지표로, 상단 밴드 돌파 시 상승 추세 지속, 하단 밴드 접근 후 반등 시 매수 기회를 포착하는 전략입니다. 분봉 데이터의 풍부한 TA-Lib 지표를 활용하여 높은 신뢰도의 진입/청산 시그널을 생성합니다.

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **볼린저 밴드 돌파 전략**을 정의한다.

- **대상 시간 구간**: 09:30:00 ~ 15:00:00 (장중 전체)
- **대상 종목**: 시가총액별 3단계 분류 (중소형 <2500억, 중형 2500~5000억, 대형 >=5000억), 가격대 1,000원~50,000원
- **전략 타입**: 볼린저 밴드 돌파 + 추세 확인 복합 전략
- **핵심 변수**: BBU, BBM, BBL, BB_WIDTH, BB_POSITION, MACD, RSI, 이동평균(5/20/60), 체결강도, 분당거래대금
- **업데이트 이력**:
  - 초기 문서 작성

## 가이드라인

- 모든 조건식은 Python 스타일의 의사코드로 작성되어 있으며, STOM 백테스터가 인식하는 변수/함수 규칙을 따릅니다.
- 조건식은 시가총액별로 분기하며, 각 분기에서 추가 필터를 적용합니다.
- 최적화 조건식은 `self.vars[i]`로 치환하여 탐색 범위를 별도로 정의합니다.
- 최적화 범위 포맷: `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]`
- 변수/함수 표기 및 사용 규칙은 Back_Testing_Guideline_Min.md를 따릅니다.

### 저장 이름 규칙

조건식 저장 및 관리 편의를 위해 다음 규칙을 사용합니다.

1. 기본 규칙:
   - `C`: Condition
   - `M`: Min (분봉)
   - `930_1500`: 시간대
   - `BBS`: Bollinger Breakout Strategy (볼린저 돌파 전략)
   - `B`/`S`: 매수/매도 조건식
   - `BO`/`SO`: 매수/매도 최적화 조건식
   - `BOR`/`SOR`: 매수/매도 최적화 범위
   - `OR`: 매수/매도 통합 최적화 범위
   - `GAR`: GA 최적화 범위

2. 예시:
   - `C_M_930_1500_BBS_B`, `C_M_930_1500_BBS_S`
   - `C_M_930_1500_BBS_BO`, `C_M_930_1500_BBS_SO`
   - `C_M_930_1500_BBS_BOR`, `C_M_930_1500_BBS_SOR`, `C_M_930_1500_BBS_OR`, `C_M_930_1500_BBS_GAR`

---

# Condition - Min Bollinger Breakout Strategy

## 전략 개요

볼린저 밴드 돌파 전략은 다음과 같은 특징을 가집니다:

- **변동성 기반 진입**: 볼린저 밴드 하단 근처에서 반등 신호 포착
- **추세 확인**: 이동평균선 배열과 MACD로 추세 방향 검증
- **모멘텀 검증**: RSI, 체결강도, 거래량으로 매수세 확인
- **리스크 관리**: 과도한 변동성 구간 회피, 안전장치 다중 적용

핵심 전략:
1. **매수 시점**: 볼린저 밴드 하단(BBL) 근처 접근 후 반등, 또는 중심선(BBM) 상향 돌파
2. **추세 확인**: 단기/중기/장기 이동평균선 정배열 확인
3. **모멘텀 확인**: MACD 골든크로스, RSI 30~70 구간, 체결강도 상승
4. **거래량 확인**: 분당거래대금 증가, 매수세 우위
5. **매도 시점**: 볼린저 밴드 상단(BBU) 근처 도달, RSI 과매수, MACD 데드크로스, 목표 수익/손절

전략 유형:
- **하단 반등형**: BBL 터치 후 BBL 위로 상승 시 매수
- **중심선 돌파형**: BBM 하향 돌파 후 재상승하여 BBM 돌파 시 매수
- **상승 지속형**: BBM과 BBU 사이에서 상승 추세 유지 시 매수

## 조건식

### 매수 조건식 - C_M_930_1500_BBS_B

```python
# ================================
#  공통 계산 지표
# ================================
전일종가              = 현재가 / (1 + (등락율 / 100))
시가등락율            = ((시가 - 전일종가) / 전일종가) * 100
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
분당순매수금액        = (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000
고가대비하락율        = ((고가 - 현재가) / 고가) * 100
분봉고가대비하락율    = ((분봉고가 - 현재가) / 분봉고가) * 100 if 분봉고가 > 0 else 0
분봉저가대비상승율    = ((현재가 - 분봉저가) / 분봉저가) * 100 if 분봉저가 > 0 else 0

# 볼린저 밴드 관련 지표
BB_WIDTH             = (BBU - BBL) / BBM * 100 if BBM > 0 else 0
BB_POSITION          = (현재가 - BBL) / (BBU - BBL) * 100 if (BBU - BBL) > 0 else 50
BB_하단근접           = (BB_POSITION <= 20)                    # 하단 20% 이내
BB_중심근접           = (40 <= BB_POSITION <= 60)              # 중심 ±10% 이내
BB_상단근접           = (BB_POSITION >= 80)                    # 상단 20% 이내
BB_중심돌파           = (현재가 > BBM and 현재가N(1) <= BBM_N(1))
BB_하단반등           = (현재가 > BBL and 현재가N(1) <= BBL_N(1))

# 이동평균선 정배열 확인
이평정배열            = (이동평균(5) > 이동평균(20) and 이동평균(20) > 이동평균(60))
이평단기상승          = (이동평균(5) > 이동평균(5, 1))
이평중기상승          = (이동평균(20) > 이동평균(20, 1))
가격이평상단          = (현재가 > 이동평균(5) and 현재가 > 이동평균(20))

# MACD 골든크로스
MACD_CROSS_UP        = (MACD > MACDS and MACD_N(1) <= MACDS_N(1))
MACD_양전환           = (MACD > 0 and MACD_N(1) <= 0)

# RSI 적정 구간
RSI_적정구간          = (30 < RSI < 70)
RSI_과매도탈출        = (RSI > 30 and RSI_N(1) <= 30)

# 체결강도 및 거래량
체결강도상승          = (체결강도 > 체결강도N(1) and 체결강도 > 체결강도평균(20))
분당거래대금증가      = (분당거래대금 > 분당거래대금평균(30) * 1.2)
매수세우위            = (최고분당매수수량(20) > 최고분당매도수량(20) * 1.1)


# ================================
#  매수 조건
# ================================
매수 = True

# 공통 필터 – 기본 안전장치
if not (관심종목 == 1):
    매수 = False
elif not (93000 <= 시분초 < 150000):
    매수 = False
elif not (1000 < 현재가 <= 50000):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (0.3 < 등락율 <= 25.0):
    매수 = False
elif not (데이터길이 >= 20):                                 # 최소 20분봉 데이터 필요
    매수 = False

# 공통 필터 – 볼린저 밴드 조건 (하단 반등 또는 중심선 돌파)
elif not (BB_하단반등 or BB_중심돌파 or (BB_하단근접 and 현재가 > 현재가N(1))):
    매수 = False
elif not (BB_WIDTH > 1.5 and BB_WIDTH < 15.0):               # 밴드폭 적정 범위 (너무 좁거나 넓지 않음)
    매수 = False

# 공통 필터 – 이동평균선 및 추세
elif not (이평단기상승 and 이평중기상승):
    매수 = False
elif not 가격이평상단:
    매수 = False
elif not (등락율각도(20) > 0):
    매수 = False

# 공통 필터 – MACD 및 RSI
elif not (MACD_CROSS_UP or MACD_양전환 or MACD > MACDS):
    매수 = False
elif not RSI_적정구간:
    매수 = False

# 공통 필터 – 거래량 및 체결강도
elif not (분당거래대금 > 분당거래대금N(1)):
    매수 = False
elif not 체결강도상승:
    매수 = False
elif not (체결강도 >= 60 and 체결강도 <= 350):
    매수 = False

# 시가총액별 세부 조건
elif 시가총액 < 2500:
    # 중소형 종목 (2500억 미만)
    if not (10 < 분당순매수금액 < 1000):
        매수 = False
    elif not (전일비 > 15 and 전일동시간비 > 40):
        매수 = False
    elif not (회전율 > 1.5):
        매수 = False
    elif not (당일거래대금 > 30 * 100):
        매수 = False
    elif not (당일거래대금각도(20) > 2 and 당일거래대금각도(20) < 60):
        매수 = False
    elif not (전일비각도(20) > 0 and 전일비각도(20) < 70):
        매수 = False
    elif not 매수세우위:
        매수 = False
    elif not (분당거래대금 / (분당거래대금평균(30) + 0.0001) > 1.0 and 분당거래대금 / (분당거래대금평균(30) + 0.0001) < 8.0):
        매수 = False
    elif not (분당매수수량 > 매도총잔량 * 0.30):
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * 0.4):
        매수 = False
    elif not (체결강도평균(20) > 75):
        매수 = False
    elif not (분봉고가대비하락율 < 3.0):                     # 분봉 고가 대비 3% 이내
        매수 = False
    elif not (분봉저가대비상승율 > 0.5):                     # 분봉 저가 대비 0.5% 이상
        매수 = False

elif 시가총액 < 5000:
    # 중형 종목 (2500억 ~ 5000억)
    if not (20 < 분당순매수금액 < 2000):
        매수 = False
    elif not (전일비 > 10 and 전일동시간비 > 25):
        매수 = False
    elif not (회전율 > 0.8):
        매수 = False
    elif not (당일거래대금 > 80 * 100):
        매수 = False
    elif not (당일거래대금각도(20) > 1 and 당일거래대금각도(20) < 55):
        매수 = False
    elif not (전일비각도(20) > 0 and 전일비각도(20) < 65):
        매수 = False
    elif not (최고분당매수수량(20) > 최고분당매도수량(20) * 1.05):
        매수 = False
    elif not (분당거래대금 / (분당거래대금평균(30) + 0.0001) > 0.9 and 분당거래대금 / (분당거래대금평균(30) + 0.0001) < 7.0):
        매수 = False
    elif not (분당매수수량 > 매도총잔량 * 0.35):
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * 0.5):
        매수 = False
    elif not (체결강도평균(20) > 80):
        매수 = False
    elif not (분봉고가대비하락율 < 2.5):
        매수 = False
    elif not (분봉저가대비상승율 > 0.3):
        매수 = False

else:
    # 대형 종목 (5000억 이상)
    if not (50 < 분당순매수금액 < 4000):
        매수 = False
    elif not (전일비 > 5 and 전일동시간비 > 15):
        매수 = False
    elif not (회전율 > 0.4):
        매수 = False
    elif not (당일거래대금 > 150 * 100):
        매수 = False
    elif not (당일거래대금각도(20) > 0.5 and 당일거래대금각도(20) < 50):
        매수 = False
    elif not (전일비각도(20) > 0 and 전일비각도(20) < 60):
        매수 = False
    elif not (최고분당매수수량(20) > 최고분당매도수량(20) * 1.02):
        매수 = False
    elif not (분당거래대금 / (분당거래대금평균(30) + 0.0001) > 0.8 and 분당거래대금 / (분당거래대금평균(30) + 0.0001) < 6.0):
        매수 = False
    elif not (분당매수수량 > 매도총잔량 * 0.40):
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * 0.6):
        매수 = False
    elif not (체결강도평균(20) > 85):
        매수 = False
    elif not (분봉고가대비하락율 < 2.0):
        매수 = False
    elif not (분봉저가대비상승율 > 0.2):
        매수 = False


# ================================
#  매수 호출
# ================================
if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식 - C_M_930_1500_BBS_S

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
분봉단기하락률        = (현재가 / max(현재가N(1), 1) - 1) * 100

# 볼린저 밴드 관련
BB_POSITION          = (현재가 - BBL) / (BBU - BBL) * 100 if (BBU - BBL) > 0 else 50
BB_상단도달           = (BB_POSITION >= 90)
BB_상단이탈           = (현재가 > BBU and 현재가N(1) <= BBU_N(1))
BB_중심하향이탈       = (현재가 < BBM and 현재가N(1) >= BBM_N(1))

# 추세 이탈
이평이탈              = (현재가 < 이동평균(5) or 현재가 < 이동평균(20))
이평역배열            = (이동평균(5) < 이동평균(20))

# MACD 데드크로스
MACD_CROSS_DOWN      = (MACD < MACDS and MACD_N(1) >= MACDS_N(1))

# RSI 과매수
RSI_과매수            = (RSI > 75)
RSI_과매수탈출        = (RSI < 75 and RSI_N(1) >= 75)

# 체결강도 및 급락 신호
체결강도하락          = (체결강도 < 체결강도평균(20) and 체결강도N(1) >= 체결강도평균(20, 1))
급락신호              = ((분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.7 and 분봉단기하락률 < -0.8)


매도 = False

# 상한가 부근 및 기본 청산
if 등락율 > 29.5:
    매도 = True
elif 시가대비등락율 < -1.5 and 수익률 <= -2.0:
    매도 = True

# 목표 수익 및 손절
elif 수익률 >= 5.0:
    매도 = True
elif 수익률 <= -5.0:
    매도 = True
elif 최고수익률 > 6.0 and 최고수익률 - 수익률 >= 3.0:
    매도 = True
elif 최고수익률 > 4.0 and 최고수익률 * 0.65 >= 수익률:
    매도 = True

# 보유 시간 기반 청산
elif 보유시간 > 180 and 수익률 < 1.5:                       # 3시간 이상 보유 시 소폭 이익이라도 청산
    매도 = True

# 볼린저 밴드 상단 도달 및 이탈
elif BB_상단도달 and 수익률 > 1.0:
    매도 = True
elif BB_상단이탈 and 수익률 > 0.5:
    매도 = True
elif BB_중심하향이탈 and 수익률 < 2.0:
    매도 = True

# MACD 및 RSI 신호
elif MACD_CROSS_DOWN and 수익률 > 0.5:
    매도 = True
elif RSI_과매수 and 수익률 > 1.0:
    매도 = True
elif RSI_과매수탈출 and 수익률 > 0.3:
    매도 = True

# 추세 이탈
elif 이평이탈 and 체결강도하락:
    매도 = True
elif 이평역배열 and 수익률 < 2.5:
    매도 = True
elif 급락신호:
    매도 = True
elif 현재가 < 최저현재가(int(30), int(보유시간)) and 보유시간 > 30:
    매도 = True

# 시가총액별 추가 조건
elif 시가총액 < 2500:
    if 0.5 < 수익률 <= 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.8:
        매도 = True
    elif 수익률 < -2.0 and 체결강도N(1) > 체결강도평균(20, 1) and 체결강도평균(20) > 체결강도:
        매도 = True
    elif 3.0 < 최고수익률 and 현재가N(1) >= 이동평균(20, 1) and 이동평균(20) > 현재가:
        매도 = True

else:
    if 0.5 < 수익률 <= 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.65:
        매도 = True
    elif 수익률 < -2.0 and 체결강도N(1) > 체결강도평균(20, 1) and 체결강도평균(20) > 체결강도:
        매도 = True
    elif 3.0 < 최고수익률 and 현재가N(1) >= 이동평균(20, 1) and 이동평균(20) > 현재가:
        매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

## 최적화 조건식

### 매수 최적화 조건식 - C_M_930_1500_BBS_BO

```python
# ================================
#  공통 계산 지표 (매수 최적화)
# ================================
전일종가              = 현재가 / (1 + (등락율 / 100))
시가등락율            = ((시가 - 전일종가) / 전일종가) * 100
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
분당순매수금액        = (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000
고가대비하락율        = ((고가 - 현재가) / 고가) * 100
분봉고가대비하락율    = ((분봉고가 - 현재가) / 분봉고가) * 100 if 분봉고가 > 0 else 0
분봉저가대비상승율    = ((현재가 - 분봉저가) / 분봉저가) * 100 if 분봉저가 > 0 else 0

BB_WIDTH             = (BBU - BBL) / BBM * 100 if BBM > 0 else 0
BB_POSITION          = (현재가 - BBL) / (BBU - BBL) * 100 if (BBU - BBL) > 0 else 50
BB_하단근접           = (BB_POSITION <= self.vars[10])
BB_중심근접           = (self.vars[11] <= BB_POSITION <= self.vars[12])
BB_상단근접           = (BB_POSITION >= self.vars[13])
BB_중심돌파           = (현재가 > BBM and 현재가N(1) <= BBM_N(1))
BB_하단반등           = (현재가 > BBL and 현재가N(1) <= BBL_N(1))

이평정배열            = (이동평균(5) > 이동평균(20) and 이동평균(20) > 이동평균(60))
이평단기상승          = (이동평균(5) > 이동평균(5, 1))
이평중기상승          = (이동평균(20) > 이동평균(20, 1))
가격이평상단          = (현재가 > 이동평균(5) and 현재가 > 이동평균(20))

MACD_CROSS_UP        = (MACD > MACDS and MACD_N(1) <= MACDS_N(1))
MACD_양전환           = (MACD > 0 and MACD_N(1) <= 0)

RSI_적정구간          = (self.vars[14] < RSI < self.vars[15])
RSI_과매도탈출        = (RSI > 30 and RSI_N(1) <= 30)

체결강도상승          = (체결강도 > 체결강도N(1) and 체결강도 > 체결강도평균(20))
분당거래대금증가      = (분당거래대금 > 분당거래대금평균(30) * self.vars[16])
매수세우위            = (최고분당매수수량(20) > 최고분당매도수량(20) * self.vars[17])

매수 = True

if not (관심종목 == 1):
    매수 = False
elif not (93000 <= 시분초 < 150000):
    매수 = False
elif not (self.vars[1] < 현재가 <= self.vars[2]):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (self.vars[3] < 등락율 <= self.vars[4]):
    매수 = False
elif not (데이터길이 >= self.vars[5]):
    매수 = False
elif not (BB_하단반등 or BB_중심돌파 or (BB_하단근접 and 현재가 > 현재가N(1))):
    매수 = False
elif not (BB_WIDTH > self.vars[6] and BB_WIDTH < self.vars[7]):
    매수 = False
elif not (이평단기상승 and 이평중기상승):
    매수 = False
elif not 가격이평상단:
    매수 = False
elif not (등락율각도(20) > self.vars[8]):
    매수 = False
elif not (MACD_CROSS_UP or MACD_양전환 or MACD > MACDS):
    매수 = False
elif not RSI_적정구간:
    매수 = False
elif not (분당거래대금 > 분당거래대금N(1)):
    매수 = False
elif not 체결강도상승:
    매수 = False
elif not (체결강도 >= self.vars[9] and 체결강도 <= 350):
    매수 = False

elif 시가총액 < self.vars[18]:
    # 중소형 종목
    if not (self.vars[19] < 분당순매수금액 < self.vars[20]):
        매수 = False
    elif not (전일비 > self.vars[21] and 전일동시간비 > self.vars[22]):
        매수 = False
    elif not (회전율 > self.vars[23]):
        매수 = False
    elif not (당일거래대금 > self.vars[24] * 100):
        매수 = False
    elif not (당일거래대금각도(20) > self.vars[25] and 당일거래대금각도(20) < self.vars[26]):
        매수 = False
    elif not (전일비각도(20) > 0 and 전일비각도(20) < self.vars[27]):
        매수 = False
    elif not 매수세우위:
        매수 = False
    elif not (분당거래대금 / (분당거래대금평균(30) + 0.0001) > self.vars[28] and 분당거래대금 / (분당거래대금평균(30) + 0.0001) < self.vars[29]):
        매수 = False
    elif not (분당매수수량 > 매도총잔량 * self.vars[30]):
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * self.vars[31]):
        매수 = False
    elif not (체결강도평균(20) > self.vars[32]):
        매수 = False
    elif not (분봉고가대비하락율 < self.vars[33]):
        매수 = False
    elif not (분봉저가대비상승율 > self.vars[34]):
        매수 = False

elif 시가총액 < self.vars[35]:
    # 중형 종목
    if not (self.vars[36] < 분당순매수금액 < self.vars[37]):
        매수 = False
    elif not (전일비 > self.vars[38] and 전일동시간비 > self.vars[39]):
        매수 = False
    elif not (회전율 > self.vars[40]):
        매수 = False
    elif not (당일거래대금 > self.vars[41] * 100):
        매수 = False
    elif not (당일거래대금각도(20) > self.vars[42] and 당일거래대금각도(20) < self.vars[43]):
        매수 = False
    elif not (전일비각도(20) > 0 and 전일비각도(20) < self.vars[44]):
        매수 = False
    elif not (최고분당매수수량(20) > 최고분당매도수량(20) * self.vars[45]):
        매수 = False
    elif not (분당거래대금 / (분당거래대금평균(30) + 0.0001) > self.vars[46] and 분당거래대금 / (분당거래대금평균(30) + 0.0001) < self.vars[47]):
        매수 = False
    elif not (분당매수수량 > 매도총잔량 * self.vars[48]):
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * self.vars[49]):
        매수 = False
    elif not (체결강도평균(20) > self.vars[50]):
        매수 = False
    elif not (분봉고가대비하락율 < self.vars[51]):
        매수 = False
    elif not (분봉저가대비상승율 > self.vars[52]):
        매수 = False

else:
    # 대형 종목
    if not (self.vars[53] < 분당순매수금액 < self.vars[54]):
        매수 = False
    elif not (전일비 > self.vars[55] and 전일동시간비 > self.vars[56]):
        매수 = False
    elif not (회전율 > self.vars[57]):
        매수 = False
    elif not (당일거래대금 > self.vars[58] * 100):
        매수 = False
    elif not (당일거래대금각도(20) > self.vars[59] and 당일거래대금각도(20) < self.vars[60]):
        매수 = False
    elif not (전일비각도(20) > 0 and 전일비각도(20) < self.vars[61]):
        매수 = False
    elif not (최고분당매수수량(20) > 최고분당매도수량(20) * self.vars[62]):
        매수 = False
    elif not (분당거래대금 / (분당거래대금평균(30) + 0.0001) > self.vars[63] and 분당거래대금 / (분당거래대금평균(30) + 0.0001) < self.vars[64]):
        매수 = False
    elif not (분당매수수량 > 매도총잔량 * self.vars[65]):
        매수 = False
    elif not (매수총잔량 > 매도총잔량 * self.vars[66]):
        매수 = False
    elif not (체결강도평균(20) > self.vars[67]):
        매수 = False
    elif not (분봉고가대비하락율 < self.vars[68]):
        매수 = False
    elif not (분봉저가대비상승율 > self.vars[69]):
        매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위 - C_M_930_1500_BBS_BOR

```python
# 공통 필터 변수
self.vars[1]  = [[1000, 3000, 1000], 1000]                    # 현재가 하한
self.vars[2]  = [[40000, 60000, 10000], 50000]                # 현재가 상한
self.vars[3]  = [[0.2, 0.5, 0.1], 0.3]                        # 등락율 하한
self.vars[4]  = [[20.0, 30.0, 5.0], 25.0]                     # 등락율 상한
self.vars[5]  = [[15, 25, 5], 20]                             # 데이터길이 하한 (분봉 수)
self.vars[6]  = [[1.0, 2.0, 0.5], 1.5]                        # BB_WIDTH 하한
self.vars[7]  = [[12.0, 18.0, 3.0], 15.0]                     # BB_WIDTH 상한
self.vars[8]  = [[-1.0, 1.0, 0.5], 0.0]                       # 등락율각도(20) 하한
self.vars[9]  = [[50, 70, 10], 60]                            # 체결강도 하한
self.vars[10] = [[15, 25, 5], 20]                             # BB_하단근접 임계 (%)
self.vars[11] = [[35, 45, 5], 40]                             # BB_중심근접 하한 (%)
self.vars[12] = [[55, 65, 5], 60]                             # BB_중심근접 상한 (%)
self.vars[13] = [[75, 85, 5], 80]                             # BB_상단근접 임계 (%)
self.vars[14] = [[25, 35, 5], 30]                             # RSI 하한
self.vars[15] = [[65, 75, 5], 70]                             # RSI 상한
self.vars[16] = [[1.1, 1.3, 0.1], 1.2]                        # 분당거래대금증가 배수
self.vars[17] = [[1.05, 1.15, 0.05], 1.10]                    # 매수세우위 비율

# 중소형 종목 (시가총액 < vars[18])
self.vars[18] = [[2000, 3000, 500], 2500]                     # 시가총액 기준 (중소형)
self.vars[19] = [[5, 15, 5], 10]                              # 분당순매수금액 하한
self.vars[20] = [[900, 1100, 100], 1000]                      # 분당순매수금액 상한
self.vars[21] = [[12, 18, 3], 15]                             # 전일비 하한
self.vars[22] = [[35, 45, 5], 40]                             # 전일동시간비 하한
self.vars[23] = [[1.2, 1.8, 0.3], 1.5]                        # 회전율 하한
self.vars[24] = [[25, 35, 5], 30]                             # 당일거래대금 하한 (백만원)
self.vars[25] = [[1, 3, 1], 2]                                # 당일거래대금각도(20) 하한
self.vars[26] = [[55, 65, 5], 60]                             # 당일거래대금각도(20) 상한
self.vars[27] = [[65, 75, 5], 70]                             # 전일비각도(20) 상한
self.vars[28] = [[0.9, 1.1, 0.1], 1.0]                        # 분당거래대금/평균 하한
self.vars[29] = [[7.5, 8.5, 0.5], 8.0]                        # 분당거래대금/평균 상한
self.vars[30] = [[0.25, 0.35, 0.05], 0.30]                    # 분당매수수량/매도총잔량 비율
self.vars[31] = [[0.3, 0.5, 0.1], 0.4]                        # 매수총잔량/매도총잔량 비율
self.vars[32] = [[70, 80, 5], 75]                             # 체결강도평균(20) 하한
self.vars[33] = [[2.5, 3.5, 0.5], 3.0]                        # 분봉고가대비하락율 상한
self.vars[34] = [[0.3, 0.7, 0.2], 0.5]                        # 분봉저가대비상승율 하한

# 중형 종목 (vars[18] <= 시가총액 < vars[35])
self.vars[35] = [[4500, 5500, 500], 5000]                     # 시가총액 기준 (중형)
self.vars[36] = [[15, 25, 5], 20]                             # 분당순매수금액 하한
self.vars[37] = [[1900, 2100, 100], 2000]                     # 분당순매수금액 상한
self.vars[38] = [[8, 12, 2], 10]                              # 전일비 하한
self.vars[39] = [[20, 30, 5], 25]                             # 전일동시간비 하한
self.vars[40] = [[0.6, 1.0, 0.2], 0.8]                        # 회전율 하한
self.vars[41] = [[70, 90, 10], 80]                            # 당일거래대금 하한 (백만원)
self.vars[42] = [[0.5, 1.5, 0.5], 1.0]                        # 당일거래대금각도(20) 하한
self.vars[43] = [[50, 60, 5], 55]                             # 당일거래대금각도(20) 상한
self.vars[44] = [[60, 70, 5], 65]                             # 전일비각도(20) 상한
self.vars[45] = [[1.00, 1.10, 0.05], 1.05]                    # 최고매수/최고매도 비율
self.vars[46] = [[0.8, 1.0, 0.1], 0.9]                        # 분당거래대금/평균 하한
self.vars[47] = [[6.5, 7.5, 0.5], 7.0]                        # 분당거래대금/평균 상한
self.vars[48] = [[0.30, 0.40, 0.05], 0.35]                    # 분당매수수량/매도총잔량 비율
self.vars[49] = [[0.4, 0.6, 0.1], 0.5]                        # 매수총잔량/매도총잔량 비율
self.vars[50] = [[75, 85, 5], 80]                             # 체결강도평균(20) 하한
self.vars[51] = [[2.0, 3.0, 0.5], 2.5]                        # 분봉고가대비하락율 상한
self.vars[52] = [[0.2, 0.4, 0.1], 0.3]                        # 분봉저가대비상승율 하한

# 대형 종목 (시가총액 >= vars[35])
self.vars[53] = [[40, 60, 10], 50]                            # 분당순매수금액 하한
self.vars[54] = [[3800, 4200, 200], 4000]                     # 분당순매수금액 상한
self.vars[55] = [[3, 7, 2], 5]                                # 전일비 하한
self.vars[56] = [[10, 20, 5], 15]                             # 전일동시간비 하한
self.vars[57] = [[0.3, 0.5, 0.1], 0.4]                        # 회전율 하한
self.vars[58] = [[130, 170, 20], 150]                         # 당일거래대금 하한 (백만원)
self.vars[59] = [[0.0, 1.0, 0.5], 0.5]                        # 당일거래대금각도(20) 하한
self.vars[60] = [[45, 55, 5], 50]                             # 당일거래대금각도(20) 상한
self.vars[61] = [[55, 65, 5], 60]                             # 전일비각도(20) 상한
self.vars[62] = [[0.98, 1.06, 0.04], 1.02]                    # 최고매수/최고매도 비율
self.vars[63] = [[0.7, 0.9, 0.1], 0.8]                        # 분당거래대금/평균 하한
self.vars[64] = [[5.5, 6.5, 0.5], 6.0]                        # 분당거래대금/평균 상한
self.vars[65] = [[0.35, 0.45, 0.05], 0.40]                    # 분당매수수량/매도총잔량 비율
self.vars[66] = [[0.5, 0.7, 0.1], 0.6]                        # 매수총잔량/매도총잔량 비율
self.vars[67] = [[80, 90, 5], 85]                             # 체결강도평균(20) 하한
self.vars[68] = [[1.5, 2.5, 0.5], 2.0]                        # 분봉고가대비하락율 상한
self.vars[69] = [[0.1, 0.3, 0.1], 0.2]                        # 분봉저가대비상승율 하한

# 총 변수 수: 69개
# 대략 경우의 수: 각 변수당 평균 3~5개 후보 → 수백만 케이스 (단계적 탐색 필수)
```

### 매도 최적화 조건식 - C_M_930_1500_BBS_SO

```python
# ================================
#  공통 계산 지표
# ================================
시가대비등락율        = ((현재가 - 시가) / 시가) * 100
분봉단기하락률        = (현재가 / max(현재가N(1), 1) - 1) * 100

BB_POSITION          = (현재가 - BBL) / (BBU - BBL) * 100 if (BBU - BBL) > 0 else 50
BB_상단도달           = (BB_POSITION >= self.vars[79])
BB_상단이탈           = (현재가 > BBU and 현재가N(1) <= BBU_N(1))
BB_중심하향이탈       = (현재가 < BBM and 현재가N(1) >= BBM_N(1))

이평이탈              = (현재가 < 이동평균(5) or 현재가 < 이동평균(20))
이평역배열            = (이동평균(5) < 이동평균(20))

MACD_CROSS_DOWN      = (MACD < MACDS and MACD_N(1) >= MACDS_N(1))

RSI_과매수            = (RSI > self.vars[80])
RSI_과매수탈출        = (RSI < self.vars[80] and RSI_N(1) >= self.vars[80])

체결강도하락          = (체결강도 < 체결강도평균(20) and 체결강도N(1) >= 체결강도평균(20, 1))
급락신호              = ((분당매도수량 - 분당매수수량) >= 매수총잔량 * self.vars[81] and 분봉단기하락률 < -self.vars[82])

매도 = False

if 등락율 > self.vars[70]:
    매도 = True
elif 시가대비등락율 < -self.vars[71] and 수익률 <= -self.vars[72]:
    매도 = True
elif 수익률 >= self.vars[73]:
    매도 = True
elif 수익률 <= -self.vars[74]:
    매도 = True
elif 최고수익률 > self.vars[75] and 최고수익률 - 수익률 >= self.vars[76]:
    매도 = True
elif 최고수익률 > self.vars[77] and 최고수익률 * self.vars[78] >= 수익률:
    매도 = True
elif 보유시간 > self.vars[83] and 수익률 < self.vars[84]:
    매도 = True
elif BB_상단도달 and 수익률 > self.vars[85]:
    매도 = True
elif BB_상단이탈 and 수익률 > self.vars[86]:
    매도 = True
elif BB_중심하향이탈 and 수익률 < self.vars[87]:
    매도 = True
elif MACD_CROSS_DOWN and 수익률 > self.vars[88]:
    매도 = True
elif RSI_과매수 and 수익률 > self.vars[89]:
    매도 = True
elif RSI_과매수탈출 and 수익률 > self.vars[90]:
    매도 = True
elif 이평이탈 and 체결강도하락:
    매도 = True
elif 이평역배열 and 수익률 < self.vars[91]:
    매도 = True
elif 급락신호:
    매도 = True
elif 현재가 < 최저현재가(int(30), int(보유시간)) and 보유시간 > 30:
    매도 = True

elif 시가총액 < 2500:
    if self.vars[92] < 수익률 <= 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * self.vars[93]:
        매도 = True
    elif 수익률 < -self.vars[94] and 체결강도N(1) > 체결강도평균(20, 1) and 체결강도평균(20) > 체결강도:
        매도 = True
    elif self.vars[95] < 최고수익률 and 현재가N(1) >= 이동평균(20, 1) and 이동평균(20) > 현재가:
        매도 = True

else:
    if self.vars[96] < 수익률 <= 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * self.vars[97]:
        매도 = True
    elif 수익률 < -self.vars[98] and 체결강도N(1) > 체결강도평균(20, 1) and 체결강도평균(20) > 체결강도:
        매도 = True
    elif self.vars[99] < 최고수익률 and 현재가N(1) >= 이동평균(20, 1) and 이동평균(20) > 현재가:
        매도 = True

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

### 매도 최적화 범위 - C_M_930_1500_BBS_SOR

```python
self.vars[70] = [[28.5, 30.0, 0.5], 29.5]                     # 상한가 근접 등락율
self.vars[71] = [[1.0, 2.0, 0.5], 1.5]                        # 시가대비등락율 하락 기준
self.vars[72] = [[1.5, 2.5, 0.5], 2.0]                        # 초기 손실 컷 수익률
self.vars[73] = [[4.0, 6.0, 1.0], 5.0]                        # 목표 수익률
self.vars[74] = [[4.5, 5.5, 0.5], 5.0]                        # 최대 손실 컷 수익률
self.vars[75] = [[5.5, 6.5, 0.5], 6.0]                        # 최고수익률 기준값
self.vars[76] = [[2.5, 3.5, 0.5], 3.0]                        # 최고수익률 대비 하락폭
self.vars[77] = [[3.5, 4.5, 0.5], 4.0]                        # 트레일링 기준 최고수익률
self.vars[78] = [[0.60, 0.70, 0.05], 0.65]                    # 트레일링 스톱 비율
self.vars[79] = [[85, 95, 5], 90]                             # BB_상단도달 임계 (%)
self.vars[80] = [[72, 78, 3], 75]                             # RSI 과매수 임계
self.vars[81] = [[0.6, 0.8, 0.1], 0.7]                        # 급락신호 매도잔량 비율
self.vars[82] = [[0.7, 0.9, 0.1], 0.8]                        # 급락신호 단기하락률
self.vars[83] = [[160, 200, 20], 180]                         # 보유시간 상한 (분)
self.vars[84] = [[1.0, 2.0, 0.5], 1.5]                        # 장기보유 손익 기준
self.vars[85] = [[0.8, 1.2, 0.2], 1.0]                        # BB 상단도달 수익률 기준
self.vars[86] = [[0.3, 0.7, 0.2], 0.5]                        # BB 상단이탈 수익률 기준
self.vars[87] = [[1.5, 2.5, 0.5], 2.0]                        # BB 중심하향이탈 수익률 기준
self.vars[88] = [[0.3, 0.7, 0.2], 0.5]                        # MACD 데드크로스 수익률 기준
self.vars[89] = [[0.8, 1.2, 0.2], 1.0]                        # RSI 과매수 수익률 기준
self.vars[90] = [[0.2, 0.4, 0.1], 0.3]                        # RSI 과매수탈출 수익률 기준
self.vars[91] = [[2.0, 3.0, 0.5], 2.5]                        # 이평역배열 수익률 기준
self.vars[92] = [[0.3, 0.7, 0.2], 0.5]                        # 중소형 매도우위 수익률 하한
self.vars[93] = [[0.7, 0.9, 0.1], 0.8]                        # 중소형 매도우위 비율
self.vars[94] = [[1.8, 2.2, 0.2], 2.0]                        # 중소형 체결강도 손절 기준
self.vars[95] = [[2.5, 3.5, 0.5], 3.0]                        # 중소형 이평이탈 최고수익률
self.vars[96] = [[0.3, 0.7, 0.2], 0.5]                        # 대형 매도우위 수익률 하한
self.vars[97] = [[0.6, 0.7, 0.05], 0.65]                      # 대형 매도우위 비율
self.vars[98] = [[1.8, 2.2, 0.2], 2.0]                        # 대형 체결강도 손절 기준
self.vars[99] = [[2.5, 3.5, 0.5], 3.0]                        # 대형 이평이탈 최고수익률

# 총 변수 수: 30개 (매도)
# 대략 경우의 수: 각 변수당 평균 3~5개 후보 → 수만~수십만 케이스
```

### 매수 매도 최적화 범위 - C_M_930_1500_BBS_OR

```python
# OR 모드는 BOR + SOR를 하나로 합친 형태입니다.
# 매수 변수: vars[1] ~ vars[69]
# 매도 변수: vars[70] ~ vars[99]

# (BOR의 vars[1]~vars[69] 전체 복사)
# ... (생략: 실제 사용 시 BOR 블록 전체 복사)

# (SOR의 vars[70]~vars[99] 전체 복사)
self.vars[70] = [[28.5, 30.0, 0.5], 29.5]
self.vars[71] = [[1.0, 2.0, 0.5], 1.5]
self.vars[72] = [[1.5, 2.5, 0.5], 2.0]
self.vars[73] = [[4.0, 6.0, 1.0], 5.0]
self.vars[74] = [[4.5, 5.5, 0.5], 5.0]
self.vars[75] = [[5.5, 6.5, 0.5], 6.0]
self.vars[76] = [[2.5, 3.5, 0.5], 3.0]
self.vars[77] = [[3.5, 4.5, 0.5], 4.0]
self.vars[78] = [[0.60, 0.70, 0.05], 0.65]
self.vars[79] = [[85, 95, 5], 90]
self.vars[80] = [[72, 78, 3], 75]
self.vars[81] = [[0.6, 0.8, 0.1], 0.7]
self.vars[82] = [[0.7, 0.9, 0.1], 0.8]
self.vars[83] = [[160, 200, 20], 180]
self.vars[84] = [[1.0, 2.0, 0.5], 1.5]
self.vars[85] = [[0.8, 1.2, 0.2], 1.0]
self.vars[86] = [[0.3, 0.7, 0.2], 0.5]
self.vars[87] = [[1.5, 2.5, 0.5], 2.0]
self.vars[88] = [[0.3, 0.7, 0.2], 0.5]
self.vars[89] = [[0.8, 1.2, 0.2], 1.0]
self.vars[90] = [[0.2, 0.4, 0.1], 0.3]
self.vars[91] = [[2.0, 3.0, 0.5], 2.5]
self.vars[92] = [[0.3, 0.7, 0.2], 0.5]
self.vars[93] = [[0.7, 0.9, 0.1], 0.8]
self.vars[94] = [[1.8, 2.2, 0.2], 2.0]
self.vars[95] = [[2.5, 3.5, 0.5], 3.0]
self.vars[96] = [[0.3, 0.7, 0.2], 0.5]
self.vars[97] = [[0.6, 0.7, 0.05], 0.65]
self.vars[98] = [[1.8, 2.2, 0.2], 2.0]
self.vars[99] = [[2.5, 3.5, 0.5], 3.0]

# 전체 경우의 수는 매우 커질 수 있으므로, 단계적 탐색을 권장합니다.
```

### 예상 시간 계산

- 변수 갯수가 매우 많으므로 (매수 69개 + 매도 30개 = 총 99개), 전체 경우의 수는 기하급수적으로 증가합니다.
- **권장 접근법**:
  1. 1단계: 각 변수 후보 수를 2~3개로 제한하여 대략적인 최적 영역 탐색
  2. 2단계: 1단계 결과 중심으로 촘촘히 재탐색 (중요 변수 우선)
  3. 3단계: GA 최적화로 미세 조정
  4. 교차검증/기간분할 옵션 사용 시 탐색 시간이 선형적으로 증가하므로 우선 TRIAL 수를 축소 후 점진 확대

### GA 최적화 범위 - C_M_930_1500_BBS_GAR

- 일반 최적화에서 확보한 최적값들을 중심으로, GA에서는 리스트 기반 후보 집합으로 전환합니다.
- 예시(일부 변수):

```python
# 공통 필터
self.vars[1]  = [[1000, 2000, 3000], 1000]
self.vars[2]  = [[40000, 50000, 60000], 50000]
self.vars[3]  = [[0.2, 0.3, 0.4, 0.5], 0.3]
self.vars[4]  = [[20.0, 25.0, 30.0], 25.0]
self.vars[6]  = [[1.0, 1.5, 2.0], 1.5]
self.vars[7]  = [[12.0, 15.0, 18.0], 15.0]
self.vars[9]  = [[50, 60, 70], 60]

# 볼린저 밴드
self.vars[10] = [[15, 20, 25], 20]
self.vars[13] = [[75, 80, 85], 80]
self.vars[14] = [[25, 30, 35], 30]
self.vars[15] = [[65, 70, 75], 70]

# 중소형 종목
self.vars[19] = [[5, 10, 15], 10]
self.vars[20] = [[900, 1000, 1100], 1000]
self.vars[32] = [[70, 75, 80], 75]
self.vars[33] = [[2.5, 3.0, 3.5], 3.0]

# 중형 종목
self.vars[36] = [[15, 20, 25], 20]
self.vars[41] = [[70, 80, 90], 80]
self.vars[50] = [[75, 80, 85], 80]

# 대형 종목
self.vars[53] = [[40, 50, 60], 50]
self.vars[58] = [[130, 150, 170], 150]
self.vars[67] = [[80, 85, 90], 85]

# 매도
self.vars[73] = [[4.0, 5.0, 6.0], 5.0]
self.vars[74] = [[4.5, 5.0, 5.5], 5.0]
self.vars[76] = [[2.5, 3.0, 3.5], 3.0]
self.vars[78] = [[0.60, 0.65, 0.70], 0.65]
self.vars[79] = [[85, 90, 95], 90]
self.vars[80] = [[72, 75, 78], 75]
self.vars[83] = [[160, 180, 200], 180]
```

---



---

## 최적화 조건식

## BO (Buy Optimization)

```python
# 기본 매수 조건을 self.vars로 변환
# 주요 변수만 최적화 대상으로 선정
# self.vars[0] 사용 - 값: 0.0001
# self.vars[1] 사용 - 값: 0.2
# self.vars[2] 사용 - 값: 0.3
# self.vars[3] 사용 - 값: 0.35
# self.vars[4] 사용 - 값: 0.4
# self.vars[5] 사용 - 값: 0.5
# self.vars[6] 사용 - 값: 0.6
# self.vars[7] 사용 - 값: 0.8
# self.vars[8] 사용 - 값: 0.9
# self.vars[9] 사용 - 값: 1
```

## BOR (Buy Optimization Range)

```python
self.vars[0] = [[0.1, 0.0, 0.1], 0.0001]  # 비율 (0.0001)
self.vars[1] = [[0.1, 0.3, 0.1], 0.2]  # 비율 (0.2)
self.vars[2] = [[0.2, 0.4, 0.1], 0.3]  # 비율 (0.3)
self.vars[3] = [[0.2, 0.5, 0.1], 0.35]  # 비율 (0.35)
self.vars[4] = [[0.3, 0.5, 0.1], 0.4]  # 비율 (0.4)
self.vars[5] = [[0.3, 0.7, 0.1], 0.5]  # 비율 (0.5)
self.vars[6] = [[0.4, 0.8, 0.1], 0.6]  # 비율 (0.6)
self.vars[7] = [[0.6, 1.0, 0.1], 0.8]  # 비율 (0.8)
self.vars[8] = [[0.6, 1.0, 0.1], 0.9]  # 비율 (0.9)
self.vars[9] = [[1, 1, 1], 1]  # 카운트 (1)
self.vars[10] = [[1.0, 1.0, 1.0], 1.02]  # 카운트 (1.02)
self.vars[11] = [[1.0, 1.0, 1.0], 1.05]  # 카운트 (1.05)
self.vars[12] = [[1.0, 1.0, 1.0], 1.1]  # 카운트 (1.1)
self.vars[13] = [[1.0, 1.0, 1.0], 1.2]  # 카운트 (1.2)
self.vars[14] = [[1.0, 1.0, 1.0], 1.5]  # 카운트 (1.5)
self.vars[15] = [[1, 2, 1], 2]  # 카운트 (2)
self.vars[16] = [[1.0, 3.0, 1.0], 2.5]  # 카운트 (2.5)
self.vars[17] = [[2.0, 3.0, 1.0], 3.0]  # 카운트 (3.0)
self.vars[18] = [[3, 6, 1], 5]  # 카운트 (5)
self.vars[19] = [[4.0, 7.0, 1.0], 6.0]  # 카운트 (6.0)
```

## SO (Sell Optimization)

```python
# 기본 매도 조건을 self.vars로 변환
# 주요 변수만 최적화 대상으로 선정
# self.vars[20] 사용 - 값: 0.3
# self.vars[21] 사용 - 값: 0.5
# self.vars[22] 사용 - 값: 0.65
# self.vars[23] 사용 - 값: 0.7
# self.vars[24] 사용 - 값: 0.8
# self.vars[25] 사용 - 값: 1
# self.vars[26] 사용 - 값: 1.5
# self.vars[27] 사용 - 값: 2.0
# self.vars[28] 사용 - 값: 2.5
# self.vars[29] 사용 - 값: 3.0
```

## SOR (Sell Optimization Range)

```python
self.vars[20] = [[0.2, 0.4, 0.1], 0.3]  # 비율 (0.3)
self.vars[21] = [[0.3, 0.7, 0.1], 0.5]  # 비율 (0.5)
self.vars[22] = [[0.5, 0.8, 0.1], 0.65]  # 비율 (0.65)
self.vars[23] = [[0.5, 0.9, 0.1], 0.7]  # 비율 (0.7)
self.vars[24] = [[0.6, 1.0, 0.1], 0.8]  # 비율 (0.8)
self.vars[25] = [[1, 1, 1], 1]  # 카운트 (1)
self.vars[26] = [[1.0, 1.0, 1.0], 1.5]  # 카운트 (1.5)
self.vars[27] = [[1.0, 2.0, 1.0], 2.0]  # 카운트 (2.0)
self.vars[28] = [[1.0, 3.0, 1.0], 2.5]  # 카운트 (2.5)
self.vars[29] = [[2.0, 3.0, 1.0], 3.0]  # 카운트 (3.0)
self.vars[30] = [[2.0, 5.0, 1.0], 4.0]  # 카운트 (4.0)
self.vars[31] = [[3, 6, 1], 5]  # 카운트 (5)
```

## OR (Optimum Range)

핵심 변수만 선별하여 최적화 (최대 10개)

```python
self.vars[0] = [[0.2, 0.4, 0.1], 0.3]  # 비율 (0.3)
self.vars[1] = [[0.3, 0.7, 0.1], 0.5]  # 비율 (0.5)
self.vars[2] = [[0.5, 0.8, 0.1], 0.65]  # 비율 (0.65)
self.vars[3] = [[0.5, 0.9, 0.1], 0.7]  # 비율 (0.7)
self.vars[4] = [[0.6, 1.0, 0.1], 0.8]  # 비율 (0.8)
self.vars[5] = [[1, 1, 1], 1]  # 카운트 (1)
self.vars[6] = [[0.1, 0.0, 0.1], 0.0001]  # 비율 (0.0001)
self.vars[7] = [[0.1, 0.3, 0.1], 0.2]  # 비율 (0.2)
self.vars[8] = [[0.2, 0.4, 0.1], 0.3]  # 비율 (0.3)
self.vars[9] = [[0.2, 0.5, 0.1], 0.35]  # 비율 (0.35)
```

**예상 경우의 수**: 약 10,000,000,000

## GAR (Genetic Algorithm Range)

```python
self.vars[0] = [[0.2, 0.4], 0.3]  # 비율 (0.3)
self.vars[1] = [[0.3, 0.7], 0.5]  # 비율 (0.5)
self.vars[2] = [[0.5, 0.8], 0.65]  # 비율 (0.65)
self.vars[3] = [[0.5, 0.9], 0.7]  # 비율 (0.7)
self.vars[4] = [[0.6, 1.0], 0.8]  # 비율 (0.8)
self.vars[5] = [[1, 1]]  # 카운트 (1)
self.vars[6] = [[0.1, 0.0], 0.0001]  # 비율 (0.0001)
self.vars[7] = [[0.1, 0.3], 0.2]  # 비율 (0.2)
self.vars[8] = [[0.2, 0.4], 0.3]  # 비율 (0.3)
self.vars[9] = [[0.2, 0.5], 0.35]  # 비율 (0.35)
```

## 조건식 개선 방향 연구

1) **볼린저 밴드 세분화**
   - 밴드 폭(Width) 변화율 모니터링
   - 밴드 수축/확장 패턴 인식
   - 밴드 워킹(Band Walking) 구간 활용

2) **다중 시간프레임 분석**
   - 5분봉, 15분봉, 60분봉 동시 분석
   - 상위 시간프레임 추세와 하위 시간프레임 진입 타이밍 결합

3) **보조지표 조합 강화**
   - Stochastic + RSI 조합 (과매수/과매도 이중 확인)
   - MACD + ADX 조합 (추세 강도 확인)
   - OBV, MFI 등 거래량 지표 추가

4) **시가총액 세분화**
   - 초대형(1조 이상), 대형(5000억~1조), 중형(2500억~5000억), 중소형(2500억 미만) 4단계 분류
   - 각 구간별 최적 파라미터 재탐색

5) **시간대별 전략 차별화**
   - 09:30~11:00 (초기): 변동성 큰 구간
   - 11:00~13:30 (중반): 안정화 구간
   - 13:30~15:00 (후반): 청산 압력 증가 구간

6) **리스크 관리 강화**
   - 동시 보유 종목 수 제한
   - 섹터별 분산 투자
   - 최대 손실률 상한선 설정

7) **최적화 절차**
   - 1단계(넓게) → 2단계(좁게) → GA(리스트) → 실거래 검증 → 재탐색

## 태그
- #주식트레이딩
- #분봉트레이딩
- #매수조건
- #매도조건
- #최적화
- #유전알고리즘
- #파이썬
- #트레이딩로직
- #볼린저밴드
- #기술적분석
- #TA-Lib
- #리스크관리
- #MACD
- #RSI
- #이동평균선
