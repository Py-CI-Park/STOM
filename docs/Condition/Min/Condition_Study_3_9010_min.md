---
tags:
  - 주식
  - 자동매매
  - 백테스팅
  - 조건식
  - 분봉
aliases:
  - C_S_5_B_Min
  - C_S_3_S_902_Min
creation date: 2025-07-15
---
# 조건식 (Condition) - 분봉(Minute) 기준

- STOM 주식 자동거래에 사용하기 위한 조건식 문서
- [[Back_Testing_Guideline_Min]] 을(를) 기반으로 작성한 Min 조건식
- [[Condition_Document_Template_Guideline]] 을(를) 바탕으로 템플릿 구조를 적용한 문서

## 목차

- [조건식 (Condition) - 분봉(Minute) 기준](#조건식-condition---분봉minute-기준)
  - [목차](#목차)
  - [소개](#소개)
  - [가이드라인](#가이드라인)
    - [저장 이름 규칙](#저장-이름-규칙)
- [Condition - Study 5_9010 (Min)](#condition---study-5_9010-min)
  - [조건식](#조건식)
    - [매수 조건식 - C_S_5_B_Min](#매수-조건식---c_s_5_b_min)
    - [매도 조건식 - C_S_3_S_902_Min](#매도-조건식---c_s_3_s_902_min)
  - [최적화 조건식](#최적화-조건식)
    - [매수 최적화 조건식 - C_S_2_BO_T_Min](#매수-최적화-조건식---c_s_2_bo_t_min)
    - [매수 최적화 범위 - C_S_2_BOR_T_Min](#매수-최적화-범위---c_s_2_bor_t_min)
    - [매도 최적화 조건식 - C_S_2_SO_T_Min](#매도-최적화-조건식---c_s_2_so_t_min)
    - [매도 최적화 범위 - C_S_2_SOR_T1_Min](#매도-최적화-범위---c_s_2_sor_t1_min)
    - [매수 매도 최적화 범위 - C_S_2_OR_T1_Min](#매수-매도-최적화-범위---c_s_2_or_t1_min)

## 개요

본 문서는 STOM 주식 자동거래 시스템에서 **분봉 기반 Study 5 전략 (09:10 기준)**을 정의한다.

- **대상 시간 구간**: 09:10:00 이후
- **대상 종목**: 관심종목, 시가총액 및 가격대 필터링 적용
- **전략 타입**: 분봉 데이터 기반 조건식 (Minute Study 5)
- **핵심 변수**: 분당거래대금, 분당매수수량, 분당순매수금액, RSI, 이동평균, 체결강도
- **업데이트 이력**:
  - 2025-07-15: 초기 문서 작성 (틱 데이터 기반에서 분봉 데이터 기반으로 변환)

## 소개

이 문서는 STOM 주식 자동거래 시스템에서 사용되는 **분봉(Minute) 데이터 기준**의 다양한 조건식을 설명합니다. 각 조건식은 매수 및 매도 전략을 포함하며, 최적화된 변수 설정을 통해 성능을 향상시킵니다.

> [!important] 중요
> 이 문서는 틱(Tick) 데이터 기반의 조건식을 분봉 데이터 기반으로 변환한 것입니다. `초당` 변수는 모두 `분당` 변수로 대체되었으며, 이로 인해 전략의 동작 방식이 기존과 다를 수 있습니다.

## 가이드라인

- 모든 조건식은 Python으로 작성되어 있으며, 주식 거래의 자동화를 목표로 합니다.
- 각 조건식은 특정 조건을 만족할 때 매수 또는 매도를 실행합니다.
- 최적화 조건식은 변수의 범위를 설정하여 최적의 매수/매도 시점을 찾습니다.
- 최적화 범위는 `self.vars[정수] = [[시작값, 종료값, 간격], 최적값]` 형식으로 설정합니다.
- GA(유전 알고리즘) 최적화 범위 생성 방법은 원본 가이드를 참고하십시오.

### 저장 이름 규칙

조건식과 관련된 다양한 테스트 및 최적화 조건을 저장할 때, 일관된 작명 규칙을 사용하여 관리의 용이성을 높일 수 있습니다. 분봉 기준 전략에는 `_Min` 접미사를 추가하여 구분하는 것을 권장합니다.

1.  **기본 규칙**:
    -   `C`: Condition을 의미합니다.
    -   `S`: Study 를 의미합니다.
    -   `숫자`: 실험 번호를 나타냅니다.
    -   `B`: 매수 조건식을 의미합니다.
    -   `S`: 매도 조건식을 의미합니다.
    -   `BO`: 매수 최적화 조건식을 의미합니다.
    -   `SO`: 매도 최적화 조건식을 의미합니다.
    -   `OR`: 매수 매도 통합 최적화 범위를 의미합니다.
    -   `GAR`: GA 최적화 범위를 의미합니다.
    -   `T`: Test 를 의미합니다.

2.  **분봉 예시**:
    -   `C_S_5_B_Min`: 다섯 번째 실험의 **분봉** 매수 조건식
    -   `C_S_5_S_Min`: 다섯 번째 실험의 **분봉** 매도 조건식
    -   `C_S_5_OR_T_Min`: 다섯 번째 실험의 **분봉** 매수/매도 통합 최적화 범위 테스트

---

# Condition - Study 5_9010 (Min)

## 조건식

### 매수 조건식 - C_S_5_B_Min

```python
# 분봉 데이터 기준 변수 사용
# 기존 '초당' 관련 변수를 '분당' 관련 변수로 모두 변경

전일종가          = 현재가 / (1 + (등락율 / 100))                      # 단위: 원
시가등락율        = ((시가 - 전일종가) / 전일종가) * 100                # 단위: 퍼센트
시가대비등락율    = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트

# '초당순매수금액' -> '분당순매수금액'으로 변경
분당순매수금액    = (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000   # 단위: 백만원

고가대비하락율    = ((고가 - 현재가) / 고가) * 100                     # 단위: 퍼센트

# New
누적거래대금비율 = 당일거래대금 / (시가총액 * 회전율 / 100) * 100 if (시가총액 * 회전율 / 100) != 0 else 0
분당순매수비율 = 분당매수수량 / (분당매수수량 + 분당매도수량) * 100 if (분당매수수량 + 분당매도수량) != 0 else 0

매수 = True

if not (관심종목 == 1):
    매수 = False
elif not (1000 < 현재가 <= 30000):
    매수 = False
elif not (2.0 < 등락율 <= 7.0):
    매수 = False
elif not (고저평균대비등락율 > 0):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
# '초당거래대금' -> '분당거래대금'으로 변경
elif not (분당거래대금 > 분당거래대금N(1) * 1.0):
    매수 = False
elif 90500 < 시분초 < 91000:
    if 시가총액 < 3000:
        if not (0.0 <= 시가등락율 and 시가등락율 < 8.0):
            매수 = False
        elif not (1.0 <= 시가대비등락율 and 시가대비등락율 < 8.0):
            매수 = False
        # '초당순매수비율' -> '분당순매수비율'로 변경
        elif not (분당순매수비율 > 70):
            매수 = False
        # '초당순매수금액' -> '분당순매수금액'으로 변경
        elif not (5 < 분당순매수금액 and 분당순매수금액 < 1000):
            매수 = False
        elif not (현재가 > (고가 - (고가 - 저가) * 15 / 100)):
            매수 = False
        elif not (누적거래대금비율 > 100):
            매수 = False
        elif not (전일비 > 10):
            매수 = False
        elif not (전일동시간비 > 0):
            매수 = False
        elif not (1 < 회전율 < 100):
            매수 = False
        elif not (당일거래대금 > 10 * 100):
            매수 = False
        elif not (당일거래대금각도(30) > 2 and 당일거래대금각도(30) < 20):
            매수 = False
        # '초당거래대금' -> '분당거래대금', '초당거래대금평균' -> '분당거래대금평균'으로 변경
        elif not (2.0 < 분당거래대금 / 분당거래대금평균(30) < 5.0):
            매수 = False
        # '초당매수수량' -> '분당매수수량'으로 변경
        elif not (분당매수수량 > 매도총잔량 * 10 / 100):
            매수 = False
        # '누적초당매도수량' -> '누적분당매도수량', '누적초당매수수량' -> '누적분당매수수량'으로 변경
        elif not(누적분당매도수량(30) < 누적분당매수수량(30) * 1):
            매수 = False
        elif not (체결강도 >= 100 and 체결강도 <= 300):
            매수 = False
    else:
        매수 = False
else:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매도 조건식 - C_S_3_S_902_Min

```python
# 분봉 데이터 기준 변수 사용
# 기존 '초당' 관련 변수를 '분당' 관련 변수로 모두 변경

시가대비등락율    = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트

매도 = False

if 등락율 > 29.5:
    매도 = True
# 보유시간은 분 단위로 변경됨에 따라 조건 재검토 필요. 가이드라인은 분 단위임.
# 원본의 '보유시간 > 60'은 60초를 의미했으나, 분봉에서는 60분을 의미함.
# 로직의 의도(단기 보유 후 최저가 이탈 시 매도)를 살리기 위해 보유시간 조건을 조정해야 할 수 있음.
# 예를 들어, 1분봉 데이터이므로 '보유시간 > 1' (1분)과 같이 사용해야 함.
elif 보유시간 > 1 and 현재가 < 최저분봉저가(보유시간):
    매도 = True
elif 시가대비등락율 < 0 and 수익률 <= -2.0 and 현재가 < 최저분봉저가(보유시간):
    매도 = True
elif 시분초 < 93000:        # 시간 조건
    if 4 <= 수익률:
        매도 = True
    elif 수익률 <= -4.0:
        매도 = True
    elif 최고수익률 > 4 and 최고수익률 * 0.6 >= 수익률:
        매도 = True
    elif 시가총액 < 10000:
        # '초당매도수량', '초당매수수량' -> '분당매도수량', '분당매수수량'으로 변경
        if 등락율각도(30) >= 10 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.5 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True
        elif 등락율각도(30) < 10 and 등락율각도(30) >= 5 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.7 and (현재가 / 현재가N(1) - 1) * 100 < -0.7:
            매도 = True
        elif 등락율각도(30) < 5 and 등락율각도(30) >= 0 and (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.8 and (현재가 / 현재가N(1) - 1) * 100 < -0.5:
            매도 = True
        elif 4 < 최고수익률 and 현재가N(1) >= 이동평균(60, 1) and 이동평균(60) > 현재가:
            매도 = True
else:
    매도 = False

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

-----

## 최적화 조건식

### 매수 최적화 조건식 - C_S_2_BO_T_Min

```python
# 분봉 데이터 기준 변수 사용
# '초당' -> '분당'으로 변경

# '초당순매수금액' -> '분당순매수금액'으로 변경
분당순매수금액    = (분당매수수량 - 분당매도수량) * 현재가 / 1_000_000   # 단위: 백만원
전일종가          = 현재가 / (1 + (등락율 / 100))                      # 단위: 원
시가등락율        = ((시가 - 전일종가) / 전일종가) * 100                # 단위: 퍼센트
시가대비등락율    = ((현재가 - 시가) / 시가) * 100                      # 단위: 퍼센트

누적거래대금비율 = 당일거래대금 / (시가총액 * 회전율 / 100) * 100 if (시가총액 * 회전율 / 100) != 0 else 0

매수 = True

# 공통 선결 조건
if not (관심종목 == 1):
    매수 = False
elif not (1000 < 현재가 <= 30000):
    매수 = False
elif not (1.0 < 등락율 <= self.vars[10]):
    매수 = False
elif not (고저평균대비등락율 > 0):
    매수 = False
elif not (현재가 < VI아래5호가):
    매수 = False
# '초당거래대금' -> '분당거래대금'으로 변경
elif not (분당거래대금 > 분당거래대금N(1) * self.vars[11]):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False
elif not (RSI < self.vars[12]):
    매수 = False
elif 시분초 < self.vars[13]:
    if 시가총액 < 5000:
        if not (1.0 <= 시가등락율 and 시가등락율 < self.vars[14]):
            매수 = False
        elif not (1.0 <= 시가대비등락율 and 시가대비등락율 < self.vars[15]):
            매수 = False
        elif not (30 < 분당순매수금액 and 분당순매수금액 < 300):
            매수 = False
        elif not (현재가 > (고가 - (고가 - 저가) * self.vars[16] / 100)):
            매수 = False
        elif not (누적거래대금비율 > self.vars[17]):
            매수 = False
        elif not (전일비 > self.vars[18]):
            매수 = False
        elif not (전일동시간비 > 100):
            매수 = False
        elif not (회전율 > self.vars[19]):
            매수 = False
        elif not (당일거래대금 > 3 * 100):
            매수 = False
        elif not (등락율각도(30) > -2 and 등락율각도(30) < 10):
            매수 = False
        elif not (전일비각도(30) > 0 and 전일비각도(30) < 50):
            매수 = False
        # '최고초당매수수량', '최고초당매도수량' -> '최고분당매수수량', '최고분당매도수량'으로 변경
        elif not (최고분당매수수량(30) > 최고분당매도수량(30) * self.vars[20]):
            매수 = False
        # '초당거래대금', '초당거래대금평균' -> '분당거래대금', '분당거래대금평균'으로 변경
        elif not (분당거래대금 / 분당거래대금평균(30) > self.vars[21]):
            매수 = False
        # '초당매수수량' -> '분당매수수량'으로 변경
        elif not (분당매수수량 > 매도총잔량 * self.vars[22] / 100):
            매수 = False
        elif not (매수총잔량 > 매도총잔량 * self.vars[23]):
            매수 = False
        elif not (매수잔량1 > 매도잔량1 * self.vars[24]):
            매수 = False
        # '누적초당매수수량', '누적초당매도수량' -> '누적분당매수수량', '누적분당매도수량'으로 변경
        elif not(누적분당매수수량(30) > 누적분당매도수량(30) * self.vars[25]):
            매수 = False
    else:
        매수 = False
else:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 매수 최적화 범위 - C_S_2_BOR_T_Min

```python
# 매수 최적화 범위 (분봉 기준)
self.vars[10] = [[15.0, 20.0, 5.0], 15.0]      # 범위갯수: 2  # 등락율 범위
self.vars[11] = [[1.0, 2.0, 0.5], 1.5]         # 범위갯수: 3  # 분당거래대금 증가율
self.vars[12] = [[65, 75, 5], 70]              # 범위갯수: 3  # RSI 범위
self.vars[13] = [[91000, 92000, 500], 91000]   # 범위갯수: 3  # 시분초 범위
self.vars[14] = [[6.0, 10.0, 1.0], 10.0]       # 범위갯수: 5  # 시가등락율 범위
self.vars[15] = [[7.0, 9.0, 1.0], 8.0]         # 범위갯수: 3  # 시가대비등락율 범위
self.vars[16] = [[10, 30, 10], 10]             # 범위갯수: 3  # 고가 대비 현재가 비율
self.vars[17] = [[5, 25, 10], 5]               # 범위갯수: 3  # 누적거래대금비율
self.vars[18] = [[10, 20, 10], 10]             # 범위갯수: 2  # 전일비 범위
self.vars[19] = [[0.5, 2.0, 0.5], 1.0]         # 범위갯수: 4  # 회전율 범위
self.vars[20] = [[0.5, 1.5, 0.5], 0.5]         # 범위갯수: 3  # 최고분당매수수량 대비 최고분당매도수량 비율
self.vars[21] = [[1.5, 3.5, 1.0], 1.5]         # 범위갯수: 3  # 분당거래대금 대비 분당거래대금평균 비율
self.vars[22] = [[20, 40, 10], 20]             # 범위갯수: 3  # 분당매수수량 대비 매도총잔량 비율
self.vars[23] = [[0.5, 0.25, -0.25], 0.5]      # 범위갯수: 2  # 매수총잔량 대비 매도총잔량 비율
self.vars[24] = [[1.5, 2.5, 0.5], 1.5]         # 범위갯수: 3  # 매수잔량1 대비 매도잔량1 비율
self.vars[25] = [[1, 3, 1], 1]                 # 범위갯수: 3  # 누적분당매수수량 대비 누적분당매도수량 비율
# 매수 총 경우의 수: (2 * 3 * 3 * 3 * 5 * 3 * 3 * 3 * 2 * 4 * 3 * 3 * 3 * 2 * 3 * 3 = 42,515,280) -> 원본과 동일
```

### 매도 최적화 조건식 - C_S_2_SO_T_Min

```python
# 분봉 데이터 기준 변수 사용
# '초당' -> '분당'으로 변경

매도 = False

if 등락율 > 29.5:
    매도 = True
elif 시분초 < 93000:        # 시간 조건
    if self.vars[1] <= 수익률:
        매도 = True
    elif 수익률 <= self.vars[2]:
        매도 = True
    elif 최고수익률 > self.vars[3] and 최고수익률 * self.vars[4] >= 수익률:
        매도 = True
    # '보유시간'은 분 단위. 예를 들어 self.vars[5]가 5이면 5분을 의미.
    elif 보유시간 > self.vars[5] and 수익률 < self.vars[6]:
        매도 = True
    elif 시가총액 < 2500000:
        # '초당매도수량', '초당매수수량' -> '분당매도수량', '분당매수수량'으로 변경
        if (분당매도수량 - 분당매수수량) >= 매수총잔량 * 0.8 and (현재가 / 현재가N(1) - 1) * 100 < self.vars[7]:
            매도 = True
        elif 수익률 < self.vars[8] and 체결강도N(1) > 체결강도평균(30,1) > 체결강도:
            매도 = True
        elif self.vars[9] < 최고수익률 and 현재가N(1) >= 이동평균(60, 1) and 이동평균(60) > 현재가:
            매도 = True
else:
    매도 = False

if 매도:
    self.Sell(종목코드, 종목명, 매도수량, 현재가, 매도호가1, 매수호가1, 강제청산)
```

### 매도 최적화 범위 - C_S_2_SOR_T1_Min

```python
# 매도 최적화 범위 (분봉 기준)
self.vars[0] = [[30, 30, 0], 30]               # 범위갯수: 1  # 고정값
self.vars[1] = [[4.0, 6.0, 1.0], 5.0]          # 범위갯수: 3  # 수익률 조건
self.vars[2] = [[-4.0, -2.0, 1.0], -4.0]       # 범위갯수: 3  # 손실 수익률 조건
self.vars[3] = [[2.0, 4.0, 1.0], 3.0]          # 범위갯수: 3  # 최고수익률 기준값
self.vars[4] = [[0.6, 0.8, 0.1], 0.7]          # 범위갯수: 3  # 최고수익률 대비 현재 수익률 비율
# '보유시간'은 분 단위로 해석해야 함. 300초 -> 5분, 1200초 -> 20분
self.vars[5] = [[5, 20, 5], 10]                # 범위갯수: 4  # 보유시간(분) 조건: 5분에서 20분까지 5분 간격
self.vars[6] = [[-1.0, 1.0, 1.0], 1.0]         # 범위갯수: 3  # 보유시간 초과 시 수익률 하한
self.vars[7] = [[-0.1, -0.2, -0.05], -0.1]     # 범위갯수: 3  # 현재가 변화율 하한
self.vars[8] = [[-2.0, 0, 1], -1.0]            # 범위갯수: 3  # 손실 수익률 조건
self.vars[9] = [[2.0, 4.0, 1.0], 3.0]          # 범위갯수: 3  # 최고수익률 조건
# 매도 총 경우의 수: (1 * 3 * 3 * 3 * 3 * 4 * 3 * 3 * 3 * 3 = 26,244) -> 원본과 동일
```

### 매수 매도 최적화 범위 - C_S_2_OR_T1_Min

```python
# --- 매도 최적화 범위 (분봉 기준) ---
self.vars[0] = [[30, 30, 0], 30]
self.vars[1] = [[4.0, 6.0, 1.0], 5.0]
self.vars[2] = [[-4.0, -2.0, 1.0], -4.0]
self.vars[3] = [[2.0, 4.0, 1.0], 3.0]
self.vars[4] = [[0.6, 0.8, 0.1], 0.7]
self.vars[5] = [[5, 20, 5], 10]              # 분 단위 보유시간
self.vars[6] = [[-1.0, 1.0, 1.0], 1.0]
self.vars[7] = [[-0.1, -0.2, -0.05], -0.1]
self.vars[8] = [[-2.0, 0, 1], -1.0]
self.vars[9] = [[2.0, 4.0, 1.0], 3.0]
# 매도 총 경우의 수: 26,244

# --- 매수 최적화 범위 (분봉 기준) ---
self.vars[10] = [[15.0, 20.0, 5.0], 15.0]
self.vars[11] = [[1.0, 2.0, 0.5], 1.5]
self.vars[12] = [[65, 75, 5], 70]
self.vars[13] = [[91000, 92000, 500], 91000]
self.vars[14] = [[6.0, 10.0, 1.0], 10.0]
self.vars[15] = [[7.0, 9.0, 1.0], 8.0]
self.vars[16] = [[10, 30, 10], 10]
self.vars[17] = [[5, 25, 10], 5]
self.vars[18] = [[10, 20, 10], 10]
self.vars[19] = [[0.5, 2.0, 0.5], 1.0]
self.vars[20] = [[0.5, 1.5, 0.5], 0.5]
self.vars[21] = [[1.5, 3.5, 1.0], 1.5]
self.vars[22] = [[20, 40, 10], 20]
self.vars[23] = [[0.5, 0.25, -0.25], 0.5]
self.vars[24] = [[1.5, 2.5, 0.5], 1.5]
self.vars[25] = [[1, 3, 1], 1]
# 매수 총 경우의 수: 42,515,280

# 매수 매도 총 경우의 수: (26,244 * 42,515,280 = 1,115,771,008,320) -> 원본과 동일
```

---

**작성일**: 2025-07-15
**최종 수정일**: 2025-11-18
**버전**: v1.1
