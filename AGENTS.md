# STOM V1 - System Trading Optimization Manager

## Purpose

STOM (System Trading Optimization Manager) V1 is a professional-grade high-frequency trading system for Korean stock markets (Kiwoom Securities integration) and cryptocurrency markets (Upbit, Binance). Built with PyQt5, this multiprocess real-time trading platform features comprehensive backtesting capabilities.

**Project Scale** (2025-11-26):
- 157 Python source files (~70,000+ lines)
- 175+ markdown documentation files
- 133 trading condition files (98.3% documentation compliance)
- 15 SQLite databases for data separation
- Multiprocess architecture with 15 inter-process communication queues

## Key Directories

### üîß Configuration & Infrastructure
- `.claude/` - Claude Code configuration and project instructions
- `.cursor/rules/` - Cursor IDE rules and settings
- `.roo/` - Roo configuration with specialized rule sets (architect, debug, test, etc.)
- `.taskmaster/` - Task management system (docs & tasks)
- `config/` - Application configuration files
- `venv_32bit/` - Python 3.9 32-bit environment (for Kiwoom API)
- `venv_64bit/` - Python 3.11 64-bit environment (modern features)

### üíπ Core Trading Modules
- `stock/` - Korean stock market trading via Kiwoom API (9 files, ~7,800 lines) [see stock/AGENTS.md]
- `coin/` - Cryptocurrency trading for Upbit & Binance (16 files, ~10,098 lines) [see coin/AGENTS.md]
- `utility/` - Shared functionality & database management (24 files, ~3,419 lines) [see utility/AGENTS.md]

### üìä Analysis & Testing
- `backtester/` - Historical data testing & optimization (23 files, ~12,993 lines) [see backtester/AGENTS.md]
- `Deep_Data/` - Advanced data analysis module with algorithms, plots, and results [see Deep_Data/AGENTS.md]
- `lecture/` - Educational materials and performance test code [see lecture/AGENTS.md]
- `tests/` - Unit tests for system validation
- `scripts/` - Automation scripts

### üé® User Interface
- `ui/` - PyQt5 interface components (70+ files, ~20,625 lines) [see ui/AGENTS.md]
- `icon/` - UI icons and visual resources

### üìö Documentation
- `docs/` - Comprehensive documentation system [see docs/AGENTS.md]
  - `Manual/` - 16+ files covering architecture, modules, API, UI/UX, data, trading
  - `Condition/` - 133 trading strategy condition files (98.3% compliant)
  - `Guideline/` - Development standards and user manuals
  - `Study/` - Research reports and system analysis
  - `CodeReview/` - Technical analysis documents

### üóÑÔ∏è Data Storage (excluded from version control)
- `_database/` - 15 SQLite databases (setting, tick, minute, tradelist, strategy, backtest, optuna)
- `_log/` - Application logs (auto-generated by system)
- `_icos_results/` - ICOS analysis results

## Entry Points

### Main Application
- `stom.py` - Main entry point (mode selection: stock/coin)
- `stom.bat` / `stom_stock.bat` / `stom_coin.bat` - Windows batch launchers (admin required)

### Installation
- `pip_install_64.bat` - Install dependencies for 64-bit Python
- `requirements.txt` - Python dependencies (PyQt5, TA-Lib, trading APIs, etc.)

### Database Management
- `utility/database_check.py` - Database integrity verification (auto-run at startup)
- `utility/db_update_day.py` - Daily data updates
- `utility/db_update_back.py` - Historical data backfill

## Architecture Overview

### Multiprocess Design
STOM uses a **15-queue multiprocess architecture** for parallel real-time processing:

```
Main Process (PyQt5 GUI)
‚îú‚îÄ‚Üí Kiwoom Manager Process (stock/kiwoom_manager.py)
‚îÇ   ‚îú‚îÄ‚Üí Receiver Tick (WebSocket/ZMQ streaming)
‚îÇ   ‚îú‚îÄ‚Üí Receiver Min (minute candle aggregation)
‚îÇ   ‚îú‚îÄ‚Üí Strategy Engine (signal generation)
‚îÇ   ‚îî‚îÄ‚Üí Trader (order execution & management)
‚îú‚îÄ‚Üí Coin Receiver Process
‚îÇ   ‚îú‚îÄ‚Üí Upbit WebSocket (real-time tick data)
‚îÇ   ‚îú‚îÄ‚Üí Binance WebSocket (real-time tick data)
‚îÇ   ‚îú‚îÄ‚Üí Strategy Engine (unified or separate)
‚îÇ   ‚îî‚îÄ‚Üí Trader (multi-exchange orders)
‚îú‚îÄ‚Üí Query Process (database operations via queryQ)
‚îú‚îÄ‚Üí Backtester Process (parallelized optimization)
‚îú‚îÄ‚Üí Kimp Process (kimchi premium arbitrage monitoring)
‚îî‚îÄ‚Üí Chart Update Threads (UI rendering)
```

### Queue Architecture (qlist)
```python
qlist[0]  = windowQ    # Main window events
qlist[1]  = soundQ     # Audio alerts
qlist[2]  = queryQ     # Database operations
qlist[3]  = teleQ      # Telegram notifications
qlist[4]  = chartQ     # Chart updates
qlist[5]  = hogaQ      # Order book data
qlist[6]  = webcQ      # Web communication
qlist[7]  = backQ      # Backtesting
qlist[8]  = creceivQ   # Coin receiver
qlist[9]  = ctraderQ   # Coin trader
qlist[10] = cstgQ      # Coin strategy
qlist[11] = liveQ      # Live trading data
qlist[12] = kimpQ      # Kimchi premium arbitrage
qlist[13] = wdzservQ   # WebSocket ZMQ server
qlist[14] = totalQ     # Overall statistics
```

### Design Patterns
- **Strategy Pattern**: Dedicated strategy engines per market
- **Observer Pattern**: Real-time data updates via queues/WebSocket
- **Factory Pattern**: Market-specific engines (Kiwoom, Upbit, Binance)
- **Singleton Pattern**: Configuration and database managers
- **Template Method**: Strategy classes inherit Receiver classes
- **Command Pattern**: Queue-based operations for all inter-process communication

## File Naming Conventions

- `*_receiver_*.py` - Real-time data collection (WebSocket/ZMQ)
- `*_strategy_*.py` - Trading logic & signal generation
- `*_trader.py` - Order execution & position management
- `*_manager.py` - Process/resource coordination
- `backengine_*_*.py` - Backtesting engines (Market √ó Timeframe)
- `ui_*.py` - Interface components & event handlers
- `ui_button_clicked_*.py` - Event handlers (cvj=coin execution/balance, svj=stock execution/balance)
- `ui_update_*.py` - Data display updates (tables, text, progress)
- `ui_draw_*.py` - Chart rendering (candles, real-time, TreeMap)
- `set_*.py` - UI component setup & layout

## For AI Agents

### Development Guidelines

1. **Always Read Before Editing** - Never propose changes to unread code
2. **Preserve Korean Variable Names** - Don't translate (ÌòÑÏû¨Í∞Ä, ÏãúÍ∞Ä, Í≥†Í∞Ä, Ï†ÄÍ∞Ä, etc.)
3. **Maintain Queue Architecture** - All inter-process communication via queues
4. **Follow Naming Conventions** - Respect `*_receiver_*.py`, `*_strategy_*.py` patterns
5. **Update Documentation** - All code changes require corresponding doc updates
6. **Test with Backtester** - Validate strategy changes before live deployment
7. **Check Database Schema** - Coordinate changes across 15 SQLite databases
8. **Maintain 98.3%+ Compliance** - Keep condition documentation compliance high

### Adding New Features

1. **Use Existing Patterns** - Follow Template Method, Strategy, Observer patterns
2. **Respect Process Boundaries** - Don't mix concerns across process types
3. **Add to Appropriate Module** - Stock/Coin/UI/Utility/Backtester separation
4. **Document Thoroughly** - Create condition documents for new strategies
5. **Consider Performance** - Reference `/lecture/testcode/` benchmarks
6. **Update Queue List** - Add new queues to qlist if needed
7. **Encrypt Sensitive Data** - Use Fernet encryption for credentials

### Debugging Approach

1. **Check Logs** - Process-specific logs in `/_log/`
2. **Validate Database** - Run `utility/database_check.py`
3. **Test Queue Communication** - Verify inter-process queue flows
4. **Validate Condition Code** - Use `back_code_test.py`
5. **Check Documentation Alignment** - Ensure code matches docs (98.3% target)

### Key Configuration Files

- `utility/setting.py` (42KB) - Global settings, 15 database paths, encrypted credentials
- `utility/static.py` (16KB) - Helper functions (threading, crypto, datetime, UI)
- `utility/query.py` (24KB) - Queue-based database operations
- `CLAUDE.md` - Comprehensive project guide for AI assistants

## Technology Stack

### Core Technologies
- **Python 3.9 (32-bit)** for Kiwoom API compatibility
- **Python 3.11 (64-bit)** for modern features
- **PyQt5** - GUI framework with WebEngine and pyqtgraph
- **SQLite** - 15 databases for data separation
- **ZeroMQ (ZMQ)** - High-performance real-time data streaming
- **WebSocket** - Exchange API connections (Upbit, Binance)
- **multiprocessing** - 15-queue parallel processing architecture

### Trading APIs
- **Kiwoom OpenAPI** - Korean stock market (Windows only, `C:/OpenAPI`)
- **pyupbit** - Upbit cryptocurrency exchange
- **python-binance** - Binance cryptocurrency exchange

### Data Processing
- **numpy 1.26.4** - High-performance numerical operations
- **pandas 2.0.3** - Data manipulation and analysis
- **TA-Lib** - Technical analysis (custom wheel in `/utility/`)

### Optimization & Testing
- **optuna** - Hyperparameter optimization
- **cmaes** - Covariance Matrix Adaptation Evolution Strategy
- **pyqtgraph** - Real-time chart rendering

## Performance Considerations

- **Numpy/Pandas** for high-performance data processing
- **TA-Lib** for technical analysis (`/utility/` custom wheel)
- **pyqtgraph** for real-time chart rendering
- **Indexed Tables** for optimized database queries
- **Multiprocess Parallelization** for concurrent operations

## Security Features

- **Encrypted Credentials** using cryptography.fernet
- **API Key Management** via `utility/static.py`
- **Blacklist Management** for risk control
- **Position Sizing** built-in risk management

## Current Status (2025-11-26)

**Completed Initiatives**:
- Phase 5: 119/121 condition files (98.3%) now documentation compliant
- Automated optimization section generation for trading conditions
- Manual documentation code reference validation (7 files, 138 code blocks)
- Path and command corrections throughout documentation

**Current Focus**:
- Maintaining documentation-code alignment
- Continuous strategy optimization
- Performance benchmarking and improvements

**Technical Debt**:
- Limited formal unit tests (educational tests exist)
- Some legacy code patterns in older modules
- Still bringing documentation to 100% compliance (2 files remaining)

## Related Documentation

- `CLAUDE.md` - Comprehensive AI assistant guide
- `docs/Manual/` - 16+ detailed system analysis documents
- `docs/Guideline/` - Development standards and procedures
- `docs/Condition/` - 133 trading strategy condition files
