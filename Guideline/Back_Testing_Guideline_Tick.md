# Back Testing Guideline

## 1. 업데이트 개요

### 1.1 변수 사용 방식의 변화

1. **단일 변수**:  
   - 그대로 변수명을 사용하거나, 과거 틱 데이터를 조회할 때 `N(틱수)` 추가  
   - 예) `초당거래대금`, `초당거래대금N(1)` (1틱 전의 초당거래대금)

2. **구간 연산 함수**:  
   - `(구간틱수, [이전값])` 형태의 **함수** 호출  
   - 예) `등락율각도(30)`, `체결강도평균(30)`, `최고초당매수수량(30)`, `최저체결강도(30, 1)` 등  
   - 괄호 없이 사용하던 과거 방식(`등락율각도30` 등)은 모두 **함수 형태**로 변경  

3. **이전값 활용** (`-1` 등):  
   - 일부 특별한 케이스(예: 매수틱 번호)에서 `...(-1)`을 사용 가능  
   - 본 문서 예시에서는 주로 `N(1)`, `N(2)` 형태만 등장


## 2. 주식 매수 변수 (stock_buy_var)

다음은 **매수 시점**에서 사용할 수 있는 변수들에 대한 설명입니다.  
(괄호 없이 단일 변수로 접근하거나, `변수명N(1)`, `변수명N(2)`와 같이 **이전 틱** 조회 가능.  
구간 연산은 `(구간틱수, [이전값])` 형태로 작성.)

### 2.1 기본 변수들 (단일 값, 괄호 없이 사용)

1. **현재가 (int)**  
   \- 1초마다 수신된 틱데이터의 현재가  
   \- `현재가` : 현재 현재가  
   \- `현재가N(1)` : 1틱 전의 현재가  
    ```python
    if 현재가 >= 1000 and 현재가 > 현재가N(1):
    매수 = True
    ```

2. **시가 (int)**  
   \- 당일 일봉 시가
   \- `시가` : 현재 시가  
   \- `시가N(1)` : 1틱 전의 시가  
    ```python
    if 시가 >= 1000 and 시가 > 시가N(1):
    매수 = True
    ```

3. **고가 (int)**, **저가 (int)**  
   \- 당일 일봉 고가, 저가  
   \- `고가` : 현재 고가  
   \- `고가N(1)` : 1틱 전의 고가  
   \- `저가` : 현재 저가  
   \- `저가N(1)` : 1틱 전의 저가  
    ```python
    if 저가 <= 1000 and 저가 < 저가N(1):
    매수 = True
    ```

4. **등락율 (float)**  
   \- 전일 종가 대비 등락율  
   \- `등락율` : 현재 등락율  
   \- `등락율N(1)` : 1틱 전의 등락율  
    ```python
    if 등락율 >= 10 and 등락율 > 등락율N(1):
    매수 = True
    ```

5. **고저평균대비등락율 (float)**  
   \- (당일 고가+저가)/2 의 평균 대비 현재가 등락율  
   \- `고저평균대비등락율` : 현재 고저평균대비등락율  
   \- `고저평균대비등락율N(1)` : 1틱 전의 고저평균대비등락율  
    ```python
    if 고저평균대비등락율 >= 10 and 고저평균대비등락율 > 고저평균대비등락율N(1):
    매수 = True
    ```

6. **당일거래대금 (int)**  
   \- 당일 거래대금(단위 설정에 따라 다름)  
   \- `당일거래대금` : 현재 당일거래대금  
   \- `당일거래대금N(1)` : 1틱 전의 당일거래대금  
    ```python
    if 당일거래대금 >= 100000000 and 당일거래대금 > 당일거래대금N(1):
    매수 = True
    ```

7. **체결강도 (float)**  
   \- (매수수량 / 매도수량 * 100) 최소0 ~ 최대500
   \- `체결강도` : 현재 체결강도  
   \- `체결강도N(1)` : 1틱 전의 체결강도  
    ```python
    if 체결강도 >= 100 and 체결강도 > 체결강도N(1):
    매수 = True
    ```

8. **거래대금증감 (int)**  
   \- 전일 거래대금 대비 증가한 당일 거래대금
   \- `거래대금증감` : 현재 거래대금증감  
   \- `거래대금증감N(1)` : 1틱 전의 거래대금증감  
    ```python
    if 거래대금증감 >= 100000000 and 거래대금증감 > 거래대금증감N(1):
    매수 = True
    ```

9. **전일비 (float)**  
   \- 전일 거래량 대비 당일 거래량 비율 * 100
   \- `전일비` : 현재 전일비  
   \- `전일비N(1)` : 1틱 전의 전일비  
    ```python
    if 전일비 >= 100 and 전일비 > 전일비N(1):
    매수 = True
    ```

10. **회전율 (float)**  
    \- 상장주식수 대비 당일 거래량 비율 * 100
    \- `회전율` : 현재 회전율  
    \- `회전율N(1)` : 1틱 전의 회전율  
    ```python
    if 회전율 >= 100 and 회전율 > 회전율N(1):
    매수 = True
    ```

11. **전일동시간비 (float)**  
    \- 전일 같은 시간대의 거래량 대비 당일 거래량 비율 * 100
    \- `전일동시간비` : 현재 전일동시간비  
    \- `전일동시간비N(1)` : 1틱 전의 전일동시간비  
    ```python
    if 전일동시간비 >= 100 and 전일동시간비 > 전일동시간비N(1):
    매수 = True
    ```

12. **시가총액 (int)**  
    \- 종목의 시가총액
    \- `시가총액` : 현재 시가총액  
    \- `시가총액N(1)` : 1틱 전의 시가총액  
    ```python
    if 시가총액 >= 1000000000 and 시가총액 > 시가총액N(1):
    매수 = True
    ```

13. **라운드피겨위5호가이내 (boolean)**  
    \- 라운드피겨(예:1000) 포함 상위5호가(예:1025)이내면 `True`, 아니면 `False`
    ```python
    if 현재가 <= 1025 and 현재가 >= 1000:
    매수 = True
    ```

14. **초당매수수량 (int)**  
    \- 1초 동안 매수 수량의 누적
    \- `초당매수수량` : 현재 초당매수수량  
    \- `초당매수수량N(1)` : 1틱 전의 초당매수수량  
    ```python
    if 초당매수수량 >= 100000000 and 초당매수수량 > 초당매수수량N(1):
    매수 = True
    ```

15. **초당매도수량 (int)**  
    \- 1초 동안 매도 수량의 누적
    \- `초당매도수량` : 현재 초당매도수량  
    \- `초당매도수량N(1)` : 1틱 전의 초당매도수량  
    ```python
    if 초당매도수량 >= 100000000 and 초당매도수량 > 초당매도수량N(1):
    매수 = True
    ```

16. **초당거래대금 (int)**  
    \- 1초 동안 거래대금의 누적
    \- `초당거래대금` : 현재 초당거래대금  
    \- `초당거래대금N(1)` : 1틱 전의 초당거래대금  
    ```python
    if 초당거래대금 >= 100000000 and 초당거래대금 > 초당거래대금N(1):
    매수 = True
    ```

17. **매도총잔량 (int)**  
    \- 각 1~5호가 잔량의 합
    \- `매도총잔량` : 현재 매도총잔량  
    \- `매도총잔량N(1)` : 1틱 전의 매도총잔량  
    ```python
    if 매도총잔량 >= 100000000 and 매도총잔량 > 매도총잔량N(1):
    매수 = True
    ```

18. **매수총잔량 (int)**  
    \- 각 1~5호가 잔량의 합
    \- `매수총잔량` : 현재 매수총잔량  
    \- `매수총잔량N(1)` : 1틱 전의 매수총잔량  
    ```python
    if 매수총잔량 >= 100000000 and 매수총잔량 > 매수총잔량N(1):
    매수 = True
    ```

19. **매도호가1~5 (int)**  
    \- 매도 1~5호가 가격
    \- `매도호가1` : 현재 매도호가1  
    \- `매도호가1N(1)` : 1틱 전의 매도호가1  
    ```python
    if 매도호가1 >= 1000 and 매도호가1 > 매도호가1N(1):
    매수 = True
    ```

20. **매도잔량1~5 (int)**  
    \- 매도 1~5호가 잔량
    \- `매도잔량1` : 현재 매도잔량1  
    \- `매도잔량1N(1)` : 1틱 전의 매도잔량1  
    ```python
    if 매도잔량1 >= 100000000 and 매도잔량1 > 매도잔량1N(1):
    매수 = True
    ```

21. **매수호가1~5 (int)**  
    \- 매수 1~5호가 가격
    \- `매수호가1` : 현재 매수호가1  
    \- `매수호가1N(1)` : 1틱 전의 매수호가1  
    ```python
    if 매수호가1 >= 1000 and 매수호가1 > 매수호가1N(1):
    매수 = True
    ```

22. **매수잔량1~5 (int)**  
    \- 매수 1~5호가 잔량
    \- `매수잔량1` : 현재 매수잔량1  
    \- `매수잔량1N(1)` : 1틱 전의 매수잔량1  
    ```python
    if 매수잔량1 >= 100000000 and 매수잔량1 > 매수잔량1N(1):
    매수 = True
    ```

23. **매도수5호가잔량합 (int)**  
    \- 매도 1~5호가 잔량 합
    \- `매도수5호가잔량합` : 현재 매도수5호가잔량합  
    \- `매도수5호가잔량합N(1)` : 1틱 전의 매도수5호가잔량합  
    ```python
    if 매도수5호가잔량합 >= 100000000 and 매도수5호가잔량합 > 매도수5호가잔량합N(1):
    매수 = True
    ```

24. **관심종목 (int)**  
    \- 거래대금순위 내에 있으면 `1`, 아니면 `0`
    \- `관심종목` : 현재 관심종목  
    \- `관심종목N(1)` : 1틱 전의 관심종목  
    ```python
    if 관심종목 >= 1 and 관심종목 > 관심종목N(1):
    매수 = True
    ```

25. **매수 (True)**  
    \- 기본적으로 `True` 상태인 변수 (전략 상단에서 `매수 = False`로 시작, 조건 만족 시 `and 매수` 식)

### 2.2 구간 연산 변수 (괄호 안에 구간틱수, 이전틱수)

1. **이동평균(float)**  
   \- 1초마다 기록된 현재가의 단순평균  
   \- `이동평균(60)` : 60틱 이동평균  
   \- `이동평균(60, 1)` : 1틱 전 기준 60틱 이동평균
   ```python
   if 이동평균(60) > 3000 and 이동평균(60, 1) > 3000:
   매수 = True
   ```  

2. **최고현재가(int)**, **최저현재가(int)**  
   \- 입력한 구간틱수 동안의 최고/최저 현재가  
   \- `최고현재가(30)` : 최근 30틱 최고가  
   \- `최고현재가(30, 1)` : 1틱 전 기준 30틱 최고가  
   \- `최저현재가(30)` : 최근 30틱 최저가  
   \- `최저현재가(30, 1)` : 1틱 전 기준 30틱 최저가  
   ```python
   if 최고현재가(30) > 30000 and 최저현재가(30) < 20000:
   매수 = True
   ```

3. **초당거래대금평균(float)**  
   \- 입력 구간틱수 동안 초당거래대금의 평균  
   \- `초당거래대금평균(60)` : 최근 60틱 동안의 초당거래대금 평균  
   \- `초당거래대금평균(60, 1)` : 1틱 전 기준 60틱 동안의 초당거래대금 평균  
   ```python
   if 초당거래대금평균(60) > 100000000 and 초당거래대금평균(60, 1) > 100000000:
   매수 = True
   ```

5. **체결강도평균 (float)**  
   \- 입력한 구간틱수 동안 체결강도의 평균값  
   \- `체결강도평균(30)` : 최근 30틱 체결강도 평균  
   \- `체결강도평균(30, 1)` : 1틱 전 기준 30틱 체결강도 평균
   ```python
   if 체결강도평균(30) > 100 and 체결강도평균(30, 1) > 100:
   매수 = True
   ```

6. **최고체결강도 (float)**  
   \- 입력한 구간틱수 동안 체결강도의 최고값  
   \- `최고체결강도(30)` : 최근 30틱 체결강도 최고  
   \- `최고체결강도(30, 1)` : 1틱 전 기준 30틱 체결강도 최고
   ```python
   if 최고체결강도(30) > 200 and 최고체결강도(30, 1) > 200:
   매수 = True
   ```

7. **최저체결강도 (float)**  
   \- 입력한 구간틱수 동안 체결강도의 최저값  
   \- `최저체결강도(30)` : 최근 30틱 체결강도 최저  
   \- `최저체결강도(30, 1)` : 1틱 전 기준 30틱 체결강도 최저
   ```python
   if 최저체결강도(30) < 100 and 최저체결강도(30, 1) < 100:
   매수 = True
   ```

8. **누적초당매수수량 (int)**  
   \- 입력한 구간틱수 동안 초당매수수량의 누적값  
   \- `누적초당매수수량(30)` : 최근 30틱 동안 초당매수수량 누적  
   \- `누적초당매수수량(30, 1)` : 1틱 전 기준 30틱 동안 초당매수수량 누적
   ```python
   if 누적초당매수수량(30) > 100000000 and 누적초당매수수량(30, 1) > 100000000:
   매수 = True
   ```

9. **누적초당매도수량 (int)**  
   \- 입력한 구간틱수 동안 초당매도수량의 누적값  
   \- `누적초당매도수량(30)` : 최근 30틱 동안 초당매도수량 누적  
   \- `누적초당매도수량(30, 1)` : 1틱 전 기준 30틱 동안 초당매도수량 누적
   ```python
   if 누적초당매도수량(30) > 100000000 and 누적초당매도수량(30, 1) > 100000000:
   매수 = True
   ```

10. **최고초당매수수량 (int)**  
    \- 입력한 구간틱수 동안 초당매수수량의 최고값  
    \- `최고초당매수수량(30)` : 최근 30틱 동안 초당매수수량 최고  
    \- `최고초당매수수량(30, 1)` : 1틱 전 기준 30틱 동안 초당매수수량 최고
    ```python
    if 최고초당매수수량(30) > 100000000 and 최고초당매수수량(30, 1) > 100000000:
    매수 = True
    ```

11. **최고초당매도수량 (int)**  
    \- 입력한 구간틱수 동안 초당매도수량의 최고값  
    \- `최고초당매도수량(30)` : 최근 30틱 동안 초당매도수량 최고  
    \- `최고초당매도수량(30, 1)` : 1틱 전 기준 30틱 동안 초당매도수량 최고
    ```python
    if 최고초당매도수량(30) > 100000000 and 최고초당매도수량(30, 1) > 100000000:
    매수 = True
    ```

12. **당일거래대금각도 (float)**  
    \- 입력한 구간틱수 동안의 당일거래대금 차이를 높이로 하고 입력한 틱수를 밑변으로 계산한 각도 (0~90)  
    \- `당일거래대금각도(30)` : 최근 30틱 동안 당일거래대금 차이를 높이로 하고 30틱을 밑변으로 계산한 각도 ('tan' 함수 사용)  
    \- `당일거래대금각도(30, 1)` : 1틱 전 기준 30틱 동안 당일거래대금 차이를 높이로 하고 30틱을 밑변으로 계산한 각도 ('tan' 함수 사용)
    ```python
    if 당일거래대금각도(30) > 10 and 당일거래대금각도(30, 1) > 10:
    매수 = True
    ```

13. **전일비각도 (float)**  
    \- 입력한 구간틱수 동안의 전일비 차이를 높이로 하고 틱수를 밑변으로 계산한 각도 (0~90)  
    \- `전일비각도(30)` : 최근 30틱 동안 전일비 차이를 높이로 하고 30틱을 밑변으로 계산한 각도 ('tan' 함수 사용)  
    \- `전일비각도(30, 1)` : 1틱 전 기준 30틱 동안 전일비 차이를 높이로 하고 30틱을 밑변으로 계산한 각도 ('tan' 함수 사용)
    ```python
    if 전일비각도(30) > 10 and 전일비각도(30, 1) > 10:
    매수 = True
    ```

14. **등락율각도 (float)**  
    \- 입력한 구간틱수 동안의 등락율 차이를 높이로 하고 틱수를 밑변으로 계산한 각도 (-90~90)  
    \- `등락율각도(30)` : 최근 30틱 동안 등락율 차이를 높이로 하고 30틱을 밑변으로 계산한 각도 ('tan' 함수 사용)  
    \- `등락율각도(30, 1)` : 1틱 전 기준 30틱 동안 등락율 차이를 높이로 하고 30틱을 밑변으로 계산한 각도 ('tan' 함수 사용)
    ```python
    if 등락율각도(30) > 10 and 등락율각도(30, 1) > 10:
    매수 = True
    ```

### 2.3 TA-Lib 보조지표

1. **BBU**
2. **BBM**
3. **BBL**
4. **MACD**
5. **MACDS**
6. **MACDH**
7. **APO**
8. **KAMA**
9. **RSI**
10. **HT_SINE**
11. **HT_LSINE**
12. **HT_PHASE**
13. **HT_QUDRA**
14. **OBV**

- 뒤에 `'_N(이전틱수)'` 등을 붙여 과거값 조회 가능  
- 예) `MACD_N(1)` → 1틱 전 MACD 값 
    ```python
    if MACD_N(1) > 100 and RSI_N(1) > 50:
        매수 = True
    ```

### 2.4 기타 변수

1. **VI해제시간 (datetime)**
2. **VI가격 (int)**
3. **VI호가단위 (int)**
4. **VI아래5호가 (int)**
5. **호가단위 (int)**
6. **데이터길이 (int)**  
    \- 1초마다 틱이 쌓이는 누적 수
7. **시분초 (int)**
    \- 서버 시간(예: 93000 → 09:30:00)
8. **종목명 (str)**
9.  **종목코드 (str)**
10. **평균값계산틱수**  
    \- 일반설정에서 장초, 장중 전략별로 설정할 수 있는 평균값 계산에 사용되는 구간의 틱수

#### 사용 예시 (매수 조건 예시)
```python
# 매수 = False로 초기화하고,
# 다음 조건이 만족하면 매수 = True가 실행되도록 예시 작성

# 예) 1) 60틱 이동평균이 3000 이상
#    2) 최근 5틱 체결강도 평균이 100 이상
#    3) 현재가가 최근 30틱 최고체결강도의 90% 미만

if 이동평균(60) > 3000 \
   and 체결강도평균(5) >= 100 \
   and 현재가 < (최고체결강도(30) * 0.9):
    매수 = True
```

## 3. 주식 매도 변수 (stock_sell_var)

이하는 매도 시점에서 사용할 수 있는 변수 목록입니다.

### 3.1 기본 변수 (괄호 없이 사용)

1. 현재가, 시가, 고가, 저가, 등락율, 고저평균대비등락율, 당일거래대금, 체결강도, 거래대금증감, 전일비, 회전율, 전일동시간비, 시가총액  
   \- 설명은 매수 변수와 동일

2. 라운드피겨위5호가이내 (boolean)  
   \- 동일, 5호가 이내면 True

3. 초당매수수량, 초당매도수량, 초당거래대금, 매도총잔량, 매수총잔량  
   \- 동일

4. 매도호가15, 매수호가15  
   \- 동일

5. 매도수5호가잔량합 (int)  
   \- 1 ~5호가 잔량 합

6. 관심종목 (int)  
   \- 1이면 관심

7. 매도(False)  
   \- 기본적으로 False인 상태로 시작해, 조건 만족 시 True를 사용 가능(전략마다 다름)

### 3.2 구간연산 변수 (구간틱수, 이전틱수/-1)

1. 이동평균(float)
2. 최고현재가(int)
3. 최저현재가(int)
4. 초당거래대금평균(float)
5. 체결강도평균(float)
6. 최고체결강도(float)
7. 최저체결강도(float)
8. 누적초당매수수량(int)
9. 누적초당매도수량(int)
10. 최고초당매수수량(int)
11. 최고초당매도수량(int)
12. 당일거래대금각도(float)
13. 전일비각도(float)
14. 등락율각도(float)

(위 변수들은 매수 변수와 동일한 방식·의미)

### 3.3 TA-Lib, 그외 변수

1. BBU
2. BBM
3. BBL
4. MACD
5. MACDS
6. MACDH
7. APO
8. KAMA
9. RSI
10. HT_SINE
11. HT_LSINE
12. HT_PHASE
13. HT_QUDRA
14. OBV
15. VI해제시간(datetime)
16. VI가격(int)
17. VI호가단위(int)
18. VI아래5호가(int)
19. 호가단위(int)
20. 데이터길이(int)
21. 시분초(int)
22. 종목명(str)
23. 종목코드(str)

### 3.4 잔고종목 변수 (보유 상태)

1. 수익률(float), 최고수익률(float), 최저수익률(float)  
   \- 현재 보유 종목의 수익률, 보유 중 최대/최소 수익률
   ```python
   if 수익률 > 5 and 최고수익률 > 10:
       매도 = True
   ```

2. 보유수량(int), 보유시간(int)  
   \- 보유시간은 초(Seconds) 단위
   ```python
   if 보유수량 > 1000 and 보유시간 > 3600:
       매도 = True
   ```

3. 매수틱번호(int)  
   \- 실제로 매수 시점 틱데이터 인덱스를 기록

#### 사용 예시 (매도 조건 예시)
```python
# 보유종목 매도 조건:
# 1) 현재가가 최근 20틱 이동평균보다 3% 이상 하락
# 2) 수익률이 5% 이상에 도달
# 3) 보유시간이 3600초(1시간) 넘으면 자동 매도

# 이 예시는 3개 조건 중 "어느 하나라도" 만족하면 매도 실행

if (현재가 < 이동평균(20) * 0.97) \
   or (수익률 >= 5) \
   or (보유시간 > 3600):
    매도 = True
```

## 4. 변수 사용 시 주의사항

1. 이전값 조회  
   \- 기본형: 변수명N(1), 변수명N(2) (1틱 전, 2틱 전 등)  
   \- 구간연산: 변수명(구간, [이전틱수])  
   \- 특별한 인덱스 조회: -1 (매수틱번호가 있는 매수 시점의 데이터)

2. 구간틱수  
   \- 평균값계산틱수는 장초, 장중 전략별로 설정된 범위 내에서만 유효

3. 직접 사용 vs 함수 형태  
   \- 직접 사용: 현재가, 시가 등은 괄호 없이 사용  
   \- 함수 형태: 이동평균(60), 최고현재가(30)처럼 괄호에 파라미터를 넣어 구간연산

4. 수치 단위  
   \- 거래대금, 수량, 가격 단위는 각 환경에 맞추어 확인 필요 (백만원 vs 원, 주 vs 수량 등)


## 5. 매수 전략 (Updated)
> **조건식이 많아 가독성을 위해 `if ~ elif ~ else` 구조 내에서 각 조건을 순서대로 배치했습니다.  
> "한 조건이라도 미충족 시 `매수 = False`" 패턴 그대로 유지하였습니다.**

```python
# 제5회 STOMING DAY STRATEGY - 매수전략 (업데이트 버전)

if not (시분초 < 92500):
    매수 = False

elif not (현재가 < VI아래5호가):
    매수 = False

elif not (초당거래대금 > 초당거래대금N(1)):
    매수 = False

elif 시가총액 < 1500:
    if not (초당매수수량 > 매도총잔량 * 50 / 100):
        매수 = False
    elif not (초당매도수량 < 매수총잔량 * 30 / 100):
        매수 = False
    elif not (1 < 매도총잔량 * 현재가 / 100_000_000 < 6):
        매수 = False
    elif not (0 < 매수총잔량 * 현재가 / 100_000_000 < 7):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * 2):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 3):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 8 / 100):
        매수 = False
    elif not ((현재가 / 저가 - 1) * 100 <= 11):
        매수 = False
    elif not (당일거래대금 > 0 * 100):
        매수 = False
    elif not (등락율각도(30) > 4):
        매수 = False
    elif not (전일비각도(30) < 70):
        매수 = False
    elif not (전일동시간비 > 100):
        매수 = False
    elif not (최고초당매수수량(30) * 3 > 최고초당매도수량(30)):
        매수 = False
    elif not (10 > 초당거래대금 / 초당거래대금평균(30)):
        매수 = False
    elif not (1000 > 초당거래대금 - 초당거래대금평균(30)):
        매수 = False
    elif not (3 > 초당거래대금평균(30) / (당일거래대금 / 데이터길이)):
        매수 = False
    elif not ((초당매수수량 - 초당매도수량) * 현재가 / 1_000_000 > 50):
        매수 = False

elif 시가총액 < 2500:
    if not (초당매수수량 > 매도총잔량 * 30 / 100):
        매수 = False
    elif not (초당매도수량 < 매수총잔량 * 20 / 100):
        매수 = False
    elif not (1 < 매도총잔량 * 현재가 / 100_000_000 < 10):
        매수 = False
    elif not (1 < 매수총잔량 * 현재가 / 100_000_000 < 30):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * 4):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 2):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 32 / 100):
        매수 = False
    elif not ((현재가 / 저가 - 1) * 100 <= 12):
        매수 = False
    elif not (당일거래대금 > 20 * 100):
        매수 = False
    elif not (등락율각도(30) > 9):
        매수 = False
    elif not (전일비각도(30) < 20):
        매수 = False
    elif not (전일동시간비 > 40):
        매수 = False
    elif not (최고초당매수수량(30) * 3 > 최고초당매도수량(30)):
        매수 = False
    elif not (10 > 초당거래대금 / 초당거래대금평균(30)):
        매수 = False
    elif not (500 > 초당거래대금 - 초당거래대금평균(30)):
        매수 = False
    elif not (6 > 초당거래대금평균(30) / (당일거래대금 / 데이터길이)):
        매수 = False
    elif not ((초당매수수량 - 초당매도수량) * 현재가 / 1_000_000 > 100):
        매수 = False

else:
    if not (초당매수수량 > 매도총잔량 * 80 / 100):
        매수 = False
    elif not (초당매도수량 < 매수총잔량 * 50 / 100):
        매수 = False
    elif not (1 < 매도총잔량 * 현재가 / 100_000_000 < 30):
        매수 = False
    elif not (2 < 매수총잔량 * 현재가 / 100_000_000 < 20):
        매수 = False
    elif not (매도총잔량 < 매수총잔량 * 3):
        매수 = False
    elif not (매수총잔량 < 매도총잔량 * 7):
        매수 = False
    elif not (현재가 > 고가 - (고가 - 저가) * 49 / 100):
        매수 = False
    elif not ((현재가 / 저가 - 1) * 100 <= 12):
        매수 = False
    elif not (등락율각도(30) > 13):
        매수 = False
    elif not (전일비각도(30) < 40):
        매수 = False
    elif not (전일동시간비 > 50):
        매수 = False
    elif not (최고초당매수수량(30) * 1 > 최고초당매도수량(30)):
        매수 = False
    elif not (10 > 초당거래대금 / 초당거래대금평균(30)):
        매수 = False
    elif not (900 > 초당거래대금 - 초당거래대금평균(30)):
        매수 = False
    elif not (10 > 초당거래대금평균(30) / (당일거래대금 / 데이터길이)):
        매수 = False
    elif not ((초당매수수량 - 초당매도수량) * 현재가 / 1_000_000 > 70):
        매수 = False
```

## 6. 매도 전략 (Updated)

> 매도 로직에서 일부 주석 처리된 구간(상승/횡보/하락 패턴)은 "이평이탈", "하락폭등" 등 다양한 추가 로직(예: 이동평균(30) 비교)을 삽입할 수 있음을 시사합니다.

```python
# 제5회 STOMING DAY STRATEGY - 매도전략 (업데이트 버전)

if 등락율 > 29.5:
    매도 = True

elif 시가총액 < 1500:
    if 20 <= 등락율각도(30) and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 30/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -50:
        매도 = True
    elif 10 <= 등락율각도(30) < 20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 90/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -75:
        매도 = True
    elif 0 <= 등락율각도(30) < 10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 30/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -25:
        매도 = True
    elif -10 <= 등락율각도(30) < 0 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 10/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -100:
        매도 = True
    elif -20 <= 등락율각도(30) < -10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 100/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -75:
        매도 = True
    elif 등락율각도(30) < -20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 100/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -100:
        매도 = True

    elif 고가 - (고가 - 저가) * 20/100 < 현재가:
        pass
    elif 고가 - (고가 - 저가) * 50/100 < 현재가 <= 고가 - (고가 - 저가) * 20/100:
        pass
    else:
        pass

elif 시가총액 < 2500:
    if 20 <= 등락율각도(30) and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 100/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -100:
        매도 = True
    elif 10 <= 등락율각도(30) < 20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 40/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -25:
        매도 = True
    elif 0 <= 등락율각도(30) < 10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 40/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -50:
        매도 = True
    elif -10 <= 등락율각도(30) < 0 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 10/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -25:
        매도 = True
    elif -20 <= 등락율각도(30) < -10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 60/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -25:
        매도 = True
    elif 등락율각도(30) < -20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 100/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -100:
        매도 = True

    elif 고가 - (고가 - 저가) * 20/100 < 현재가:
        pass
    elif 고가 - (고가 - 저가) * 50/100 < 현재가 <= 고가 - (고가 - 저가) * 20/100:
        pass
    else:
        pass

else:
    if 20 <= 등락율각도(30) and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 80/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -100:
        매도 = True
    elif 10 <= 등락율각도(30) < 20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 10/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -75:
        매도 = True
    elif 0 <= 등락율각도(30) < 10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 70/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -75:
        매도 = True
    elif -10 <= 등락율각도(30) < 0 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 80/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -25:
        매도 = True
    elif -20 <= 등락율각도(30) < -10 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 50/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -100:
        매도 = True
    elif 등락율각도(30) < -20 and (초당매도수량 - 초당매수수량) >= 매수총잔량 * 50/100 and (현재가 / 현재가N(1) - 1) * 10000 <= -25:
        매도 = True

    elif 고가 - (고가 - 저가) * 20/100 < 현재가:
        pass
    elif 고가 - (고가 - 저가) * 50/100 < 현재가 <= 고가 - (고가 - 저가) * 20/100:
        pass
    else:
        pass
```

## 7. 추가 전략 예시 (Updated)

> 전략 세분화: 횡보/돌파/눌림/돌림 등 업데이트된 변수와 구간연산 함수를 반영해 예시 작성

### 7-1. 횡보전략
- 최고체결강도(30) - 최저체결강도(30)이 10 미만이면, 변동폭이 작아 "횡보"로 간주

```python
if not (최고체결강도(30) - 최저체결강도(30) < 10):
    매수 = False
```

### 7-2. 돌파전략
- 변동폭이 작지 않고, 일정데이터(60틱) 이후 체결강도평균(30)이 과거(30틱 전) 체결강도평균(30)보다 큰지 확인 → 상승 돌파

```python
if 최고체결강도(30) - 최저체결강도(30) < 10:
    매수 = False
elif not (데이터길이 > 60 and 체결강도평균(30) > 체결강도평균(30, 30)):
    매수 = False
```

### 7-3. 눌림전략
- 위 돌파와 반대로 "체결강도평균이 과거보다 컸으나", 지금 살짝 눌린 상태라면?

```python
if 최고체결강도(30) - 최저체결강도(30) < 10:
    매수 = False
elif 데이터길이 > 60 and 체결강도평균(30) > 체결강도평균(30, 30):
    매수 = False
```

### 7-4. 돌림전략
- 눌림 후 다시 올라가는 "V자 반등" 형태를 검증할 수도 있음

```python
if 최고체결강도(30) - 최저체결강도(30) < 10:
    매수 = False
```

> 각 예시 코드는 전략의 아이디어일 뿐, 실제론 다양한 변수(이동평균, 전일동시간비, 체결강도각도 등)를 조합하여 구체화해야 합니다.



## 8. 문서 활용 팁

1. **변수의 종류 및 사용법**:  
   - **기본 변수**: 현재가, 시가, 고가, 저가 등은 괄호 없이 사용하며, 이전 틱 조회 시 `변수명N(1)` 형식으로 접근합니다.
   - **구간 연산 변수**: 이동평균, 최고현재가 등은 `(구간틱수, [이전값])` 형태로 사용합니다.
   - **TA-Lib 보조지표**: BBU, MACD 등은 `_N(이전틱수)`를 붙여 과거값을 조회할 수 있습니다.
   - **기타 변수**: VI해제시간, 종목명 등 다양한 변수들이 있으며, 각 변수의 사용법에 맞게 활용해야 합니다.

2. **조건식 디버깅**:  
   본 예시처럼 조건을 단계별로 if ~ elif ~ else로 분리하면, 어느 조건에서 매수 = False가 되었는지 로그 추적이 용이합니다.

3. **변수 업데이트**:  
   "등락율각도(30)", "체결강도평균(30, 30)", "초당거래대금N(1)" 등 함수형 또는 N(틱수) 형식으로 업데이트된 표기를 사용함으로써, 이후 코드 확장이나 최적화 작업이 편리해집니다.

4. **전략 세분화 및 최적화**:  
   - 매수/매도 전략을 세분화하여 다양한 시장 상황에 맞게 대응할 수 있도록 설계합니다.
   - 각 전략의 조건을 과거 데이터 분석을 통해 최적화하여, 백테스트 결과를 개선할 수 있습니다.

5. **백테스트 결과 개선**:  
   전략별로 시총 구간을 세분화(1500억, 2500억...)한 예시는, 종목 특성에 따른 조건을 명확히 분기한 사례입니다. 각 조건의 임계값(30%, 20% 등)은 과거 데이터 분석을 통해 최적화 가능.

6. **문서의 일관성 유지**:  
   - 문서 내 변수 및 함수 표기법을 일관되게 유지하여, 코드 확장 및 유지보수가 용이하도록 합니다.
   - 새로운 전략이나 변수를 추가할 때, 기존 형식에 맞춰 문서를 업데이트합니다.

7. **실시간 데이터 활용**:  
   - 실시간으로 수신되는 틱 데이터를 활용하여, 전략의 유효성을 지속적으로 검증하고 조정합니다.
   - 초당 단위로 집계되는 변수는 변동성이 큰 종목일수록 더 세밀한 로직 설계가 필요합니다.

8. **GPT에게 질문 시**:  
   "위 마크다운의 '매수전략' 부분에서 시총 < 1500 조건을 수정하고 싶다" 등 구체적으로 질문하면 더욱 정확한 답변을 얻을 수 있습니다.

이러한 팁을 통해 문서를 효과적으로 활용하고, 전략을 최적화하여 더 나은 투자 성과를 달성할 수 있습니다.

## 9. 출처

이 문서의 일부 내용은 `ui/set_text.py` 파일에서 참조되었습니다. 해당 파일의 코드는 매수 및 매도 전략의 예시와 변수 사용 방법에 대한 정보를 제공합니다. 자세한 내용은 `ui/set_text.py` 파일을 참조하십시오.

---

**Last Update: 2025-01-01**