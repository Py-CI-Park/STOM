# 분봉 백테스팅 가이드라인 (Minute Backtesting Guideline)

---

> **참고**: 이 문서는 분봉(1분봉) 데이터를 활용한 백테스팅 전략 작성을 위한 변수 사용법과 예제를 제공합니다. 틱 데이터 백테스팅과의 차이점을 중심으로 설명하며, 분봉 차트 분석에 적합한 전략 수립을 지원합니다.

---

## 1. 분봉 데이터 개요

분봉 데이터는 1분 단위로 집계된 캔들스틱 데이터로, 다음과 같은 특징을 가집니다:

- **시간 단위**: 1분 간격으로 데이터 집계
- **봉 구성**: 분봉시가, 분봉고가, 분봉저가, 현재가(종가)
- **거래 정보**: 분당거래대금, 분당매수/매도수량
- **보조지표**: 다양한 기술적 지표 (MACD, RSI, BBand 등)

### 틱 데이터와의 주요 차이점

| 구분 | 틱 데이터 | 분봉 데이터 |
|------|-----------|-------------|
| 시간 단위 | 초(초당) | 분(분당) |
| 데이터 갱신 | 실시간 틱 | 1분마다 |
| 봉 정보 | 일봉만 | 일봉 + 분봉 |
| 보조지표 | 제한적 | 풍부한 TA-Lib 지표 |
| 시간 표기 | 시분초 | 시분초 |

---

## 2. 주식 매수 변수 (stock_buy_var2)

### 2.1 기본 변수 (괄호 없이 사용)

1. **현재가 (int)**  
   \- 분봉의 종가  
   \- `현재가` : 현재 분봉 종가  
   \- `현재가N(1)` : 1분봉 전의 종가  
   ```python
   if 현재가 > 5000 and 현재가 > 현재가N(1):
       매수 = True
   ```

2. **시가, 고가, 저가 (int)**  
   \- 일봉상의 시가, 고가, 저가  
   \- `시가`, `고가`, `저가` : 현재 일봉 기준  
   \- `시가N(1)` : 1분봉 전 기준 일봉 시가  
   ```python
   if 현재가 > 고가 * 0.95 and 현재가 > 저가 * 1.05:
       매수 = True
   ```

3. **분봉시가, 분봉고가, 분봉저가 (int)**  
   \- 분봉상의 시가, 고가, 저가  
   \- `분봉시가` : 현재 분봉의 시가  
   \- `분봉고가N(1)` : 1분봉 전의 고가  
   ```python
   if 현재가 > 분봉시가 and 분봉고가 > 분봉고가N(1):
       매수 = True
   ```

4. **등락율 (float)**  
   \- 일봉상 전일종가 대비 등락율  
   \- `등락율` : 현재 등락율  
   \- `등락율N(1)` : 1분봉 전의 등락율  
   ```python
   if 등락율 > 2.0 and 등락율 > 등락율N(1):
       매수 = True
   ```

5. **고저평균대비등락율 (float)**  
   \- 당일 고가와 저가의 평균 대비 현재가의 등락율  
   \- `고저평균대비등락율` : 현재 고저평균대비등락율  
   \- `고저평균대비등락율N(1)` : 1분봉 전의 고저평균대비등락율  
   ```python
   if 고저평균대비등락율 > 1.0 and 고저평균대비등락율 > 고저평균대비등락율N(1):
       매수 = True
   ```

6. **당일거래대금 (int)**  
   \- 당일 누적 거래대금 (단위: 백만원)  
   \- `당일거래대금` : 현재 당일거래대금  
   \- `당일거래대금N(1)` : 1분봉 전의 당일거래대금  
   ```python
   if 당일거래대금 > 1000 and 당일거래대금 > 당일거래대금N(1):
       매수 = True
   ```

7. **체결강도 (float)**  
   \- 매도수량 대비 매수수량의 비율 (0~500)  
   \- `체결강도` : 현재 체결강도  
   \- `체결강도N(1)` : 1분봉 전의 체결강도  
   ```python
   if 체결강도 > 120 and 체결강도 > 체결강도N(1):
       매수 = True
   ```

8. **거래대금증감 (int)**  
   \- 전일거래대금 대비 증가분  
   \- `거래대금증감` : 현재 거래대금증감  
   \- `거래대금증감N(1)` : 1분봉 전의 거래대금증감  
   ```python
   if 거래대금증감 > 0 and 거래대금증감 > 거래대금증감N(1):
       매수 = True
   ```

9. **전일비 (float)**  
   \- 전일거래량 대비 당일거래량의 비율  
   \- `전일비` : 현재 전일비  
   \- `전일비N(1)` : 1분봉 전의 전일비  
   ```python
   if 전일비 > 150 and 전일비 > 전일비N(1):
       매수 = True
   ```

10. **회전율 (float)**  
    \- 상장주식수 대비 당일거래량의 비율  
    \- `회전율` : 현재 회전율  
    \- `회전율N(1)` : 1분봉 전의 회전율  
    ```python
    if 회전율 > 5.0 and 회전율 > 회전율N(1):
        매수 = True
    ```

11. **전일동시간비 (float)**  
    \- 전일 동시간대 거래량 대비 당일거래량의 비율  
    \- `전일동시간비` : 현재 전일동시간비  
    \- `전일동시간비N(1)` : 1분봉 전의 전일동시간비  
    ```python
    if 전일동시간비 > 200 and 전일동시간비 > 전일동시간비N(1):
        매수 = True
    ```

12. **시가총액 (int)**  
    \- 시가총액 (단위: 억원)  
    \- `시가총액` : 현재 시가총액  
    \- `시가총액N(1)` : 1분봉 전의 시가총액  
    ```python
    if 시가총액 > 1000 and 시가총액 < 10000:
        매수 = True
    ```

13. **라운드피겨위5호가이내 (boolean)**  
    \- 라운드피겨 가격 위 5호가 이내에 현재가가 위치하는지 여부  
    \- `라운드피겨위5호가이내` : 현재 라운드피겨위5호가이내  
    \- `라운드피겨위5호가이내N(1)` : 1분봉 전의 라운드피겨위5호가이내  
    ```python
    if 라운드피겨위5호가이내 and not 라운드피겨위5호가이내N(1):
        매수 = True
    ```

14. **분당매수수량, 분당매도수량 (int)**  
    \- 1분 동안의 매수/매도 수량  
    \- `분당매수수량` : 현재 분당매수수량  
    \- `분당매수수량N(1)` : 1분봉 전의 분당매수수량  
    ```python
    if 분당매수수량 > 100000 and 분당매수수량 > 분당매도수량:
        매수 = True
    ```

15. **분당거래대금 (int)**  
    \- 1분 동안의 거래대금 (단위: 백만원)  
    \- `분당거래대금` : 현재 분당거래대금  
    \- `분당거래대금N(1)` : 1분봉 전의 분당거래대금  
    ```python
    if 분당거래대금 > 100 and 분당거래대금 > 분당거래대금N(1):
        매수 = True
    ```

16. **매도총잔량, 매수총잔량 (int)**  
    \- 매도/매수 총 잔량  
    \- `매도총잔량` : 현재 매도총잔량  
    \- `매수총잔량N(1)` : 1분봉 전의 매수총잔량  
    ```python
    if 매수총잔량 > 매도총잔량 and 매수총잔량 > 매수총잔량N(1):
        매수 = True
    ```

17. **매도호가1~5, 매도잔량1~5 (int)**  
    \- 매도 1~5호가 가격 및 잔량  
    \- `매도호가1` : 현재 매도호가1  
    \- `매도호가1N(1)` : 1분봉 전의 매도호가1  
    ```python
    if 매도호가1 > 5000 and 매도잔량1 < 100000:
        매수 = True
    ```

18. **매수호가1~5, 매수잔량1~5 (int)**  
    \- 매수 1~5호가 가격 및 잔량  
    \- `매수호가1` : 현재 매수호가1  
    \- `매수호가1N(1)` : 1분봉 전의 매수호가1  
    ```python
    if 매수호가1 < 4900 and 매수잔량1 > 100000:
        매수 = True
    ```

19. **매도수5호가잔량합 (int)**  
    \- 매도 1~5호가 잔량 합  
    \- `매도수5호가잔량합` : 현재 매도수5호가잔량합  
    \- `매도수5호가잔량합N(1)` : 1분봉 전의 매도수5호가잔량합  
    ```python
    if 매도수5호가잔량합 < 1000000 and 매도수5호가잔량합 < 매도수5호가잔량합N(1):
        매수 = True
    ```

20. **관심종목 (int)**  
    \- 거래대금순위 내에 있으면 1, 아니면 0  
    \- `관심종목` : 현재 관심종목  
    \- `관심종목N(1)` : 1분봉 전의 관심종목  
    ```python
    if 관심종목 == 1 and 관심종목N(1) == 0:
        매수 = True
    ```

21. **매수 (True)**  
    \- 기본적으로 True 상태인 변수 (전략 상단에서 매수 = False로 시작)

### 2.2 구간 연산 변수 (괄호 안에 구간봉수, 이전봉수)

1. **이동평균 (float)**  
   \- 1분마다 기록된 현재가의 단순평균  
   \- `이동평균(60)` : 60분봉 이동평균  
   \- `이동평균(60, 1)` : 1분봉 전 기준 60분봉 이동평균  
   ```python
   if 이동평균(60) > 3000 and 이동평균(60, 1) > 3000:
       매수 = True
   ```

2. **최고현재가, 최저현재가 (int)**  
   \- 입력한 구간봉수 동안의 최고/최저 현재가  
   \- `최고현재가(30)` : 최근 30분봉 최고가  
   \- `최저현재가(30, 1)` : 1분봉 전 기준 30분봉 최저가  
   ```python
   if 최고현재가(30) > 30000 and 최저현재가(30) < 20000:
       매수 = True
   ```

3. **최고분봉고가, 최저분봉저가 (int)**  
   \- 입력한 구간봉수 동안의 분봉 고가/저가 극값  
   \- `최고분봉고가(30)` : 최근 30분봉 중 분봉고가 최고값  
   \- `최저분봉저가(30, 1)` : 1분봉 전 기준 30분봉 중 분봉저가 최저값  
   ```python
   if 최고분봉고가(30) > 현재가 * 1.1 and 최저분봉저가(30) < 현재가 * 0.9:
       매수 = True
   ```

4. **분당거래대금평균 (float)**  
   \- 입력 구간봉수 동안 분당거래대금의 평균  
   \- `분당거래대금평균(60)` : 최근 60분봉 동안의 분당거래대금 평균  
   \- `분당거래대금평균(60, 1)` : 1분봉 전 기준 60분봉 동안의 분당거래대금 평균  
   ```python
   if 분당거래대금평균(60) > 100 and 분당거래대금평균(60, 1) > 100:
       매수 = True
   ```

5. **체결강도평균 (float)**  
   \- 입력한 구간봉수 동안 체결강도의 평균값  
   \- `체결강도평균(30)` : 최근 30분봉 체결강도 평균  
   \- `체결강도평균(30, 1)` : 1분봉 전 기준 30분봉 체결강도 평균  
   ```python
   if 체결강도평균(30) > 120 and 체결강도평균(30, 1) > 120:
       매수 = True
   ```

6. **최고체결강도, 최저체결강도 (float)**  
   \- 입력한 구간봉수 동안 체결강도의 최고/최저값  
   \- `최고체결강도(30)` : 최근 30분봉 체결강도 최고  
   \- `최저체결강도(30, 1)` : 1분봉 전 기준 30분봉 체결강도 최저  
   ```python
   if 최고체결강도(30) > 200 and 최저체결강도(30) > 80:
       매수 = True
   ```

7. **누적분당매수수량, 누적분당매도수량 (int)**  
   \- 입력한 구간봉수 동안 분당매수/매도수량의 누적값  
   \- `누적분당매수수량(30)` : 최근 30분봉 동안 분당매수수량 누적  
   \- `누적분당매도수량(30, 1)` : 1분봉 전 기준 30분봉 동안 분당매도수량 누적  
   ```python
   if 누적분당매수수량(30) > 1000000 and 누적분당매수수량(30) > 누적분당매도수량(30):
       매수 = True
   ```

8. **최고분당매수수량, 최고분당매도수량 (int)**  
   \- 입력한 구간봉수 동안 분당매수/매도수량의 최고값  
   \- `최고분당매수수량(30)` : 최근 30분봉 동안 분당매수수량 최고  
   \- `최고분당매도수량(30, 1)` : 1분봉 전 기준 30분봉 동안 분당매도수량 최고  
   ```python
   if 최고분당매수수량(30) > 100000 and 최고분당매수수량(30) > 최고분당매도수량(30):
       매수 = True
   ```

9. **당일거래대금각도 (float)**  
   \- 입력한 구간봉수 동안의 당일거래대금 차이를 높이로 하고 입력한 봉수를 밑변으로 계산한 각도 (0~90)  
   \- `당일거래대금각도(30)` : 최근 30분봉 동안 당일거래대금 차이를 높이로 하고 30분봉을 밑변으로 계산한 각도  
   \- `당일거래대금각도(30, 1)` : 1분봉 전 기준 30분봉 동안 당일거래대금 각도  
   ```python
   if 당일거래대금각도(30) > 10 and 당일거래대금각도(30, 1) > 10:
       매수 = True
   ```

10. **전일비각도 (float)**  
    \- 입력한 구간봉수 동안의 전일비 차이를 높이로 하고 봉수를 밑변으로 계산한 각도 (0~90)  
    \- `전일비각도(30)` : 최근 30분봉 동안 전일비 각도  
    \- `전일비각도(30, 1)` : 1분봉 전 기준 30분봉 동안 전일비 각도  
    ```python
    if 전일비각도(30) > 10 and 전일비각도(30, 1) > 10:
        매수 = True
    ```

11. **등락율각도 (float)**  
    \- 입력한 구간봉수 동안의 등락율 차이를 높이로 하고 봉수를 밑변으로 계산한 각도 (-90~90)  
    \- `등락율각도(30)` : 최근 30분봉 동안 등락율 각도  
    \- `등락율각도(30, 1)` : 1분봉 전 기준 30분봉 동안 등락율 각도  
    ```python
    if 등락율각도(30) > 10 and 등락율각도(30, 1) > 10:
        매수 = True
    ```

### 2.3 TA-Lib 보조지표

분봉 데이터에서는 다양한 기술적 지표를 활용할 수 있습니다.

1. **AD (Accumulation/Distribution Line)**  
2. **ADOSC (Accumulation/Distribution Oscillator)**  
3. **ADXR (Average Directional Movement Index Rating)**  
4. **APO (Absolute Price Oscillator)**  
5. **AROOND, AROONU (Aroon Down/Up)**  
6. **ATR (Average True Range)**  
7. **BBU, BBM, BBL (Bollinger Bands Upper/Middle/Lower)**  
8. **CCI (Commodity Channel Index)**  
9. **DIM, DIP (Directional Indicator Minus/Plus)**  
10. **MACD, MACDS, MACDH (MACD Line/Signal/Histogram)**  
11. **MFI (Money Flow Index)**  
12. **MOM (Momentum)**  
13. **OBV (On Balance Volume)**  
14. **PPO (Percentage Price Oscillator)**  
15. **ROC (Rate of Change)**  
16. **RSI (Relative Strength Index)**  
17. **SAR (Parabolic SAR)**  
18. **STOCHSK, STOCHSD (Stochastic %K/%D Slow)**  
19. **STOCHFK, STOCHFD (Stochastic %K/%D Fast)**  
20. **WILLR (Williams %R)**

- 뒤에 `'_N(이전봉수)'`을 붙여 과거값 조회 가능  
- 예) `MACD_N(1)` → 1분봉 전 MACD 값  
    ```python
    if MACD > 0 and MACD_N(1) <= 0 and RSI > 50 and 현재가 < BBU:
        매수 = True
    ```

### 2.4 기타 변수

1. **VI해제시간 (datetime)**  
2. **VI가격 (int)**  
3. **VI호가단위 (int)**  
4. **VI아래5호가 (int)**  
5. **호가단위 (int)**  
6. **데이터길이 (int)**  
   \- 1분에 한번 기록된 봉수의 누적합  
7. **시분초 (int)**  
   \- 서버 시간 (예: 93000 → 09:30:00)  
8. **종목명 (str)**  
9. **종목코드 (str)**  
10. **평균값계산틱수**  
    \- 일반설정에서 장초, 장중 전략별로 설정할 수 있는 평균값 계산에 사용되는 구간의 봉수

#### 사용 예시 (매수 조건 예시)
```python
# 매수 = False로 초기화하고,
# 다음 조건이 만족하면 매수 = True가 실행되도록 예시 작성

# 예) 1) 60분봉 이동평균이 3000 이상
#    2) 최근 5분봉 체결강도 평균이 120 이상
#    3) RSI가 30 이하에서 50 이상으로 반전
#    4) 분당거래대금이 평균보다 2배 이상

if 이동평균(60) > 3000 \
   and 체결강도평균(5) >= 120 \
   and RSI_N(1) <= 30 and RSI > 50 \
   and 분당거래대금 > 분당거래대금평균(20) * 2:
    매수 = True
```

---

## 3. 주식 매도 변수 (stock_sell_var2)

매도 시점에서 사용할 수 있는 변수 목록입니다.

### 3.1 기본 변수 (괄호 없이 사용)

1. **현재가, 시가, 고가, 저가, 등락율, 고저평균대비등락율, 당일거래대금, 체결강도, 거래대금증감, 전일비, 회전율, 전일동시간비, 시가총액**  
   \- 설명은 매수 변수와 동일

2. **분봉시가, 분봉고가, 분봉저가**  
   \- 분봉상의 시고저가

3. **라운드피겨위5호가이내 (boolean)**  
   \- 동일, 5호가 이내면 True

4. **분당매수수량, 분당매도수량, 분당거래대금, 매도총잔량, 매수총잔량**  
   \- 동일

5. **매도호가1~5, 매수호가1~5**  
   \- 동일

6. **매도수5호가잔량합 (int)**  
   \- 1~5호가 잔량 합

7. **관심종목 (int)**  
   \- 1이면 관심

8. **매도 (False)**  
   \- 기본적으로 False인 상태로 시작해, 조건 만족 시 True를 사용 가능

### 3.2 구간연산 변수 (구간봉수, 이전봉수/-1)

1. **이동평균(float)**
2. **최고현재가(int)**
3. **최저현재가(int)**
4. **최고분봉고가(int)**
5. **최저분봉저가(int)**
6. **분당거래대금평균(float)**
7. **체결강도평균(float)**
8. **최고체결강도(float)**
9. **최저체결강도(float)**
10. **누적분당매수수량(int)**
11. **누적분당매도수량(int)**
12. **최고분당매수수량(int)**
13. **최고분당매도수량(int)**
14. **당일거래대금각도(float)**
15. **전일비각도(float)**
16. **등락율각도(float)**

(위 변수들은 매수 변수와 동일한 방식·의미)

### 3.3 TA-Lib 보조지표

1. **AD, ADOSC, ADXR, APO, AROOND, AROONU, ATR**
2. **BBU, BBM, BBL**
3. **CCI, DIM, DIP**
4. **MACD, MACDS, MACDH**
5. **MFI, MOM, OBV, PPO, ROC**
6. **RSI, SAR**
7. **STOCHSK, STOCHSD, STOCHFK, STOCHFD**
8. **WILLR**

### 3.4 기타 변수

1. **VI해제시간(datetime)**
2. **VI가격(int)**
3. **VI호가단위(int)**
4. **VI아래5호가(int)**
5. **호가단위(int)**
6. **데이터길이(int)**
7. **시분초(int)**
8. **종목명(str)**
9. **종목코드(str)**

### 3.5 잔고종목 변수 (보유 상태)

1. **수익률(float), 최고수익률(float), 최저수익률(float)**  
   \- 현재 보유 종목의 수익률, 보유 중 최대/최소 수익률
   ```python
   if 수익률 > 5 and 최고수익률 > 10:
       매도 = True
   ```

2. **보유수량(int), 보유시간(int)**  
   \- 보유시간은 분(Minutes) 단위
   ```python
   if 보유수량 > 1000 and 보유시간 > 60:
       매도 = True
   ```

3. **매수틱번호(int)**  
   \- 실제로 매수 시점 분봉데이터 인덱스를 기록

#### 사용 예시 (매도 조건 예시)
```python
# 보유종목 매도 조건:
# 1) RSI가 70 이상 과매수 구간
# 2) 수익률이 3% 이상에 도달
# 3) 보유시간이 60분 넘으면 자동 매도
# 4) 볼린저밴드 상단 돌파 후 하락 신호
# 5) 현재가가 매수시점 대비 이동평균선 아래로 하락

# 이 예시는 5개 조건 중 "어느 하나라도" 만족하면 매도 실행

if (RSI > 70) \
   or (수익률 >= 3) \
   or (보유시간 > 60) \
   or (현재가 > BBU_N(1) and 현재가 < BBU) \
   or (현재가 < 이동평균(20) and 현재가N(-1) >= 이동평균(20, -1)):
    매도 = True
```

---

## 4. 변수 사용 시 주의사항

1. **이전값 조회**  
   \- 기본형: 변수명N(1), 변수명N(2) (1분봉 전, 2분봉 전 등)  
   \- 구간연산: 변수명(구간, [이전봉수])  
   \- 특별한 인덱스 조회 (매도 조건식에서만): -1 (모든 변수의 매수시점 정보를 조회)

2. **구간봉수**  
   \- 평균값계산틱수는 장초, 장중 전략별로 설정된 범위 내에서만 유효

3. **직접 사용 vs 함수 형태**  
   \- 직접 사용: 현재가, 시가 등은 괄호 없이 사용  
   \- 함수 형태: 이동평균(60), 최고현재가(30)처럼 괄호에 파라미터를 넣어 구간연산

4. **수치 단위**  
   \- 거래대금, 수량, 가격 단위는 각 환경에 맞추어 확인 필요

5. **분봉 특수 변수**  
   \- 분봉시가, 분봉고가, 분봉저가는 분봉 차트에서만 사용 가능
   \- 시분초 변수는 HHMMSS 형태 (예: 93000, 153000)

---

## 5. 분봉 전략 예시

### 5.1 분봉 돌파전략
```python
# 분봉 돌파전략 - 20분봉 최고가 돌파 시 매수
if not (시분초 >= 93000 and 시분초 <= 150000):
    매수 = False
elif not (현재가 > 최고분봉고가(20, 1)):
    매수 = False
elif not (분당거래대금 > 분당거래대금평균(60)):
    매수 = False
elif not (RSI > 50 and RSI_N(1) <= 50):
    매수 = False
elif not (MACD > MACDS and MACD_N(1) <= MACDS_N(1)):
    매수 = False
```

### 5.2 볼린저밴드 반전전략
```python
# 볼린저밴드 하단 터치 후 반등 매수
if not (현재가_N(1) <= BBL_N(1)):
    매수 = False
elif not (현재가 > BBL):
    매수 = False
elif not (RSI_N(1) < 30 and RSI > 35):
    매수 = False
elif not (체결강도 > 130):
    매수 = False
elif not (분당매수수량 > 분당매도수량 * 1.5):
    매수 = False
```

### 5.3 이동평균선 정배열 전략
```python
# 단기, 중기, 장기 이동평균선 정배열 + 골든크로스
if not (이동평균(5) > 이동평균(20) > 이동평균(60)):
    매수 = False
elif not (이동평균(5) > 이동평균(5, 1)):
    매수 = False
elif not (이동평균(20) > 이동평균(20, 1)):
    매수 = False
elif not (현재가 > 이동평균(5)):
    매수 = False
elif not (분당거래대금 > 100):
    매수 = False
```

### 5.4 분봉 매도전략
```python
# 분봉 매도전략 - 다중 조건 체크
if RSI > 80:
    매도 = True
elif 수익률 > 5:
    매도 = True
elif 보유시간 > 120:  # 2시간 이상 보유 시 매도
    매도 = True
elif 현재가 < 이동평균(20) and 이동평균(20) < 이동평균(20, 1):
    매도 = True
elif 현재가 < BBM and 현재가_N(1) >= BBM_N(1):
    매도 = True
elif MACD < MACDS and MACD_N(1) >= MACDS_N(1):
    매도 = True
```

---

## 6. 분봉 vs 틱 데이터 전략 차이점

### 6.1 시간 관점

**틱 데이터**:
- 실시간 변화 감지
- 초단위 빠른 진입/청산
- 스캘핑에 적합

**분봉 데이터**:
- 노이즈 필터링
- 트렌드 추종에 적합
- 중단기 전략에 유리

### 6.2 지표 활용

**틱 데이터**:
- 체결강도, 거래량 중심
- 호가창 정보 활용
- 즉시성 중시

**분봉 데이터**:
- 기술적 지표 풍부
- 캔들패턴 분석 가능
- 보조지표 조합 전략

### 6.3 전략 설계

**틱 데이터 전략**:
```python
# 빠른 진입/청산
if 초당거래대금 > 초당거래대금평균(30) * 3:
    매수 = True
if 수익률 > 1 or 보유시간 > 300:  # 5분
    매도 = True
```

**분봉 데이터 전략**:
```python
# 안정적인 트렌드 추종
if 이동평균(20) > 이동평균(60) and RSI > 50:
    매수 = True
if 수익률 > 5 or 보유시간 > 240:  # 4시간
    매도 = True
```

---

## 7. 실전 활용 팁

### 7.1 분봉 데이터 최적화

1. **적절한 구간 설정**
   - 단기: 5~20분봉
   - 중기: 20~60분봉
   - 장기: 60분봉 이상

2. **보조지표 조합**
   - 추세: MACD + 이동평균
   - 모멘텀: RSI + 스토캐스틱
   - 변동성: 볼린저밴드 + ATR

3. **시간대별 전략**
   - 장초: 높은 변동성 활용
   - 장중: 안정적인 추세 추종
   - 장마감: 포지션 정리

### 7.2 백테스트 검증

1. **다양한 시장 상황 테스트**
   - 상승장, 하락장, 횡보장
   - 고변동성, 저변동성 구간

2. **최적화 매개변수 탐색**
   - 이동평균 기간
   - RSI 임계값
   - 보유시간 설정

3. **리스크 관리**
   - 손절매 설정
   - 포지션 사이징
   - 최대 보유시간 제한

---

## 8. 조건식 작성 시 주의사항 (중요)

### 8.1 용어 혼용 주의
- 분봉 백테스팅이지만 일부 변수명에 "틱"이라는 용어 사용됨
  - 예: `평균값계산틱수`, `매수틱번호`
- 이는 시스템 내부 명명 규칙이므로 그대로 사용해야 함

### 8.2 보조지표 사용법 (필수 확인)
```python
# ❌ 잘못된 사용법
if MACD_N > 0:  # 에러 발생
if MACDS(1) > 0:  # 에러 발생

# ✅ 올바른 사용법
if MACD > 0:  # 현재값
if MACD_N(1) > 0:  # 1분봉 전 값
```

### 8.3 매도 조건에서 -1 사용법
```python
# 매수 시점의 값과 현재값 비교
if 현재가 < 현재가N(-1) * 0.97:  # 매수가 대비 3% 손실
    매도 = True

# 구간연산에서도 -1 사용 가능
if 이동평균(20) < 이동평균(20, -1) * 0.95:  # 매수시점 이평선 대비 5% 하락
    매도 = True
```

### 8.4 시간 조건 작성법
```python
# ❌ 잘못된 사용법
if 시분 >= 930:  # 변수명 오류
if 시분초 >= 0930:  # 앞에 0 붙이면 8진수로 인식

# ✅ 올바른 사용법
if 시분초 >= 93000:  # 9시 30분
if 시분초 >= 93000 and 시분초 <= 150000:  # 9시 30분 ~ 15시
```

### 8.5 구간 연산 파라미터
```python
# 매수 조건: 두 번째 파라미터는 이전봉수만 가능
이동평균(60)  # 현재 기준 60분봉 이평
이동평균(60, 1)  # 1분봉 전 기준 60분봉 이평

# 매도 조건: 두 번째 파라미터에 -1 추가 가능
이동평균(60, -1)  # 매수시점 기준 60분봉 이평
체결강도평균(30, -1)  # 매수시점 기준 30분봉 체결강도 평균
```

---

## 9. 문서 활용 가이드

1. **전략 개발 순서**
   - 아이디어 도출 → 변수 선택 → 조건 작성 → 백테스트 → 최적화

2. **변수 활용법**
   - 기본 변수로 기초 조건 설정
   - 구간 연산으로 패턴 감지
   - 보조지표로 신호 확인

3. **코드 작성 팁**
   - 조건을 단계별로 분리
   - 명확한 주석 작성
   - 예외 상황 고려

4. **성능 향상**
   - 불필요한 연산 최소화
   - 조건 순서 최적화
   - 메모리 효율적 사용

---

**Last Update: 2025-01-01**

---

> **참고 문서**: 이 가이드라인은 `ui/set_text.py`의 `stock_buy_var2`와 `stock_sell_var2` 변수 정보를 기반으로 작성되었습니다. 틱 데이터 가이드라인과 함께 참고하여 다양한 시간대 전략을 개발하시기 바랍니다. 