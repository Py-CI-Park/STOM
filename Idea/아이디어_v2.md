# 아이디어 V2 - 1분봉 기반 고도화된 조건식 시스템

## 개요
Min 폴더의 기존 조건식들을 분석하여 더욱 정교하고 고도화된 1분봉 기반 조건식 시스템을 제안합니다. 기존의 단일 지표 의존성을 탈피하고 다중 지표 융합과 패턴 인식을 통한 신뢰성 높은 매매 신호를 생성합니다.

## 기존 분석 결과
기존 Min 폴더의 조건식들 분석:
- **삼중 확인 매수 조건식**: RSI, MACD, 볼린저밴드 3개 지표 조합
- **MACD 정밀 신호 체계**: MACD 라인, 시그널, 히스토그램 종합 분석
- **RSI 다층 필터링**: 5, 14, 21 기간 RSI 조합
- **볼린저밴드 전략적 활용**: 밴드 위치, 수축/확장 패턴 활용

## V2 핵심 개선사항

### 1. 1분봉 기반 하이브리드 융합 시스템
기존 단일 전략의 한계를 극복하고 복합 신호를 통한 정확도 향상

### 2. 적응형 매개변수 시스템
시장 변동성에 따른 동적 매개변수 조정

### 3. 패턴 인식 기반 신호 생성
차트 패턴과 기술적 지표의 결합

### 4. 리스크 관리 강화
다층 손절매 시스템과 포지션 사이징

---

## 새로운 1분봉 조건식들

### 1. 스칼핑 전용 1분봉 조건식 (Scalping Master)

#### 매수 조건식
```python
# 1분봉 스칼핑 전용 매수 조건식
# 초단기 모멘텀 포착과 빠른 진입/청산을 목표

# 1분봉 기술적 지표
RSI_1 = RSI(7)        # 1분봉 단기 RSI
RSI_5 = RSI(14)       # 5분봉 표준 RSI
MACD_1 = MACD(8, 17, 5)     # 1분봉 민감한 MACD
MACD_히스토그램_1 = MACDH(8, 17, 5)
BB_위치_1 = (현재가 - 볼린저하단(10, 1.5)) / (볼린저상단(10, 1.5) - 볼린저하단(10, 1.5))

# 초단기 모멘텀 지표
가격변화율_30초 = (현재가 - 현재가_N(0.5)) / 현재가_N(0.5) * 100  # 30초 변화율
체결강도_평균 = (체결강도 + 체결강도_N(1) + 체결강도_N(2)) / 3
거래량_급증 = 분당거래량 > 분당거래량평균(5) * 2.0

# 1분봉 스칼핑 조건
if not (시분 >= 930 and 시분 <= 1500):
    매수 = False
elif not (5000 < 현재가 <= 100000):  # 스칼핑 적합 가격대
    매수 = False
elif not (시가총액 >= 1000):  # 1000억원 이상 (유동성 확보)
    매수 = False

# 초단기 모멘텀 조건
elif not (가격변화율_30초 > 0.1):  # 30초간 0.1% 이상 상승
    매수 = False
elif not (RSI_1 >= 30 and RSI_1 <= 55):  # 1분봉 RSI 반등구간
    매수 = False
elif not (MACD_히스토그램_1 > 0):  # 1분봉 MACD 양수
    매수 = False
elif not (BB_위치_1 >= 0.2 and BB_위치_1 <= 0.6):  # 볼린저밴드 적정구간
    매수 = False

# 거래량 및 체결강도 조건
elif not 거래량_급증:  # 거래량 급증 필수
    매수 = False
elif not (체결강도_평균 >= 120):  # 강한 매수 우세
    매수 = False
elif not (현재가 > 고가_N(1)):  # 전 분봉 고가 돌파
    매수 = False

# 스칼핑 특화 조건
elif not (분당거래대금 >= 10억):  # 최소 거래대금 확보
    매수 = False
elif not (호가스프레드율 <= 0.3):  # 낮은 스프레드
    매수 = False
elif not (매수호가잔량1 > 매도호가잔량1 * 1.2):  # 매수 우세
    매수 = False

else:
    매수 = True

# 스칼핑 리스크 관리
if 매수:
    매수수량 = min(매수가능금액 * 0.1, 최대단위수 * 50)  # 소량 분할 매수
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

#### 매도 조건식
```python
# 1분봉 스칼핑 매도 (빠른 이익실현과 손절)

# 빠른 이익실현
if 수익률 >= 0.8:  # 0.8% 이익실현
    매도 = True
elif 수익률 <= -0.4:  # 0.4% 손절
    매도 = True

# 모멘텀 소실 매도
elif 가격변화율_30초 < -0.1:  # 30초간 하락전환
    매도 = True
elif RSI_1 > 70:  # 1분봉 과매수
    매도 = True
elif 체결강도 < 95:  # 매수세 약화
    매도 = True

# 시간 기반 매도
elif 보유시간 >= 3:  # 3분 이상 보유시 매도
    매도 = True

# 호가창 변화 매도
elif 매도호가잔량1 > 매수호가잔량1 * 1.5:  # 매도 우세 전환
    매도 = True

else:
    매도 = False

if 매도:
    self.Sell(종목코드, 종목명, 보유수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 2. 인공지능 패턴 인식 조건식 (AI Pattern Recognition)

#### 매수 조건식
```python
# AI 패턴 인식 기반 1분봉 매수 조건식
# 머신러닝 로직을 모방한 패턴 스코어링 시스템

# 패턴 점수 계산 함수들
def 상승패턴점수():
    점수 = 0
    
    # 1. 연속 상승 패턴
    if 현재가 > 현재가_N(1) > 현재가_N(2):
        점수 += 15
    
    # 2. 지지선 반등 패턴
    if 현재가 > 최저분봉저가(5) * 1.02:
        점수 += 10
    
    # 3. 거래량 증가 패턴
    if 분당거래량 > 분당거래량평균(10) * 1.5:
        점수 += 20
    
    # 4. 기술적 지표 정렬 패턴
    if RSI(14) > RSI_N(14, 1) and MACD > MACD_N(1):
        점수 += 25
    
    # 5. 이동평균선 돌파 패턴
    이평5 = 이동평균(5)
    이평20 = 이동평균(20)
    if 현재가 > 이평5 > 이평20:
        점수 += 20
    
    # 6. 볼린저밴드 스퀴즈 후 확장 패턴
    BB_폭 = 볼린저상단(20, 2) - 볼린저하단(20, 2)
    BB_폭_이전 = 볼린저상단_N(20, 2, 5) - 볼린저하단_N(20, 2, 5)
    if BB_폭 > BB_폭_이전 * 1.1:
        점수 += 15
    
    return 점수

def 매수신호강도():
    강도 = 0
    
    # 기술적 지표 강도
    if 30 <= RSI(14) <= 60:
        강도 += 10
    if MACDH > 0 and MACDH > MACDH_N(1):
        강도 += 15
    if Stoch_K(14, 3) > Stoch_D(14, 3):
        강도 += 10
    
    # 거래 활동 강도
    if 체결강도 > 110:
        강도 += 20
    if 분당매수량 > 분당매도량 * 1.3:
        강도 += 15
    
    # 가격 움직임 강도
    if 현재가 > 시가 * 1.01:
        강도 += 10
    if 등락율 > 1.0:
        강도 += 10
    
    return 강도

# AI 패턴 인식 메인 로직
패턴점수 = 상승패턴점수()
신호강도 = 매수신호강도()
종합점수 = 패턴점수 + 신호강도

# 기본 조건 확인
if not (시분 >= 930 and 시분 <= 1500):
    매수 = False
elif not (3000 < 현재가 <= 200000):
    매수 = False
elif not (시가총액 >= 500):
    매수 = False

# AI 점수 기반 매수 결정
elif 종합점수 >= 85:  # 고신뢰도 신호
    매수 = True
    매수수량 = 매수가능금액 * 0.3  # 적극적 매수
elif 종합점수 >= 70:  # 중신뢰도 신호
    매수 = True
    매수수량 = 매수가능금액 * 0.2  # 보통 매수
elif 종합점수 >= 55:  # 저신뢰도 신호
    매수 = True
    매수수량 = 매수가능금액 * 0.1  # 소량 매수
else:
    매수 = False

if 매수:
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 3. 멀티타임프레임 융합 조건식 (Multi-Timeframe Fusion)

#### 매수 조건식
```python
# 멀티타임프레임 융합 1분봉 조건식
# 1분, 5분, 15분봉 신호를 종합하여 매수 결정

# 1분봉 신호
RSI_1분 = RSI(14)
MACD_1분 = MACD
BB_위치_1분 = (현재가 - 볼린저하단(20, 2)) / (볼린저상단(20, 2) - 볼린저하단(20, 2))

# 5분봉 신호 (5분봉 데이터 시뮬레이션)
RSI_5분 = RSI(70)    # 5분봉 RSI 근사치 (14*5)
MACD_5분 = MACD(60, 130, 45)  # 5분봉 MACD 근사치

# 15분봉 신호 (15분봉 데이터 시뮬레이션)
이평_15분_단기 = 이동평균(75)   # 15분봉 5이평 근사치
이평_15분_장기 = 이동평균(300)  # 15분봉 20이평 근사치

# 타임프레임별 신호 점수
def 타임프레임_점수():
    점수_1분 = 0
    점수_5분 = 0
    점수_15분 = 0
    
    # 1분봉 신호 점수
    if 30 <= RSI_1분 <= 65:
        점수_1분 += 20
    if MACD > MACDS and MACDH > 0:
        점수_1분 += 25
    if 0.2 <= BB_위치_1분 <= 0.7:
        점수_1분 += 15
    if 분당거래량 > 분당거래량평균(20) * 1.5:
        점수_1분 += 15
    if 체결강도 > 105:
        점수_1분 += 10
    
    # 5분봉 신호 점수
    if 35 <= RSI_5분 <= 70:
        점수_5분 += 25
    if MACD_5분 > 0:
        점수_5분 += 20
    if 현재가 > 이동평균(25):  # 5분봉 5이평 근사
        점수_5분 += 20
    
    # 15분봉 신호 점수
    if 이평_15분_단기 > 이평_15분_장기:
        점수_15분 += 30
    if 현재가 > 이평_15분_단기:
        점수_15분 += 25
    if 등락율 > 0.5:
        점수_15분 += 20
    
    return 점수_1분, 점수_5분, 점수_15분

# 융합 신호 계산
점수1, 점수5, 점수15 = 타임프레임_점수()
가중점수 = (점수1 * 0.4) + (점수5 * 0.35) + (점수15 * 0.25)  # 가중평균

# 기본 조건
if not (시분 >= 930 and 시분 <= 1500):
    매수 = False
elif not (2000 < 현재가 <= 150000):
    매수 = False
elif not (시가총액 >= 300):
    매수 = False

# 멀티타임프레임 조건
elif not (점수1 >= 50):  # 1분봉 기본 점수 확보
    매수 = False
elif not (점수5 >= 40):  # 5분봉 기본 점수 확보
    매수 = False
elif not (점수15 >= 30):  # 15분봉 기본 점수 확보
    매수 = False
elif not (가중점수 >= 55):  # 융합 점수 기준
    매수 = False

# 추가 안전장치
elif not (회전율 > 0.3):
    매수 = False
elif 라운드피겨위5호가이내:
    매수 = False

else:
    매수 = True

if 매수:
    # 신호 강도에 따른 포지션 사이징
    if 가중점수 >= 75:
        매수수량 = 매수가능금액 * 0.4
    elif 가중점수 >= 65:
        매수수량 = 매수가능금액 * 0.3
    else:
        매수수량 = 매수가능금액 * 0.2
    
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 4. 볼륨 프로파일 기반 조건식 (Volume Profile Strategy)

#### 매수 조건식
```python
# 볼륨 프로파일 기반 1분봉 매수 조건식
# 거래량 분포와 가격대별 매매 심리를 분석

# 볼륨 프로파일 변수
def 볼륨프로파일_분석():
    # 최근 20분간 가격대별 거래량 분석
    거래량_분포 = {}
    
    for i in range(20):
        가격 = int(현재가_N(i) / 100) * 100  # 100원 단위로 그룹화
        거래량 = 분당거래량_N(i)
        
        if 가격 in 거래량_분포:
            거래량_분포[가격] += 거래량
        else:
            거래량_분포[가격] = 거래량
    
    # 최대 거래량 가격대 (POC: Point of Control)
    POC_가격 = max(거래량_분포, key=거래량_분포.get)
    POC_거래량 = 거래량_분포[POC_가격]
    
    # 현재가와 POC의 관계
    POC_거리율 = abs(현재가 - POC_가격) / 현재가 * 100
    
    return POC_가격, POC_거래량, POC_거리율

# 매수 압력 분석
def 매수압력_분석():
    압력점수 = 0
    
    # 호가창 분석
    매수호가_총량 = sum([매수호가잔량1, 매수호가잔량2, 매수호가잔량3, 매수호가잔량4, 매수호가잔량5])
    매도호가_총량 = sum([매도호가잔량1, 매도호가잔량2, 매도호가잔량3, 매도호가잔량4, 매도호가잔량5])
    
    호가비율 = 매수호가_총량 / (매도호가_총량 + 1)
    
    if 호가비율 > 1.2:
        압력점수 += 20
    elif 호가비율 > 1.0:
        압력점수 += 10
    
    # 체결 분석
    if 분당매수량 > 분당매도량 * 1.3:
        압력점수 += 25
    elif 분당매수량 > 분당매도량:
        압력점수 += 15
    
    # 연속 체결 분석
    연속상승 = 0
    for i in range(5):
        if 현재가_N(i) > 현재가_N(i+1):
            연속상승 += 1
        else:
            break
    
    압력점수 += 연속상승 * 5
    
    return 압력점수

# 볼륨 프로파일 메인 로직
POC_가격, POC_거래량, POC_거리율 = 볼륨프로파일_분석()
매수압력점수 = 매수압력_분석()

# 기본 조건
if not (시분 >= 930 and 시분 <= 1500):
    매수 = False
elif not (1000 < 현재가 <= 80000):
    매수 = False
elif not (시가총액 >= 200):
    매수 = False

# 볼륨 프로파일 조건
elif not (POC_거리율 <= 2.0):  # POC 근처 2% 이내
    매수 = False
elif not (현재가 >= POC_가격 * 0.998):  # POC 근처에서 상승
    매수 = False
elif not (분당거래량 > POC_거래량 * 0.8):  # POC 수준 거래량
    매수 = False

# 매수 압력 조건
elif not (매수압력점수 >= 40):  # 충분한 매수 압력
    매수 = False
elif not (체결강도 >= 105):
    매수 = False

# 기술적 지표 보조 조건
elif not (RSI(14) >= 40 and RSI(14) <= 70):
    매수 = False
elif not (MACDH > 0):
    매수 = False

# 리스크 관리
elif not (등락율 <= 20.0):  # 급등주 제외
    매수 = False
elif not (회전율 >= 0.5):  # 활발한 거래
    매수 = False

else:
    매수 = True

if 매수:
    # 볼륨 프로파일 신뢰도에 따른 포지션 사이징
    if POC_거리율 <= 0.5 and 매수압력점수 >= 60:
        매수수량 = 매수가능금액 * 0.4  # 고신뢰도
    elif POC_거리율 <= 1.0 and 매수압력점수 >= 50:
        매수수량 = 매수가능금액 * 0.3  # 중신뢰도
    else:
        매수수량 = 매수가능금액 * 0.2  # 저신뢰도
    
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

### 5. 적응형 변동성 돌파 조건식 (Adaptive Volatility Breakout)

#### 매수 조건식
```python
# 적응형 변동성 돌파 1분봉 조건식
# 시장 변동성에 따라 돌파 기준을 동적으로 조정

# 변동성 계산
def 변동성_계산():
    # ATR (Average True Range) 계산
    TR_리스트 = []
    for i in range(1, 15):  # 14일 ATR
        고가 = 고가_N(i)
        저가 = 저가_N(i)
        전일종가 = 현재가_N(i+1)
        
        TR = max(고가 - 저가, abs(고가 - 전일종가), abs(저가 - 전일종가))
        TR_리스트.append(TR)
    
    ATR = sum(TR_리스트) / len(TR_리스트)
    ATR_비율 = ATR / 현재가 * 100  # ATR을 %로 변환
    
    # 변동성 레벨 결정
    if ATR_비율 >= 3.0:
        변동성레벨 = "HIGH"
    elif ATR_비율 >= 1.5:
        변동성레벨 = "MEDIUM"
    else:
        변동성레벨 = "LOW"
    
    return ATR, ATR_비율, 변동성레벨

# 적응형 돌파 기준 설정
def 돌파기준_설정(변동성레벨):
    if 변동성레벨 == "HIGH":
        # 고변동성: 높은 돌파 기준
        저항선배수 = 1.015  # 1.5%
        거래량배수 = 2.5
        체결강도기준 = 130
    elif 변동성레벨 == "MEDIUM":
        # 중변동성: 보통 돌파 기준
        저항선배수 = 1.01   # 1.0%
        거래량배수 = 2.0
        체결강도기준 = 115
    else:
        # 저변동성: 낮은 돌파 기준
        저항선배수 = 1.005  # 0.5%
        거래량배수 = 1.5
        체결강도기준 = 105
    
    return 저항선배수, 거래량배수, 체결강도기준

# 저항선 계산
def 저항선_계산():
    # 최근 20분간 고가 중 상위 3개의 평균
    고가_리스트 = [고가_N(i) for i in range(20)]
    고가_리스트.sort(reverse=True)
    상위저항선 = sum(고가_리스트[:3]) / 3
    
    # 최근 5분간 최고가
    단기저항선 = max([고가_N(i) for i in range(5)])
    
    return 상위저항선, 단기저항선

# 적응형 돌파 메인 로직
ATR, ATR_비율, 변동성레벨 = 변동성_계산()
저항선배수, 거래량배수, 체결강도기준 = 돌파기준_설정(변동성레벨)
상위저항선, 단기저항선 = 저항선_계산()

# 기본 조건
if not (시분 >= 930 and 시분 <= 1500):
    매수 = False
elif not (5000 < 현재가 <= 200000):
    매수 = False
elif not (시가총액 >= 1000):
    매수 = False

# 적응형 돌파 조건
elif not (현재가 > 단기저항선 * 저항선배수):  # 저항선 돌파
    매수 = False
elif not (분당거래량 > 분당거래량평균(20) * 거래량배수):  # 거래량 급증
    매수 = False
elif not (체결강도 >= 체결강도기준):  # 강한 매수세
    매수 = False

# 변동성별 추가 조건
if 변동성레벨 == "HIGH":
    # 고변동성에서는 더 엄격한 조건
    if not (RSI(14) >= 50 and RSI(14) <= 75):
        매수 = False
    elif not (MACD > MACDS * 1.05):  # MACD 확실한 우위
        매수 = False
    elif not (현재가 > 이동평균(10) * 1.02):  # 이평선 확실한 상승
        매수 = False

elif 변동성레벨 == "MEDIUM":
    # 중변동성에서는 표준 조건
    if not (RSI(14) >= 45 and RSI(14) <= 70):
        매수 = False
    elif not (MACD > MACDS):
        매수 = False
    elif not (현재가 > 이동평균(20)):
        매수 = False

else:  # LOW 변동성
    # 저변동성에서는 완화된 조건
    if not (RSI(14) >= 40 and RSI(14) <= 65):
        매수 = False
    elif not (MACDH > 0):  # MACD 히스토그램만 확인
        매수 = False

# 리스크 관리
elif not (등락율 <= 25.0):
    매수 = False
elif not (분당거래대금 >= 5억):
    매수 = False

else:
    매수 = True

if 매수:
    # 변동성 레벨에 따른 포지션 사이징
    if 변동성레벨 == "HIGH":
        매수수량 = 매수가능금액 * 0.15  # 고변동성: 소량
    elif 변동성레벨 == "MEDIUM":
        매수수량 = 매수가능금액 * 0.25  # 중변동성: 보통
    else:
        매수수량 = 매수가능금액 * 0.35  # 저변동성: 적극적
    
    self.Buy(종목코드, 종목명, 매수수량, 현재가, 매도호가1, 매수호가1, 데이터길이)
```

---

## V2 시스템 통합 전략

### 1. 조건식 우선순위 시스템
```python
# 조건식 우선순위 및 신뢰도 기반 실행 시스템

조건식_신뢰도 = {
    "멀티타임프레임_융합": 0.85,
    "AI_패턴_인식": 0.80,
    "적응형_변동성_돌파": 0.75,
    "볼륨_프로파일": 0.70,
    "스칼핑_전용": 0.65
}

# 복수 조건식 동시 신호시 가중 평균으로 최종 결정
def 통합_매수_결정():
    신호_점수 = 0
    총_가중치 = 0
    
    for 조건식, 신뢰도 in 조건식_신뢰도.items():
        if 조건식_신호(조건식):  # 해당 조건식이 매수 신호
            신호_점수 += 신뢰도
            총_가중치 += 신뢰도
    
    if 총_가중치 == 0:
        return False
    
    최종_신뢰도 = 신호_점수 / 총_가중치
    
    return 최종_신뢰도 >= 0.75  # 75% 이상 신뢰도시 매수
```

### 2. 동적 리스크 관리
```python
# 시장 상황에 따른 동적 리스크 관리

def 시장상황_분석():
    코스피_변화율 = (코스피지수 - 코스피지수_N(1)) / 코스피지수_N(1) * 100
    코스닥_변화율 = (코스닥지수 - 코스닥지수_N(1)) / 코스닥지수_N(1) * 100
    
    if 코스피_변화율 > 1.0 and 코스닥_변화율 > 1.5:
        return "강세장"
    elif 코스피_변화율 < -1.0 and 코스닥_변화율 < -1.5:
        return "약세장"
    else:
        return "보합장"

# 시장 상황별 포지션 사이징
시장상황 = 시장상황_분석()

if 시장상황 == "강세장":
    최대_포지션_비율 = 0.4  # 적극적
    손절_기준 = -3.0
elif 시장상황 == "약세장":
    최대_포지션_비율 = 0.15  # 보수적
    손절_기준 = -1.5
else:
    최대_포지션_비율 = 0.25  # 표준
    손절_기준 = -2.0
```

### 3. 성과 추적 및 학습 시스템
```python
# 조건식별 성과 추적 및 피드백 시스템

조건식_성과 = {
    "멀티타임프레임_융합": {"승률": 0, "평균수익률": 0, "거래횟수": 0},
    "AI_패턴_인식": {"승률": 0, "평균수익률": 0, "거래횟수": 0},
    # ... 다른 조건식들
}

def 성과_업데이트(조건식명, 수익률):
    조건식_성과[조건식명]["거래횟수"] += 1
    
    if 수익률 > 0:
        조건식_성과[조건식명]["승률"] += 1
    
    # 평균 수익률 업데이트 (이동평균)
    이전_평균 = 조건식_성과[조건식명]["평균수익률"]
    거래횟수 = 조건식_성과[조건식명]["거래횟수"]
    
    새_평균 = (이전_평균 * (거래횟수-1) + 수익률) / 거래횟수
    조건식_성과[조건식명]["평균수익률"] = 새_평균
    
    # 신뢰도 재계산
    승률 = 조건식_성과[조건식명]["승률"] / 거래횟수
    조건식_신뢰도[조건식명] = (승률 * 0.6) + (min(새_평균/5, 0.4))  # 승률 60%, 수익률 40% 반영
```

---

## 결론

V2 시스템은 기존 Min 폴더 조건식들의 장점을 흡수하고 1분봉 특성에 최적화된 새로운 조건식들을 추가하여 다음과 같은 개선을 제공합니다:

1. **정확도 향상**: 다중 지표 융합과 패턴 인식을 통한 신호 정확도 향상
2. **적응성 강화**: 시장 변동성과 상황에 따른 동적 매개변수 조정
3. **리스크 관리**: 다층 리스크 관리 시스템으로 안전성 확보
4. **학습 능력**: 성과 추적을 통한 지속적인 시스템 개선
5. **1분봉 최적화**: 초단기 매매에 특화된 신호 생성 및 실행

이 V2 시스템을 통해 기존 대비 더욱 정교하고 신뢰성 높은 1분봉 자동매매가 가능할 것으로 기대됩니다. 